const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-N872kxM8.js","assets/react-9j9_jfRo.js"])))=>i.map(i=>d[i]);
import{j as e,E as ye,a as we,m as jt,H as kr,B as Me,M as is,U as Ae,R as Os,X as ue,b as Sr,C as Cr,L as Tr,c as Pr,D as Xe,A as Be,d as Ca,F as Oe,S as $t,e as me,f as Ta,g as Mr,P as ze,h as Pa,i as At,k as je,l as Zt,n as ws,o as zs,T as Xs,V as Ns,p as He,q as os,r as Se,s as Or,t as Ft,u as Re,I as es,v as Ds,w as dt,x as ts,y as Ls,z as Nt,G as qe,J as ot,K as Ma,N as Ue,O as Fe,Q as Es,W as Ot,Y as Oa,Z as za,_ as Da,$ as La,a0 as $s,a1 as Is,a2 as Rs,a3 as $a,a4 as As,a5 as Ze,a6 as zt,a7 as Ia,a8 as zr,a9 as Ra,aa as Ua,ab as Us,ac as Ws,ad as Wa,ae as Dr,af as Lr,ag as qa,ah as qs,ai as Ba,aj as Ha,ak as Va,al as bt,am as Zs,an as et,ao as Ga,ap as $r,aq as Ir,ar as Rr,as as Ur,at as Ya}from"./ui-DSV1l2TU.js";import{a as Ja,u as de,r as m,g as Qa,c as ke,b as Ka,B as Xa,R as er,d as fe,N as Te}from"./react-9j9_jfRo.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var Wr,tr=Ja;Wr=tr.createRoot,tr.hydrateRoot;const nt={backgrounds:{main:"https://souqpale.com/wp-content/uploads/2025/03/c6a88587-52e0-40e0-bc99-c71f3c739318.jpg",pattern:'data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M54.627 0l.83.828-1.415 1.415L51.8 0h2.827zM5.373 0l-.83.828L5.96 2.243 8.2 0H5.374zM48.97 0l3.657 3.657-1.414 1.414L46.143 0h2.828zM11.03 0L7.372 3.657 8.787 5.07 13.857 0H11.03zm32.284 0L49.8 6.485 48.384 7.9l-7.9-7.9h2.83zM16.686 0L10.2 6.485 11.616 7.9l7.9-7.9h-2.83zM22.344 0L13.858 8.485 15.272 9.9l9.9-9.9h-2.828zM32 0l-9.9 9.9 1.414 1.414L33.414 1.414 32 0zm-3.172 0L19.757 9.071l1.415 1.414L31.243 0h-2.415zm-5.656 0L14.343 8.828l1.415 1.415L25.586 0h-2.415zm-5.656 0L8.687 8.828 10.1 10.243 20.93 0h-3.414zM28.828 0L27.414 1.414 33.414 7.414V0h-4.586zm-9.656 0L17.757 1.414 23.757 7.414V0h-4.585zm-9.657 0L8.1 1.414l6 6V0H9.516zM0 0c0 .828.635 1.5 1.414 1.5.793 0 1.414-.672 1.414-1.5H0zm0 4.172l4.172 4.172 1.415-1.415L1.414 2.757 0 4.172zm0 5.656l9.828 9.828 1.414-1.414L1.414 8.414 0 9.828zm0 5.656l14.485 14.485 1.414-1.414L1.414 14.07 0 15.485zm0 5.657l19.142 19.142 1.414-1.414L1.414 19.728 0 21.142zm0 5.657l23.8 23.8 1.414-1.414L1.414 25.385 0 26.8zm0 5.657l28.456 28.457 1.414-1.414L1.414 31.042 0 32.456zm0 5.657l33.113 33.114 1.414-1.414L1.414 36.7 0 38.113zm0 5.657l37.77 37.77 1.415-1.414L1.414 42.356 0 43.77zm0 5.657l42.427 42.428 1.414-1.414L1.414 48.013 0 49.427zm0 5.657l47.084 47.085 1.414-1.414L1.414 53.67 0 55.084zm0 5.657l51.741 51.741 1.414-1.414L1.414 59.327 0 60.741zm0 5.657l56.398 56.398 1.414-1.414L1.414 65.084 0 66.498zm60.741 0L0 5.757 1.414 4.343 60.74 63.67l-1.414 1.414z" fill="%23ffffff" fill-opacity="0.4" fill-rule="evenodd"/%3E%3C/svg%3E',overlay:"linear-gradient(to bottom right, rgba(10, 15, 28, 0.95), rgba(26, 31, 46, 0.95))"},icons:{foodProgram:"https://souqpale.com/wp-content/uploads/2025/03/2-1.png",weightScale:"https://souqpale.com/wp-content/uploads/2025/03/5.png",exerciseProgram:"https://souqpale.com/wp-content/uploads/2025/03/1-1.png",profile:"https://souqpale.com/wp-content/uploads/2025/03/3-1.png"}};function Za({onRegister:a,onSuccess:t}){const s=de(),[r,n]=m.useState(""),[i,l]=m.useState(""),[o,c]=m.useState(!1),[d,u]=m.useState(!1),[x,g]=m.useState(null),[b,p]=m.useState(!1);m.useEffect(()=>{const f=localStorage.getItem("savedAdminEmail"),N=localStorage.getItem("savedAdminPassword");f&&N&&(n(f),l(N),p(!0))},[]);const v=async f=>{f.preventDefault(),u(!0),g(null);try{const N={email:"mk@powerhouse.com",password:"Admin@123"};r===N.email&&i===N.password?(b?(localStorage.setItem("savedAdminEmail",r),localStorage.setItem("savedAdminPassword",i)):(localStorage.removeItem("savedAdminEmail"),localStorage.removeItem("savedAdminPassword")),localStorage.setItem("userType","admin"),s("/admin"),t()):g("البريد الإلكتروني أو كلمة المرور غير صحيحة")}catch(N){g("حدث خطأ أثناء تسجيل الدخول"),console.error("Login error:",N)}finally{u(!1)}},h=()=>{s("/reset-password")};return e.jsxs("div",{dir:"rtl",className:"min-h-screen text-white flex items-center justify-center pt-0 mt-0",children:[e.jsx("div",{className:"fixed inset-0 z-0",style:{backgroundImage:`url("${nt.backgrounds.main}")`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),e.jsxs("div",{className:"relative z-10 w-full max-w-md mx-auto px-6 -mt-10",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("img",{src:"https://souqpale.com/wp-content/uploads/2025/03/تصميم-بدون-عنوان-9.png",alt:"Logo",className:"h-24 w-auto"})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-1",children:"مرحباً بك"}),e.jsx("p",{className:"text-gray-400",children:"مرحباً بك في لوحة تحكم المدربين"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[x&&e.jsx("div",{className:"bg-red-500/10 border border-red-500 text-red-500 p-4 rounded-xl text-center",children:x}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"البريد الإلكتروني:"}),e.jsx("input",{type:"email",value:r,onChange:f=>n(f.target.value),className:"w-full bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-4 focus:outline-none focus:border-[#0AE7F2]",placeholder:"example@email.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"كلمة السر:"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",value:i,onChange:f=>l(f.target.value),className:"w-full bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-4 pr-12 focus:outline-none focus:border-[#0AE7F2]",placeholder:"••••••••",required:!0}),e.jsx("button",{type:"button",onClick:()=>c(!o),className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",children:o?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]}),e.jsx("button",{type:"button",onClick:h,className:"text-[#0AE7F2] text-sm mt-1 hover:underline",children:"نسيت كلمة المرور؟"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"rememberMe",checked:b,onChange:f=>p(f.target.checked),className:"w-4 h-4 rounded border-[#0AE7F2]/20 bg-[#1A1F2E]/60 text-[#0AE7F2] focus:ring-[#0AE7F2] focus:ring-offset-0"}),e.jsx("label",{htmlFor:"rememberMe",className:"text-sm text-gray-400",children:"تذكرني"})]}),e.jsx("button",{type:"submit",disabled:d,className:"w-full bg-[#0AE7F2] text-black py-4 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[#0AE7F2]/90 transition-colors",children:d?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"جاري تسجيل الدخول..."})]}):"تسجيل الدخول!"})]})]})]})}const en="modulepreload",tn=function(a){return"/"+a},sr={},lt=function(t,s,r){let n=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),o=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=Promise.allSettled(s.map(c=>{if(c=tn(c),c in sr)return;sr[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const x=document.createElement("link");if(x.rel=d?"stylesheet":en,d||(x.as="script"),x.crossOrigin="",x.href=c,o&&x.setAttribute("nonce",o),document.head.appendChild(x),d)return new Promise((g,b)=>{x.addEventListener("load",g),x.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return n.then(l=>{for(const o of l||[])o.status==="rejected"&&i(o.reason);return t().catch(i)})},sn=a=>{let t;return a?t=a:typeof fetch>"u"?t=(...s)=>lt(async()=>{const{default:r}=await Promise.resolve().then(()=>_t);return{default:r}},void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)};class Bs extends Error{constructor(t,s="FunctionsError",r){super(t),this.name=s,this.context=r}}class rn extends Bs{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class an extends Bs{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class nn extends Bs{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Fs;(function(a){a.Any="any",a.ApNortheast1="ap-northeast-1",a.ApNortheast2="ap-northeast-2",a.ApSouth1="ap-south-1",a.ApSoutheast1="ap-southeast-1",a.ApSoutheast2="ap-southeast-2",a.CaCentral1="ca-central-1",a.EuCentral1="eu-central-1",a.EuWest1="eu-west-1",a.EuWest2="eu-west-2",a.EuWest3="eu-west-3",a.SaEast1="sa-east-1",a.UsEast1="us-east-1",a.UsWest1="us-west-1",a.UsWest2="us-west-2"})(Fs||(Fs={}));var on=function(a,t,s,r){function n(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(r.next(u))}catch(x){l(x)}}function c(u){try{d(r.throw(u))}catch(x){l(x)}}function d(u){u.done?i(u.value):n(u.value).then(o,c)}d((r=r.apply(a,t||[])).next())})};class ln{constructor(t,{headers:s={},customFetch:r,region:n=Fs.Any}={}){this.url=t,this.headers=s,this.region=n,this.fetch=sn(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,s={}){var r;return on(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:l}=s;let o={},{region:c}=s;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let d;l&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",d=l):typeof l=="string"?(o["Content-Type"]="text/plain",d=l):typeof FormData<"u"&&l instanceof FormData?d=l:(o["Content-Type"]="application/json",d=JSON.stringify(l)));const u=yield this.fetch(`${this.url}/${t}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),n),body:d}).catch(p=>{throw new rn(p)}),x=u.headers.get("x-relay-error");if(x&&x==="true")throw new an(u);if(!u.ok)throw new nn(u);let g=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),b;return g==="application/json"?b=yield u.json():g==="application/octet-stream"?b=yield u.blob():g==="text/event-stream"?b=u:g==="multipart/form-data"?b=yield u.formData():b=yield u.text(),{data:b,error:null}}catch(n){return{data:null,error:n}}})}}var Ee={},Hs={},ls={},It={},cs={},ds={},cn=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Et=cn();const dn=Et.fetch,qr=Et.fetch.bind(Et),Br=Et.Headers,un=Et.Request,hn=Et.Response,_t=Object.freeze(Object.defineProperty({__proto__:null,Headers:Br,Request:un,Response:hn,default:qr,fetch:dn},Symbol.toStringTag,{value:"Module"})),mn=Qa(_t);var us={};Object.defineProperty(us,"__esModule",{value:!0});let xn=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};us.default=xn;var Hr=ke&&ke.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(ds,"__esModule",{value:!0});const fn=Hr(mn),pn=Hr(us);let gn=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=fn.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,s){return this.headers=Object.assign({},this.headers),this.headers[t]=s,this}then(t,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var l,o,c;let d=null,u=null,x=null,g=i.status,b=i.statusText;if(i.ok){if(this.method!=="HEAD"){const f=await i.text();f===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=f:u=JSON.parse(f))}const v=(l=this.headers.Prefer)===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),h=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");v&&h&&h.length>1&&(x=parseInt(h[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(d={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,x=null,g=406,b="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const v=await i.text();try{d=JSON.parse(v),Array.isArray(d)&&i.status===404&&(u=[],d=null,g=200,b="OK")}catch{i.status===404&&v===""?(g=204,b="No Content"):d={message:v}}if(d&&this.isMaybeSingle&&(!((c=d==null?void 0:d.details)===null||c===void 0)&&c.includes("0 rows"))&&(d=null,g=200,b="OK"),d&&this.shouldThrowOnError)throw new pn.default(d)}return{error:d,data:u,count:x,status:g,statusText:b}});return this.shouldThrowOnError||(n=n.catch(i=>{var l,o,c;return{error:{message:`${(l=i==null?void 0:i.name)!==null&&l!==void 0?l:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(t,s)}returns(){return this}overrideTypes(){return this}};ds.default=gn;var bn=ke&&ke.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(cs,"__esModule",{value:!0});const vn=bn(ds);let jn=class extends vn.default{select(t){let s=!1;const r=(t??"*").split("").map(n=>/\s/.test(n)&&!s?"":(n==='"'&&(s=!s),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:s=!0,nullsFirst:r,foreignTable:n,referencedTable:i=n}={}){const l=i?`${i}.order`:"order",o=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${o?`${o},`:""}${t}.${s?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:s,referencedTable:r=s}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${t}`),this}range(t,s,{foreignTable:r,referencedTable:n=r}={}){const i=typeof n>"u"?"offset":`${n}.offset`,l=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(l,`${s-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:s=!1,settings:r=!1,buffers:n=!1,wal:i=!1,format:l="text"}={}){var o;const c=[t?"analyze":null,s?"verbose":null,r?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${d}"; options=${c};`,l==="json"?this:this}rollback(){var t;return((t=this.headers.Prefer)!==null&&t!==void 0?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};cs.default=jn;var yn=ke&&ke.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(It,"__esModule",{value:!0});const wn=yn(cs);let Nn=class extends wn.default{eq(t,s){return this.url.searchParams.append(t,`eq.${s}`),this}neq(t,s){return this.url.searchParams.append(t,`neq.${s}`),this}gt(t,s){return this.url.searchParams.append(t,`gt.${s}`),this}gte(t,s){return this.url.searchParams.append(t,`gte.${s}`),this}lt(t,s){return this.url.searchParams.append(t,`lt.${s}`),this}lte(t,s){return this.url.searchParams.append(t,`lte.${s}`),this}like(t,s){return this.url.searchParams.append(t,`like.${s}`),this}likeAllOf(t,s){return this.url.searchParams.append(t,`like(all).{${s.join(",")}}`),this}likeAnyOf(t,s){return this.url.searchParams.append(t,`like(any).{${s.join(",")}}`),this}ilike(t,s){return this.url.searchParams.append(t,`ilike.${s}`),this}ilikeAllOf(t,s){return this.url.searchParams.append(t,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(t,s){return this.url.searchParams.append(t,`ilike(any).{${s.join(",")}}`),this}is(t,s){return this.url.searchParams.append(t,`is.${s}`),this}in(t,s){const r=Array.from(new Set(s)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}contains(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cs.{${s.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(s)}`),this}containedBy(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cd.{${s.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(s)}`),this}rangeGt(t,s){return this.url.searchParams.append(t,`sr.${s}`),this}rangeGte(t,s){return this.url.searchParams.append(t,`nxl.${s}`),this}rangeLt(t,s){return this.url.searchParams.append(t,`sl.${s}`),this}rangeLte(t,s){return this.url.searchParams.append(t,`nxr.${s}`),this}rangeAdjacent(t,s){return this.url.searchParams.append(t,`adj.${s}`),this}overlaps(t,s){return typeof s=="string"?this.url.searchParams.append(t,`ov.${s}`):this.url.searchParams.append(t,`ov.{${s.join(",")}}`),this}textSearch(t,s,{config:r,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const l=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${i}fts${l}.${s}`),this}match(t){return Object.entries(t).forEach(([s,r])=>{this.url.searchParams.append(s,`eq.${r}`)}),this}not(t,s,r){return this.url.searchParams.append(t,`not.${s}.${r}`),this}or(t,{foreignTable:s,referencedTable:r=s}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${t})`),this}filter(t,s,r){return this.url.searchParams.append(t,`${s}.${r}`),this}};It.default=Nn;var En=ke&&ke.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(ls,"__esModule",{value:!0});const St=En(It);let An=class{constructor(t,{headers:s={},schema:r,fetch:n}){this.url=t,this.headers=s,this.schema=r,this.fetch=n}select(t,{head:s=!1,count:r}={}){const n=s?"HEAD":"GET";let i=!1;const l=(t??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",l),r&&(this.headers.Prefer=`count=${r}`),new St.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:s,defaultToNull:r=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),s&&i.push(`count=${s}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(t)){const l=t.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(l.length>0){const o=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new St.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:s,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){const l="POST",o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&o.push(this.headers.Prefer),n&&o.push(`count=${n}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new St.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:s}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),s&&n.push(`count=${s}`),this.headers.Prefer=n.join(","),new St.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const s="DELETE",r=[];return t&&r.push(`count=${t}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new St.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};ls.default=An;var hs={},ms={};Object.defineProperty(ms,"__esModule",{value:!0});ms.version=void 0;ms.version="0.0.0-automated";Object.defineProperty(hs,"__esModule",{value:!0});hs.DEFAULT_HEADERS=void 0;const Fn=ms;hs.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Fn.version}`};var Vr=ke&&ke.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Hs,"__esModule",{value:!0});const _n=Vr(ls),kn=Vr(It),Sn=hs;let Cn=class Gr{constructor(t,{headers:s={},schema:r,fetch:n}={}){this.url=t,this.headers=Object.assign(Object.assign({},Sn.DEFAULT_HEADERS),s),this.schemaName=r,this.fetch=n}from(t){const s=new URL(`${this.url}/${t}`);return new _n.default(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new Gr(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:r=!1,get:n=!1,count:i}={}){let l;const o=new URL(`${this.url}/rpc/${t}`);let c;r||n?(l=r?"HEAD":"GET",Object.entries(s).filter(([u,x])=>x!==void 0).map(([u,x])=>[u,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([u,x])=>{o.searchParams.append(u,x)})):(l="POST",c=s);const d=Object.assign({},this.headers);return i&&(d.Prefer=`count=${i}`),new kn.default({method:l,url:o,headers:d,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};Hs.default=Cn;var kt=ke&&ke.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.PostgrestError=Ee.PostgrestBuilder=Ee.PostgrestTransformBuilder=Ee.PostgrestFilterBuilder=Ee.PostgrestQueryBuilder=Ee.PostgrestClient=void 0;const Yr=kt(Hs);Ee.PostgrestClient=Yr.default;const Jr=kt(ls);Ee.PostgrestQueryBuilder=Jr.default;const Qr=kt(It);Ee.PostgrestFilterBuilder=Qr.default;const Kr=kt(cs);Ee.PostgrestTransformBuilder=Kr.default;const Xr=kt(ds);Ee.PostgrestBuilder=Xr.default;const Zr=kt(us);Ee.PostgrestError=Zr.default;var Tn=Ee.default={PostgrestClient:Yr.default,PostgrestQueryBuilder:Jr.default,PostgrestFilterBuilder:Qr.default,PostgrestTransformBuilder:Kr.default,PostgrestBuilder:Xr.default,PostgrestError:Zr.default};const{PostgrestClient:Pn,PostgrestQueryBuilder:Qd,PostgrestFilterBuilder:Kd,PostgrestTransformBuilder:Xd,PostgrestBuilder:Zd,PostgrestError:eu}=Tn,Mn="2.11.2",On={"X-Client-Info":`realtime-js/${Mn}`},zn="1.0.0",ea=1e4,Dn=1e3;var yt;(function(a){a[a.connecting=0]="connecting",a[a.open=1]="open",a[a.closing=2]="closing",a[a.closed=3]="closed"})(yt||(yt={}));var _e;(function(a){a.closed="closed",a.errored="errored",a.joined="joined",a.joining="joining",a.leaving="leaving"})(_e||(_e={}));var Pe;(function(a){a.close="phx_close",a.error="phx_error",a.join="phx_join",a.reply="phx_reply",a.leave="phx_leave",a.access_token="access_token"})(Pe||(Pe={}));var _s;(function(a){a.websocket="websocket"})(_s||(_s={}));var it;(function(a){a.Connecting="connecting",a.Open="open",a.Closing="closing",a.Closed="closed"})(it||(it={}));class Ln{constructor(){this.HEADER_LENGTH=1}decode(t,s){return t.constructor===ArrayBuffer?s(this._binaryDecode(t)):s(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const s=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,s,r)}_decodeBroadcast(t,s,r){const n=s.getUint8(1),i=s.getUint8(2);let l=this.HEADER_LENGTH+2;const o=r.decode(t.slice(l,l+n));l=l+n;const c=r.decode(t.slice(l,l+i));l=l+i;const d=JSON.parse(r.decode(t.slice(l,t.byteLength)));return{ref:null,topic:o,event:c,payload:d}}}class ta{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var xe;(function(a){a.abstime="abstime",a.bool="bool",a.date="date",a.daterange="daterange",a.float4="float4",a.float8="float8",a.int2="int2",a.int4="int4",a.int4range="int4range",a.int8="int8",a.int8range="int8range",a.json="json",a.jsonb="jsonb",a.money="money",a.numeric="numeric",a.oid="oid",a.reltime="reltime",a.text="text",a.time="time",a.timestamp="timestamp",a.timestamptz="timestamptz",a.timetz="timetz",a.tsrange="tsrange",a.tstzrange="tstzrange"})(xe||(xe={}));const rr=(a,t,s={})=>{var r;const n=(r=s.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(t).reduce((i,l)=>(i[l]=$n(l,a,t,n),i),{})},$n=(a,t,s,r)=>{const n=t.find(o=>o.name===a),i=n==null?void 0:n.type,l=s[a];return i&&!r.includes(i)?sa(i,l):ks(l)},sa=(a,t)=>{if(a.charAt(0)==="_"){const s=a.slice(1,a.length);return Wn(t,s)}switch(a){case xe.bool:return In(t);case xe.float4:case xe.float8:case xe.int2:case xe.int4:case xe.int8:case xe.numeric:case xe.oid:return Rn(t);case xe.json:case xe.jsonb:return Un(t);case xe.timestamp:return qn(t);case xe.abstime:case xe.date:case xe.daterange:case xe.int4range:case xe.int8range:case xe.money:case xe.reltime:case xe.text:case xe.time:case xe.timestamptz:case xe.timetz:case xe.tsrange:case xe.tstzrange:return ks(t);default:return ks(t)}},ks=a=>a,In=a=>{switch(a){case"t":return!0;case"f":return!1;default:return a}},Rn=a=>{if(typeof a=="string"){const t=parseFloat(a);if(!Number.isNaN(t))return t}return a},Un=a=>{if(typeof a=="string")try{return JSON.parse(a)}catch(t){return console.log(`JSON parse error: ${t}`),a}return a},Wn=(a,t)=>{if(typeof a!="string")return a;const s=a.length-1,r=a[s];if(a[0]==="{"&&r==="}"){let i;const l=a.slice(1,s);try{i=JSON.parse("["+l+"]")}catch{i=l?l.split(","):[]}return i.map(o=>sa(t,o))}return a},qn=a=>typeof a=="string"?a.replace(" ","T"):a,ra=a=>{let t=a;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class fs{constructor(t,s,r={},n=ea){this.channel=t,this.event=s,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var r;return this._hasReceived(t)&&s((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var ar;(function(a){a.SYNC="sync",a.JOIN="join",a.LEAVE="leave"})(ar||(ar={}));class Pt{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Pt.syncState(this.state,n,i,l),this.pendingDiffs.forEach(c=>{this.state=Pt.syncDiff(this.state,c,i,l)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},n=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Pt.syncDiff(this.state,n,i,l),o())}),this.onJoin((n,i,l)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:l})}),this.onLeave((n,i,l)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:l})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,r,n){const i=this.cloneDeep(t),l=this.transformState(s),o={},c={};return this.map(i,(d,u)=>{l[d]||(c[d]=u)}),this.map(l,(d,u)=>{const x=i[d];if(x){const g=u.map(h=>h.presence_ref),b=x.map(h=>h.presence_ref),p=u.filter(h=>b.indexOf(h.presence_ref)<0),v=x.filter(h=>g.indexOf(h.presence_ref)<0);p.length>0&&(o[d]=p),v.length>0&&(c[d]=v)}else o[d]=u}),this.syncDiff(i,{joins:o,leaves:c},r,n)}static syncDiff(t,s,r,n){const{joins:i,leaves:l}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(i,(o,c)=>{var d;const u=(d=t[o])!==null&&d!==void 0?d:[];if(t[o]=this.cloneDeep(c),u.length>0){const x=t[o].map(b=>b.presence_ref),g=u.filter(b=>x.indexOf(b.presence_ref)<0);t[o].unshift(...g)}r(o,u,c)}),this.map(l,(o,c)=>{let d=t[o];if(!d)return;const u=c.map(x=>x.presence_ref);d=d.filter(x=>u.indexOf(x.presence_ref)<0),t[o]=d,n(o,d,c),d.length===0&&delete t[o]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(r=>s(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,r)=>{const n=t[r];return"metas"in n?s[r]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):s[r]=n,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var nr;(function(a){a.ALL="*",a.INSERT="INSERT",a.UPDATE="UPDATE",a.DELETE="DELETE"})(nr||(nr={}));var ir;(function(a){a.BROADCAST="broadcast",a.PRESENCE="presence",a.POSTGRES_CHANGES="postgres_changes",a.SYSTEM="system"})(ir||(ir={}));var We;(function(a){a.SUBSCRIBED="SUBSCRIBED",a.TIMED_OUT="TIMED_OUT",a.CLOSED="CLOSED",a.CHANNEL_ERROR="CHANNEL_ERROR"})(We||(We={}));class Vs{constructor(t,s={config:{}},r){this.topic=t,this.params=s,this.socket=r,this.bindings={},this.state=_e.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new fs(this,Pe.join,this.params,this.timeout),this.rejoinTimer=new ta(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=_e.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=_e.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=_e.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=_e.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Pe.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Pt(this),this.broadcastEndpointURL=ra(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,s=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:l,private:o}}=this.params;this._onError(u=>t==null?void 0:t(We.CHANNEL_ERROR,u)),this._onClose(()=>t==null?void 0:t(We.CLOSED));const c={},d={broadcast:i,presence:l,postgres_changes:(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&n!==void 0?n:[],private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:u})=>{var x;if(this.socket.setAuth(),u===void 0){t==null||t(We.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,b=(x=g==null?void 0:g.length)!==null&&x!==void 0?x:0,p=[];for(let v=0;v<b;v++){const h=g[v],{filter:{event:f,schema:N,table:w,filter:j}}=h,F=u&&u[v];if(F&&F.event===f&&F.schema===N&&F.table===w&&F.filter===j)p.push(Object.assign(Object.assign({},h),{id:F.id}));else{this.unsubscribe(),t==null||t(We.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,t&&t(We.SUBSCRIBED);return}}).receive("error",u=>{t==null||t(We.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(We.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,r){return this._on(t,s,r)}async send(t,s={}){var r,n;if(!this._canPush()&&t.type==="broadcast"){const{event:i,payload:l}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:l,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=s.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=d.body)===null||n===void 0?void 0:n.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var l,o,c;const d=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(o=(l=this.params)===null||l===void 0?void 0:l.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=_e.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Pe.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const n=new fs(this,Pe.leave,{},t);n.receive("ok",()=>{s(),r("ok")}).receive("timeout",()=>{s(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(t,s,r){const n=new AbortController,i=setTimeout(()=>n.abort(),r),l=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:n.signal}));return clearTimeout(i),l}_push(t,s,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new fs(this,t,s,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(t,s,r){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,r){var n,i;const l=t.toLocaleLowerCase(),{close:o,error:c,leave:d,join:u}=Pe;if(r&&[o,c,d,u].indexOf(l)>=0&&r!==this._joinRef())return;let g=this._onMessage(l,s,r);if(s&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(l)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(b=>{var p,v,h;return((p=b.filter)===null||p===void 0?void 0:p.event)==="*"||((h=(v=b.filter)===null||v===void 0?void 0:v.event)===null||h===void 0?void 0:h.toLocaleLowerCase())===l}).map(b=>b.callback(g,r)):(i=this.bindings[l])===null||i===void 0||i.filter(b=>{var p,v,h,f,N,w;if(["broadcast","presence","postgres_changes"].includes(l))if("id"in b){const j=b.id,F=(p=b.filter)===null||p===void 0?void 0:p.event;return j&&((v=s.ids)===null||v===void 0?void 0:v.includes(j))&&(F==="*"||(F==null?void 0:F.toLocaleLowerCase())===((h=s.data)===null||h===void 0?void 0:h.type.toLocaleLowerCase()))}else{const j=(N=(f=b==null?void 0:b.filter)===null||f===void 0?void 0:f.event)===null||N===void 0?void 0:N.toLocaleLowerCase();return j==="*"||j===((w=s==null?void 0:s.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return b.type.toLocaleLowerCase()===l}).map(b=>{if(typeof g=="object"&&"ids"in g){const p=g.data,{schema:v,table:h,commit_timestamp:f,type:N,errors:w}=p;g=Object.assign(Object.assign({},{schema:v,table:h,commit_timestamp:f,eventType:N,new:{},old:{},errors:w}),this._getPayloadRecords(p))}b.callback(g,r)})}_isClosed(){return this.state===_e.closed}_isJoined(){return this.state===_e.joined}_isJoining(){return this.state===_e.joining}_isLeaving(){return this.state===_e.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,r){const n=t.toLocaleLowerCase(),i={type:n,filter:s,callback:r};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(t,s){const r=t.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Vs.isEqual(n.filter,s))}),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const r in t)if(t[r]!==s[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Pe.close,{},t)}_onError(t){this._on(Pe.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=_e.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=rr(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=rr(t.columns,t.old_record)),s}}const Bn=()=>{},Hn=typeof WebSocket<"u",Vn=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Gn{constructor(t,s){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=On,this.params={},this.timeout=ea,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Bn,this.conn=null,this.sendBuffer=[],this.serializer=new Ln,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let l;return i?l=i:typeof fetch>"u"?l=(...o)=>lt(async()=>{const{default:c}=await Promise.resolve().then(()=>_t);return{default:c}},void 0).then(({default:c})=>c(...o)):l=fetch,(...o)=>l(...o)},this.endPoint=`${t}/${_s.websocket}`,this.httpEndpoint=ra(t),s!=null&&s.transport?this.transport=s.transport:this.transport=null,s!=null&&s.params&&(this.params=s.params),s!=null&&s.headers&&(this.headers=Object.assign(Object.assign({},this.headers),s.headers)),s!=null&&s.timeout&&(this.timeout=s.timeout),s!=null&&s.logger&&(this.logger=s.logger),s!=null&&s.heartbeatIntervalMs&&(this.heartbeatIntervalMs=s.heartbeatIntervalMs);const n=(r=s==null?void 0:s.params)===null||r===void 0?void 0:r.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=s!=null&&s.reconnectAfterMs?s.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=s!=null&&s.encode?s.encode:(i,l)=>l(JSON.stringify(i)),this.decode=s!=null&&s.decode?s.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ta(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(s==null?void 0:s.fetch),s!=null&&s.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(s==null?void 0:s.worker)||!1,this.workerUrl=s==null?void 0:s.workerUrl}this.accessToken=(s==null?void 0:s.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Hn){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Yn(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),lt(async()=>{const{default:t}=await import("./browser-N872kxM8.js").then(s=>s.b);return{default:t}},__vite__mapDeps([0,1])).then(({default:t})=>{this.conn=new t(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:zn}))}disconnect(t,s){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,s??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.disconnect(),t}log(t,s,r){this.logger(t,s,r)}connectionState(){switch(this.conn&&this.conn.readyState){case yt.connecting:return it.Connecting;case yt.open:return it.Open;case yt.closing:return it.Closing;default:return it.Closed}}isConnected(){return this.connectionState()===it.Open}channel(t,s={config:{}}){const r=new Vs(`realtime:${t}`,s,this);return this.channels.push(r),r}push(t){const{topic:s,event:r,payload:n,ref:i}=t,l=()=>{this.encode(t,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${s} ${r} (${i})`,n),this.isConnected()?l():this.sendBuffer.push(l)}async setAuth(t=null){let s=t||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(s){let r=null;try{r=JSON.parse(atob(s.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=s,this.channels.forEach(n=>{s&&n.updateJoinPayload({access_token:s}),n.joinedOnce&&n._isJoined()&&n._push(Pe.access_token,{access_token:s})})}}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(t=this.conn)===null||t===void 0||t.close(Dn,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s._joinRef()!==t._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_onConnMessage(t){this.decode(t.data,s=>{let{topic:r,event:n,payload:i,ref:l}=s;l&&l===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${n} ${l&&"("+l+")"||""}`,i),this.channels.filter(o=>o._isMember(r)).forEach(o=>o._trigger(n,i,l)),this.stateChangeCallbacks.message.forEach(o=>o(s))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(t=>t())}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(s=>s(t))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(s=>s(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(Pe.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const r=t.match(/\?/)?"&":"?",n=new URLSearchParams(s);return`${t}${r}${n}`}_workerObjectUrl(t){let s;if(t)s=t;else{const r=new Blob([Vn],{type:"application/javascript"});s=URL.createObjectURL(r)}return s}}class Yn{constructor(t,s,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=yt.connecting,this.send=()=>{},this.url=null,this.url=t,this.close=r.close}}class Gs extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function be(a){return typeof a=="object"&&a!==null&&"__isStorageError"in a}class Jn extends Gs{constructor(t,s){super(t),this.name="StorageApiError",this.status=s}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ss extends Gs{constructor(t,s){super(t),this.name="StorageUnknownError",this.originalError=s}}var Qn=function(a,t,s,r){function n(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(r.next(u))}catch(x){l(x)}}function c(u){try{d(r.throw(u))}catch(x){l(x)}}function d(u){u.done?i(u.value):n(u.value).then(o,c)}d((r=r.apply(a,t||[])).next())})};const aa=a=>{let t;return a?t=a:typeof fetch>"u"?t=(...s)=>lt(async()=>{const{default:r}=await Promise.resolve().then(()=>_t);return{default:r}},void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)},Kn=()=>Qn(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield lt(()=>Promise.resolve().then(()=>_t),void 0)).Response:Response}),Cs=a=>{if(Array.isArray(a))return a.map(s=>Cs(s));if(typeof a=="function"||a!==Object(a))return a;const t={};return Object.entries(a).forEach(([s,r])=>{const n=s.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[n]=Cs(r)}),t};var ut=function(a,t,s,r){function n(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(r.next(u))}catch(x){l(x)}}function c(u){try{d(r.throw(u))}catch(x){l(x)}}function d(u){u.done?i(u.value):n(u.value).then(o,c)}d((r=r.apply(a,t||[])).next())})};const ps=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),Xn=(a,t,s)=>ut(void 0,void 0,void 0,function*(){const r=yield Kn();a instanceof r&&!(s!=null&&s.noResolveJson)?a.json().then(n=>{t(new Jn(ps(n),a.status||500))}).catch(n=>{t(new Ss(ps(n),n))}):t(new Ss(ps(a),a))}),Zn=(a,t,s,r)=>{const n={method:a,headers:(t==null?void 0:t.headers)||{}};return a==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),s))};function Rt(a,t,s,r,n,i){return ut(this,void 0,void 0,function*(){return new Promise((l,o)=>{a(s,Zn(t,r,n,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>l(c)).catch(c=>Xn(c,o,r))})})}function ss(a,t,s,r){return ut(this,void 0,void 0,function*(){return Rt(a,"GET",t,s,r)})}function Je(a,t,s,r,n){return ut(this,void 0,void 0,function*(){return Rt(a,"POST",t,r,n,s)})}function ei(a,t,s,r,n){return ut(this,void 0,void 0,function*(){return Rt(a,"PUT",t,r,n,s)})}function ti(a,t,s,r){return ut(this,void 0,void 0,function*(){return Rt(a,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}function na(a,t,s,r,n){return ut(this,void 0,void 0,function*(){return Rt(a,"DELETE",t,r,n,s)})}var Ne=function(a,t,s,r){function n(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(r.next(u))}catch(x){l(x)}}function c(u){try{d(r.throw(u))}catch(x){l(x)}}function d(u){u.done?i(u.value):n(u.value).then(o,c)}d((r=r.apply(a,t||[])).next())})};const si={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},or={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ri{constructor(t,s={},r,n){this.url=t,this.headers=s,this.bucketId=r,this.fetch=aa(n)}uploadOrUpdate(t,s,r,n){return Ne(this,void 0,void 0,function*(){try{let i;const l=Object.assign(Object.assign({},or),n);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(l.upsert)});const c=l.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",l.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",l.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,o["cache-control"]=`max-age=${l.cacheControl}`,o["content-type"]=l.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(o=Object.assign(Object.assign({},o),n.headers));const d=this._removeEmptyFolders(s),u=this._getFinalPath(d),x=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:t,body:i,headers:o},l!=null&&l.duplex?{duplex:l.duplex}:{})),g=yield x.json();return x.ok?{data:{path:d,id:g.Id,fullPath:g.Key},error:null}:{data:null,error:g}}catch(i){if(be(i))return{data:null,error:i};throw i}})}upload(t,s,r){return Ne(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,s,r)})}uploadToSignedUrl(t,s,r,n){return Ne(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(t),l=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${l}`);o.searchParams.set("token",s);try{let c;const d=Object.assign({upsert:or.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const x=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),g=yield x.json();return x.ok?{data:{path:i,fullPath:g.Key},error:null}:{data:null,error:g}}catch(c){if(be(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,s){return Ne(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t);const n=Object.assign({},this.headers);s!=null&&s.upsert&&(n["x-upsert"]="true");const i=yield Je(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),l=new URL(this.url+i.url),o=l.searchParams.get("token");if(!o)throw new Gs("No token returned by API");return{data:{signedUrl:l.toString(),path:t,token:o},error:null}}catch(r){if(be(r))return{data:null,error:r};throw r}})}update(t,s,r){return Ne(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,s,r)})}move(t,s,r){return Ne(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(be(n))return{data:null,error:n};throw n}})}copy(t,s,r){return Ne(this,void 0,void 0,function*(){try{return{data:{path:(yield Je(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(be(n))return{data:null,error:n};throw n}})}createSignedUrl(t,s,r){return Ne(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t),i=yield Je(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:s},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const l=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${l}`)},{data:i,error:null}}catch(n){if(be(n))return{data:null,error:n};throw n}})}createSignedUrls(t,s,r){return Ne(this,void 0,void 0,function*(){try{const n=yield Je(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:t},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(l=>Object.assign(Object.assign({},l),{signedUrl:l.signedURL?encodeURI(`${this.url}${l.signedURL}${i}`):null})),error:null}}catch(n){if(be(n))return{data:null,error:n};throw n}})}download(t,s){return Ne(this,void 0,void 0,function*(){const n=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),l=i?`?${i}`:"";try{const o=this._getFinalPath(t);return{data:yield(yield ss(this.fetch,`${this.url}/${n}/${o}${l}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(be(o))return{data:null,error:o};throw o}})}info(t){return Ne(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{const r=yield ss(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:Cs(r),error:null}}catch(r){if(be(r))return{data:null,error:r};throw r}})}exists(t){return Ne(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{return yield ti(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(be(r)&&r instanceof Ss){const n=r.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,s){const r=this._getFinalPath(t),n=[],i=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";i!==""&&n.push(i);const o=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});c!==""&&n.push(c);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${d}`)}}}remove(t){return Ne(this,void 0,void 0,function*(){try{return{data:yield na(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}})}list(t,s,r){return Ne(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},si),s),{prefix:t||""});return{data:yield Je(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(be(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const s=[];return t.width&&s.push(`width=${t.width}`),t.height&&s.push(`height=${t.height}`),t.resize&&s.push(`resize=${t.resize}`),t.format&&s.push(`format=${t.format}`),t.quality&&s.push(`quality=${t.quality}`),s.join("&")}}const ai="2.7.1",ni={"X-Client-Info":`storage-js/${ai}`};var xt=function(a,t,s,r){function n(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(r.next(u))}catch(x){l(x)}}function c(u){try{d(r.throw(u))}catch(x){l(x)}}function d(u){u.done?i(u.value):n(u.value).then(o,c)}d((r=r.apply(a,t||[])).next())})};class ii{constructor(t,s={},r){this.url=t,this.headers=Object.assign(Object.assign({},ni),s),this.fetch=aa(r)}listBuckets(){return xt(this,void 0,void 0,function*(){try{return{data:yield ss(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}})}getBucket(t){return xt(this,void 0,void 0,function*(){try{return{data:yield ss(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}})}createBucket(t,s={public:!1}){return xt(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(be(r))return{data:null,error:r};throw r}})}updateBucket(t,s){return xt(this,void 0,void 0,function*(){try{return{data:yield ei(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(be(r))return{data:null,error:r};throw r}})}emptyBucket(t){return xt(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}})}deleteBucket(t){return xt(this,void 0,void 0,function*(){try{return{data:yield na(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(s){if(be(s))return{data:null,error:s};throw s}})}}class oi extends ii{constructor(t,s={},r){super(t,s,r)}from(t){return new ri(this.url,this.headers,t,this.fetch)}}const li="2.49.1";let Ct="";typeof Deno<"u"?Ct="deno":typeof document<"u"?Ct="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ct="react-native":Ct="node";const ci={"X-Client-Info":`supabase-js-${Ct}/${li}`},di={headers:ci},ui={schema:"public"},hi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},mi={};var xi=function(a,t,s,r){function n(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(r.next(u))}catch(x){l(x)}}function c(u){try{d(r.throw(u))}catch(x){l(x)}}function d(u){u.done?i(u.value):n(u.value).then(o,c)}d((r=r.apply(a,t||[])).next())})};const fi=a=>{let t;return a?t=a:typeof fetch>"u"?t=qr:t=fetch,(...s)=>t(...s)},pi=()=>typeof Headers>"u"?Br:Headers,gi=(a,t,s)=>{const r=fi(s),n=pi();return(i,l)=>xi(void 0,void 0,void 0,function*(){var o;const c=(o=yield t())!==null&&o!==void 0?o:a;let d=new n(l==null?void 0:l.headers);return d.has("apikey")||d.set("apikey",a),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},l),{headers:d}))})};var bi=function(a,t,s,r){function n(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(r.next(u))}catch(x){l(x)}}function c(u){try{d(r.throw(u))}catch(x){l(x)}}function d(u){u.done?i(u.value):n(u.value).then(o,c)}d((r=r.apply(a,t||[])).next())})};function vi(a){return a.replace(/\/$/,"")}function ji(a,t){const{db:s,auth:r,realtime:n,global:i}=a,{db:l,auth:o,realtime:c,global:d}=t,u={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},d),i),accessToken:()=>bi(this,void 0,void 0,function*(){return""})};return a.accessToken?u.accessToken=a.accessToken:delete u.accessToken,u}const ia="2.68.0",vt=30*1e3,Ts=3,gs=Ts*vt,yi="http://localhost:9999",wi="supabase.auth.token",Ni={"X-Client-Info":`gotrue-js/${ia}`},Ps="X-Supabase-Api-Version",oa={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Ei(a){return Math.round(Date.now()/1e3)+a}function Ai(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){const t=Math.random()*16|0;return(a=="x"?t:t&3|8).toString(16)})}const De=()=>typeof window<"u"&&typeof document<"u",tt={tested:!1,writable:!1},Mt=()=>{if(!De())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(tt.tested)return tt.writable;const a=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(a,a),globalThis.localStorage.removeItem(a),tt.tested=!0,tt.writable=!0}catch{tt.tested=!0,tt.writable=!1}return tt.writable};function Fi(a){const t={},s=new URL(a);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((n,i)=>{t[i]=n})}catch{}return s.searchParams.forEach((r,n)=>{t[n]=r}),t}const la=a=>{let t;return a?t=a:typeof fetch>"u"?t=(...s)=>lt(async()=>{const{default:r}=await Promise.resolve().then(()=>_t);return{default:r}},void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)},_i=a=>typeof a=="object"&&a!==null&&"status"in a&&"ok"in a&&"json"in a&&typeof a.json=="function",ca=async(a,t,s)=>{await a.setItem(t,JSON.stringify(s))},Wt=async(a,t)=>{const s=await a.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},qt=async(a,t)=>{await a.removeItem(t)};function ki(a){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let s="",r,n,i,l,o,c,d,u=0;for(a=a.replace("-","+").replace("_","/");u<a.length;)l=t.indexOf(a.charAt(u++)),o=t.indexOf(a.charAt(u++)),c=t.indexOf(a.charAt(u++)),d=t.indexOf(a.charAt(u++)),r=l<<2|o>>4,n=(o&15)<<4|c>>2,i=(c&3)<<6|d,s=s+String.fromCharCode(r),c!=64&&n!=0&&(s=s+String.fromCharCode(n)),d!=64&&i!=0&&(s=s+String.fromCharCode(i));return s}class xs{constructor(){this.promise=new xs.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}xs.promiseConstructor=Promise;function lr(a){const t=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,s=a.split(".");if(s.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!t.test(s[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=s[1];return JSON.parse(ki(r))}async function Si(a){return await new Promise(t=>{setTimeout(()=>t(null),a)})}function Ci(a,t){return new Promise((r,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const l=await a(i);if(!t(i,null,l)){r(l);return}}catch(l){if(!t(i,l)){n(l);return}}})()})}function Ti(a){return("0"+a.toString(16)).substr(-2)}function Pi(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=s.length;let n="";for(let i=0;i<56;i++)n+=s.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(t),Array.from(t,Ti).join("")}async function Mi(a){const s=new TextEncoder().encode(a),r=await crypto.subtle.digest("SHA-256",s),n=new Uint8Array(r);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}function Oi(a){return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function zi(a){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),a;const s=await Mi(a);return Oi(s)}async function ft(a,t,s=!1){const r=Pi();let n=r;s&&(n+="/PASSWORD_RECOVERY"),await ca(a,`${t}-code-verifier`,n);const i=await zi(r);return[i,r===i?"plain":"s256"]}const Di=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Li(a){const t=a.headers.get(Ps);if(!t||!t.match(Di))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}class Ys extends Error{constructor(t,s,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=r}}function ee(a){return typeof a=="object"&&a!==null&&"__isAuthError"in a}class $i extends Ys{constructor(t,s,r){super(t,s,r),this.name="AuthApiError",this.status=s,this.code=r}}function Ii(a){return ee(a)&&a.name==="AuthApiError"}class da extends Ys{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class ht extends Ys{constructor(t,s,r,n){super(t,r,n),this.name=s,this.status=r}}class Ge extends ht{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ri(a){return ee(a)&&a.name==="AuthSessionMissingError"}class bs extends ht{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Bt extends ht{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Ht extends ht{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ui(a){return ee(a)&&a.name==="AuthImplicitGrantRedirectError"}class cr extends ht{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ms extends ht{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function vs(a){return ee(a)&&a.name==="AuthRetryableFetchError"}class dr extends ht{constructor(t,s,r){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=r}}var Wi=function(a,t){var s={};for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&t.indexOf(r)<0&&(s[r]=a[r]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(a);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(a,r[n])&&(s[r[n]]=a[r[n]]);return s};const rt=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),qi=[502,503,504];async function ur(a){var t;if(!_i(a))throw new Ms(rt(a),0);if(qi.includes(a.status))throw new Ms(rt(a),a.status);let s;try{s=await a.json()}catch(i){throw new da(rt(i),i)}let r;const n=Li(a);if(n&&n.getTime()>=oa["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?r=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(r=s.error_code),r){if(r==="weak_password")throw new dr(rt(s),a.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new Ge}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((i,l)=>i&&typeof l=="string",!0))throw new dr(rt(s),a.status,s.weak_password.reasons);throw new $i(rt(s),a.status||500,r)}const Bi=(a,t,s,r)=>{const n={method:a,headers:(t==null?void 0:t.headers)||{}};return a==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),s))};async function re(a,t,s,r){var n;const i=Object.assign({},r==null?void 0:r.headers);i[Ps]||(i[Ps]=oa["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const l=(n=r==null?void 0:r.query)!==null&&n!==void 0?n:{};r!=null&&r.redirectTo&&(l.redirect_to=r.redirectTo);const o=Object.keys(l).length?"?"+new URLSearchParams(l).toString():"",c=await Hi(a,t,s+o,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function Hi(a,t,s,r,n,i){const l=Bi(t,r,n,i);let o;try{o=await a(s,Object.assign({},l))}catch(c){throw console.error(c),new Ms(rt(c),0)}if(o.ok||await ur(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(c){await ur(c)}}function Ye(a){var t;let s=null;Ji(a)&&(s=Object.assign({},a),a.expires_at||(s.expires_at=Ei(a.expires_in)));const r=(t=a.user)!==null&&t!==void 0?t:a;return{data:{session:s,user:r},error:null}}function hr(a){const t=Ye(a);return!t.error&&a.weak_password&&typeof a.weak_password=="object"&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.message&&typeof a.weak_password.message=="string"&&a.weak_password.reasons.reduce((s,r)=>s&&typeof r=="string",!0)&&(t.data.weak_password=a.weak_password),t}function Qe(a){var t;return{data:{user:(t=a.user)!==null&&t!==void 0?t:a},error:null}}function Vi(a){return{data:a,error:null}}function Gi(a){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i}=a,l=Wi(a,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i},c=Object.assign({},l);return{data:{properties:o,user:c},error:null}}function Yi(a){return a}function Ji(a){return a.access_token&&a.refresh_token&&a.expires_in}var Qi=function(a,t){var s={};for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&t.indexOf(r)<0&&(s[r]=a[r]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(a);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(a,r[n])&&(s[r[n]]=a[r[n]]);return s};class Ki{constructor({url:t="",headers:s={},fetch:r}){this.url=t,this.headers=s,this.fetch=la(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,s="global"){try{return await re(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ee(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,s={}){try{return await re(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Qe})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:s}=t,r=Qi(t,["options"]),n=Object.assign(Object.assign({},r),s);return"newEmail"in r&&(n.new_email=r==null?void 0:r.newEmail,delete n.newEmail),await re(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Gi,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(ee(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await re(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Qe})}catch(s){if(ee(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,r,n,i,l,o,c;try{const d={nextPage:null,lastPage:0,total:0},u=await re(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(s=t==null?void 0:t.page)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"",per_page:(i=(n=t==null?void 0:t.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Yi});if(u.error)throw u.error;const x=await u.json(),g=(l=u.headers.get("x-total-count"))!==null&&l!==void 0?l:0,b=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return b.length>0&&(b.forEach(p=>{const v=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),h=JSON.parse(p.split(";")[1].split("=")[1]);d[`${h}Page`]=v}),d.total=parseInt(g)),{data:Object.assign(Object.assign({},x),d),error:null}}catch(d){if(ee(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){try{return await re(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Qe})}catch(s){if(ee(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){try{return await re(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:Qe})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,s=!1){try{return await re(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:Qe})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){try{const{data:s,error:r}=await re(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:s,error:r}}catch(s){if(ee(s))return{data:null,error:s};throw s}}async _deleteFactor(t){try{return{data:await re(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(ee(s))return{data:null,error:s};throw s}}}const Xi={getItem:a=>Mt()?globalThis.localStorage.getItem(a):null,setItem:(a,t)=>{Mt()&&globalThis.localStorage.setItem(a,t)},removeItem:a=>{Mt()&&globalThis.localStorage.removeItem(a)}};function mr(a={}){return{getItem:t=>a[t]||null,setItem:(t,s)=>{a[t]=s},removeItem:t=>{delete a[t]}}}function Zi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const pt={debug:!!(globalThis&&Mt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ua extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class eo extends ua{}async function to(a,t,s){pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",a,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),pt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",a)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(a,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",a,n.name);try{return await s()}finally{pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",a,n.name)}}else{if(t===0)throw pt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",a),new eo(`Acquiring an exclusive Navigator LockManager lock "${a}" immediately failed`);if(pt.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}Zi();const so={url:yi,storageKey:wi,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ni,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function xr(a,t,s){return await s()}class Dt{constructor(t){var s,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Dt.nextInstanceID,Dt.nextInstanceID+=1,this.instanceID>0&&De()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},so),t);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Ki({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=la(n.fetch),this.lock=n.lock||xr,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:De()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=to:this.lock=xr,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:Mt()?this.storage=Xi:(this.memoryStorage={},this.storage=mr(this.memoryStorage)):(this.memoryStorage={},this.storage=mr(this.memoryStorage)),De()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ia}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const s=Fi(window.location.href);let r="none";if(this._isImplicitGrantCallback(s)?r="implicit":await this._isPKCECallback(s)&&(r="pkce"),De()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:i}=await this._getSessionFromURL(s,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Ui(i)){const c=(t=i.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:l,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",l,"redirect type",o),await this._saveSession(l),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",l):await this._notifyAllSubscribers("SIGNED_IN",l)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return ee(s)?{error:s}:{error:new da("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,r,n;try{const i=await re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=t==null?void 0:t.options)===null||n===void 0?void 0:n.captchaToken}},xform:Ye}),{data:l,error:o}=i;if(o||!l)return{data:{user:null,session:null},error:o};const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(ee(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(t){var s,r,n;try{let i;if("email"in t){const{email:u,password:x,options:g}=t;let b=null,p=null;this.flowType==="pkce"&&([b,p]=await ft(this.storage,this.storageKey)),i=await re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:u,password:x,data:(s=g==null?void 0:g.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:b,code_challenge_method:p},xform:Ye})}else if("phone"in t){const{phone:u,password:x,options:g}=t;i=await re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:x,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},channel:(n=g==null?void 0:g.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:Ye})}else throw new Bt("You must provide either an email or phone number and a password");const{data:l,error:o}=i;if(o||!l)return{data:{user:null,session:null},error:o};const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(ee(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(t){try{let s;if("email"in t){const{email:i,password:l,options:o}=t;s=await re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:hr})}else if("phone"in t){const{phone:i,password:l,options:o}=t;s=await re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:hr})}else throw new Bt("You must provide either an email or phone number and a password");const{data:r,error:n}=s;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new bs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(s){if(ee(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(t){var s,r,n,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=t.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async _exchangeCodeForSession(t){const s=await Wt(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(s??"").split("/");try{const{data:i,error:l}=await re(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:Ye});if(await qt(this.storage,`${this.storageKey}-code-verifier`),l)throw l;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new bs}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:l})}catch(i){if(ee(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(t){try{const{options:s,provider:r,token:n,access_token:i,nonce:l}=t,o=await re(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:i,nonce:l,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Ye}),{data:c,error:d}=o;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new bs}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(s){if(ee(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(t){var s,r,n,i,l;try{if("email"in t){const{email:o,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await ft(this.storage,this.storageKey));const{error:x}=await re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:x}}if("phone"in t){const{phone:o,options:c}=t,{data:d,error:u}=await re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(l=c==null?void 0:c.channel)!==null&&l!==void 0?l:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new Bt("You must provide either an email or phone number.")}catch(o){if(ee(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var s,r;try{let n,i;"options"in t&&(n=(s=t.options)===null||s===void 0?void 0:s.redirectTo,i=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:l,error:o}=await re(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:Ye});if(o)throw o;if(!l)throw new Error("An error occurred on token verification.");const c=l.session,d=l.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(n){if(ee(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(t){var s,r,n;try{let i=null,l=null;return this.flowType==="pkce"&&([i,l]=await ft(this.storage,this.storageKey)),await re(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=t==null?void 0:t.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:l}),headers:this.headers,xform:Vi})}catch(i){if(ee(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:r}=t;if(r)throw r;if(!s)throw new Ge;const{error:n}=await re(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:n}})}catch(t){if(ee(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:r,type:n,options:i}=t,{error:l}=await re(this.fetch,"POST",s,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:l}}else if("phone"in t){const{phone:r,type:n,options:i}=t,{data:l,error:o}=await re(this.fetch,"POST",s,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:o}}throw new Bt("You must provide either an email or phone number and a type")}catch(s){if(ee(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await s()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=s();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await Wt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<gs:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.storage.isServer){let l=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,d,u)=>(!l&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),l=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:t},error:null}}const{session:n,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Qe}):await this._useSession(async s=>{var r,n,i;const{data:l,error:o}=s;if(o)throw o;return!(!((r=l.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ge}:await re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:Qe})})}catch(s){if(ee(s))return Ri(s)&&(await this._removeSession(),await qt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async r=>{const{data:n,error:i}=r;if(i)throw i;if(!n.session)throw new Ge;const l=n.session;let o=null,c=null;this.flowType==="pkce"&&t.email!=null&&([o,c]=await ft(this.storage,this.storageKey));const{data:d,error:u}=await re(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:c}),jwt:l.access_token,xform:Qe});if(u)throw u;return l.user=d.user,await this._saveSession(l),await this._notifyAllSubscribers("USER_UPDATED",l),{data:{user:l.user},error:null}})}catch(r){if(ee(r))return{data:{user:null},error:r};throw r}}_decodeJWT(t){return lr(t)}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ge;const s=Date.now()/1e3;let r=s,n=!0,i=null;const l=lr(t.access_token);if(l.exp&&(r=l.exp,n=r<=s),n){const{session:o,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(t.access_token);if(c)throw c;i={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:r-s,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(s){if(ee(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var r;if(!t){const{data:l,error:o}=s;if(o)throw o;t=(r=l.session)!==null&&r!==void 0?r:void 0}if(!(t!=null&&t.refresh_token))throw new Ge;const{session:n,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(ee(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(t,s){try{if(!De())throw new Ht("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Ht(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new cr("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ht("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new cr("No code detected.");const{data:N,error:w}=await this._exchangeCodeForSession(t.code);if(w)throw w;const j=new URL(window.location.href);return j.searchParams.delete("code"),window.history.replaceState(window.history.state,"",j.toString()),{data:{session:N.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:i,refresh_token:l,expires_in:o,expires_at:c,token_type:d}=t;if(!i||!o||!l||!d)throw new Ht("No session defined in URL");const u=Math.round(Date.now()/1e3),x=parseInt(o);let g=u+x;c&&(g=parseInt(c));const b=g-u;b*1e3<=vt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${b}s, should have been closer to ${x}s`);const p=g-x;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,g,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,g,u);const{data:v,error:h}=await this._getUser(i);if(h)throw h;const f={provider_token:r,provider_refresh_token:n,access_token:i,expires_in:x,expires_at:g,refresh_token:l,token_type:d,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:f,redirectType:t.type},error:null}}catch(r){if(ee(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await Wt(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var r;const{data:n,error:i}=s;if(i)return{error:i};const l=(r=n.session)===null||r===void 0?void 0:r.access_token;if(l){const{error:o}=await this.admin.signOut(l,t);if(o&&!(Ii(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return t!=="others"&&(await this._removeSession(),await qt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const s=Ai(),r={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async s=>{var r,n;try{const{data:{session:i},error:l}=s;if(l)throw l;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,s={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await ft(this.storage,this.storageKey,!0));try{return await re(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(i){if(ee(i))return{data:null,error:i};throw i}}async getUserIdentities(){var t;try{const{data:s,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(s){if(ee(s))return{data:null,error:s};throw s}}async linkIdentity(t){var s;try{const{data:r,error:n}=await this._useSession(async i=>{var l,o,c,d,u;const{data:x,error:g}=i;if(g)throw g;const b=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(l=t.options)===null||l===void 0?void 0:l.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await re(this.fetch,"GET",b,{headers:this.headers,jwt:(u=(d=x.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return De()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:t.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(ee(r))return{data:{provider:t.provider,url:null},error:r};throw r}}async unlinkIdentity(t){try{return await this._useSession(async s=>{var r,n;const{data:i,error:l}=s;if(l)throw l;return await re(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(n=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(s){if(ee(s))return{data:null,error:s};throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const r=Date.now();return await Ci(async n=>(n>0&&await Si(200*Math.pow(2,n-1)),this._debug(s,"refreshing attempt",n),await re(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Ye})),(n,i)=>{const l=200*Math.pow(2,n);return i&&vs(i)&&Date.now()+l-r<vt})}catch(r){if(this._debug(s,"error",r),ee(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",r),De()&&!s.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const r=await Wt(this.storage,this.storageKey);if(this._debug(s,"session from storage",r),!this._isValidSession(r)){this._debug(s,"session is not valid"),r!==null&&await this._removeSession();return}const n=((t=r.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<gs;if(this._debug(s,`session has${n?"":" not"} expired with margin of ${gs}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:i}=await this._callRefreshToken(r.refresh_token);i&&(console.error(i),vs(i)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(s,"error",r),console.error(r);return}finally{this._debug(s,"end")}}async _callRefreshToken(t){var s,r;if(!t)throw new Ge;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new xs;const{data:i,error:l}=await this._refreshAccessToken(t);if(l)throw l;if(!i.session)throw new Ge;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(n,"error",i),ee(i)){const l={session:null,error:i};return vs(i)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(l),l}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(t,s,r=!0){const n=`#_notifyAllSubscribers(${t})`;this._debug(n,"begin",s,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:s});const i=[],l=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,s)}catch(c){i.push(c)}});if(await Promise.all(l),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await ca(this.storage,this.storageKey,t)}async _removeSession(){this._debug("#_removeSession()"),await qt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&De()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),vt);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:r}}=s;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-t)/vt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${vt}ms, refresh threshold is ${Ts} ticks`),n<=Ts&&await this._callRefreshToken(r.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof ua)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!De()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,r){const n=[`provider=${encodeURIComponent(s)}`];if(r!=null&&r.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,l]=await ft(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(l)}`});n.push(o.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);n.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${n.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var r;const{data:n,error:i}=s;return i?{data:null,error:i}:await re(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(ee(s))return{data:null,error:s};throw s}}async _enroll(t){try{return await this._useSession(async s=>{var r,n;const{data:i,error:l}=s;if(l)return{data:null,error:l};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:c,error:d}=await re(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(t.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(ee(s))return{data:null,error:s};throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:n,error:i}=s;if(i)return{data:null,error:i};const{data:l,error:o}=await re(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:o})})}catch(s){if(ee(s))return{data:null,error:s};throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:n,error:i}=s;return i?{data:null,error:i}:await re(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(ee(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(t){const{data:s,error:r}=await this._challenge({factorId:t.factorId});return r?{data:null,error:r}:await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const r=(t==null?void 0:t.factors)||[],n=r.filter(l=>l.factor_type==="totp"&&l.status==="verified"),i=r.filter(l=>l.factor_type==="phone"&&l.status==="verified");return{data:{all:r,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var s,r;const{data:{session:n},error:i}=t;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const l=this._decodeJWT(n.access_token);let o=null;l.aal&&(o=l.aal);let c=o;((r=(s=n.user.factors)===null||s===void 0?void 0:s.filter(x=>x.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const u=l.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}Dt.nextInstanceID=0;const ro=Dt;class ao extends ro{constructor(t){super(t)}}var no=function(a,t,s,r){function n(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(r.next(u))}catch(x){l(x)}}function c(u){try{d(r.throw(u))}catch(x){l(x)}}function d(u){u.done?i(u.value):n(u.value).then(o,c)}d((r=r.apply(a,t||[])).next())})};class io{constructor(t,s,r){var n,i,l;if(this.supabaseUrl=t,this.supabaseKey=s,!t)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const o=vi(t);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,d={db:ui,realtime:mi,auth:Object.assign(Object.assign({},hi),{storageKey:c}),global:di},u=ji(r??{},d);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(x,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((l=u.auth)!==null&&l!==void 0?l:{},this.headers,u.global.fetch),this.fetch=gi(s,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Pn(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new ln(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new oi(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,s={},r={}){return this.rest.rpc(t,s,r)}channel(t,s={config:{}}){return this.realtime.channel(t,s)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,s;return no(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(s=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&s!==void 0?s:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:s,detectSessionInUrl:r,storage:n,storageKey:i,flowType:l,lock:o,debug:c},d,u){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ao({url:this.authUrl,headers:Object.assign(Object.assign({},x),d),storageKey:i,autoRefreshToken:t,persistSession:s,detectSessionInUrl:r,storage:n,flowType:l,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new Gn(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,r)=>{this._handleTokenChanged(s,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(t,s,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:t==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const oo=(a,t,s)=>new io(a,t,s),lo="https://nqqcfgaxnrjopfkrcrjg.supabase.co",co="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xcWNmZ2F4bnJqb3Bma3JjcmpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTE3MTcsImV4cCI6MjA2MDUyNzcxN30.NvA1IfsjrqInGsVrs2wn5rMmOaVgjdhW1_1iXU_qqlA",S=oo(lo,co);let Tt=!1;const q=()=>Tt&&!!S,Js=async()=>{if(!S)return console.error("Supabase client not initialized due to missing credentials"),Tt=!1,!1;try{const{error:a}=await S.from("trainee_profiles").select("count");if(a){if(a.code==="42P01")return console.warn("Trainee profiles table not found, but Supabase connection successful"),Tt=!0,!0;throw a}return console.log("Supabase connection successful"),Tt=!0,!0}catch(a){return a instanceof Error?console.error("Supabase connection error:",{message:a.message,name:a.name,stack:a.stack}):console.error("Unknown Supabase connection error:",a),Tt=!1,!1}};Js().then(a=>{console.log("Supabase initialized:",a)});let Vt;const uo=new Uint8Array(16);function ho(){if(!Vt&&(Vt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Vt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Vt(uo)}const ve=[];for(let a=0;a<256;++a)ve.push((a+256).toString(16).slice(1));function mo(a,t=0){return ve[a[t+0]]+ve[a[t+1]]+ve[a[t+2]]+ve[a[t+3]]+"-"+ve[a[t+4]]+ve[a[t+5]]+"-"+ve[a[t+6]]+ve[a[t+7]]+"-"+ve[a[t+8]]+ve[a[t+9]]+"-"+ve[a[t+10]]+ve[a[t+11]]+ve[a[t+12]]+ve[a[t+13]]+ve[a[t+14]]+ve[a[t+15]]}const xo=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),fr={randomUUID:xo};function Ie(a,t,s){if(fr.randomUUID&&!t&&!a)return fr.randomUUID();a=a||{};const r=a.random||(a.rng||ho)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,mo(r)}const fo=async(a,t)=>{var s;if(!q()){if(a==="user@powerhouse.com"&&t==="User@123")return{user:{id:"test-trainee-id",email:"user@powerhouse.com"},profile:{name:"أحمد محمد",email:"user@powerhouse.com",phone:"970 59 123 4567",plan:"premium",status:"active",height:175,weight:80,targetWeight:75,goals:["weight_loss","muscle_gain"],gender:"male",stats:{completedExercises:45,completedMeals:38,progress:75}}};throw new Error("البريد الإلكتروني أو كلمة المرور غير صحيحة")}try{const{data:r,error:n}=await S.auth.signInWithPassword({email:a,password:t});if(n)throw(s=n.message)!=null&&s.includes("Invalid login credentials")?new Error("البريد الإلكتروني أو كلمة المرور غير صحيحة"):n;if(!r.user)throw new Error("البريد الإلكتروني أو كلمة المرور غير صحيحة");const{data:i,error:l}=await S.from("trainee_profiles").select("*").eq("id",r.user.id).single();if(l)throw l.code==="PGRST116"?new Error("لم يتم العثور على الملف الشخصي"):l;if(i.status!=="active")throw new Error("الحساب غير نشط. يرجى التواصل مع المدير");const{data:o}=await S.from("trainee_performance").select("completed_exercises, completed_meals, progress_value").eq("trainee_id",r.user.id).order("date",{ascending:!1}).limit(1).single();return{user:{id:r.user.id,email:r.user.email||""},profile:{name:i.name,email:i.email,phone:i.phone||"",plan:i.subscription_plan,status:i.status,height:i.height||0,weight:i.current_weight||0,targetWeight:i.target_weight||0,goals:i.goal||[],gender:i.gender||"male",stats:o?{completedExercises:o.completed_exercises||0,completedMeals:o.completed_meals||0,progress:o.progress_value||0}:void 0}}}catch(r){throw console.error("Error during login:",r),r instanceof Error?r:new Error("حدث خطأ أثناء تسجيل الدخول")}},ha=async(a,t,s,r,n,i,l,o,c="basic",d="male")=>{if(!q())return{success:!0,userId:Ie()};try{const{data:u}=await S.from("trainee_profiles").select("id").eq("email",t).single();if(u)return{success:!1,error:"البريد الإلكتروني مسجل مسبقاً"};const{data:x,error:g}=await S.auth.signUp({email:t,password:s,options:{data:{name:a,role:"trainee"}}});if(g)throw g;if(!x.user)throw new Error("فشل إنشاء المستخدم");const{error:b}=await S.from("trainee_profiles").insert([{id:x.user.id,name:a,email:t,phone:r,password_hash:s,initial_weight:i,current_weight:i,target_weight:l,height:n,fat_percentage:0,muscle_mass:0,goal:o,subscription_plan:c,status:"active",role:"trainee",gender:d}]);if(b)throw await S.auth.admin.deleteUser(x.user.id),b;return{success:!0,userId:x.user.id}}catch(u){return console.error("Error during registration:",u),{success:!1,error:u instanceof Error?u.message:"حدث خطأ أثناء التسجيل"}}},po=async()=>{if(!q()){const a=localStorage.getItem("traineeProfile");if(a)try{const t=JSON.parse(a);return{name:t.name||"أحمد محمد",email:t.email||"user@powerhouse.com",phone:t.phone||"970 59 123 4567",plan:t.plan||"premium",status:t.status||"active",height:t.height||175,weight:t.weight||80,targetWeight:t.targetWeight||75,goals:t.goals||["weight_loss","muscle_gain"],gender:t.gender||"male",stats:{completedExercises:45,completedMeals:38,progress:75}}}catch(t){console.error("Error parsing stored profile:",t)}return{name:"أحمد محمد",email:"user@powerhouse.com",phone:"970 59 123 4567",plan:"premium",status:"active",height:175,weight:80,targetWeight:75,goals:["weight_loss","muscle_gain"],gender:"male",stats:{completedExercises:45,completedMeals:38,progress:75}}}try{const{data:{user:a}}=await S.auth.getUser();if(!a)return null;const{data:t,error:s}=await S.from("trainee_profiles").select("*").eq("id",a.id).single();if(s)throw s;if(!t)return null;const{data:r}=await S.from("trainee_performance").select("completed_exercises, completed_meals, progress_value").eq("trainee_id",a.id).order("date",{ascending:!1}).limit(1).single();return{name:t.name,email:t.email,phone:t.phone||"",plan:t.subscription_plan,status:t.status,height:t.height||0,weight:t.current_weight||0,targetWeight:t.target_weight||0,goals:t.goal||[],gender:t.gender||"male",stats:r?{completedExercises:r.completed_exercises||0,completedMeals:r.completed_meals||0,progress:r.progress_value||0}:void 0}}catch(a){return console.error("Error fetching trainee profile:",a),null}};function go({onRegister:a,onSuccess:t}){const s=de(),[r,n]=m.useState(""),[i,l]=m.useState(""),[o,c]=m.useState(!1),[d,u]=m.useState(!1),[x,g]=m.useState(null),[b,p]=m.useState(!1);m.useEffect(()=>{const N=localStorage.getItem("savedTraineeEmail"),w=localStorage.getItem("savedTraineePassword");N&&w&&(n(N),l(w),p(!0))},[]);const v=async N=>{N.preventDefault(),u(!0),g(null);try{if(q()){const{data:w,error:j}=await S.auth.signInWithPassword({email:r,password:i});if(j)throw new Error(j.message);if(!w.user)throw new Error("البريد الإلكتروني أو كلمة المرور غير صحيحة");const{data:F,error:C}=await S.from("trainee_profiles").select("*").eq("id",w.user.id).single();if(C)throw new Error("حدث خطأ أثناء جلب بيانات المستخدم");localStorage.setItem("userType","user"),localStorage.setItem("traineeProfile",JSON.stringify(F)),localStorage.setItem("traineeId",w.user.id),b?(localStorage.setItem("savedTraineeEmail",r),localStorage.setItem("savedTraineePassword",i)):(localStorage.removeItem("savedTraineeEmail"),localStorage.removeItem("savedTraineePassword")),s("/trainee"),t()}else{const w=await fo(r,i);b?(localStorage.setItem("savedTraineeEmail",r),localStorage.setItem("savedTraineePassword",i)):(localStorage.removeItem("savedTraineeEmail"),localStorage.removeItem("savedTraineePassword")),localStorage.setItem("userType","user"),localStorage.setItem("traineeProfile",JSON.stringify(w.profile)),localStorage.setItem("traineeId",w.user.id),s("/trainee"),t()}}catch(w){g(w instanceof Error?w.message:"حدث خطأ أثناء تسجيل الدخول"),console.error("Login error:",w)}finally{u(!1)}},h=()=>{s("/reset-password")},f=()=>{s("/trainee/register")};return e.jsxs("div",{dir:"rtl",className:"min-h-screen text-white flex justify-center pt-5",children:[e.jsx("div",{className:"fixed inset-0 z-0",style:{backgroundImage:`url("${nt.backgrounds.main}")`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),e.jsxs("div",{className:"relative z-10 w-full max-w-md mx-auto px-6",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("img",{src:"https://souqpale.com/wp-content/uploads/2025/03/تصميم-بدون-عنوان-9.png",alt:"Logo",className:"h-24 w-auto"})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-1",children:"مرحباً بك"}),e.jsx("p",{className:"text-gray-400",children:"يتوجب عليك تسجيل الدخول للبدء"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[x&&e.jsx("div",{className:"bg-red-500/10 border border-red-500 text-red-500 p-4 rounded-xl text-center",children:x}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"البريد الإلكتروني:"}),e.jsx("input",{type:"email",value:r,onChange:N=>n(N.target.value),className:"w-full bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-4 focus:outline-none focus:border-[#0AE7F2]",placeholder:"example@email.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"كلمة السر:"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",value:i,onChange:N=>l(N.target.value),className:"w-full bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-4 pr-12 focus:outline-none focus:border-[#0AE7F2]",placeholder:"••••••••",required:!0}),e.jsx("button",{type:"button",onClick:()=>c(!o),className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",children:o?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]}),e.jsx("button",{type:"button",onClick:h,className:"text-[#0AE7F2] text-sm mt-1 hover:underline",children:"نسيت كلمة المرور؟"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"rememberMe",checked:b,onChange:N=>p(N.target.checked),className:"w-4 h-4 rounded border-[#0AE7F2]/20 bg-[#1A1F2E]/60 text-[#0AE7F2] focus:ring-[#0AE7F2] focus:ring-offset-0"}),e.jsx("label",{htmlFor:"rememberMe",className:"text-sm text-gray-400",children:"تذكرني"})]}),e.jsx("button",{type:"submit",disabled:d,className:"w-full bg-[#0AE7F2] text-black py-4 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[#0AE7F2]/90 transition-colors",children:d?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"جاري تسجيل الدخول..."})]}):"تسجيل الدخول!"}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-gray-400",children:["ليس لديك حساب؟"," ",e.jsx("button",{type:"button",onClick:f,className:"text-[#0AE7F2] hover:underline",children:"سجل الآن!"})]})})]})]})]})}function bo({onFinish:a}){const[t,s]=m.useState(0);return m.useEffect(()=>{const r=setInterval(()=>{s(n=>n>=100?(clearInterval(r),setTimeout(()=>{a()},500),100):n+5)},100);return()=>clearInterval(r)},[a]),e.jsxs("div",{className:"fixed inset-0 bg-[#0A0F1C] flex flex-col items-center justify-center z-50",children:[e.jsx(jt.div,{initial:{scale:.5,opacity:0,rotateY:-30},animate:{scale:1.5,opacity:1,rotateY:0},transition:{duration:1.5,ease:"easeOut",scale:{type:"spring",stiffness:100,damping:15}},className:"mb-16",children:e.jsx(jt.img,{src:"https://souqpale.com/wp-content/uploads/2025/03/تصميم-بدون-عنوان-9.png",alt:"Logo",className:"w-80 h-80 object-contain",animate:{y:[0,-20,0],scale:[1,1.05,1],filter:["drop-shadow(0 0 0px rgba(10, 231, 242, 0.7))","drop-shadow(0 0 30px rgba(10, 231, 242, 0.9))","drop-shadow(0 0 0px rgba(10, 231, 242, 0.7))"]},transition:{duration:3,ease:"easeInOut",times:[0,.5,1],repeat:1/0,repeatType:"reverse"}})}),e.jsx("div",{className:"w-64 h-2 bg-[#1A1F2E] rounded-full overflow-hidden",children:e.jsx(jt.div,{initial:{width:0},animate:{width:`${t}%`},className:"h-full bg-[#0AE7F2]"})})]})}function vo({onRegister:a,onSuccess:t}){const[s,r]=m.useState(!0),n=de(),i=()=>{r(!1)},l=()=>{n("/trainee/register")};return s?e.jsx(bo,{onFinish:i}):e.jsx(go,{onRegister:l,onSuccess:t})}function mt(){const a=de(),t=Ka(),[s,r]=m.useState(0),[n,i]=m.useState(0);m.useEffect(()=>{t.pathname.startsWith("/trainee")&&l()},[t.pathname]);const l=async()=>{try{if(!q()){r(0),i(0);return}const{data:{user:o}}=await S.auth.getUser();if(!o){r(0),i(0);return}const{data:c}=await S.from("conversations").select("id").eq("trainee_id",o.id);let d=0;if(c&&c.length>0){const x=c.map(b=>b.id),{count:g}=await S.from("messages").select("id",{count:"exact",head:!0}).in("conversation_id",x).neq("sender_id",o.id).is("read_at",null);d=g||0}const{count:u}=await S.from("notifications").select("id",{count:"exact",head:!0}).or(`recipient_id.eq.${o.id},recipient_id.is.null`).is("read_at",null);r(d),i(u||0)}catch(o){console.error("Error fetching unread counts:",o)}};return t.pathname.startsWith("/trainee")?e.jsx("nav",{className:"fixed bottom-0 inset-x-0 z-50 bg-[#0D1B2A] text-white border-t border-gray-700 w-full",style:{paddingBottom:"calc(8px + env(safe-area-inset-bottom))"},children:e.jsxs("div",{className:"max-w-[600px] mx-auto flex justify-between items-center px-4 py-2",children:[e.jsx(Gt,{icon:e.jsx(kr,{size:22}),label:"الرئيسية",onClick:()=>a("/trainee")}),e.jsx(Gt,{icon:e.jsx(Me,{size:22}),label:"الإشعارات",count:n,onClick:()=>a("/trainee/notifications")}),e.jsx(Gt,{icon:e.jsx(is,{size:22}),label:"التواصل",count:s,onClick:()=>a("/trainee/chat")}),e.jsx(Gt,{icon:e.jsx(Ae,{size:22}),label:"حسابي",onClick:()=>a("/trainee/profile")})]})}):null}function Gt({icon:a,label:t,count:s,onClick:r}){return e.jsxs("button",{onClick:r,className:"flex flex-col items-center gap-0 relative text-xs text-white font-medium pb-1",title:t,"aria-label":t,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"text-[#0AE7F2]",style:{filter:"drop-shadow(0 0 10px rgba(10, 231, 242, 0.7)) drop-shadow(0 0 20px rgba(10, 231, 242, 0.5)) drop-shadow(0 0 30px rgba(10, 231, 242, 0.3))"},children:a}),(s??0)>0&&e.jsx("span",{className:"absolute -top-1 -right-2 bg-red-500 text-white text-[10px] min-w-[16px] h-4 px-1 flex items-center justify-center rounded-full",children:s>9?"9+":s})]}),t]})}function he(a){const t=Object.prototype.toString.call(a);return a instanceof Date||typeof a=="object"&&t==="[object Date]"?new a.constructor(+a):typeof a=="number"||t==="[object Number]"||typeof a=="string"||t==="[object String]"?new Date(a):new Date(NaN)}function Ke(a,t){return a instanceof Date?new a.constructor(t):new Date(t)}const ma=6048e5,jo=864e5,Yt=43200,pr=1440;let yo={};function Ut(){return yo}function Lt(a,t){var o,c,d,u;const s=Ut(),r=(t==null?void 0:t.weekStartsOn)??((c=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:c.weekStartsOn)??s.weekStartsOn??((u=(d=s.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??0,n=he(a),i=n.getDay(),l=(i<r?7:0)+i-r;return n.setDate(n.getDate()-l),n.setHours(0,0,0,0),n}function rs(a){return Lt(a,{weekStartsOn:1})}function xa(a){const t=he(a),s=t.getFullYear(),r=Ke(a,0);r.setFullYear(s+1,0,4),r.setHours(0,0,0,0);const n=rs(r),i=Ke(a,0);i.setFullYear(s,0,4),i.setHours(0,0,0,0);const l=rs(i);return t.getTime()>=n.getTime()?s+1:t.getTime()>=l.getTime()?s:s-1}function gr(a){const t=he(a);return t.setHours(0,0,0,0),t}function as(a){const t=he(a),s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return s.setUTCFullYear(t.getFullYear()),+a-+s}function wo(a,t){const s=gr(a),r=gr(t),n=+s-as(s),i=+r-as(r);return Math.round((n-i)/jo)}function No(a){const t=xa(a),s=Ke(a,0);return s.setFullYear(t,0,4),s.setHours(0,0,0,0),rs(s)}function Qt(a,t){const s=he(a),r=he(t),n=s.getTime()-r.getTime();return n<0?-1:n>0?1:n}function Eo(a){return Ke(a,Date.now())}function Ao(a){return a instanceof Date||typeof a=="object"&&Object.prototype.toString.call(a)==="[object Date]"}function Fo(a){if(!Ao(a)&&typeof a!="number")return!1;const t=he(a);return!isNaN(Number(t))}function _o(a,t){const s=he(a),r=he(t),n=s.getFullYear()-r.getFullYear(),i=s.getMonth()-r.getMonth();return n*12+i}function ko(a){return t=>{const r=(a?Math[a]:Math.trunc)(t);return r===0?0:r}}function So(a,t){return+he(a)-+he(t)}function Co(a){const t=he(a);return t.setHours(23,59,59,999),t}function To(a){const t=he(a),s=t.getMonth();return t.setFullYear(t.getFullYear(),s+1,0),t.setHours(23,59,59,999),t}function Po(a){const t=he(a);return+Co(t)==+To(t)}function Mo(a,t){const s=he(a),r=he(t),n=Qt(s,r),i=Math.abs(_o(s,r));let l;if(i<1)l=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-n*i);let o=Qt(s,r)===-n;Po(he(a))&&i===1&&Qt(a,r)===1&&(o=!1),l=n*(i-Number(o))}return l===0?0:l}function Oo(a,t,s){const r=So(a,t)/1e3;return ko(s==null?void 0:s.roundingMethod)(r)}function zo(a){const t=he(a),s=Ke(a,0);return s.setFullYear(t.getFullYear(),0,1),s.setHours(0,0,0,0),s}const Do={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Lo=(a,t,s)=>{let r;const n=Do[a];return typeof n=="string"?r=n:t===1?r=n.one:r=n.other.replace("{{count}}",t.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+r:r+" ago":r};function wt(a){return(t={})=>{const s=t.width?String(t.width):a.defaultWidth;return a.formats[s]||a.formats[a.defaultWidth]}}const $o={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Io={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Ro={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Uo={date:wt({formats:$o,defaultWidth:"full"}),time:wt({formats:Io,defaultWidth:"full"}),dateTime:wt({formats:Ro,defaultWidth:"full"})},Wo={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},qo=(a,t,s,r)=>Wo[a];function Le(a){return(t,s)=>{const r=s!=null&&s.context?String(s.context):"standalone";let n;if(r==="formatting"&&a.formattingValues){const l=a.defaultFormattingWidth||a.defaultWidth,o=s!=null&&s.width?String(s.width):l;n=a.formattingValues[o]||a.formattingValues[l]}else{const l=a.defaultWidth,o=s!=null&&s.width?String(s.width):a.defaultWidth;n=a.values[o]||a.values[l]}const i=a.argumentCallback?a.argumentCallback(t):t;return n[i]}}const Bo={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Ho={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Vo={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Go={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Yo={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Jo={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Qo=(a,t)=>{const s=Number(a),r=s%100;if(r>20||r<10)switch(r%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},Ko={ordinalNumber:Qo,era:Le({values:Bo,defaultWidth:"wide"}),quarter:Le({values:Ho,defaultWidth:"wide",argumentCallback:a=>a-1}),month:Le({values:Vo,defaultWidth:"wide"}),day:Le({values:Go,defaultWidth:"wide"}),dayPeriod:Le({values:Yo,defaultWidth:"wide",formattingValues:Jo,defaultFormattingWidth:"wide"})};function $e(a){return(t,s={})=>{const r=s.width,n=r&&a.matchPatterns[r]||a.matchPatterns[a.defaultMatchWidth],i=t.match(n);if(!i)return null;const l=i[0],o=r&&a.parsePatterns[r]||a.parsePatterns[a.defaultParseWidth],c=Array.isArray(o)?Zo(o,x=>x.test(l)):Xo(o,x=>x.test(l));let d;d=a.valueCallback?a.valueCallback(c):c,d=s.valueCallback?s.valueCallback(d):d;const u=t.slice(l.length);return{value:d,rest:u}}}function Xo(a,t){for(const s in a)if(Object.prototype.hasOwnProperty.call(a,s)&&t(a[s]))return s}function Zo(a,t){for(let s=0;s<a.length;s++)if(t(a[s]))return s}function fa(a){return(t,s={})=>{const r=t.match(a.matchPattern);if(!r)return null;const n=r[0],i=t.match(a.parsePattern);if(!i)return null;let l=a.valueCallback?a.valueCallback(i[0]):i[0];l=s.valueCallback?s.valueCallback(l):l;const o=t.slice(n.length);return{value:l,rest:o}}}const el=/^(\d+)(th|st|nd|rd)?/i,tl=/\d+/i,sl={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},rl={any:[/^b/i,/^(a|c)/i]},al={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},nl={any:[/1/i,/2/i,/3/i,/4/i]},il={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},ol={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},ll={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},cl={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},dl={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ul={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},hl={ordinalNumber:fa({matchPattern:el,parsePattern:tl,valueCallback:a=>parseInt(a,10)}),era:$e({matchPatterns:sl,defaultMatchWidth:"wide",parsePatterns:rl,defaultParseWidth:"any"}),quarter:$e({matchPatterns:al,defaultMatchWidth:"wide",parsePatterns:nl,defaultParseWidth:"any",valueCallback:a=>a+1}),month:$e({matchPatterns:il,defaultMatchWidth:"wide",parsePatterns:ol,defaultParseWidth:"any"}),day:$e({matchPatterns:ll,defaultMatchWidth:"wide",parsePatterns:cl,defaultParseWidth:"any"}),dayPeriod:$e({matchPatterns:dl,defaultMatchWidth:"any",parsePatterns:ul,defaultParseWidth:"any"})},pa={code:"en-US",formatDistance:Lo,formatLong:Uo,formatRelative:qo,localize:Ko,match:hl,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ml(a){const t=he(a);return wo(t,zo(t))+1}function xl(a){const t=he(a),s=+rs(t)-+No(t);return Math.round(s/ma)+1}function ga(a,t){var u,x,g,b;const s=he(a),r=s.getFullYear(),n=Ut(),i=(t==null?void 0:t.firstWeekContainsDate)??((x=(u=t==null?void 0:t.locale)==null?void 0:u.options)==null?void 0:x.firstWeekContainsDate)??n.firstWeekContainsDate??((b=(g=n.locale)==null?void 0:g.options)==null?void 0:b.firstWeekContainsDate)??1,l=Ke(a,0);l.setFullYear(r+1,0,i),l.setHours(0,0,0,0);const o=Lt(l,t),c=Ke(a,0);c.setFullYear(r,0,i),c.setHours(0,0,0,0);const d=Lt(c,t);return s.getTime()>=o.getTime()?r+1:s.getTime()>=d.getTime()?r:r-1}function fl(a,t){var o,c,d,u;const s=Ut(),r=(t==null?void 0:t.firstWeekContainsDate)??((c=(o=t==null?void 0:t.locale)==null?void 0:o.options)==null?void 0:c.firstWeekContainsDate)??s.firstWeekContainsDate??((u=(d=s.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)??1,n=ga(a,t),i=Ke(a,0);return i.setFullYear(n,0,r),i.setHours(0,0,0,0),Lt(i,t)}function pl(a,t){const s=he(a),r=+Lt(s,t)-+fl(s,t);return Math.round(r/ma)+1}function ce(a,t){const s=a<0?"-":"",r=Math.abs(a).toString().padStart(t,"0");return s+r}const Ve={y(a,t){const s=a.getFullYear(),r=s>0?s:1-s;return ce(t==="yy"?r%100:r,t.length)},M(a,t){const s=a.getMonth();return t==="M"?String(s+1):ce(s+1,2)},d(a,t){return ce(a.getDate(),t.length)},a(a,t){const s=a.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(a,t){return ce(a.getHours()%12||12,t.length)},H(a,t){return ce(a.getHours(),t.length)},m(a,t){return ce(a.getMinutes(),t.length)},s(a,t){return ce(a.getSeconds(),t.length)},S(a,t){const s=t.length,r=a.getMilliseconds(),n=Math.trunc(r*Math.pow(10,s-3));return ce(n,t.length)}},gt={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},br={G:function(a,t,s){const r=a.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(r,{width:"abbreviated"});case"GGGGG":return s.era(r,{width:"narrow"});case"GGGG":default:return s.era(r,{width:"wide"})}},y:function(a,t,s){if(t==="yo"){const r=a.getFullYear(),n=r>0?r:1-r;return s.ordinalNumber(n,{unit:"year"})}return Ve.y(a,t)},Y:function(a,t,s,r){const n=ga(a,r),i=n>0?n:1-n;if(t==="YY"){const l=i%100;return ce(l,2)}return t==="Yo"?s.ordinalNumber(i,{unit:"year"}):ce(i,t.length)},R:function(a,t){const s=xa(a);return ce(s,t.length)},u:function(a,t){const s=a.getFullYear();return ce(s,t.length)},Q:function(a,t,s){const r=Math.ceil((a.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return ce(r,2);case"Qo":return s.ordinalNumber(r,{unit:"quarter"});case"QQQ":return s.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(r,{width:"wide",context:"formatting"})}},q:function(a,t,s){const r=Math.ceil((a.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return ce(r,2);case"qo":return s.ordinalNumber(r,{unit:"quarter"});case"qqq":return s.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(r,{width:"wide",context:"standalone"})}},M:function(a,t,s){const r=a.getMonth();switch(t){case"M":case"MM":return Ve.M(a,t);case"Mo":return s.ordinalNumber(r+1,{unit:"month"});case"MMM":return s.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(r,{width:"wide",context:"formatting"})}},L:function(a,t,s){const r=a.getMonth();switch(t){case"L":return String(r+1);case"LL":return ce(r+1,2);case"Lo":return s.ordinalNumber(r+1,{unit:"month"});case"LLL":return s.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(r,{width:"wide",context:"standalone"})}},w:function(a,t,s,r){const n=pl(a,r);return t==="wo"?s.ordinalNumber(n,{unit:"week"}):ce(n,t.length)},I:function(a,t,s){const r=xl(a);return t==="Io"?s.ordinalNumber(r,{unit:"week"}):ce(r,t.length)},d:function(a,t,s){return t==="do"?s.ordinalNumber(a.getDate(),{unit:"date"}):Ve.d(a,t)},D:function(a,t,s){const r=ml(a);return t==="Do"?s.ordinalNumber(r,{unit:"dayOfYear"}):ce(r,t.length)},E:function(a,t,s){const r=a.getDay();switch(t){case"E":case"EE":case"EEE":return s.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(r,{width:"short",context:"formatting"});case"EEEE":default:return s.day(r,{width:"wide",context:"formatting"})}},e:function(a,t,s,r){const n=a.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return ce(i,2);case"eo":return s.ordinalNumber(i,{unit:"day"});case"eee":return s.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(n,{width:"short",context:"formatting"});case"eeee":default:return s.day(n,{width:"wide",context:"formatting"})}},c:function(a,t,s,r){const n=a.getDay(),i=(n-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return ce(i,t.length);case"co":return s.ordinalNumber(i,{unit:"day"});case"ccc":return s.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(n,{width:"narrow",context:"standalone"});case"cccccc":return s.day(n,{width:"short",context:"standalone"});case"cccc":default:return s.day(n,{width:"wide",context:"standalone"})}},i:function(a,t,s){const r=a.getDay(),n=r===0?7:r;switch(t){case"i":return String(n);case"ii":return ce(n,t.length);case"io":return s.ordinalNumber(n,{unit:"day"});case"iii":return s.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(r,{width:"short",context:"formatting"});case"iiii":default:return s.day(r,{width:"wide",context:"formatting"})}},a:function(a,t,s){const n=a.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(a,t,s){const r=a.getHours();let n;switch(r===12?n=gt.noon:r===0?n=gt.midnight:n=r/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(a,t,s){const r=a.getHours();let n;switch(r>=17?n=gt.evening:r>=12?n=gt.afternoon:r>=4?n=gt.morning:n=gt.night,t){case"B":case"BB":case"BBB":return s.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(a,t,s){if(t==="ho"){let r=a.getHours()%12;return r===0&&(r=12),s.ordinalNumber(r,{unit:"hour"})}return Ve.h(a,t)},H:function(a,t,s){return t==="Ho"?s.ordinalNumber(a.getHours(),{unit:"hour"}):Ve.H(a,t)},K:function(a,t,s){const r=a.getHours()%12;return t==="Ko"?s.ordinalNumber(r,{unit:"hour"}):ce(r,t.length)},k:function(a,t,s){let r=a.getHours();return r===0&&(r=24),t==="ko"?s.ordinalNumber(r,{unit:"hour"}):ce(r,t.length)},m:function(a,t,s){return t==="mo"?s.ordinalNumber(a.getMinutes(),{unit:"minute"}):Ve.m(a,t)},s:function(a,t,s){return t==="so"?s.ordinalNumber(a.getSeconds(),{unit:"second"}):Ve.s(a,t)},S:function(a,t){return Ve.S(a,t)},X:function(a,t,s){const r=a.getTimezoneOffset();if(r===0)return"Z";switch(t){case"X":return jr(r);case"XXXX":case"XX":return at(r);case"XXXXX":case"XXX":default:return at(r,":")}},x:function(a,t,s){const r=a.getTimezoneOffset();switch(t){case"x":return jr(r);case"xxxx":case"xx":return at(r);case"xxxxx":case"xxx":default:return at(r,":")}},O:function(a,t,s){const r=a.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+vr(r,":");case"OOOO":default:return"GMT"+at(r,":")}},z:function(a,t,s){const r=a.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+vr(r,":");case"zzzz":default:return"GMT"+at(r,":")}},t:function(a,t,s){const r=Math.trunc(a.getTime()/1e3);return ce(r,t.length)},T:function(a,t,s){const r=a.getTime();return ce(r,t.length)}};function vr(a,t=""){const s=a>0?"-":"+",r=Math.abs(a),n=Math.trunc(r/60),i=r%60;return i===0?s+String(n):s+String(n)+t+ce(i,2)}function jr(a,t){return a%60===0?(a>0?"-":"+")+ce(Math.abs(a)/60,2):at(a,t)}function at(a,t=""){const s=a>0?"-":"+",r=Math.abs(a),n=ce(Math.trunc(r/60),2),i=ce(r%60,2);return s+n+t+i}const yr=(a,t)=>{switch(a){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},ba=(a,t)=>{switch(a){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},gl=(a,t)=>{const s=a.match(/(P+)(p+)?/)||[],r=s[1],n=s[2];if(!n)return yr(a,t);let i;switch(r){case"P":i=t.dateTime({width:"short"});break;case"PP":i=t.dateTime({width:"medium"});break;case"PPP":i=t.dateTime({width:"long"});break;case"PPPP":default:i=t.dateTime({width:"full"});break}return i.replace("{{date}}",yr(r,t)).replace("{{time}}",ba(n,t))},bl={p:ba,P:gl},vl=/^D+$/,jl=/^Y+$/,yl=["D","DD","YY","YYYY"];function wl(a){return vl.test(a)}function Nl(a){return jl.test(a)}function El(a,t,s){const r=Al(a,t,s);if(console.warn(r),yl.includes(a))throw new RangeError(r)}function Al(a,t,s){const r=a[0]==="Y"?"years":"days of the month";return`Use \`${a.toLowerCase()}\` instead of \`${a}\` (in \`${t}\`) for formatting ${r} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Fl=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_l=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,kl=/^'([^]*?)'?$/,Sl=/''/g,Cl=/[a-zA-Z]/;function Tl(a,t,s){var u,x,g,b;const r=Ut(),n=r.locale??pa,i=r.firstWeekContainsDate??((x=(u=r.locale)==null?void 0:u.options)==null?void 0:x.firstWeekContainsDate)??1,l=r.weekStartsOn??((b=(g=r.locale)==null?void 0:g.options)==null?void 0:b.weekStartsOn)??0,o=he(a);if(!Fo(o))throw new RangeError("Invalid time value");let c=t.match(_l).map(p=>{const v=p[0];if(v==="p"||v==="P"){const h=bl[v];return h(p,n.formatLong)}return p}).join("").match(Fl).map(p=>{if(p==="''")return{isToken:!1,value:"'"};const v=p[0];if(v==="'")return{isToken:!1,value:Pl(p)};if(br[v])return{isToken:!0,value:p};if(v.match(Cl))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:p}});n.localize.preprocessor&&(c=n.localize.preprocessor(o,c));const d={firstWeekContainsDate:i,weekStartsOn:l,locale:n};return c.map(p=>{if(!p.isToken)return p.value;const v=p.value;(Nl(v)||wl(v))&&El(v,t,String(a));const h=br[v[0]];return h(o,v,n.localize,d)}).join("")}function Pl(a){const t=a.match(kl);return t?t[1].replace(Sl,"'"):a}function Ml(a,t,s){const r=Ut(),n=(s==null?void 0:s.locale)??r.locale??pa,i=2520,l=Qt(a,t);if(isNaN(l))throw new RangeError("Invalid time value");const o=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:l});let c,d;l>0?(c=he(t),d=he(a)):(c=he(a),d=he(t));const u=Oo(d,c),x=(as(d)-as(c))/1e3,g=Math.round((u-x)/60);let b;if(g<2)return s!=null&&s.includeSeconds?u<5?n.formatDistance("lessThanXSeconds",5,o):u<10?n.formatDistance("lessThanXSeconds",10,o):u<20?n.formatDistance("lessThanXSeconds",20,o):u<40?n.formatDistance("halfAMinute",0,o):u<60?n.formatDistance("lessThanXMinutes",1,o):n.formatDistance("xMinutes",1,o):g===0?n.formatDistance("lessThanXMinutes",1,o):n.formatDistance("xMinutes",g,o);if(g<45)return n.formatDistance("xMinutes",g,o);if(g<90)return n.formatDistance("aboutXHours",1,o);if(g<pr){const p=Math.round(g/60);return n.formatDistance("aboutXHours",p,o)}else{if(g<i)return n.formatDistance("xDays",1,o);if(g<Yt){const p=Math.round(g/pr);return n.formatDistance("xDays",p,o)}else if(g<Yt*2)return b=Math.round(g/Yt),n.formatDistance("aboutXMonths",b,o)}if(b=Mo(d,c),b<12){const p=Math.round(g/Yt);return n.formatDistance("xMonths",p,o)}else{const p=b%12,v=Math.trunc(b/12);return p<3?n.formatDistance("aboutXYears",v,o):p<9?n.formatDistance("overXYears",v,o):n.formatDistance("almostXYears",v+1,o)}}function Kt(a,t){return Ml(a,Eo(a),t)}const Ol={lessThanXSeconds:{one:"أقل من ثانية",two:"أقل من ثانيتين",threeToTen:"أقل من {{count}} ثواني",other:"أقل من {{count}} ثانية"},xSeconds:{one:"ثانية واحدة",two:"ثانيتان",threeToTen:"{{count}} ثواني",other:"{{count}} ثانية"},halfAMinute:"نصف دقيقة",lessThanXMinutes:{one:"أقل من دقيقة",two:"أقل من دقيقتين",threeToTen:"أقل من {{count}} دقائق",other:"أقل من {{count}} دقيقة"},xMinutes:{one:"دقيقة واحدة",two:"دقيقتان",threeToTen:"{{count}} دقائق",other:"{{count}} دقيقة"},aboutXHours:{one:"ساعة واحدة تقريباً",two:"ساعتين تقريبا",threeToTen:"{{count}} ساعات تقريباً",other:"{{count}} ساعة تقريباً"},xHours:{one:"ساعة واحدة",two:"ساعتان",threeToTen:"{{count}} ساعات",other:"{{count}} ساعة"},xDays:{one:"يوم واحد",two:"يومان",threeToTen:"{{count}} أيام",other:"{{count}} يوم"},aboutXWeeks:{one:"أسبوع واحد تقريبا",two:"أسبوعين تقريبا",threeToTen:"{{count}} أسابيع تقريبا",other:"{{count}} أسبوعا تقريبا"},xWeeks:{one:"أسبوع واحد",two:"أسبوعان",threeToTen:"{{count}} أسابيع",other:"{{count}} أسبوعا"},aboutXMonths:{one:"شهر واحد تقريباً",two:"شهرين تقريبا",threeToTen:"{{count}} أشهر تقريبا",other:"{{count}} شهرا تقريباً"},xMonths:{one:"شهر واحد",two:"شهران",threeToTen:"{{count}} أشهر",other:"{{count}} شهرا"},aboutXYears:{one:"سنة واحدة تقريباً",two:"سنتين تقريبا",threeToTen:"{{count}} سنوات تقريباً",other:"{{count}} سنة تقريباً"},xYears:{one:"سنة واحد",two:"سنتان",threeToTen:"{{count}} سنوات",other:"{{count}} سنة"},overXYears:{one:"أكثر من سنة",two:"أكثر من سنتين",threeToTen:"أكثر من {{count}} سنوات",other:"أكثر من {{count}} سنة"},almostXYears:{one:"ما يقارب سنة واحدة",two:"ما يقارب سنتين",threeToTen:"ما يقارب {{count}} سنوات",other:"ما يقارب {{count}} سنة"}},zl=(a,t,s)=>{const r=Ol[a];let n;return typeof r=="string"?n=r:t===1?n=r.one:t===2?n=r.two:t<=10?n=r.threeToTen.replace("{{count}}",String(t)):n=r.other.replace("{{count}}",String(t)),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"خلال "+n:"منذ "+n:n},Dl={full:"EEEE، do MMMM y",long:"do MMMM y",medium:"d MMM y",short:"dd/MM/yyyy"},Ll={full:"HH:mm:ss",long:"HH:mm:ss",medium:"HH:mm:ss",short:"HH:mm"},$l={full:"{{date}} 'عند الساعة' {{time}}",long:"{{date}} 'عند الساعة' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Il={date:wt({formats:Dl,defaultWidth:"full"}),time:wt({formats:Ll,defaultWidth:"full"}),dateTime:wt({formats:$l,defaultWidth:"full"})},Rl={lastWeek:"eeee 'الماضي عند الساعة' p",yesterday:"'الأمس عند الساعة' p",today:"'اليوم عند الساعة' p",tomorrow:"'غدا عند الساعة' p",nextWeek:"eeee 'القادم عند الساعة' p",other:"P"},Ul=a=>Rl[a],Wl={narrow:["ق","ب"],abbreviated:["ق.م.","ب.م."],wide:["قبل الميلاد","بعد الميلاد"]},ql={narrow:["1","2","3","4"],abbreviated:["ر1","ر2","ر3","ر4"],wide:["الربع الأول","الربع الثاني","الربع الثالث","الربع الرابع"]},Bl={narrow:["ي","ف","م","أ","م","ي","ي","أ","س","أ","ن","د"],abbreviated:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],wide:["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"]},Hl={narrow:["ح","ن","ث","ر","خ","ج","س"],short:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],abbreviated:["أحد","اثنين","ثلاثاء","أربعاء","خميس","جمعة","سبت"],wide:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"]},Vl={narrow:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"المساء",night:"الليل",midnight:"منتصف الليل"}},Gl={narrow:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},abbreviated:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"},wide:{am:"ص",pm:"م",morning:"في الصباح",noon:"الظهر",afternoon:"بعد الظهر",evening:"في المساء",night:"في الليل",midnight:"منتصف الليل"}},Yl=a=>String(a),Jl={ordinalNumber:Yl,era:Le({values:Wl,defaultWidth:"wide"}),quarter:Le({values:ql,defaultWidth:"wide",argumentCallback:a=>a-1}),month:Le({values:Bl,defaultWidth:"wide"}),day:Le({values:Hl,defaultWidth:"wide"}),dayPeriod:Le({values:Vl,defaultWidth:"wide",formattingValues:Gl,defaultFormattingWidth:"wide"})},Ql=/^(\d+)(th|st|nd|rd)?/i,Kl=/\d+/i,Xl={narrow:/[قب]/,abbreviated:/[قب]\.م\./,wide:/(قبل|بعد) الميلاد/},Zl={any:[/قبل/,/بعد/]},ec={narrow:/^[1234]/i,abbreviated:/ر[1234]/,wide:/الربع (الأول|الثاني|الثالث|الرابع)/},tc={any:[/1/i,/2/i,/3/i,/4/i]},sc={narrow:/^[أيفمسند]/,abbreviated:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/,wide:/^(يناير|فبراير|مارس|أبريل|مايو|يونيو|يوليو|أغسطس|سبتمبر|أكتوبر|نوفمبر|ديسمبر)/},rc={narrow:[/^ي/i,/^ف/i,/^م/i,/^أ/i,/^م/i,/^ي/i,/^ي/i,/^أ/i,/^س/i,/^أ/i,/^ن/i,/^د/i],any:[/^يناير/i,/^فبراير/i,/^مارس/i,/^أبريل/i,/^مايو/i,/^يونيو/i,/^يوليو/i,/^أغسطس/i,/^سبتمبر/i,/^أكتوبر/i,/^نوفمبر/i,/^ديسمبر/i]},ac={narrow:/^[حنثرخجس]/i,short:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,abbreviated:/^(أحد|اثنين|ثلاثاء|أربعاء|خميس|جمعة|سبت)/i,wide:/^(الأحد|الاثنين|الثلاثاء|الأربعاء|الخميس|الجمعة|السبت)/i},nc={narrow:[/^ح/i,/^ن/i,/^ث/i,/^ر/i,/^خ/i,/^ج/i,/^س/i],wide:[/^الأحد/i,/^الاثنين/i,/^الثلاثاء/i,/^الأربعاء/i,/^الخميس/i,/^الجمعة/i,/^السبت/i],any:[/^أح/i,/^اث/i,/^ث/i,/^أر/i,/^خ/i,/^ج/i,/^س/i]},ic={narrow:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/,any:/^(ص|م|منتصف الليل|الظهر|بعد الظهر|في الصباح|في المساء|في الليل)/},oc={any:{am:/^ص/,pm:/^م/,midnight:/منتصف الليل/,noon:/الظهر/,afternoon:/بعد الظهر/,morning:/في الصباح/,evening:/في المساء/,night:/في الليل/}},lc={ordinalNumber:fa({matchPattern:Ql,parsePattern:Kl,valueCallback:a=>parseInt(a,10)}),era:$e({matchPatterns:Xl,defaultMatchWidth:"wide",parsePatterns:Zl,defaultParseWidth:"any"}),quarter:$e({matchPatterns:ec,defaultMatchWidth:"wide",parsePatterns:tc,defaultParseWidth:"any",valueCallback:a=>a+1}),month:$e({matchPatterns:sc,defaultMatchWidth:"wide",parsePatterns:rc,defaultParseWidth:"any"}),day:$e({matchPatterns:ac,defaultMatchWidth:"wide",parsePatterns:nc,defaultParseWidth:"any"}),dayPeriod:$e({matchPatterns:ic,defaultMatchWidth:"any",parsePatterns:oc,defaultParseWidth:"any"})},Xt={code:"ar",formatDistance:zl,formatLong:Il,formatRelative:Ul,localize:Jl,match:lc,options:{weekStartsOn:6,firstWeekContainsDate:1}};function ct(a,t="yyyy-MM-dd"){const s=typeof a=="string"?new Date(a):a;return Tl(s,t)}function va(a){const t=typeof a=="string"?new Date(a):a;return Kt(t,{addSuffix:!0,locale:Xt})}const st={width:340,height:180,minValue:0,maxValue:100,padding:{left:0,right:0,top:10,bottom:10}},cc=["100%","80%","60%","40%","20%","0%"];function dc({data:a,loading:t,error:s,onRetry:r}){const n=m.useMemo(()=>{if(!a.length)return"";const{width:o,height:c,minValue:d,maxValue:u,padding:x}=st,g=u-d,b=o-x.left-x.right,p=c-x.top-x.bottom,v=a.map((f,N)=>({x:x.left+N/(a.length-1)*b,y:x.top+p-(f.value-d)/g*p}));let h=`M ${v[0].x},${v[0].y}`;for(let f=0;f<v.length-1;f++){const N=v[f],w=v[f+1],j=N.x+(w.x-N.x)/3,F=N.x+2*(w.x-N.x)/3,C=N.y,A=w.y;h+=` C ${j},${C} ${F},${A} ${w.x},${w.y}`}return h},[a]),i=m.useMemo(()=>{if(!a.length)return"";const{width:o,height:c,padding:d}=st;return`${n} L ${o-d.right},${c-d.bottom} L ${d.left},${c-d.bottom} Z`},[n,a]),l=m.useMemo(()=>{if(!a.length)return{x:0,y:0,value:0,dayIndex:0};const o=Math.max(...a.map(w=>w.value)),c=a.findIndex(w=>w.value===o),{width:d,height:u,minValue:x,maxValue:g,padding:b}=st,p=g-x,v=d-b.left-b.right,h=u-b.top-b.bottom,f=b.left+c/(a.length-1)*v,N=b.top+h-(o-x)/p*h;return{x:f,y:N,value:o,dayIndex:c}},[a]);return t?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"w-10 h-10 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):s?e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center h-48 flex flex-col items-center justify-center",children:[e.jsx("p",{children:s}),r&&e.jsx("button",{onClick:r,className:"underline hover:no-underline mt-2",children:"إعادة المحاولة"})]}):e.jsxs("div",{className:"relative h-48",children:[e.jsx("div",{className:"absolute right-0 inset-y-0 flex flex-col justify-between pr-1",children:cc.map((o,c)=>e.jsx("div",{className:"text-[10px] text-white -translate-y-1/2",children:o},c))}),e.jsx("div",{className:"absolute inset-0 flex flex-col justify-between mr-6",children:[...Array(6)].map((o,c)=>e.jsx("div",{className:"w-full border-t border-dashed border-white/30"},c))}),e.jsxs("div",{className:"absolute inset-0 mr-6",children:[a.length>0&&e.jsx("div",{className:"absolute bottom-0 rounded-t-sm",style:{left:`${l.dayIndex/(a.length-1)*100}%`,transform:"translateX(-50%)",width:"20px",height:`${st.height-l.y-st.padding.bottom}px`,background:"linear-gradient(180deg, rgba(10, 231, 242, 0.7) 0%, rgba(10, 231, 242, 0.2) 100%)",zIndex:1}}),e.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${st.width} ${st.height}`,preserveAspectRatio:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#0AE7F2",stopOpacity:"0.2"}),e.jsx("stop",{offset:"100%",stopColor:"#0AE7F2",stopOpacity:"0"})]})}),e.jsx("path",{d:i,fill:"url(#gradient)"}),e.jsx("path",{d:n,fill:"none",stroke:"#0AE7F2",strokeWidth:"2"}),e.jsx("foreignObject",{x:l.x-15,y:l.y-20,width:"30",height:"15",children:e.jsxs("div",{className:"bg-[#0AE7F2] text-black text-[8px] font-bold rounded-full px-2 py-0.5 text-center",children:[l.value,"%"]})})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-6 flex justify-between",children:a.map((o,c)=>e.jsxs("div",{className:`text-[10px] flex flex-col items-center ${c===l.dayIndex?"text-[#0AE7F2] font-bold":"text-white"}`,children:[e.jsx("span",{className:"mb-1",children:o.day}),e.jsx("span",{className:"text-[8px] text-gray-400",children:ct(o.date,"MM-dd")})]},c))})]})}const ns=["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],Jt=()=>[{day:"الجمعة",date:"2024-04-19",completedExercises:3,completedMeals:3,value:60},{day:"الخميس",date:"2024-04-18",completedExercises:4,completedMeals:2,value:60},{day:"الأربعاء",date:"2024-04-17",completedExercises:3,completedMeals:3,value:60},{day:"الثلاثاء",date:"2024-04-16",completedExercises:3,completedMeals:3,value:60},{day:"الإثنين",date:"2024-04-15",completedExercises:2,completedMeals:2,value:40},{day:"الأحد",date:"2024-04-14",completedExercises:5,completedMeals:4,value:90},{day:"السبت",date:"2024-04-13",completedExercises:3,completedMeals:2,value:50}],wr=async()=>{if(!q())return Jt();try{const{data:{user:a},error:t}=await S.auth.getUser();if(t||!a)return Jt();const s=Array.from({length:7},(o,c)=>{const d=new Date;return d.setDate(d.getDate()-c),d.toISOString().split("T")[0]}),{data:r,error:n}=await S.from("trainee_performance").select("date, completed_exercises, completed_meals, progress_value").eq("trainee_id",a.id).in("date",s);if(n)return console.error("Error fetching performance data:",n),Jt();const i=new Map;return r==null||r.forEach(o=>{const c=new Date(o.date),d=ns[c.getDay()];i.set(o.date,{day:d,date:o.date,completedExercises:o.completed_exercises,completedMeals:o.completed_meals,value:o.progress_value})}),s.map(o=>{const c=new Date(o).getDay(),d=ns[c];return i.has(o)?i.get(o):{day:d,date:o,completedExercises:0,completedMeals:0,value:0}})}catch(a){return console.error("Error fetching weekly performance:",a),Jt()}},ja=async(a,t)=>{if(!q()){const s=new Date,r=ns[s.getDay()],n=s.toISOString().split("T")[0],i=.6,l=.4,o=5,c=3,d=Math.min(1,a/o)*100*i,u=Math.min(1,t/c)*100*l,x=Math.round(d+u);return{day:r,date:n,completedExercises:a,completedMeals:t,value:x}}try{const{data:{user:s},error:r}=await S.auth.getUser();if(r||!s)return null;const n=new Date,i=n.toISOString().split("T")[0],l=.6,o=.4,c=5,d=3,u=Math.min(1,a/c)*100*l,x=Math.min(1,t/d)*100*o,g=Math.round(u+x),{data:b,error:p}=await S.from("trainee_performance").select("id").eq("trainee_id",s.id).eq("date",i).maybeSingle();if(p&&p.code!=="PGRST116")throw p;let v;if(b){const{data:f,error:N}=await S.from("trainee_performance").update({completed_exercises:a,completed_meals:t,progress_value:g,updated_at:new Date().toISOString()}).eq("id",b.id).select().single();if(N)throw N;v=f}else{const{data:f,error:N}=await S.from("trainee_performance").insert({id:Ie(),trainee_id:s.id,date:i,completed_exercises:a,completed_meals:t,progress_value:g}).select().single();if(N)throw N;v=f}return{day:ns[n.getDay()],date:v.date,completedExercises:v.completed_exercises,completedMeals:v.completed_meals,value:v.progress_value}}catch(s){return console.error("Error updating daily performance:",s),null}},uc=async()=>{if(!q())return!1;try{const{data:{user:a},error:t}=await S.auth.getUser();if(t||!a)return!1;const s=new Date,r=[];for(let i=0;i<7;i++){const l=new Date;l.setDate(s.getDate()-i);const o=l.toISOString().split("T")[0],c=Math.floor(Math.random()*5)+1,d=Math.floor(Math.random()*3)+1,u=.6,x=.4,g=5,b=3,p=Math.min(1,c/g)*100*u,v=Math.min(1,d/b)*100*x,h=Math.round(p+v);r.push({id:Ie(),trainee_id:a.id,date:o,completed_exercises:c,completed_meals:d,progress_value:h})}const{error:n}=await S.from("trainee_performance").upsert(r,{onConflict:"trainee_id,date"});if(n)throw n;return!0}catch(a){return console.error("Error generating mock weekly performance:",a),!1}};function hc({className:a=""}){const[t,s]=m.useState([]),[r,n]=m.useState(!0),[i,l]=m.useState(null);m.useEffect(()=>{o()},[]);const o=async()=>{try{n(!0),l(null);const c=await wr();if(c.length>0)s(c);else{await uc();const d=await wr();s(d)}}catch(c){console.error("Error fetching weekly progress:",c),l("حدث خطأ أثناء تحميل بيانات الأداء")}finally{n(!1)}};return e.jsxs("div",{className:`bg-[#1A1F2E]/60 backdrop-blur-sm rounded-2xl border border-[#0AE7F2]/20 p-6 ${a}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"الأداء الأسبوعي"}),e.jsx("button",{onClick:o,disabled:r,className:"p-2 hover:bg-[#0AE7F2]/10 rounded-full transition-colors text-[#0AE7F2] disabled:opacity-50",title:"تحديث",children:e.jsx(Os,{size:16,className:r?"animate-spin":""})})]}),e.jsx(dc,{data:t,loading:r,error:i,onRetry:o})]})}function mc({src:a,alt:t,width:s=200,height:r=150,className:n=""}){const[i,l]=m.useState(!1);return m.useEffect(()=>{l(!0);const o=setInterval(()=>{l(!0),setTimeout(()=>{l(!1)},1e3)},5e3);return()=>clearInterval(o)},[]),e.jsx(jt.div,{animate:i?{scale:[1,1.1,1]}:{},transition:{duration:1,ease:"easeInOut"},className:n,style:{width:s,height:r},children:e.jsx("img",{src:a,alt:t,className:"w-full h-full object-contain"})})}var ya={exports:{}};(function(a,t){(function(r,n){a.exports=n(m)})(ke,s=>(()=>{var r={"./node_modules/css-mediaquery/index.js":(o,c)=>{c.match=p,c.parse=v;var d=/(?:(only|not)?\s*([^\s\(\)]+)(?:\s*and)?\s*)?(.+)?/i,u=/\(\s*([^\s\:\)]+)\s*(?:\:\s*([^\s\)]+))?\s*\)/,x=/^(?:(min|max)-)?(.+)/,g=/(em|rem|px|cm|mm|in|pt|pc)?$/,b=/(dpi|dpcm|dppx)?$/;function p(w,j){return v(w).some(function(F){var C=F.inverse,A=F.type==="all"||j.type===F.type;if(A&&C||!(A||C))return!1;var E=F.expressions.every(function(_){var k=_.feature,O=_.modifier,M=_.value,y=j[k];if(!y)return!1;switch(k){case"orientation":case"scan":return y.toLowerCase()===M.toLowerCase();case"width":case"height":case"device-width":case"device-height":M=N(M),y=N(y);break;case"resolution":M=f(M),y=f(y);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":M=h(M),y=h(y);break;case"grid":case"color":case"color-index":case"monochrome":M=parseInt(M,10)||1,y=parseInt(y,10)||0;break}switch(O){case"min":return y>=M;case"max":return y<=M;default:return y===M}});return E&&!C||!E&&C})}function v(w){return w.split(",").map(function(j){j=j.trim();var F=j.match(d),C=F[1],A=F[2],E=F[3]||"",_={};return _.inverse=!!C&&C.toLowerCase()==="not",_.type=A?A.toLowerCase():"all",E=E.match(/\([^\)]+\)/g)||[],_.expressions=E.map(function(k){var O=k.match(u),M=O[1].toLowerCase().match(x);return{modifier:M[1],feature:M[2],value:O[2]}}),_})}function h(w){var j=Number(w),F;return j||(F=w.match(/^(\d+)\s*\/\s*(\d+)$/),j=F[1]/F[2]),j}function f(w){var j=parseFloat(w),F=String(w).match(b)[1];switch(F){case"dpcm":return j/2.54;case"dppx":return j*96;default:return j}}function N(w){var j=parseFloat(w),F=String(w).match(g)[1];switch(F){case"em":return j*16;case"rem":return j*16;case"cm":return j*96/2.54;case"mm":return j*96/2.54/10;case"in":return j*96;case"pt":return j*72;case"pc":return j*72/12;default:return j}}},"./node_modules/hyphenate-style-name/index.js":(o,c,d)=>{d.r(c),d.d(c,{default:()=>v});var u=/[A-Z]/g,x=/^ms-/,g={};function b(h){return"-"+h.toLowerCase()}function p(h){if(g.hasOwnProperty(h))return g[h];var f=h.replace(u,b);return g[h]=x.test(f)?"-"+f:f}const v=p},"./node_modules/matchmediaquery/index.js":(o,c,d)=>{var u=d("./node_modules/css-mediaquery/index.js").match,x=typeof window<"u"?window.matchMedia:null;function g(p,v,h){var f=this;if(x&&!h){var N=x.call(window,p);this.matches=N.matches,this.media=N.media,N.addListener(F)}else this.matches=u(p,v),this.media=p;this.addListener=w,this.removeListener=j,this.dispose=C;function w(A){N&&N.addListener(A)}function j(A){N&&N.removeListener(A)}function F(A){f.matches=A.matches,f.media=A.media}function C(){N&&N.removeListener(F)}}function b(p,v,h){return new g(p,v,h)}o.exports=b},"./node_modules/object-assign/index.js":o=>{/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var c=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable;function x(b){if(b==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(b)}function g(){try{if(!Object.assign)return!1;var b=new String("abc");if(b[5]="de",Object.getOwnPropertyNames(b)[0]==="5")return!1;for(var p={},v=0;v<10;v++)p["_"+String.fromCharCode(v)]=v;var h=Object.getOwnPropertyNames(p).map(function(N){return p[N]});if(h.join("")!=="0123456789")return!1;var f={};return"abcdefghijklmnopqrst".split("").forEach(function(N){f[N]=N}),Object.keys(Object.assign({},f)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}o.exports=g()?Object.assign:function(b,p){for(var v,h=x(b),f,N=1;N<arguments.length;N++){v=Object(arguments[N]);for(var w in v)d.call(v,w)&&(h[w]=v[w]);if(c){f=c(v);for(var j=0;j<f.length;j++)u.call(v,f[j])&&(h[f[j]]=v[f[j]])}}return h}},"./node_modules/prop-types/checkPropTypes.js":(o,c,d)=>{var u=function(){};{var x=d("./node_modules/prop-types/lib/ReactPropTypesSecret.js"),g={},b=d("./node_modules/prop-types/lib/has.js");u=function(v){var h="Warning: "+v;typeof console<"u"&&console.error(h);try{throw new Error(h)}catch{}}}function p(v,h,f,N,w){for(var j in v)if(b(v,j)){var F;try{if(typeof v[j]!="function"){var C=Error((N||"React class")+": "+f+" type `"+j+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof v[j]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw C.name="Invariant Violation",C}F=v[j](h,j,N,f,null,x)}catch(E){F=E}if(F&&!(F instanceof Error)&&u((N||"React class")+": type specification of "+f+" `"+j+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof F+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),F instanceof Error&&!(F.message in g)){g[F.message]=!0;var A=w?w():"";u("Failed "+f+" type: "+F.message+(A??""))}}}p.resetWarningCache=function(){g={}},o.exports=p},"./node_modules/prop-types/factoryWithTypeCheckers.js":(o,c,d)=>{var u=d("./node_modules/react-is/index.js"),x=d("./node_modules/object-assign/index.js"),g=d("./node_modules/prop-types/lib/ReactPropTypesSecret.js"),b=d("./node_modules/prop-types/lib/has.js"),p=d("./node_modules/prop-types/checkPropTypes.js"),v=function(){};v=function(f){var N="Warning: "+f;typeof console<"u"&&console.error(N);try{throw new Error(N)}catch{}};function h(){return null}o.exports=function(f,N){var w=typeof Symbol=="function"&&Symbol.iterator,j="@@iterator";function F(D){var U=D&&(w&&D[w]||D[j]);if(typeof U=="function")return U}var C="<<anonymous>>",A={array:O("array"),bigint:O("bigint"),bool:O("boolean"),func:O("function"),number:O("number"),object:O("object"),string:O("string"),symbol:O("symbol"),any:M(),arrayOf:y,element:W(),elementType:z(),instanceOf:I,node:X(),objectOf:T,oneOf:H,oneOfType:G,shape:Q,exact:$};function E(D,U){return D===U?D!==0||1/D===1/U:D!==D&&U!==U}function _(D,U){this.message=D,this.data=U&&typeof U=="object"?U:{},this.stack=""}_.prototype=Error.prototype;function k(D){var U={},L=0;function K(ne,te,se,ie,le,oe,V){if(ie=ie||C,oe=oe||se,V!==g){if(N){var ge=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw ge.name="Invariant Violation",ge}else if(typeof console<"u"){var Ce=ie+":"+se;!U[Ce]&&L<3&&(v("You are manually calling a React.PropTypes validation function for the `"+oe+"` prop on `"+ie+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),U[Ce]=!0,L++)}}return te[se]==null?ne?te[se]===null?new _("The "+le+" `"+oe+"` is marked as required "+("in `"+ie+"`, but its value is `null`.")):new _("The "+le+" `"+oe+"` is marked as required in "+("`"+ie+"`, but its value is `undefined`.")):null:D(te,se,ie,le,oe)}var Z=K.bind(null,!1);return Z.isRequired=K.bind(null,!0),Z}function O(D){function U(L,K,Z,ne,te,se){var ie=L[K],le=R(ie);if(le!==D){var oe=Y(ie);return new _("Invalid "+ne+" `"+te+"` of type "+("`"+oe+"` supplied to `"+Z+"`, expected ")+("`"+D+"`."),{expectedType:D})}return null}return k(U)}function M(){return k(h)}function y(D){function U(L,K,Z,ne,te){if(typeof D!="function")return new _("Property `"+te+"` of component `"+Z+"` has invalid PropType notation inside arrayOf.");var se=L[K];if(!Array.isArray(se)){var ie=R(se);return new _("Invalid "+ne+" `"+te+"` of type "+("`"+ie+"` supplied to `"+Z+"`, expected an array."))}for(var le=0;le<se.length;le++){var oe=D(se,le,Z,ne,te+"["+le+"]",g);if(oe instanceof Error)return oe}return null}return k(U)}function W(){function D(U,L,K,Z,ne){var te=U[L];if(!f(te)){var se=R(te);return new _("Invalid "+Z+" `"+ne+"` of type "+("`"+se+"` supplied to `"+K+"`, expected a single ReactElement."))}return null}return k(D)}function z(){function D(U,L,K,Z,ne){var te=U[L];if(!u.isValidElementType(te)){var se=R(te);return new _("Invalid "+Z+" `"+ne+"` of type "+("`"+se+"` supplied to `"+K+"`, expected a single ReactElement type."))}return null}return k(D)}function I(D){function U(L,K,Z,ne,te){if(!(L[K]instanceof D)){var se=D.name||C,ie=B(L[K]);return new _("Invalid "+ne+" `"+te+"` of type "+("`"+ie+"` supplied to `"+Z+"`, expected ")+("instance of `"+se+"`."))}return null}return k(U)}function H(D){if(!Array.isArray(D))return arguments.length>1?v("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):v("Invalid argument supplied to oneOf, expected an array."),h;function U(L,K,Z,ne,te){for(var se=L[K],ie=0;ie<D.length;ie++)if(E(se,D[ie]))return null;var le=JSON.stringify(D,function(V,ge){var Ce=Y(ge);return Ce==="symbol"?String(ge):ge});return new _("Invalid "+ne+" `"+te+"` of value `"+String(se)+"` "+("supplied to `"+Z+"`, expected one of "+le+"."))}return k(U)}function T(D){function U(L,K,Z,ne,te){if(typeof D!="function")return new _("Property `"+te+"` of component `"+Z+"` has invalid PropType notation inside objectOf.");var se=L[K],ie=R(se);if(ie!=="object")return new _("Invalid "+ne+" `"+te+"` of type "+("`"+ie+"` supplied to `"+Z+"`, expected an object."));for(var le in se)if(b(se,le)){var oe=D(se,le,Z,ne,te+"."+le,g);if(oe instanceof Error)return oe}return null}return k(U)}function G(D){if(!Array.isArray(D))return v("Invalid argument supplied to oneOfType, expected an instance of array."),h;for(var U=0;U<D.length;U++){var L=D[U];if(typeof L!="function")return v("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+pe(L)+" at index "+U+"."),h}function K(Z,ne,te,se,ie){for(var le=[],oe=0;oe<D.length;oe++){var V=D[oe],ge=V(Z,ne,te,se,ie,g);if(ge==null)return null;ge.data&&b(ge.data,"expectedType")&&le.push(ge.data.expectedType)}var Ce=le.length>0?", expected one of type ["+le.join(", ")+"]":"";return new _("Invalid "+se+" `"+ie+"` supplied to "+("`"+te+"`"+Ce+"."))}return k(K)}function X(){function D(U,L,K,Z,ne){return P(U[L])?null:new _("Invalid "+Z+" `"+ne+"` supplied to "+("`"+K+"`, expected a ReactNode."))}return k(D)}function ae(D,U,L,K,Z){return new _((D||"React class")+": "+U+" type `"+L+"."+K+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+Z+"`.")}function Q(D){function U(L,K,Z,ne,te){var se=L[K],ie=R(se);if(ie!=="object")return new _("Invalid "+ne+" `"+te+"` of type `"+ie+"` "+("supplied to `"+Z+"`, expected `object`."));for(var le in D){var oe=D[le];if(typeof oe!="function")return ae(Z,ne,te,le,Y(oe));var V=oe(se,le,Z,ne,te+"."+le,g);if(V)return V}return null}return k(U)}function $(D){function U(L,K,Z,ne,te){var se=L[K],ie=R(se);if(ie!=="object")return new _("Invalid "+ne+" `"+te+"` of type `"+ie+"` "+("supplied to `"+Z+"`, expected `object`."));var le=x({},L[K],D);for(var oe in le){var V=D[oe];if(b(D,oe)&&typeof V!="function")return ae(Z,ne,te,oe,Y(V));if(!V)return new _("Invalid "+ne+" `"+te+"` key `"+oe+"` supplied to `"+Z+"`.\nBad object: "+JSON.stringify(L[K],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(D),null,"  "));var ge=V(se,oe,Z,ne,te+"."+oe,g);if(ge)return ge}return null}return k(U)}function P(D){switch(typeof D){case"number":case"string":case"undefined":return!0;case"boolean":return!D;case"object":if(Array.isArray(D))return D.every(P);if(D===null||f(D))return!0;var U=F(D);if(U){var L=U.call(D),K;if(U!==D.entries){for(;!(K=L.next()).done;)if(!P(K.value))return!1}else for(;!(K=L.next()).done;){var Z=K.value;if(Z&&!P(Z[1]))return!1}}else return!1;return!0;default:return!1}}function J(D,U){return D==="symbol"?!0:U?U["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&U instanceof Symbol:!1}function R(D){var U=typeof D;return Array.isArray(D)?"array":D instanceof RegExp?"object":J(U,D)?"symbol":U}function Y(D){if(typeof D>"u"||D===null)return""+D;var U=R(D);if(U==="object"){if(D instanceof Date)return"date";if(D instanceof RegExp)return"regexp"}return U}function pe(D){var U=Y(D);switch(U){case"array":case"object":return"an "+U;case"boolean":case"date":case"regexp":return"a "+U;default:return U}}function B(D){return!D.constructor||!D.constructor.name?C:D.constructor.name}return A.checkPropTypes=p,A.resetWarningCache=p.resetWarningCache,A.PropTypes=A,A}},"./node_modules/prop-types/index.js":(o,c,d)=>{{var u=d("./node_modules/react-is/index.js"),x=!0;o.exports=d("./node_modules/prop-types/factoryWithTypeCheckers.js")(u.isElement,x)}},"./node_modules/prop-types/lib/ReactPropTypesSecret.js":o=>{var c="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";o.exports=c},"./node_modules/prop-types/lib/has.js":o=>{o.exports=Function.call.bind(Object.prototype.hasOwnProperty)},"./node_modules/react-is/cjs/react-is.development.js":(o,c)=>{/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var d=typeof Symbol=="function"&&Symbol.for,u=d?Symbol.for("react.element"):60103,x=d?Symbol.for("react.portal"):60106,g=d?Symbol.for("react.fragment"):60107,b=d?Symbol.for("react.strict_mode"):60108,p=d?Symbol.for("react.profiler"):60114,v=d?Symbol.for("react.provider"):60109,h=d?Symbol.for("react.context"):60110,f=d?Symbol.for("react.async_mode"):60111,N=d?Symbol.for("react.concurrent_mode"):60111,w=d?Symbol.for("react.forward_ref"):60112,j=d?Symbol.for("react.suspense"):60113,F=d?Symbol.for("react.suspense_list"):60120,C=d?Symbol.for("react.memo"):60115,A=d?Symbol.for("react.lazy"):60116,E=d?Symbol.for("react.block"):60121,_=d?Symbol.for("react.fundamental"):60117,k=d?Symbol.for("react.responder"):60118,O=d?Symbol.for("react.scope"):60119;function M(V){return typeof V=="string"||typeof V=="function"||V===g||V===N||V===p||V===b||V===j||V===F||typeof V=="object"&&V!==null&&(V.$$typeof===A||V.$$typeof===C||V.$$typeof===v||V.$$typeof===h||V.$$typeof===w||V.$$typeof===_||V.$$typeof===k||V.$$typeof===O||V.$$typeof===E)}function y(V){if(typeof V=="object"&&V!==null){var ge=V.$$typeof;switch(ge){case u:var Ce=V.type;switch(Ce){case f:case N:case g:case p:case b:case j:return Ce;default:var Ks=Ce&&Ce.$$typeof;switch(Ks){case h:case w:case A:case C:case v:return Ks;default:return ge}}case x:return ge}}}var W=f,z=N,I=h,H=v,T=u,G=w,X=g,ae=A,Q=C,$=x,P=p,J=b,R=j,Y=!1;function pe(V){return Y||(Y=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),B(V)||y(V)===f}function B(V){return y(V)===N}function D(V){return y(V)===h}function U(V){return y(V)===v}function L(V){return typeof V=="object"&&V!==null&&V.$$typeof===u}function K(V){return y(V)===w}function Z(V){return y(V)===g}function ne(V){return y(V)===A}function te(V){return y(V)===C}function se(V){return y(V)===x}function ie(V){return y(V)===p}function le(V){return y(V)===b}function oe(V){return y(V)===j}c.AsyncMode=W,c.ConcurrentMode=z,c.ContextConsumer=I,c.ContextProvider=H,c.Element=T,c.ForwardRef=G,c.Fragment=X,c.Lazy=ae,c.Memo=Q,c.Portal=$,c.Profiler=P,c.StrictMode=J,c.Suspense=R,c.isAsyncMode=pe,c.isConcurrentMode=B,c.isContextConsumer=D,c.isContextProvider=U,c.isElement=L,c.isForwardRef=K,c.isFragment=Z,c.isLazy=ne,c.isMemo=te,c.isPortal=se,c.isProfiler=ie,c.isStrictMode=le,c.isSuspense=oe,c.isValidElementType=M,c.typeOf=y})()},"./node_modules/react-is/index.js":(o,c,d)=>{o.exports=d("./node_modules/react-is/cjs/react-is.development.js")},"./node_modules/shallow-equal/dist/index.esm.js":(o,c,d)=>{d.r(c),d.d(c,{shallowEqualArrays:()=>x,shallowEqualObjects:()=>u});function u(g,b){if(g===b)return!0;if(!g||!b)return!1;var p=Object.keys(g),v=Object.keys(b),h=p.length;if(v.length!==h)return!1;for(var f=0;f<h;f++){var N=p[f];if(g[N]!==b[N]||!Object.prototype.hasOwnProperty.call(b,N))return!1}return!0}function x(g,b){if(g===b)return!0;if(!g||!b)return!1;var p=g.length;if(b.length!==p)return!1;for(var v=0;v<p;v++)if(g[v]!==b[v])return!1;return!0}},"./src/Component.ts":function(o,c,d){var u=this&&this.__rest||function(p,v){var h={};for(var f in p)Object.prototype.hasOwnProperty.call(p,f)&&v.indexOf(f)<0&&(h[f]=p[f]);if(p!=null&&typeof Object.getOwnPropertySymbols=="function")for(var N=0,f=Object.getOwnPropertySymbols(p);N<f.length;N++)v.indexOf(f[N])<0&&Object.prototype.propertyIsEnumerable.call(p,f[N])&&(h[f[N]]=p[f[N]]);return h},x=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(c,"__esModule",{value:!0});var g=x(d("./src/useMediaQuery.ts")),b=function(p){var v=p.children,h=p.device,f=p.onChange,N=u(p,["children","device","onChange"]),w=(0,g.default)(N,h,f);return typeof v=="function"?v(w):w?v:null};c.default=b},"./src/Context.ts":(o,c,d)=>{Object.defineProperty(c,"__esModule",{value:!0});var u=d("react"),x=(0,u.createContext)(void 0);c.default=x},"./src/index.ts":function(o,c,d){var u=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(c,"__esModule",{value:!0}),c.Context=c.toQuery=c.useMediaQuery=c.default=void 0;var x=u(d("./src/useMediaQuery.ts"));c.useMediaQuery=x.default;var g=u(d("./src/Component.ts"));c.default=g.default;var b=u(d("./src/toQuery.ts"));c.toQuery=b.default;var p=u(d("./src/Context.ts"));c.Context=p.default},"./src/mediaQuery.ts":function(o,c,d){var u=this&&this.__assign||function(){return u=Object.assign||function(j){for(var F,C=1,A=arguments.length;C<A;C++){F=arguments[C];for(var E in F)Object.prototype.hasOwnProperty.call(F,E)&&(j[E]=F[E])}return j},u.apply(this,arguments)},x=this&&this.__rest||function(j,F){var C={};for(var A in j)Object.prototype.hasOwnProperty.call(j,A)&&F.indexOf(A)<0&&(C[A]=j[A]);if(j!=null&&typeof Object.getOwnPropertySymbols=="function")for(var E=0,A=Object.getOwnPropertySymbols(j);E<A.length;E++)F.indexOf(A[E])<0&&Object.prototype.propertyIsEnumerable.call(j,A[E])&&(C[A[E]]=j[A[E]]);return C},g=this&&this.__importDefault||function(j){return j&&j.__esModule?j:{default:j}};Object.defineProperty(c,"__esModule",{value:!0});var b=g(d("./node_modules/prop-types/index.js")),p=b.default.oneOfType([b.default.string,b.default.number]),v={all:b.default.bool,grid:b.default.bool,aural:b.default.bool,braille:b.default.bool,handheld:b.default.bool,print:b.default.bool,projection:b.default.bool,screen:b.default.bool,tty:b.default.bool,tv:b.default.bool,embossed:b.default.bool},h={orientation:b.default.oneOf(["portrait","landscape"]),scan:b.default.oneOf(["progressive","interlace"]),aspectRatio:b.default.string,deviceAspectRatio:b.default.string,height:p,deviceHeight:p,width:p,deviceWidth:p,color:b.default.bool,colorIndex:b.default.bool,monochrome:b.default.bool,resolution:p,type:Object.keys(v)};h.type;var f=x(h,["type"]),N=u({minAspectRatio:b.default.string,maxAspectRatio:b.default.string,minDeviceAspectRatio:b.default.string,maxDeviceAspectRatio:b.default.string,minHeight:p,maxHeight:p,minDeviceHeight:p,maxDeviceHeight:p,minWidth:p,maxWidth:p,minDeviceWidth:p,maxDeviceWidth:p,minColor:b.default.number,maxColor:b.default.number,minColorIndex:b.default.number,maxColorIndex:b.default.number,minMonochrome:b.default.number,maxMonochrome:b.default.number,minResolution:p,maxResolution:p},f),w=u(u({},v),N);c.default={all:w,types:v,matchers:h,features:N}},"./src/toQuery.ts":function(o,c,d){var u=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(c,"__esModule",{value:!0});var x=u(d("./node_modules/hyphenate-style-name/index.js")),g=u(d("./src/mediaQuery.ts")),b=function(f){return"not ".concat(f)},p=function(f,N){var w=(0,x.default)(f);return typeof N=="number"&&(N="".concat(N,"px")),N===!0?w:N===!1?b(w):"(".concat(w,": ").concat(N,")")},v=function(f){return f.join(" and ")},h=function(f){var N=[];return Object.keys(g.default.all).forEach(function(w){var j=f[w];j!=null&&N.push(p(w,j))}),v(N)};c.default=h},"./src/useMediaQuery.ts":function(o,c,d){var u=this&&this.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(c,"__esModule",{value:!0});var x=d("react"),g=u(d("./node_modules/matchmediaquery/index.js")),b=u(d("./node_modules/hyphenate-style-name/index.js")),p=d("./node_modules/shallow-equal/dist/index.esm.js"),v=u(d("./src/toQuery.ts")),h=u(d("./src/Context.ts")),f=function(_){return _.query||(0,v.default)(_)},N=function(_){if(_){var k=Object.keys(_);return k.reduce(function(O,M){return O[(0,b.default)(M)]=_[M],O},{})}},w=function(){var _=(0,x.useRef)(!1);return(0,x.useEffect)(function(){_.current=!0},[]),_.current},j=function(_){var k=(0,x.useContext)(h.default),O=function(){return N(_)||N(k)},M=(0,x.useState)(O),y=M[0],W=M[1];return(0,x.useEffect)(function(){var z=O();(0,p.shallowEqualObjects)(y,z)||W(z)},[_,k]),y},F=function(_){var k=function(){return f(_)},O=(0,x.useState)(k),M=O[0],y=O[1];return(0,x.useEffect)(function(){var W=k();M!==W&&y(W)},[_]),M},C=function(_,k){var O=function(){return(0,g.default)(_,k||{},!!k)},M=(0,x.useState)(O),y=M[0],W=M[1],z=w();return(0,x.useEffect)(function(){if(z){var I=O();return W(I),function(){I&&I.dispose()}}},[_,k]),y},A=function(_){var k=(0,x.useState)(_.matches),O=k[0],M=k[1];return(0,x.useEffect)(function(){var y=function(W){M(W.matches)};return _.addListener(y),M(_.matches),function(){_.removeListener(y)}},[_]),O},E=function(_,k,O){var M=j(k),y=F(_);if(!y)throw new Error("Invalid or missing MediaQuery!");var W=C(y,M),z=A(W),I=w();return(0,x.useEffect)(function(){I&&O&&O(z)},[z]),(0,x.useEffect)(function(){return function(){W&&W.dispose()}},[]),z};c.default=E},react:o=>{o.exports=s}},n={};function i(o){var c=n[o];if(c!==void 0)return c.exports;var d=n[o]={exports:{}};return r[o].call(d.exports,d,d.exports,i),d.exports}i.d=(o,c)=>{for(var d in c)i.o(c,d)&&!i.o(o,d)&&Object.defineProperty(o,d,{enumerable:!0,get:c[d]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var l=i("./src/index.ts");return l})())})(ya);var xc=ya.exports;function fc(){const a=de(),[t,s]=m.useState(""),[r,n]=m.useState("⚦"),[i,l]=m.useState(0),[o,c]=m.useState(!1);xc.useMediaQuery({maxWidth:768}),m.useEffect(()=>{d(),u()},[]);const d=async()=>{try{if(q()){const{data:{user:p}}=await S.auth.getUser();if(p){const{data:v,error:h}=await S.from("trainee_profiles").select("name, gender").eq("id",p.id).single();if(h){console.error("Error fetching profile:",h);return}v&&(s(v.name||""),n(v.gender==="male"?"♂":v.gender==="female"?"♀":"⚦"))}}else{const p=await po();p&&(s(p.name||""),n(p.gender==="male"?"♂":p.gender==="female"?"♀":"⚦"))}}catch(p){console.error("Failed to fetch trainee profile:",p)}},u=async()=>{if(q())try{const{data:{user:p}}=await S.auth.getUser();if(!p)return;const{count:v,error:h}=await S.from("notifications").select("id",{count:"exact",head:!0}).or(`recipient_id.eq.${p.id},recipient_id.is.null`).is("read_at",null);h||l(v||0)}catch(p){console.error("Error fetching notifications:",p)}},x=p=>{const v={home:"/trainee",diet:"/trainee/diet",weight:"/trainee/weight",exercise:"/trainee/exercise",profile:"/trainee/profile",steps:"/trainee/steps",notifications:"/trainee/notifications",chat:"/trainee/chat",settings:"/trainee/profile"};v[p]&&(a(v[p]),c(!1))},g=()=>{localStorage.removeItem("userType"),localStorage.removeItem("traineeProfile"),localStorage.removeItem("traineeId"),a("/trainee/login")},b=[{id:"home",label:"الرئيسية",icon:kr},{id:"exercise",label:"التمارين",icon:Xe},{id:"diet",label:"البرنامج الغذائي",icon:Be},{id:"weight",label:"الوزن",icon:Ca},{id:"steps",label:"الخطوات",icon:Oe},{id:"profile",label:"الملف الشخصي",icon:Ae},{id:"notifications",label:"الإشعارات",icon:Me,badge:i},{id:"settings",label:"الإعدادات",icon:$t}];return e.jsxs("div",{dir:"rtl",className:"h-screen bg-[#0A0F1C] text-white overflow-hidden flex flex-col",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)",touchAction:"none"},children:[e.jsx("div",{className:"fixed inset-0 z-0",style:{backgroundImage:`url("${nt.backgrounds.main}")`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>c(!1)}),e.jsx("div",{className:`fixed top-0 right-0 h-full w-64 bg-[#1A1F2E]/95 backdrop-blur-lg z-50 transition-transform duration-300 ease-in-out ${o?"translate-x-0":"translate-x-full"}`,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-[#0AE7F2]/20 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>c(!1),className:"p-2 rounded-full hover:bg-[#0AE7F2]/10",children:e.jsx(ue,{size:24,className:"text-[#0AE7F2]"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center",children:e.jsx(Ae,{size:20,className:"text-[#0AE7F2]"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"font-bold",children:t}),e.jsxs("div",{className:"flex items-center text-[#0AE7F2] text-sm",children:[e.jsx(Sr,{size:12,className:"ml-1"}),e.jsx("span",{children:r==="♂"?"ذكر":r==="♀"?"أنثى":"آخر"})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto py-4",children:e.jsx("div",{className:"space-y-1 px-3",children:b.map(p=>e.jsxs("button",{onClick:()=>x(p.id),className:"w-full flex items-center justify-between p-3 rounded-xl hover:bg-[#0AE7F2]/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center",children:e.jsx(p.icon,{size:18,className:"text-[#0AE7F2]"})}),e.jsx("span",{children:p.label})]}),e.jsxs("div",{className:"flex items-center",children:[p.badge&&p.badge>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center ml-2",children:p.badge>9?"9+":p.badge}),e.jsx(Cr,{size:16,className:"text-gray-400"})]})]},p.id))})}),e.jsx("div",{className:"p-4 border-t border-[#0AE7F2]/20",children:e.jsxs("button",{onClick:g,className:"w-full flex items-center gap-3 p-3 rounded-xl text-rose-500 hover:bg-rose-500/10 transition-colors",children:[e.jsx(Tr,{size:20}),e.jsx("span",{children:"تسجيل الخروج"})]})})]})}),e.jsxs("div",{className:"relative z-10 w-full max-w-md mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("button",{onClick:()=>c(!0),className:"relative","aria-label":"القائمة",children:e.jsx(Pr,{className:"w-7 h-7 text-white"})}),e.jsx(mc,{src:"https://souqpale.com/wp-content/uploads/2025/03/تصميم-بدون-عنوان-9.png",alt:"Logo",width:140,height:80}),e.jsxs("button",{onClick:()=>a("/trainee/notifications"),className:"relative","aria-label":"الإشعارات",children:[e.jsx(Me,{className:"w-7 h-7 text-white"}),i>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-[10px] min-w-[16px] h-4 px-1 flex items-center justify-center rounded-full",children:i})]})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsx(jt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.7},className:"text-[16px] md:text-[18px] font-semibold text-[#0AE7F2]",children:t?`مرحباً بك ${r} ${t}`:"مرحباً بك في تطبيق MK"})}),e.jsx("div",{className:"flex flex-col items-center mt-6",children:e.jsx("div",{className:"grid grid-cols-2 gap-x-14 gap-y-11",children:[{label:"وزنك الصباحي",icon:nt.icons.weightScale,route:"weight"},{label:"برنامجك الغذائي",icon:nt.icons.foodProgram,route:"diet"},{label:"صفحة حسابك",icon:nt.icons.profile,route:"profile"},{label:"برنامج تمارينك",icon:nt.icons.exerciseProgram,route:"exercise"}].map(({label:p,icon:v,route:h})=>e.jsxs("button",{onClick:()=>x(h),className:"relative w-[100px] h-[100px] md:w-[120px] md:h-[120px] flex flex-col items-center justify-center group hover:scale-105 transition","aria-label":p,children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-[20px] border-[3px] md:border-[3.5px] border-[#0ae7f2]"}),e.jsx("img",{src:v,alt:p,className:"relative w-10 h-10 md:w-12 md:h-12 object-contain mb-1"}),e.jsx("span",{className:"relative text-[11px] md:text-[12px] font-medium text-[#0AE7F2] text-center leading-tight",children:p})]},h))})}),e.jsx(jt.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.8},className:"mt-8 mb-[calc(80px+env(safe-area-inset-bottom))] origin-top",children:e.jsx(hc,{})})]}),e.jsx(mt,{})]})}const pc=async(a,t)=>{if(!q())return{id:Date.now().toString(),userId:"test-user-id",weight:a,date:new Date().toISOString(),notes:t};try{const{data:{user:s}}=await S.auth.getUser();if(!s)throw new Error("المستخدم غير مسجل الدخول");const n=new Date().toISOString().split("T")[0],{data:i,error:l}=await S.from("weight_records").insert({user_id:s.id,weight:a,date:n,notes:t}).select().single();if(l)throw l;const{error:o}=await S.from("trainee_profiles").update({current_weight:a,updated_at:new Date().toISOString()}).eq("id",s.id);if(o)throw o;const c=localStorage.getItem("traineeProfile");if(c){const d=JSON.parse(c);d.weight=a,localStorage.setItem("traineeProfile",JSON.stringify(d))}return{id:i.id,userId:i.user_id,weight:i.weight,date:i.date,notes:i.notes}}catch(s){throw console.error("Error submitting weight:",s),s}},gc=async a=>{if(!q()){const t=localStorage.getItem("traineeProfile");if(t){const s=JSON.parse(t);s.weight=a,localStorage.setItem("traineeProfile",JSON.stringify(s))}return}try{const{data:{user:t}}=await S.auth.getUser();if(!t)throw new Error("المستخدم غير مسجل الدخول");const{error:s}=await S.from("trainee_profiles").update({current_weight:a,updated_at:new Date().toISOString()}).eq("id",t.id);if(s)throw s;const r=localStorage.getItem("traineeProfile");if(r){const n=JSON.parse(r);n.weight=a,localStorage.setItem("traineeProfile",JSON.stringify(n))}}catch(t){throw console.error("Error updating trainee weight:",t),t}};function bc({onBack:a,onCaloriesRateClick:t}){const s=de(),[r,n]=m.useState(70),[i]=m.useState(2228),[l,o]=m.useState(!1),[c,d]=m.useState(r),[u,x]=m.useState(!1),[g,b]=m.useState(null),[p,v]=m.useState(null),[h,f]=m.useState(!1),[N,w]=m.useState(0),[j,F]=m.useState(0);m.useEffect(()=>{const T=localStorage.getItem("traineeProfile");if(T)try{const G=JSON.parse(T);G.weight&&(n(G.weight),d(G.weight))}catch(G){console.error("Error parsing stored profile:",G)}},[]);const C=()=>{s("/trainee")},A=()=>{s("/trainee/calories")},E=T=>{const G=Math.min(Math.max(30,Number(T.toFixed(1))),200);d(G),n(G)},_=T=>{f(!0),w(T.touches[0].clientX),F(r)},k=T=>{T.preventDefault(),f(!0),w(T.clientX),F(r)},O=T=>{if(!h)return;const X=(N-T.touches[0].clientX)*.15;E(j-X)},M=T=>{if(!h)return;const X=(N-T.clientX)*.15;E(j-X)},y=()=>{f(!1)},W=async()=>{x(!0),b(null),v(null);try{await gc(c),n(c),o(!1),v("تم تحديث الوزن بنجاح")}catch(T){console.error("Error updating weight:",T),b(T instanceof Error?T.message:"حدث خطأ أثناء تحديث الوزن")}finally{x(!1)}},z=async()=>{x(!0),b(null),v(null);try{await pc(r),v("تم إرسال الوزن بنجاح!")}catch(T){console.error("Error submitting weight:",T),b(T instanceof Error?T.message:"حدث خطأ أثناء إرسال الوزن")}finally{x(!1)}},I=()=>{const X=(r-30)/170*100;return Math.max(0,Math.min(100,X))},H=T=>{const G=I(),X=T/49*100,ae=Math.abs(X-G),Q=20;if(ae<=Q){const $=1-ae/Q,P=32,R=P+(48-P)*$,Y=.3+.7*$;return{height:`${R}px`,backgroundColor:`rgba(10, 231, 242, ${Y})`}}return{height:"32px",backgroundColor:"rgba(10, 231, 242, 0.3)"}};return e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base internal-bg",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsx("div",{className:"header-base",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:C,className:"text-white",children:e.jsx(me,{size:24})}),e.jsx("h1",{className:"text-xl font-bold",children:"وزنك الحالي"}),e.jsx("div",{className:"w-6"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto content-container",children:e.jsxs("div",{className:"space-y-6",children:[g&&e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:g}),p&&e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500 text-emerald-500 p-4 rounded-xl text-center",children:p}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"inline-block",children:e.jsxs("h2",{className:"text-[#0AE7F2] text-6xl font-bold mb-2",children:[r.toFixed(1)," Kg"]})})}),e.jsxs("div",{className:"card-base",children:[e.jsxs("div",{className:"h-16 flex items-center justify-center cursor-pointer select-none touch-none relative",onTouchStart:_,onTouchMove:O,onTouchEnd:y,onMouseDown:k,onMouseMove:M,onMouseUp:y,onMouseLeave:y,children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-[#0AE7F2] rounded-full transition-all duration-200 z-10 shadow-[0_0_10px_rgba(10,231,242,0.5)]",style:{left:`${I()}%`}}),e.jsx("div",{className:"w-full flex items-center justify-center space-x-1 rtl:space-x-reverse",children:Array.from({length:50}).map((T,G)=>e.jsx("div",{className:"w-0.5 transition-all duration-200",style:H(G)},G))})]}),e.jsx("p",{className:"text-center text-sm text-gray-400 mt-2",children:"اسحب يميناً أو يساراً لتعديل الوزن"})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-gray-400 text-lg",children:["الرجاء إرسال وزنك كل يوم أحد من خلال",e.jsx("br",{}),"الضغط على زر ",e.jsx("span",{className:"text-[#0AE7F2]",children:"الإرسال"})," بالأسفل"]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:z,disabled:u,className:"flex-1 bg-black/60 backdrop-blur-sm border-[1.5px] border-[#0AE7F2] hover:border-[#0AE7F2]/80 text-[#0AE7F2] py-4 rounded-2xl font-medium disabled:opacity-50 transition-colors text-lg",children:u?"جاري الإرسال...":"أرسل وزني!"}),e.jsx("button",{onClick:()=>{d(r),o(!0)},disabled:u,className:"flex-1 bg-[#0AE7F2] text-black py-4 rounded-2xl font-medium disabled:opacity-50 hover:bg-[#0AE7F2]/90 transition-colors text-lg",children:"تحديث وزني!"})]}),e.jsxs("button",{onClick:A,className:"w-full card-base cursor-pointer hover:bg-[#1A1F2E]/80 transition-colors",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"معدل الحرق!"}),e.jsxs("div",{className:"flex items-center justify-center bg-black/40 rounded-2xl p-4",children:[e.jsx("div",{className:"text-[#0AE7F2] mr-2",children:e.jsx(Ta,{size:32,className:"drop-shadow-[0_0_8px_rgba(10,231,242,0.5)]"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[#0AE7F2] text-2xl font-bold",children:i}),e.jsx("p",{className:"text-sm text-gray-400",children:"Kcal"})]})]})]})]})}),e.jsx(mt,{})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl p-6 w-[90%] max-w-md mx-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-6 text-center",children:"تحديث الوزن"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-8",children:[e.jsx("button",{onClick:()=>E(c-.1),className:"w-12 h-12 rounded-full bg-[#0AE7F2]/10 text-[#0AE7F2] flex items-center justify-center hover:bg-[#0AE7F2]/20 transition-colors",disabled:u,children:e.jsx(Mr,{size:24,className:"drop-shadow-[0_0_8px_rgba(10,231,242,0.5)]"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("input",{type:"number",value:c,onChange:T=>E(parseFloat(T.target.value)),className:"w-24 bg-transparent text-center text-4xl font-bold text-[#0AE7F2] focus:outline-none",step:"0.1",disabled:u}),e.jsx("p",{className:"text-gray-400",children:"Kg"})]}),e.jsx("button",{onClick:()=>E(c+.1),className:"w-12 h-12 rounded-full bg-[#0AE7F2]/10 text-[#0AE7F2] flex items-center justify-center hover:bg-[#0AE7F2]/20 transition-colors",disabled:u,children:e.jsx(ze,{size:24,className:"drop-shadow-[0_0_8px_rgba(10,231,242,0.5)]"})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>o(!1),disabled:u,className:"flex-1 py-3 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:W,disabled:u,className:"flex-1 py-3 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors",children:u?"جاري الحفظ...":"حفظ"})]})]})})]})}function vc({onBack:a}){const t=de(),[s,r]=m.useState(70),[n,i]=m.useState(170),[l,o]=m.useState(25),[c,d]=m.useState("male"),[u,x]=m.useState(1.2),[g,b]=m.useState(0),[p,v]=m.useState(0),h=()=>{t("/trainee/weight")},f=[{id:1,label:"منخفض",value:1.2,active:!0},{id:2,label:"متوسط",value:1.55,active:!1},{id:3,label:"مرتفع",value:1.9,active:!1}],N=()=>{let w;c==="male"?w=10*s+6.25*n-5*l+5:w=10*s+6.25*n-5*l-161;const j=Math.round(w);b(j);const F=Math.round(j*u);v(F)};return e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base internal-bg",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-[#1A1F2E]/80 backdrop-blur-lg",children:[e.jsx("button",{onClick:h,className:"text-white",children:e.jsx(me,{size:24})}),e.jsx("h1",{className:"text-xl font-bold",children:"حاسبة معدل الحرق!"}),e.jsx("div",{className:"w-6"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"px-6 py-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",children:"الجنس:"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>d("male"),className:`flex-1 py-3 rounded-xl ${c==="male"?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/60 text-gray-400"}`,children:"ذكر"}),e.jsx("button",{onClick:()=>d("female"),className:`flex-1 py-3 rounded-xl ${c==="female"?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/60 text-gray-400"}`,children:"أنثى"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",children:"العمر:"}),e.jsx("input",{type:"number",value:l,onChange:w=>o(Number(w.target.value)),className:"w-full bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-3 text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",children:"الوزن (كجم):"}),e.jsx("input",{type:"number",value:s,onChange:w=>r(Number(w.target.value)),className:"w-full bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-3 text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2",children:"الطول (سم):"}),e.jsx("input",{type:"number",value:n,onChange:w=>i(Number(w.target.value)),className:"w-full bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-3 text-center"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg mb-4",children:"مستوى النشاط:"}),e.jsx("div",{className:"flex justify-between gap-4",children:f.map(w=>e.jsxs("button",{onClick:()=>x(w.value),className:`flex-1 aspect-square rounded-2xl flex flex-col items-center justify-center border-2 ${u===w.value?"border-[#0AE7F2] text-[#0AE7F2]":"border-gray-600 text-gray-400"}`,children:[e.jsx("span",{className:"text-2xl font-bold",children:w.id}),e.jsx("span",{className:"text-sm",children:w.label})]},w.id))})]}),e.jsxs("button",{onClick:N,className:"w-full bg-[#0AE7F2] text-black py-4 rounded-xl font-medium flex items-center justify-center gap-2 hover:bg-[#0AE7F2]/90 transition-colors",children:[e.jsx(Pa,{size:20}),e.jsx("span",{children:"احسب معدل الحرق"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm p-6 rounded-xl border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"معدل الأيض الأساسي (BMR)"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-2xl font-bold text-[#0AE7F2]",children:g}),e.jsx("span",{className:"text-gray-400",children:"سعرة/يوم"})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm p-6 rounded-xl border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"إجمالي الحرق اليومي (TDEE)"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-2xl font-bold text-[#0AE7F2]",children:p}),e.jsx("span",{className:"text-gray-400",children:"سعرة/يوم"})]})]})]})]})}),e.jsx(mt,{})]})]})}const jc=()=>e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M6 4v16"}),e.jsx("path",{d:"M18 4v16"}),e.jsx("path",{d:"M6 12h12"}),e.jsx("path",{d:"M8 8l4 4 4-4"}),e.jsx("path",{d:"M16 16l-4-4-4 4"})]}),yc=()=>e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M6 3v18"}),e.jsx("path",{d:"M18 3v18"}),e.jsx("path",{d:"M6 12h12"}),e.jsx("path",{d:"M6 8h12"}),e.jsx("path",{d:"M6 16h12"})]}),wc=()=>e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 4C7.5 4 4 7.5 4 12"}),e.jsx("path",{d:"M20 12c0-4.5-3.5-8-8-8"}),e.jsx("path",{d:"M12 8c-2.2 0-4 1.8-4 4"}),e.jsx("path",{d:"M16 12c0-2.2-1.8-4-4-4"})]}),Nc=()=>e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M7 4c0 0 2-2 5-2s5 2 5 2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M7 20c0 0 2 2 5 2s5-2 5-2"}),e.jsx("path",{d:"M7 16c0 0 2-2 5-2s5 2 5 2"})]}),Ec=()=>e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 4c0 0-2-2-5-2s-5 2-5 2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M17 20c0 0-2 2-5 2s-5-2-5-2"}),e.jsx("path",{d:"M17 16c0 0-2-2-5-2s-5 2-5 2"})]}),Ac=()=>e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"6",y:"4",width:"12",height:"16",rx:"2"}),e.jsx("line",{x1:"6",y1:"8",x2:"18",y2:"8"}),e.jsx("line",{x1:"6",y1:"12",x2:"18",y2:"12"}),e.jsx("line",{x1:"6",y1:"16",x2:"18",y2:"16"})]}),Fc=()=>e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 12m-8 0a8 8 0 1 0 16 0a8 8 0 1 0 -16 0"}),e.jsx("path",{d:"M12 8l0 4l2 2"}),e.jsx("path",{d:"M17.5 17.5l-2.5 -2.5"}),e.jsx("path",{d:"M3 12h2"}),e.jsx("path",{d:"M19 12h2"})]}),Nr=[{id:"cardio",name:"أيروبي",icon:Fc},{id:"back",name:"ظهر",icon:jc},{id:"chest",name:"صدر",icon:yc},{id:"shoulders",name:"أكتاف",icon:wc},{id:"legs",name:"أرجل",icon:Oe},{id:"abs",name:"بطن",icon:Ac},{id:"biceps",name:"يد أمامية",icon:Nc},{id:"triceps",name:"يد خلفية",icon:Ec}];function _c({onBack:a,onChestClick:t}){var h;de();const[s,r]=m.useState(null),[n,i]=m.useState([]),[l,o]=m.useState(!1),[c,d]=m.useState(null),[u,x]=m.useState(""),[g,b]=m.useState(null),p=f=>{if(f.id==="chest"){t();return}r(f.id),o(!0),setTimeout(()=>{i([{id:"1",name:`تمرين ${f.name} 1`,sets:3,reps:12,description:`وصف تمرين ${f.name}`,videoUrl:"https://player.vimeo.com/video/915685526",thumbnailUrl:"https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?q=80&w=1000&auto=format&fit=crop"},{id:"2",name:`تمرين ${f.name} 2`,sets:4,reps:10,description:`وصف تمرين ${f.name}`,videoUrl:"https://player.vimeo.com/video/915685526",thumbnailUrl:"https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?q=80&w=1000&auto=format&fit=crop"},{id:"3",name:`تمرين ${f.name} 3`,sets:3,reps:15,description:`وصف تمرين ${f.name}`,videoUrl:"https://player.vimeo.com/video/915685526",thumbnailUrl:"https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?q=80&w=1000&auto=format&fit=crop"}]),o(!1)},500)},v=n.filter(f=>f.name.toLowerCase().includes(u.toLowerCase()));return e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsxs("div",{className:"header-base",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:a,className:"text-white",children:e.jsx(me,{size:24})}),e.jsx("h1",{className:"text-lg font-bold",children:"كل التمارين"}),e.jsx("button",{className:"text-white",children:e.jsx(At,{size:24})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u,onChange:f=>x(f.target.value),placeholder:"ابحث عن تمرين...",className:"input-base w-full pr-12"}),e.jsx(je,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-[#0AE7F2]",size:20})]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto content-container",children:[!s&&e.jsx("div",{className:"grid grid-cols-2 gap-4 mb-8",children:Nr.map(f=>e.jsxs("button",{onClick:()=>p(f),className:"relative w-full h-[140px] flex flex-col items-center justify-center group",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-[28px] border-2 border-[#0ae7f2]"}),e.jsx("div",{className:"relative text-[#0AE7F2] mb-2 h-16 flex items-center transition-transform duration-300 group-hover:scale-110",children:typeof f.icon=="function"?e.jsx(f.icon,{}):e.jsx(f.icon,{size:40,className:"text-[#0AE7F2]"})}),e.jsx("span",{className:"relative text-sm font-medium text-[#0AE7F2]",children:f.name})]},f.id))}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:()=>r(null),className:"bg-[#1A1F2E]/60 text-[#0AE7F2] px-4 py-2 rounded-xl flex items-center gap-2",children:[e.jsx(me,{size:16}),e.jsx("span",{children:"العودة للفئات"})]}),e.jsxs("h2",{className:"text-lg font-bold",children:["تمارين ",(h=Nr.find(f=>f.id===s))==null?void 0:h.name]})]}),l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):c?e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:c}):v.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"لا توجد تمارين متاحة لهذه الفئة"})}):v.map(f=>e.jsxs("div",{className:"card-base",children:[e.jsxs("div",{className:"relative w-full h-48 mb-4 rounded-xl overflow-hidden cursor-pointer group",onClick:()=>b(f),children:[e.jsx("img",{src:f.thumbnailUrl,alt:f.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Zt,{size:48,className:"text-[#0AE7F2]"})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:f.name}),e.jsx("button",{onClick:()=>b(f),className:"text-[#0AE7F2] hover:bg-[#0AE7F2]/10 p-2 rounded-full transition-colors",children:e.jsx(Zt,{size:20})})]}),f.description&&e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:f.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-[#0AE7F2]",children:[e.jsxs("span",{children:[f.sets," مجموعات"]}),e.jsxs("span",{children:[f.reps," تكرار"]})]})]},f.id))]})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-4xl",children:[e.jsx("button",{onClick:()=>b(null),className:"absolute -top-12 right-0 text-white hover:text-[#0AE7F2] transition-colors",children:e.jsx(ue,{size:24})}),e.jsx("div",{className:"relative pt-[56.25%] rounded-xl overflow-hidden",children:e.jsx("iframe",{src:g.videoUrl,className:"absolute inset-0 w-full h-full",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:g.name}),g.description&&e.jsx("p",{className:"text-gray-400",children:g.description})]})]})})]})}function kc({onBack:a}){de();const[t,s]=m.useState([]),[r,n]=m.useState(!0),[i,l]=m.useState(null),[o,c]=m.useState(""),[d,u]=m.useState(null);m.useEffect(()=>{x()},[]);const x=async()=>{n(!0);try{s([{id:"1",name:"تمرين ضغط صدر علوي بالدمبل",sets:3,reps:12,description:"تمرين لتقوية عضلات الصدر العلوية",videoUrl:"https://player.vimeo.com/video/915685526",thumbnailUrl:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?q=80&w=1000&auto=format&fit=crop"},{id:"2",name:"تمرين ضغط صدر مستوي بالدمبل",sets:4,reps:10,description:"تمرين لتقوية عضلات الصدر الوسطى",videoUrl:"https://player.vimeo.com/video/915685526",thumbnailUrl:"https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?q=80&w=1000&auto=format&fit=crop"},{id:"3",name:"تمرين تجميع صدر بالجهاز",sets:3,reps:15,description:"تمرين لتقوية عضلات الصدر الداخلية",videoUrl:"https://player.vimeo.com/video/915685526",thumbnailUrl:"https://images.unsplash.com/photo-1571019613576-2b22c76fd955?q=80&w=1000&auto=format&fit=crop"}]),l(null)}catch(b){console.error("Error fetching chest exercises:",b),l("حدث خطأ أثناء تحميل التمارين")}finally{n(!1)}},g=t.filter(b=>b.name.toLowerCase().includes(o.toLowerCase()));return e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsxs("div",{className:"header-base",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:a,className:"text-white",children:e.jsx(me,{size:24})}),e.jsx("h1",{className:"text-lg font-bold",children:"تمارين الصدر"}),e.jsx("button",{className:"text-white",children:e.jsx(At,{size:24})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:o,onChange:b=>c(b.target.value),placeholder:"ابحث عن تمرين...",className:"input-base w-full pr-12"}),e.jsx(je,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-[#0AE7F2]",size:20})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto content-container",children:e.jsx("div",{className:"space-y-4",children:r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):i?e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:i}):g.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"لا توجد تمارين تطابق بحثك"})}):g.map(b=>e.jsxs("div",{className:"card-base",children:[e.jsxs("div",{className:"relative w-full h-48 mb-4 rounded-xl overflow-hidden cursor-pointer group",onClick:()=>u(b),children:[e.jsx("img",{src:b.thumbnailUrl,alt:b.name,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Zt,{size:48,className:"text-[#0AE7F2]"})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:b.name}),e.jsx("button",{onClick:()=>u(b),className:"text-[#0AE7F2] hover:bg-[#0AE7F2]/10 p-2 rounded-full transition-colors",children:e.jsx(Zt,{size:20})})]}),b.description&&e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:b.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-[#0AE7F2]",children:[e.jsxs("span",{children:[b.sets," مجموعات"]}),e.jsxs("span",{children:[b.reps," تكرار"]})]})]},b.id))})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-4xl",children:[e.jsx("button",{onClick:()=>u(null),className:"absolute -top-12 right-0 text-white hover:text-[#0AE7F2] transition-colors",children:e.jsx(ue,{size:24})}),e.jsx("div",{className:"relative pt-[56.25%] rounded-xl overflow-hidden",children:e.jsx("iframe",{src:d.videoUrl,className:"absolute inset-0 w-full h-full",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:d.name}),d.description&&e.jsx("p",{className:"text-gray-400",children:d.description})]})]})})]})}const Sc=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M6 4v16"}),e.jsx("path",{d:"M18 4v16"}),e.jsx("path",{d:"M6 12h12"}),e.jsx("path",{d:"M8 8l4 4 4-4"}),e.jsx("path",{d:"M16 16l-4-4-4 4"})]}),Cc=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M6 3v18"}),e.jsx("path",{d:"M18 3v18"}),e.jsx("path",{d:"M6 12h12"}),e.jsx("path",{d:"M6 8h12"}),e.jsx("path",{d:"M6 16h12"})]}),Tc=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 4C7.5 4 4 7.5 4 12"}),e.jsx("path",{d:"M20 12c0-4.5-3.5-8-8-8"}),e.jsx("path",{d:"M12 8c-2.2 0-4 1.8-4 4"}),e.jsx("path",{d:"M16 12c0-2.2-1.8-4-4-4"})]}),Pc=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M7 4c0 0 2-2 5-2s5 2 5 2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M7 20c0 0 2 2 5 2s5-2 5-2"}),e.jsx("path",{d:"M7 16c0 0 2-2 5-2s5 2 5 2"})]}),Mc=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 4c0 0-2-2-5-2s-5 2-5 2"}),e.jsx("path",{d:"M12 2v20"}),e.jsx("path",{d:"M17 20c0 0-2 2-5 2s-5-2-5-2"}),e.jsx("path",{d:"M17 16c0 0-2-2-5-2s-5 2-5 2"})]}),Oc=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"6",y:"4",width:"12",height:"16",rx:"2"}),e.jsx("line",{x1:"6",y1:"8",x2:"18",y2:"8"}),e.jsx("line",{x1:"6",y1:"12",x2:"18",y2:"12"}),e.jsx("line",{x1:"6",y1:"16",x2:"18",y2:"16"})]}),zc=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 12m-8 0a8 8 0 1 0 16 0a8 8 0 1 0 -16 0"}),e.jsx("path",{d:"M12 8l0 4l2 2"}),e.jsx("path",{d:"M17.5 17.5l-2.5 -2.5"}),e.jsx("path",{d:"M3 12h2"}),e.jsx("path",{d:"M19 12h2"})]});function Dc({onBack:a}){de();const[t,s]=m.useState(null),[r,n]=m.useState([]),[i,l]=m.useState(0),[o,c]=m.useState(!0),[d,u]=m.useState(null),[x,g]=m.useState(null);m.useEffect(()=>{b()},[]),m.useEffect(()=>{const E=r.reduce((_,k)=>_+k.exercises.filter(O=>O.status==="completed").length,0);l(E),v(E)},[r]);const b=async()=>{try{if(c(!0),u(null),q()){const{data:{user:E}}=await S.auth.getUser();if(!E)throw new Error("المستخدم غير مسجل الدخول");const _=new Date,k=new Date(_);k.setDate(_.getDate()-_.getDay());const O=k.toISOString().split("T")[0],{data:M,error:y}=await S.from("weekly_schedules").select("id").eq("trainee_id",E.id).eq("week_start_date",O).single();if(y&&y.code!=="PGRST116")throw y;if(!M){n(p());return}const{data:W,error:z}=await S.from("schedule_exercises").select(`
            id,
            exercise_id,
            day_of_week,
            sets,
            reps,
            status,
            completed_at,
            exercises (
              name,
              category,
              description,
              video_url
            )
          `).eq("schedule_id",M.id).order("day_of_week",{ascending:!0});if(z)throw z;const I=W.reduce((G,X)=>{const ae=X.day_of_week;return G[ae]||(G[ae]=[]),G[ae].push(X),G},{}),H=[],T=["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];for(const[G,X]of Object.entries(I)){const ae=parseInt(G),Q=T[ae],$=X.map(R=>({id:R.id,name:R.exercises.name,sets:R.sets,reps:R.reps,type:R.exercises.category.includes("cardio")?"cardio":"strength",status:R.status,description:R.exercises.description,videoUrl:R.exercises.video_url})),P=$.filter(R=>R.status==="completed").length,J=$.length>0?Math.round(P/$.length*100):0;H.push({id:ae,name:`تمارين ${Q}`,exercises:$,lastPerformed:ae===_.getDay()?"اليوم":T[ae],progress:J})}n(H.length>0?H:p())}else n(p())}catch(E){console.error("Error fetching workout programs:",E),u("حدث خطأ أثناء تحميل برامج التمارين"),n(p())}finally{c(!1)}},p=()=>[{id:1,name:"تمارين الصدر والكتف",lastPerformed:"اليوم",progress:0,exercises:[{id:1,name:"بنش بريس",sets:4,reps:12,type:"strength",status:"pending",videoUrl:"https://player.vimeo.com/video/915685526"},{id:2,name:"دمبل بريس",sets:3,reps:15,type:"strength",status:"pending",videoUrl:"https://player.vimeo.com/video/915685526"},{id:3,name:"بوش اب",sets:3,reps:20,type:"strength",status:"pending",videoUrl:"https://player.vimeo.com/video/915685526"}]},{id:2,name:"تمارين الظهر",lastPerformed:"منذ يومين",progress:0,exercises:[{id:4,name:"بول اب",sets:4,reps:10,type:"strength",status:"pending",videoUrl:"https://player.vimeo.com/video/915685526"},{id:5,name:"ديدليفت",sets:3,reps:12,type:"strength",status:"pending",videoUrl:"https://player.vimeo.com/video/915685526"},{id:6,name:"بنت اوفر رو",sets:3,reps:15,type:"strength",status:"pending",videoUrl:"https://player.vimeo.com/video/915685526"}]},{id:3,name:"تمارين الكارديو",lastPerformed:"منذ 3 أيام",progress:0,exercises:[{id:7,name:"جري",sets:1,reps:1,duration:"20 دقيقة",type:"cardio",status:"pending",videoUrl:"https://player.vimeo.com/video/915685526"},{id:8,name:"دراجة ثابتة",sets:1,reps:1,duration:"15 دقيقة",type:"cardio",status:"pending",videoUrl:"https://player.vimeo.com/video/915685526"},{id:9,name:"حبل القفز",sets:3,reps:1,duration:"5 دقائق",type:"cardio",status:"pending",videoUrl:"https://player.vimeo.com/video/915685526"}]}],v=async E=>{try{if(q()){const{data:_}=await S.from("trainee_performance").select("completed_meals").eq("date",new Date().toISOString().split("T")[0]).single(),k=(_==null?void 0:_.completed_meals)||0;await ja(E,k)}}catch(_){console.error("Error updating performance:",_)}},h=async(E,_,k)=>{const O=r.map(M=>{if(M.id===E){const y=M.exercises.map(H=>H.id===_?{...H,status:k}:H),W=y.filter(H=>H.status==="completed").length,z=y.length,I=Math.round(W/z*100);return{...M,exercises:y,progress:I}}return M});if(n(O),q())try{const{error:M}=await S.from("schedule_exercises").update({status:k,completed_at:k==="completed"?new Date().toISOString():null}).eq("id",_);if(M)throw M}catch(M){console.error("Error updating exercise status:",M),n(r)}if(t&&t.id===E){const M=O.find(y=>y.id===E);M&&s(M)}},f=(E,_)=>{E?g({url:E,name:_}):alert("لا يوجد فيديو متاح لهذا التمرين")},N=(E,_)=>E==="cardio"?e.jsx(zc,{}):_.includes("صدر")||_.includes("بنش")||_.includes("بوش")?e.jsx(Cc,{}):_.includes("ظهر")||_.includes("بول")||_.includes("ديدليفت")?e.jsx(Sc,{}):_.includes("كتف")||_.includes("شولدر")?e.jsx(Tc,{}):_.includes("بايسبس")||_.includes("يد أمامية")?e.jsx(Pc,{}):_.includes("ترايسبس")||_.includes("يد خلفية")?e.jsx(Mc,{}):_.includes("بطن")||_.includes("كرانش")?e.jsx(Oc,{}):e.jsx(ws,{size:20,className:"text-[#0AE7F2]"}),w=E=>{switch(E){case"completed":return"text-emerald-500 bg-emerald-500/10";case"skipped":return"text-rose-500 bg-rose-500/10";default:return"text-amber-500 bg-amber-500/10"}},j=E=>{switch(E){case"completed":return e.jsx(Se,{size:16,className:"text-emerald-500"});case"skipped":return e.jsx(os,{size:16,className:"text-rose-500"});default:return e.jsx(Xs,{size:16,className:"text-amber-500"})}},F=()=>{t?s(null):a()},C=()=>e.jsx("div",{className:"content-container space-y-4",children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):d?e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:[d,e.jsx("button",{onClick:b,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}):r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ws,{size:32,className:"text-[#0AE7F2]"})}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"لا توجد تمارين"}),e.jsx("p",{className:"text-gray-400",children:"لم يتم تعيين أي تمارين لك بعد"})]}):r.map(E=>e.jsxs("button",{onClick:()=>s(E),className:"w-full card-base hover:bg-[#1A1F2E]/80 transition-all group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(zs,{size:20,className:"text-[#0AE7F2] opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("h2",{className:"text-lg font-bold text-[#0AE7F2]",children:E.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-gray-400",children:[E.exercises.length," تمارين"]}),e.jsxs("span",{className:"text-[#0AE7F2]",children:[Math.round(E.progress),"%"]})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0AE7F2] rounded-full transition-all duration-300",style:{width:`${E.progress}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"آخر تمرين"}),e.jsx("span",{className:"text-[#0AE7F2]",children:E.lastPerformed})]})]},E.id))}),A=()=>e.jsx("div",{className:"content-container",children:e.jsxs("div",{className:"card-base",children:[e.jsx("h2",{className:"text-xl font-bold text-[#0AE7F2] mb-6",children:t==null?void 0:t.name}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"تقدم البرنامج"}),e.jsxs("span",{className:"text-[#0AE7F2]",children:[Math.round((t==null?void 0:t.progress)||0),"%"]})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0AE7F2] rounded-full transition-all duration-300",style:{width:`${(t==null?void 0:t.progress)||0}%`}})})]}),e.jsx("div",{className:"space-y-4",children:t==null?void 0:t.exercises.map(E=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#1A1F2E]/40 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-[#0AE7F2]",children:N(E.type,E.name)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-1",children:E.name}),e.jsx("p",{className:"text-sm text-gray-400",children:E.duration?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Xs,{size:14}),E.duration]}):`${E.sets} مجموعات × ${E.reps} تكرار`})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E.videoUrl&&e.jsx("button",{onClick:_=>{_.stopPropagation(),f(E.videoUrl,E.name)},className:"w-8 h-8 rounded-full flex items-center justify-center transition-colors bg-[#0AE7F2]/20 text-[#0AE7F2] hover:bg-[#0AE7F2]/30",title:"شاهد فيديو التمرين",children:e.jsx(Ns,{size:16})}),e.jsx("button",{onClick:()=>h(t.id,E.id,"completed"),className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${E.status==="completed"?"bg-emerald-500/20 text-emerald-500":"hover:bg-emerald-500/10 text-gray-400"}`,children:e.jsx(He,{size:16})}),e.jsx("button",{onClick:()=>h(t.id,E.id,"skipped"),className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${E.status==="skipped"?"bg-rose-500/20 text-rose-500":"hover:bg-rose-500/10 text-gray-400"}`,children:e.jsx(ue,{size:16})}),e.jsxs("div",{className:`px-2 py-1 rounded-full text-xs flex items-center gap-1 ${w(E.status)}`,children:[j(E.status),e.jsx("span",{children:E.status==="completed"?"مكتمل":E.status==="skipped"?"متخطى":"معلق"})]})]})]},E.id))})]})});return e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsx("div",{className:"header-base",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:F,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h1",{className:"text-xl font-bold",children:"قائمة تماريني"}),e.jsx("button",{className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(At,{size:20,className:"text-[#0AE7F2]"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:t?A():C()})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-4xl",children:[e.jsx("button",{onClick:()=>g(null),className:"absolute -top-12 right-0 text-white hover:text-[#0AE7F2] transition-colors",children:e.jsx(ue,{size:24})}),e.jsx("div",{className:"relative pt-[56.25%] rounded-xl overflow-hidden",children:e.jsx("iframe",{src:x.url,className:"absolute inset-0 w-full h-full",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:x.name})})]})})]})}const wa=async()=>{if(!q())return[{id:"1",title:"تحديث البرنامج التدريبي",message:"تم تحديث برنامجك التدريبي لهذا الأسبوع. تفقد التمارين الجديدة!",type:"info",createdAt:new Date(Date.now()-5*60*1e3).toISOString()},{id:"2",title:"تهانينا!",message:"لقد أكملت جميع تمارين اليوم. أحسنت!",type:"success",createdAt:new Date(Date.now()-2*60*60*1e3).toISOString()},{id:"3",title:"تذكير بموعد التمرين",message:"لديك تمرين مجدول بعد ساعة من الآن",type:"warning",readAt:new Date(Date.now()-2.5*60*60*1e3).toISOString(),createdAt:new Date(Date.now()-3*60*60*1e3).toISOString()}];try{const{data:{user:a}}=await S.auth.getUser();if(!a)throw new Error("المستخدم غير مسجل الدخول");const{data:t,error:s}=await S.from("notifications").select("*").or(`recipient_id.eq.${a.id},recipient_id.is.null`).order("created_at",{ascending:!1});if(s)throw s;return t.map(r=>({id:r.id,title:r.title,message:r.message,type:r.type,senderId:r.sender_id,recipientId:r.recipient_id,readAt:r.read_at,createdAt:r.created_at}))}catch(a){throw console.error("Error getting notifications:",a),a}},Er=async(a,t,s,r)=>{if(!q())return{id:Ie(),title:a,message:t,type:s,recipientId:r,createdAt:new Date().toISOString()};try{const{data:{user:n}}=await S.auth.getUser();if(!n)throw new Error("المستخدم غير مسجل الدخول");const{data:i,error:l}=await S.from("notifications").insert({title:a,message:t,type:s,sender_id:n.id,recipient_id:r}).select().single();if(l)throw l;return{id:i.id,title:i.title,message:i.message,type:i.type,senderId:i.sender_id,recipientId:i.recipient_id,readAt:i.read_at,createdAt:i.created_at}}catch(n){throw console.error("Error sending notification:",n),n}},Na=async a=>{if(q())try{const{data:{user:t}}=await S.auth.getUser();if(!t)throw new Error("المستخدم غير مسجل الدخول");const{error:s}=await S.from("notifications").update({read_at:new Date().toISOString()}).eq("id",a).or(`recipient_id.eq.${t.id},recipient_id.is.null`);if(s)throw s}catch(t){throw console.error("Error marking notification as read:",t),t}},Ea=async a=>{if(q())try{const{data:{user:t}}=await S.auth.getUser();if(!t)throw new Error("المستخدم غير مسجل الدخول");const{error:s}=await S.from("notifications").delete().eq("id",a).or(`recipient_id.eq.${t.id},recipient_id.is.null`);if(s)throw s}catch(t){throw console.error("Error deleting notification:",t),t}};function Aa({onBack:a}){const t=de(),[s,r]=m.useState([]),[n,i]=m.useState(null),[l,o]=m.useState(!0),[c,d]=m.useState(null),[u,x]=m.useState(!1);m.useEffect(()=>{b(),g()},[]);const g=async()=>{if(q()){const{data:{user:j}}=await S.auth.getUser();if(j){const{data:F}=await S.from("trainee_profiles").select("email, role").eq("id",j.id).single();F&&(F.email==="mk@powerhouse.com"||F.role==="admin")&&x(!0)}}else{const j=localStorage.getItem("userType");x(j==="admin")}},b=async()=>{try{if(o(!0),d(null),q()){const{data:{user:j}}=await S.auth.getUser();if(!j)throw new Error("المستخدم غير مسجل الدخول");const{data:F,error:C}=await S.from("notifications").select("*").or(`recipient_id.eq.${j.id},recipient_id.is.null`).order("created_at",{ascending:!1});if(C)throw C;const A=F.map(E=>({id:E.id,title:E.title,message:E.message,timestamp:new Date(E.created_at),type:E.type,read:!!E.read_at}));r(A)}else{const F=(await wa()).map(C=>({id:C.id,title:C.title,message:C.message,timestamp:new Date(C.createdAt),type:C.type,read:!!C.readAt}));r(F)}}catch(j){console.error("Error fetching notifications:",j),d("حدث خطأ أثناء تحميل الإشعارات"),r([{id:"1",title:"تحديث البرنامج التدريبي",message:"تم تحديث برنامجك التدريبي لهذا الأسبوع. تفقد التمارين الجديدة!",timestamp:new Date(Date.now()-5*60*1e3),type:"info",read:!1},{id:"2",title:"تهانينا!",message:"لقد أكملت جميع تمارين اليوم. أحسنت!",timestamp:new Date(Date.now()-2*60*60*1e3),type:"success",read:!1},{id:"3",title:"تذكير بموعد التمرين",message:"لديك تمرين مجدول بعد ساعة من الآن",timestamp:new Date(Date.now()-3*60*60*1e3),type:"warning",read:!0}])}finally{o(!1)}},p=()=>{t("/trainee")},v=(j,F)=>{const C="rounded-2xl p-6 border transition-all",A=F?"border-[#0AE7F2]/20":"border-[#0AE7F2]";switch(j){case"success":return`${C} ${A} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"warning":case"weight":return`${C} ${A} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"error":return`${C} ${A} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"exercise":return`${C} ${A} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"meal":return`${C} ${A} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"subscription":return`${C} ${A} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;default:return`${C} ${A} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`}},h=j=>{switch(j){case"success":return e.jsx(Se,{size:24,className:"text-[#0AE7F2]"});case"warning":case"weight":return e.jsx(Re,{size:24,className:"text-[#0AE7F2]"});default:return e.jsx(Me,{size:24,className:"text-[#0AE7F2]"})}},f=async j=>{try{await Na(j),r(s.map(F=>F.id===j?{...F,read:!0}:F)),i(null)}catch(F){console.error("Error marking notification as read:",F)}},N=async j=>{try{await Ea(j),r(s.filter(F=>F.id!==j)),i(null)}catch(F){console.error("Error deleting notification:",F)}},w=s.filter(j=>!j.read).length;return l?e.jsx("div",{className:"h-full flex items-center justify-center bg-[#0A0F1C]",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsx("div",{className:"header-base",children:e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("button",{onClick:p,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-xl font-bold",children:"الإشعارات"}),w>0&&e.jsxs("p",{className:"text-sm text-[#0AE7F2]",children:[w," إشعارات جديدة"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:b,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",disabled:l,children:e.jsx(Os,{size:20,className:`text-[#0AE7F2] ${l?"animate-spin":""}`})})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto content-container",children:[c&&e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-4",children:[c,e.jsx("button",{onClick:b,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}),s.map(j=>e.jsx("div",{className:v(j.type,j.read),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-3 rounded-xl",children:h(j.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold",children:j.title}),!j.read&&e.jsx("span",{className:"w-2 h-2 bg-[#0AE7F2] rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-400",children:va(j.timestamp)}),e.jsx("button",{onClick:()=>i(n===j.id?null:j.id),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(Or,{size:16})})]})]}),e.jsx("p",{className:"text-gray-400",children:j.message}),n===j.id&&e.jsxs("div",{className:"mt-4 flex gap-4 border-t border-[#0AE7F2]/20 pt-4",children:[!j.read&&e.jsx("button",{onClick:()=>f(j.id),className:"text-sm text-[#0AE7F2] hover:text-[#0AE7F2]/80 transition-colors",children:"تحديد كمقروء"}),e.jsxs("button",{onClick:()=>N(j.id),className:"text-sm text-rose-500 hover:text-rose-400 transition-colors flex items-center gap-1",children:[e.jsx(Ft,{size:14}),e.jsx("span",{children:"حذف"})]})]})]})]})},j.id)),s.length===0&&!c&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Me,{size:32,className:"text-[#0AE7F2]"})}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-400",children:"ستظهر هنا جميع إشعاراتك الجديدة"})]})]}),e.jsx(mt,{})]})]})}const Lc=async a=>{if(!q())return{id:Ie(),trainerId:"trainer-id",traineeId:a,lastMessageAt:new Date,status:"active"};try{const{data:{user:t}}=await S.auth.getUser();if(!t)throw new Error("المستخدم غير مسجل الدخول");const{data:s,error:r}=await S.from("conversations").select("*").eq("trainee_id",a).single();if(r&&r.code!=="PGRST116")throw r;if(s)return{id:s.id,trainerId:s.trainer_id,traineeId:s.trainee_id,lastMessageAt:new Date(s.last_message_at),status:s.status};const{data:n,error:i}=await S.from("trainee_profiles").select("id").eq("email","mk@powerhouse.com").single();if(i)throw i;const{data:l,error:o}=await S.from("conversations").insert({trainer_id:n.id,trainee_id:a}).select().single();if(o)throw o;return{id:l.id,trainerId:l.trainer_id,traineeId:l.trainee_id,lastMessageAt:new Date(l.last_message_at),status:l.status}}catch(t){throw console.error("Error getting or creating conversation:",t),t}},$c=async(a,t)=>{if(!q())return{id:Ie(),senderId:"user-id",recipientId:"trainer-id",message:t,createdAt:new Date().toISOString()};try{const{data:{user:s}}=await S.auth.getUser();if(!s)throw new Error("المستخدم غير مسجل الدخول");const{data:r,error:n}=await S.from("messages").insert({conversation_id:a,sender_id:s.id,content:t}).select().single();if(n)throw n;return await S.from("conversations").update({last_message_at:new Date().toISOString()}).eq("id",a),{id:r.id,senderId:r.sender_id,recipientId:"",message:r.content,readAt:r.read_at,createdAt:r.created_at}}catch(s){throw console.error("Error sending message:",s),s}},Ic=async a=>{if(!q())return[{id:"1",senderId:"trainer-id",recipientId:"user-id",message:"مرحباً بك في برنامجك التدريبي! كيف يمكنني مساعدتك اليوم؟",createdAt:new Date(Date.now()-24*60*60*1e3).toISOString()},{id:"2",senderId:"user-id",recipientId:"trainer-id",message:"مرحباً! أريد استشارة بخصوص جدول التمارين الأسبوعي",createdAt:new Date(Date.now()-23*60*60*1e3).toISOString()},{id:"3",senderId:"trainer-id",recipientId:"user-id",message:"بالتأكيد! هل تريد تعديل البرنامج الحالي أم إنشاء برنامج جديد يناسب أهدافك؟",createdAt:new Date(Date.now()-22*60*60*1e3).toISOString()}];try{const{data:t,error:s}=await S.from("messages").select("*").eq("conversation_id",a).order("created_at",{ascending:!0});if(s)throw s;return t.map(r=>({id:r.id,senderId:r.sender_id,recipientId:"",message:r.content,readAt:r.read_at,createdAt:r.created_at}))}catch(t){throw console.error("Error getting messages:",t),t}},Rc=async(a,t)=>{if(q())try{const{data:{user:s}}=await S.auth.getUser();if(!s)throw new Error("المستخدم غير مسجل الدخول");const{error:r}=await S.from("messages").update({read_at:new Date().toISOString()}).eq("conversation_id",a).eq("sender_id",t).is("read_at",null);if(r)throw r}catch(s){throw console.error("Error marking messages as read:",s),s}};function Uc({onBack:a}){const t=de(),[s,r]=m.useState(""),[n,i]=m.useState([]),[l,o]=m.useState(null),[c,d]=m.useState(!1),[u,x]=m.useState(!1),[g,b]=m.useState(!0);m.useState(null);const p=m.useRef(null),v=m.useRef(null);m.useEffect(()=>{f()},[]),m.useEffect(()=>{var E;h(),(E=v.current)==null||E.focus()},[n]);const h=()=>{var E;(E=p.current)==null||E.scrollIntoView({behavior:"smooth"})},f=async()=>{try{if(b(!0),q()){const{data:{user:E}}=await S.auth.getUser();if(!E){N();return}const _=await Lc(E.id);o(_);const k=await Ic(_.id),O=k.map(y=>({id:y.id,text:y.message,sender:y.senderId===_.trainerId?"trainer":"user",timestamp:new Date(y.createdAt),status:y.readAt?"read":"delivered"}));i(O),k.filter(y=>y.senderId===_.trainerId&&!y.readAt).map(y=>y.id).length>0&&await Rc(_.id,_.trainerId)}else N()}catch(E){console.error("Error fetching conversation:",E),N()}finally{b(!1)}},N=()=>{o({id:Ie(),trainerId:"trainer-id",traineeId:"trainee-id",lastMessageAt:new Date}),i([{id:"1",text:"مرحباً بك في برنامجك التدريبي! كيف يمكنني مساعدتك اليوم؟",sender:"trainer",timestamp:new Date(Date.now()-24*60*60*1e3),status:"read"},{id:"2",text:"مرحباً! أريد استشارة بخصوص جدول التمارين الأسبوعي",sender:"user",timestamp:new Date(Date.now()-23*60*60*1e3),status:"read"},{id:"3",text:"بالتأكيد! هل تريد تعديل البرنامج الحالي أم إنشاء برنامج جديد يناسب أهدافك؟",sender:"trainer",timestamp:new Date(Date.now()-22*60*60*1e3),status:"read"}])},w=async()=>{if(!s.trim()||!l)return;const E={id:Date.now().toString(),text:s,sender:"user",timestamp:new Date,status:"sent"};i(_=>[..._,E]),r("");try{if(q()){const _=await $c(l.id,s);i(k=>k.map(O=>O.id===E.id?{...O,id:_.id,status:"delivered"}:O))}d(!0),setTimeout(()=>{const _={id:(Date.now()+1).toString(),text:"حسناً، سأقوم بمراجعة برنامجك الحالي وأقترح التعديلات المناسبة. هل يمكنك إخباري عن أهدافك الحالية؟",sender:"trainer",timestamp:new Date,status:"sent"};i(k=>[...k,_]),d(!1),setTimeout(()=>{i(k=>k.map(O=>O.id===E.id?{...O,status:"read"}:O))},500)},2500)}catch(_){console.error("Error sending message:",_),i(k=>k.map(O=>O.id===E.id?{...O,status:"pending"}:O))}},j=E=>{switch(E){case"sent":return e.jsx(He,{size:16,className:"text-gray-400"});case"delivered":return e.jsx(ts,{size:16,className:"text-gray-400"});case"read":return e.jsx(ts,{size:16,className:"text-[#0AE7F2]"});default:return e.jsx(Re,{size:16,className:"text-gray-400"})}},F=E=>ct(E,"HH:mm"),C=[{icon:es,label:"صورة"},{icon:Ls,label:"ملف"},{icon:Ae,label:"جهة اتصال"}],A=()=>{t("/trainee")};return g?e.jsx("div",{className:"h-full flex items-center justify-center bg-[#0A0F1C]",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{dir:"rtl",className:"min-h-screen bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"fixed inset-0 z-0 opacity-5",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415L51.8 0h2.827zM5.373 0l-.83.828L5.96 2.243 8.2 0H5.374zM48.97 0l3.657 3.657-1.414 1.414L46.143 0h2.828zM11.03 0L7.372 3.657 8.787 5.07 13.857 0H11.03zm32.284 0L49.8 6.485 48.384 7.9l-7.9-7.9h2.83zM16.686 0L10.2 6.485 11.616 7.9l7.9-7.9h-2.83zM22.344 0L13.858 8.485 15.272 9.9l9.9-9.9h-2.828zM32 0l-9.9 9.9 1.414 1.414L33.414 1.414 32 0zm-3.172 0L19.757 9.071l1.415 1.414L31.243 0h-2.415zm-5.656 0L14.343 8.828l1.415 1.415L25.586 0h-2.415zm-5.656 0L8.687 8.828 10.1 10.243 20.93 0h-3.414zM28.828 0L27.414 1.414 33.414 7.414V0h-4.586zm-9.656 0L17.757 1.414 23.757 7.414V0h-4.585zm-9.657 0L8.1 1.414l6 6V0H9.516zM0 0c0 .828.635 1.5 1.414 1.5.793 0 1.414-.672 1.414-1.5H0zm0 4.172l4.172 4.172 1.415-1.415L1.414 2.757 0 4.172zm0 5.656l9.828 9.828 1.414-1.414L1.414 8.414 0 9.828zm0 5.656l14.485 14.485 1.414-1.414L1.414 14.07 0 15.485zm0 5.657l19.142 19.142 1.414-1.414L1.414 19.728 0 21.142zm0 5.657l23.8 23.8 1.414-1.414L1.414 25.385 0 26.8zm0 5.657l28.456 28.457 1.414-1.414L1.414 31.042 0 32.456zm0 5.657l33.113 33.114 1.414-1.414L1.414 36.7 0 38.113zm0 5.657l37.77 37.77 1.415-1.414L1.414 42.356 0 43.77zm0 5.657l42.427 42.428 1.414-1.414L1.414 48.013 0 49.427zm0 5.657l47.084 47.085 1.414-1.414L1.414 53.67 0 55.084zm0 5.657l51.741 51.741 1.414-1.414L1.414 59.327 0 60.741zm0 5.657l56.398 56.398 1.414-1.414L1.414 65.084 0 66.498zm60.741 0L0 5.757 1.414 4.343 60.74 63.67l-1.414 1.414z' fill='%23ffffff' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E")`,backgroundSize:"30px 30px"}})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-[#1A1F2E]/80 backdrop-blur-lg border-b border-[#0AE7F2]/20",children:[e.jsx("button",{onClick:A,className:"text-white",children:e.jsx(me,{size:24})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h2",{className:"font-bold",children:"المدرب أحمد"}),e.jsx("p",{className:"text-sm text-[#0AE7F2]",children:"متصل الآن"})]}),e.jsx("div",{className:"w-10 h-10 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center",children:e.jsx(Ae,{size:24,className:"text-[#0AE7F2]"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 pb-48",children:[n.map(E=>e.jsx("div",{className:`flex ${E.sender==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl p-4 ${E.sender==="user"?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/80 backdrop-blur-sm border border-[#0AE7F2]/20"}`,children:[e.jsx("p",{className:"mb-2",children:E.text}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("span",{className:`text-xs ${E.sender==="user"?"text-black/60":"text-gray-400"}`,children:F(E.timestamp)}),E.sender==="user"&&j(E.status)]})]})},E.id)),c&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-[#1A1F2E]/80 backdrop-blur-sm border border-[#0AE7F2]/20 rounded-2xl p-4",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-[#0AE7F2] rounded-full animate-bounce"}),e.jsx("span",{className:"w-2 h-2 bg-[#0AE7F2] rounded-full animate-bounce [animation-delay:0.2s]"}),e.jsx("span",{className:"w-2 h-2 bg-[#0AE7F2] rounded-full animate-bounce [animation-delay:0.4s]"})]})})}),e.jsx("div",{ref:p})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-[#1A1F2E]/95 backdrop-blur-lg border-t border-[#0AE7F2]/20",children:[u&&e.jsx("div",{className:"p-4 border-b border-[#0AE7F2]/20",children:e.jsx("div",{className:"flex justify-around",children:C.map((E,_)=>e.jsxs("button",{className:"flex flex-col items-center gap-2 p-4 rounded-xl hover:bg-[#0AE7F2]/10 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center",children:e.jsx(E.icon,{size:24,className:"text-[#0AE7F2]"})}),e.jsx("span",{className:"text-sm",children:E.label})]},_))})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>x(!u),className:"text-[#0AE7F2] hover:bg-[#0AE7F2]/10 p-2 rounded-full transition-colors",children:e.jsx(ze,{size:24})}),e.jsxs("div",{className:"flex-1 bg-black/40 rounded-xl flex items-center min-h-[48px]",children:[e.jsx("input",{ref:v,type:"text",value:s,onChange:E=>r(E.target.value),placeholder:"اكتب رسالتك...",className:"flex-1 bg-transparent px-4 py-2 text-white placeholder-gray-400 focus:outline-none min-h-[40px]",onKeyPress:E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),w())}}),e.jsxs("div",{className:"flex items-center gap-2 px-4",children:[e.jsx("button",{className:"text-gray-400 hover:text-[#0AE7F2] transition-colors p-1",children:e.jsx(es,{size:20})}),e.jsx("button",{className:"text-gray-400 hover:text-[#0AE7F2] transition-colors p-1",children:e.jsx(Ds,{size:20})})]})]}),e.jsx("button",{onClick:w,className:"bg-[#0AE7F2] text-black p-3 rounded-xl hover:bg-[#0AE7F2]/90 transition-colors",children:e.jsx(dt,{size:20})})]})}),e.jsx("div",{className:"h-24"})]})]})]})}function Wc({steps:a,targetSteps:t}){const s=Math.min(100,Math.round(a/t*100)),r=()=>s>=100?"bg-emerald-500":s>=75?"bg-[#0AE7F2]":s>=50?"bg-amber-500":"bg-[#0AE7F2]",n=()=>s>=100?"text-emerald-500":s>=75?"text-[#0AE7F2]":s>=50?"text-amber-500":"text-[#0AE7F2]";return e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(Oe,{size:24,className:"text-[#0AE7F2] mr-2"}),e.jsx("h3",{className:"text-lg font-medium text-white",children:"خطواتي اليومية"})]}),e.jsx("div",{className:"relative w-full h-4 bg-[#1A1F2E]/60 rounded-full overflow-hidden mb-2",children:e.jsx("div",{className:`absolute top-0 right-0 h-full ${r()} rounded-full transition-all duration-500 ease-out`,style:{width:`${s}%`}})}),e.jsxs("div",{className:"flex justify-between w-full text-sm",children:[e.jsx("span",{className:`${n()} font-bold text-xl`,children:a.toLocaleString()}),e.jsxs("span",{className:"text-gray-400",children:["الهدف: ",t.toLocaleString()]})]}),s>=100&&e.jsx("div",{className:"mt-2 bg-emerald-500/10 border border-emerald-500 text-emerald-500 px-4 py-2 rounded-xl text-center",children:"أحسنت! لقد حققت هدفك اليومي 🎉"})]})})}const qc=async(a=new Date().toISOString().split("T")[0])=>{if(!q())return{id:"mock-id",traineeId:"mock-trainee-id",date:a,steps:Math.floor(Math.random()*2500)+500,targetSteps:3e3,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{const{data:{user:t}}=await S.auth.getUser();if(!t)throw new Error("المستخدم غير مسجل الدخول");const{data:s,error:r}=await S.from("trainee_steps").select("*").eq("trainee_id",t.id).eq("date",a).single();if(r){if(r.code==="PGRST116")return null;throw r}return{id:s.id,traineeId:s.trainee_id,date:s.date,steps:s.steps,targetSteps:s.target_steps,createdAt:s.created_at,updatedAt:s.updated_at}}catch(t){throw console.error("Error fetching daily steps:",t),t}},js=async a=>{if(!q()){const t=new Date,s=[];for(let r=0;r<7;r++){const n=new Date;n.setDate(t.getDate()-r);const i=n.toISOString().split("T")[0];s.push({id:`mock-id-${r}`,traineeId:"mock-trainee-id",date:i,steps:Math.floor(Math.random()*3500)+500,targetSteps:3e3,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}return s}try{const{data:{user:t}}=await S.auth.getUser();if(!t)throw new Error("المستخدم غير مسجل الدخول");if(!a){const o=new Date,c=o.getDay(),d=o.getDate()-c;a=new Date(o.setDate(d)).toISOString().split("T")[0]}const s=new Date(a),r=new Date(s);r.setDate(r.getDate()+6);const n=r.toISOString().split("T")[0],{data:i,error:l}=await S.from("trainee_steps").select("*").eq("trainee_id",t.id).gte("date",a).lte("date",n).order("date",{ascending:!0});if(l)throw l;return i.map(o=>({id:o.id,traineeId:o.trainee_id,date:o.date,steps:o.steps,targetSteps:o.target_steps,createdAt:o.created_at,updatedAt:o.updated_at}))}catch(t){throw console.error("Error fetching weekly steps:",t),t}},Bc=async(a,t=new Date().toISOString().split("T")[0])=>{if(!q())return{id:"mock-id",traineeId:"mock-trainee-id",date:t,steps:a,targetSteps:3e3,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{const{data:{user:s}}=await S.auth.getUser();if(!s)throw new Error("المستخدم غير مسجل الدخول");const{data:r,error:n}=await S.from("trainee_steps").select("id").eq("trainee_id",s.id).eq("date",t).single();if(n&&n.code!=="PGRST116")throw n;let i;if(r){const{data:l,error:o}=await S.from("trainee_steps").update({steps:a,updated_at:new Date().toISOString()}).eq("id",r.id).select().single();if(o)throw o;i=l}else{const{data:l,error:o}=await S.from("trainee_steps").insert({trainee_id:s.id,date:t,steps:a,target_steps:3e3}).select().single();if(o)throw o;i=l}return{id:i.id,traineeId:i.trainee_id,date:i.date,steps:i.steps,targetSteps:i.target_steps,createdAt:i.created_at,updatedAt:i.updated_at}}catch(s){throw console.error("Error updating step count:",s),s}},Hc=async a=>{if(!q()){console.log("Mock: Updated target steps to",a);return}try{const{data:{user:t}}=await S.auth.getUser();if(!t)throw new Error("المستخدم غير مسجل الدخول");const s=new Date().toISOString().split("T")[0],{error:r}=await S.from("trainee_steps").update({target_steps:a,updated_at:new Date().toISOString()}).eq("trainee_id",t.id).gte("date",s);if(r)throw r}catch(t){throw console.error("Error updating target steps:",t),t}};function Fa({onBack:a}){const t=de(),[s,r]=m.useState(!0),[n,i]=m.useState(null),[l,o]=m.useState(0),[c,d]=m.useState(3e3),[u,x]=m.useState([]),[g,b]=m.useState(!1),[p,v]=m.useState(3e3),[h,f]=m.useState(!1),[N,w]=m.useState(0),[j,F]=m.useState(!1);m.useEffect(()=>{C()},[]);const C=async()=>{try{r(!0),i(null);const y=await qc();y&&(o(y.steps),w(y.steps),d(y.targetSteps),v(y.targetSteps));const W=await js();x(W)}catch(y){console.error("Error loading step data:",y),i("حدث خطأ أثناء تحميل بيانات الخطوات")}finally{r(!1)}},A=()=>{a?a():t("/trainee/exercise")},E=async()=>{try{F(!0),await Hc(p),d(p),b(!1);const y=await js();x(y)}catch(y){console.error("Error updating target steps:",y),i("حدث خطأ أثناء تحديث الخطوات المستهدفة")}finally{F(!1)}},_=async()=>{try{F(!0),await Bc(N),o(N),f(!1);const y=await js();x(y)}catch(y){console.error("Error updating steps:",y),i("حدث خطأ أثناء تحديث الخطوات")}finally{F(!1)}},k=y=>new Date(y).toLocaleDateString("ar-SA",{month:"short",day:"numeric"}),O=y=>{const W=new Date(y);return["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"][W.getDay()]},M=y=>{const W=new Date().toISOString().split("T")[0];return y===W};return e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsx("div",{className:"header-base",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:A,className:"text-white",children:e.jsx(me,{size:24})}),e.jsx("h1",{className:"text-xl font-bold",children:"خطواتي اليومية"}),e.jsx("button",{className:"text-white",children:e.jsx(At,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto content-container",children:s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):n?e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6",children:[n,e.jsx("button",{onClick:C,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card-base",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"خطواتي اليوم"}),h?e.jsx("button",{onClick:()=>{f(!1),w(l)},className:"text-rose-500 hover:bg-rose-500/10 p-2 rounded-full transition-colors",children:e.jsx(ue,{size:20})}):e.jsx("button",{onClick:()=>f(!0),className:"text-[#0AE7F2] hover:bg-[#0AE7F2]/10 p-2 rounded-full transition-colors",children:e.jsx(Nt,{size:20})})]}),h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:()=>w(Math.max(0,N-100)),className:"w-12 h-12 rounded-full bg-[#0AE7F2]/10 text-[#0AE7F2] flex items-center justify-center hover:bg-[#0AE7F2]/20 transition-colors",children:e.jsx(Mr,{size:24})}),e.jsx("input",{type:"number",value:N,onChange:y=>w(Math.max(0,parseInt(y.target.value)||0)),className:"w-32 bg-[#1A1F2E]/40 border border-[#0AE7F2]/20 rounded-xl p-3 text-center text-2xl font-bold text-[#0AE7F2] focus:outline-none focus:border-[#0AE7F2]"}),e.jsx("button",{onClick:()=>w(N+100),className:"w-12 h-12 rounded-full bg-[#0AE7F2]/10 text-[#0AE7F2] flex items-center justify-center hover:bg-[#0AE7F2]/20 transition-colors",children:e.jsx(ze,{size:24})})]}),e.jsxs("button",{onClick:_,disabled:j,className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center justify-center gap-2",children:[j?e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(qe,{size:20}),e.jsx("span",{children:"حفظ الخطوات"})]})]}):e.jsx(Wc,{steps:l,targetSteps:c})]}),e.jsxs("div",{className:"card-base",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"الخطوات المستهدفة"}),g?e.jsx("button",{onClick:()=>{b(!1),v(c)},className:"text-rose-500 hover:bg-rose-500/10 p-2 rounded-full transition-colors",children:e.jsx(ue,{size:20})}):e.jsx("button",{onClick:()=>b(!0),className:"text-[#0AE7F2] hover:bg-[#0AE7F2]/10 p-2 rounded-full transition-colors",children:e.jsx(Nt,{size:20})})]}),g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ot,{size:24,className:"text-[#0AE7F2]"}),e.jsx("input",{type:"number",value:p,onChange:y=>v(Math.max(1e3,Math.min(2e4,parseInt(y.target.value)||3e3))),className:"flex-1 bg-[#1A1F2E]/40 border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",min:"1000",max:"20000",step:"500"})]}),e.jsxs("button",{onClick:E,disabled:j,className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center justify-center gap-2",children:[j?e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(qe,{size:20}),e.jsx("span",{children:"حفظ الهدف"})]})]}):e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ot,{size:24,className:"text-[#0AE7F2]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"الهدف اليومي"}),e.jsxs("p",{className:"text-2xl font-bold text-[#0AE7F2]",children:[c.toLocaleString()," خطوة"]})]})]})]}),e.jsxs("div",{className:"card-base",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"إحصائيات الأسبوع"}),e.jsx("div",{className:"space-y-4",children:u.map(y=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 w-20",children:[e.jsx(Oe,{size:16,className:`${M(y.date)?"text-[#0AE7F2]":"text-gray-400"}`}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:`${M(y.date)?"text-white font-bold":"text-white"}`,children:O(y.date)}),e.jsx("div",{className:"text-xs text-gray-400",children:k(y.date)})]})]}),e.jsx("div",{className:"flex-1 mx-4",children:e.jsx("div",{className:"h-2 bg-[#1A1F2E]/60 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${y.steps>=y.targetSteps?"bg-emerald-500":"bg-[#0AE7F2]"} rounded-full`,style:{width:`${Math.min(100,y.steps/y.targetSteps*100)}%`}})})}),e.jsx("span",{className:`font-medium w-16 text-right ${y.steps>=y.targetSteps?"text-emerald-500":"text-[#0AE7F2]"}`,children:y.steps.toLocaleString()})]},y.date))})]}),e.jsxs("div",{className:"card-base",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"نصائح للنشاط"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:e.jsx("p",{className:"text-white",children:"حاول المشي لمدة 30 دقيقة يومياً على الأقل"})}),e.jsx("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:e.jsx("p",{className:"text-white",children:"استخدم السلالم بدلاً من المصعد كلما أمكن"})}),e.jsx("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:e.jsx("p",{className:"text-white",children:"خذ استراحات قصيرة للمشي كل ساعة إذا كنت تعمل مكتبياً"})}),e.jsx("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:e.jsx("p",{className:"text-white",children:"حاول زيادة عدد خطواتك تدريجياً بمعدل 500 خطوة أسبوعياً"})}),e.jsx("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:e.jsx("p",{className:"text-white",children:"اجعل المشي جزءاً من روتينك اليومي للحصول على أفضل النتائج"})})]})]})]})}),e.jsx(mt,{})]})]})}function Vc({onBack:a}){const t=de(),[s,r]=m.useState("main"),[n,i]=m.useState(0),[l,o]=m.useState(3e3);m.useEffect(()=>{(async()=>{try{const u=Math.floor(Math.random()*2500)+500;i(u)}catch(u){console.error("Error fetching steps:",u)}})()},[]);const c=()=>{s!=="main"?r("main"):t("/trainee")};return s==="notifications"?e.jsx(Aa,{onBack:()=>r("main")}):s==="chat"?e.jsx(Uc,{onBack:()=>r("main")}):s==="all-exercises"?e.jsx(_c,{onBack:()=>r("main"),onChestClick:()=>r("chest")}):s==="chest"?e.jsx(kc,{onBack:()=>r("all-exercises")}):s==="my-exercises"?e.jsx(Dc,{onBack:()=>r("main")}):s==="daily-steps"?e.jsx(Fa,{onBack:()=>r("main")}):e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base",children:e.jsx("div",{className:"bg-overlay"})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsx("div",{className:"bg-[#1A1F2E]/80 backdrop-blur-lg border-b border-[#0AE7F2]/20 py-2",children:e.jsxs("div",{className:"flex justify-between items-center px-4",children:[e.jsx("button",{onClick:c,className:"text-white",children:e.jsx(me,{size:24})}),e.jsx("h1",{className:"text-lg font-bold",children:"برنامج تماريني!"}),e.jsx("button",{className:"text-white",children:e.jsx(At,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pt-2",children:e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-180px)]",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-[300px] mx-auto",children:[e.jsxs("button",{onClick:()=>r("all-exercises"),className:"relative w-[140px] h-[140px] flex flex-col items-center justify-center group",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-[28px] border-2 border-[#0ae7f2]"}),e.jsx("div",{className:"relative text-[#0AE7F2] mb-2 h-16 flex items-center transition-transform duration-300 group-hover:scale-110",children:e.jsx(Xe,{size:40,className:"text-[#0AE7F2]"})}),e.jsx("span",{className:"relative text-sm font-medium text-[#0AE7F2]",children:"كل التمارين!"})]}),e.jsxs("button",{onClick:()=>r("my-exercises"),className:"relative w-[140px] h-[140px] flex flex-col items-center justify-center group",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-[28px] border-2 border-[#0ae7f2]"}),e.jsx("div",{className:"relative text-[#0AE7F2] mb-2 h-16 flex items-center transition-transform duration-300 group-hover:scale-110",children:e.jsx(Ma,{size:40,className:"text-[#0AE7F2]"})}),e.jsx("span",{className:"relative text-sm font-medium text-[#0AE7F2]",children:"قائمة تماريني!"})]}),e.jsxs("button",{onClick:()=>r("daily-steps"),className:"relative w-[140px] h-[140px] flex flex-col items-center justify-center group",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-[28px] border-2 border-[#0ae7f2]"}),e.jsx("div",{className:"relative text-[#0AE7F2] mb-2 h-16 flex items-center",children:e.jsx(Oe,{size:40,className:"text-[#0AE7F2]"})}),e.jsxs("div",{className:"relative text-center",children:[e.jsx("div",{className:"text-sm font-medium text-[#0AE7F2] mb-1",children:"خطواتي اليومية!"}),e.jsx("div",{className:"text-sm text-[#0AE7F2]",children:n})]})]}),e.jsxs("button",{onClick:()=>r("daily-steps"),className:"relative w-[140px] h-[140px] flex flex-col items-center justify-center group",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-[28px] border-2 border-[#0ae7f2]"}),e.jsx("div",{className:"relative text-[#0AE7F2] mb-2 h-16 flex items-center",children:e.jsx(ot,{size:40,className:"text-[#0AE7F2]"})}),e.jsxs("div",{className:"relative text-center",children:[e.jsx("div",{className:"text-sm font-medium text-[#0AE7F2] mb-1",children:"خطوات المستهدفة!"}),e.jsx("div",{className:"text-sm text-[#0AE7F2]",children:l})]})]})]}),e.jsx("button",{onClick:()=>t("/trainee"),className:"w-full max-w-[300px] mt-6 bg-black/50 backdrop-blur-sm rounded-[24px] border-2 border-[#0ae7f2] h-[50px] text-[#0AE7F2] text-sm font-medium hover:bg-black/60 transition-all",children:"الصفحة الرئيسية"})]})}),e.jsx(mt,{})]})]})}const Qs=[{id:"dairy-1",name:"مصل اللبن، حمضي، سائل",hebrewName:"מי גבינה, חומצי, נוזלי",calories:24,protein:.8,carbs:5.1,fat:.1,category:"milk"},{id:"dairy-2",name:"برغل مطبوخ مع فاصوليا بيضاء وطماطم",hebrewName:"בורגול, מבושל עם שעועית לבנה ועגבניות",calories:112,protein:5.3,carbs:15.3,fat:1.7,category:"other"},{id:"dairy-3",name:"حليب بشري",hebrewName:"חלב אם",calories:70,protein:1,carbs:6.9,fat:4.4,category:"milk"},{id:"dairy-4",name:"حليب بقر، 3% دهون",hebrewName:"חלב 3% שומן, תנובה, טרה, הרדוף, יטבתה",calories:60,protein:3.3,carbs:4.6,fat:3,category:"milk"},{id:"dairy-5",name:"حليب بقر، 1% دهون، مدعم بالكالسيوم",hebrewName:"חלב 1% שומן בקרטון מועשר ויטמין A,D, וסידן",calories:42,protein:3,carbs:4.6,fat:1,category:"milk"},{id:"dairy-6",name:"حليب بقر، 3% دهون، مدعم بالكالسيوم",hebrewName:"חלב 3% שומן, מועשר בסידן, תנובה,טרה,יטבתה",calories:58,protein:3.2,carbs:4.6,fat:3,category:"milk"},{id:"dairy-7",name:"حليب بقر، 3% دهون، مدعم بالفيتامينات",hebrewName:"חלב 3% שומן, מועשר בויטמינים B12, D,E, יטבתה",calories:57,protein:3,carbs:4.7,fat:3,category:"milk"},{id:"dairy-8",name:"حليب بقر، 1% دهون",hebrewName:"חלב 1% שומן, תנובה, טרה, הרדוף, יטבתה",calories:43,protein:3.3,carbs:5.1,fat:1,category:"milk"},{id:"dairy-9",name:"مشروب حليب، 3% دهون، فانيلا/موز/موكا",hebrewName:"משקה חלב בטעם וניל,3% שומן, טרה",calories:86,protein:2.5,carbs:12,fat:3,category:"milk"},{id:"dairy-10",name:"حليب بقر، 3% دهون، قليل اللاكتوز",hebrewName:"חלב 2% שומן, כולל דל לקטוז, תנובה",calories:51,protein:3.2,carbs:4.9,fat:2,category:"milk"},{id:"dairy-11",name:"حليب ماعز، سائل، كامل الدسم",hebrewName:"חלב עזים 4% שומן",calories:69,protein:3.6,carbs:4.5,fat:4.1,category:"milk"},{id:"dairy-12",name:"حليب ماعز، 3.7% دهون",hebrewName:"חלב עזים 3.7% שומן, צוריאל",calories:66,protein:3,carbs:4.7,fat:3.7,category:"milk"},{id:"dairy-13",name:"حليب غنم، 7% دهون",hebrewName:"חלב כבשים 7% שומן",calories:108,protein:6,carbs:5.4,fat:7,category:"milk"},{id:"dairy-14",name:"حليب إبل",hebrewName:"חלב נאקות (גמלים)",calories:58,protein:3.1,carbs:4.7,fat:3,category:"milk"},{id:"dairy-15",name:"حليب مجفف، معاد تكوينه، كامل الدسم",hebrewName:"חלב מיובש, מלא, משוחזר",calories:61,protein:3.2,carbs:4.7,fat:3.3,category:"milk"},{id:"dairy-16",name:"زبادي، 4.5% دهون",hebrewName:"יוגורט 4.5% שומן, תנובה",calories:68,protein:3.3,carbs:3.5,fat:4.5,category:"yogurt"},{id:"dairy-17",name:"زبادي، 1.5% دهون",hebrewName:"יוגורט 1.5% שומן, תנובה",calories:48,protein:3.6,carbs:4.3,fat:1.5,category:"yogurt"},{id:"dairy-18",name:"زبادي، عادي، 3% دهون",hebrewName:"יוגורט טבעי 3% שומן",calories:65,protein:4.7,carbs:4.7,fat:3,category:"yogurt"},{id:"dairy-19",name:"زبادي، 3% دهون، بروبيوتيك، مع فاكهة",hebrewName:"יוגורט פרוביוטי עם פרי 3% שומן",calories:115,protein:3.8,carbs:18.2,fat:3,category:"yogurt"},{id:"dairy-20",name:"زبادي، 0% دهون، مع فاكهة",hebrewName:"יוגורט עם פרי 0% שומן",calories:40,protein:4.8,carbs:4.9,fat:0,category:"yogurt"},{id:"dairy-21",name:"زبادي، 1.5% دهون، فانيلا",hebrewName:"יוגורט בטעם וניל 1.5% שומן",calories:93,protein:3.7,carbs:16,fat:1.5,category:"yogurt"},{id:"dairy-22",name:"مشروب زبادي، 1.5% دهون، فراولة",hebrewName:"משקה יוגורט בטעם תות 1.5% שומן",calories:94,protein:3.1,carbs:17.2,fat:1.5,category:"yogurt"},{id:"dairy-23",name:"جبنة قريش، 5% دهون",hebrewName:"גבינה לבנה 5% שומן (קוטג׳)",calories:91,protein:8,carbs:3.5,fat:5,category:"cheese"},{id:"dairy-24",name:"جبنة كريمية، 9% دهون",hebrewName:"גבינה לבנה 9% שומן",calories:127,protein:8,carbs:3.5,fat:9,category:"cheese"},{id:"dairy-25",name:"جبنة كريمية، 5% دهون",hebrewName:"גבינה לבנה 5% שומן",calories:91,protein:9.5,carbs:2,fat:5,category:"cheese"},{id:"dairy-26",name:"جبنة كوارك، 5% دهون",hebrewName:"גבינת קוואקר 5% שומן",calories:91,protein:9.5,carbs:2,fat:5,category:"cheese"},{id:"dairy-27",name:"جبنة بلغارية، 5% دهون",hebrewName:"גבינה בולגרית 5% שומן",calories:91,protein:9.5,carbs:2,fat:5,category:"cheese"},{id:"dairy-28",name:"جبنة بلغارية، 16% دهون",hebrewName:"גבינה בולגרית 16% שומן",calories:166,protein:9,carbs:1.1,fat:16,category:"cheese"},{id:"dairy-29",name:"جبنة على طراز فيتا، 5% دهون",hebrewName:"גבינה בסגנון פטה 5% שומן",calories:91,protein:9.5,carbs:2,fat:5,category:"cheese"},{id:"dairy-30",name:"جبنة على طراز فيتا، 16% دهون",hebrewName:"גבינה בסגנון פטה 16% שומן",calories:166,protein:9,carbs:1.1,fat:16,category:"cheese"},{id:"dairy-31",name:"جبنة صلبة، صفراء، 28% دهون",hebrewName:"גבינה קשה צהובה 28% שומן",calories:350,protein:25,carbs:2,fat:28,category:"cheese"},{id:"dairy-32",name:"جبنة صلبة، صفراء، 22% دهون",hebrewName:"גבינה קשה צהובה 22% שומן",calories:300,protein:25,carbs:2,fat:22,category:"cheese"},{id:"dairy-33",name:"جبنة صلبة، صفراء، 9% دهون",hebrewName:"גבינה קשה צהובה 9% שומן",calories:200,protein:25,carbs:2,fat:9,category:"cheese"},{id:"dairy-34",name:"جبنة بارميزان",hebrewName:"גבינת פרמזן",calories:420,protein:38,carbs:3.2,fat:29,category:"cheese"},{id:"dairy-35",name:"جبنة موزاريلا",hebrewName:"גבינת מוצרלה",calories:280,protein:22,carbs:2.2,fat:22,category:"cheese"},{id:"dairy-36",name:"جبنة موزاريلا، لايت",hebrewName:"גבינת מוצרלה לייט",calories:200,protein:22,carbs:2.2,fat:12,category:"cheese"},{id:"dairy-37",name:"جبنة كاشكافال",hebrewName:"גבינת קשקבל",calories:350,protein:25,carbs:2,fat:28,category:"cheese"},{id:"dairy-38",name:"جبنة شيدر",hebrewName:"גבינת צ׳דר",calories:400,protein:25,carbs:1.3,fat:33,category:"cheese"},{id:"dairy-39",name:"جبنة جودا",hebrewName:"גבינת גאודה",calories:350,protein:25,carbs:2.2,fat:27,category:"cheese"},{id:"dairy-40",name:"جبنة روكفور",hebrewName:"גבינת רוקפור",calories:370,protein:21.5,carbs:2,fat:30.6,category:"cheese"},{id:"dairy-41",name:"جبنة بري",hebrewName:"גבינת ברי",calories:330,protein:20.8,carbs:.5,fat:27.7,category:"cheese"},{id:"dairy-42",name:"جبنة كاممبير",hebrewName:"גבינת קממבר",calories:300,protein:19.8,carbs:.5,fat:24.3,category:"cheese"},{id:"dairy-43",name:"جبنة ريكوتا",hebrewName:"גבינת ריקוטה",calories:174,protein:11.3,carbs:3.8,fat:12.9,category:"cheese"},{id:"dairy-44",name:"جبنة ماسكاربوني",hebrewName:"גבינת מסקרפונה",calories:420,protein:4.3,carbs:3.6,fat:42.1,category:"cheese"},{id:"dairy-45",name:"جبنة كريمية، 16% دهون",hebrewName:"גבינת שמנת 16% שומן",calories:166,protein:9,carbs:1.1,fat:16,category:"cheese"},{id:"dairy-46",name:"جبنة كريمية، 24% دهون",hebrewName:"גבינת שמנת 24% שומן",calories:240,protein:9,carbs:1.1,fat:24,category:"cheese"},{id:"dairy-47",name:"جبنة قابلة للدهن، 9% دهون",hebrewName:"ממרח גבינה 9% שומן",calories:127,protein:8,carbs:3.5,fat:9,category:"cheese"},{id:"dairy-48",name:"جبنة قابلة للدهن، 16% دهون",hebrewName:"ממרח גבינה 16% שומן",calories:166,protein:9,carbs:1.1,fat:16,category:"cheese"},{id:"dairy-49",name:"كريمة حامضة، 15% دهون",hebrewName:"שמנת חמוצה 15% שומן",calories:170,protein:2.5,carbs:3.5,fat:15,category:"cream"},{id:"dairy-50",name:"كريمة حامضة، 27% دهون",hebrewName:"שמנת חמוצה 27% שומן",calories:270,protein:2.5,carbs:3.5,fat:27,category:"cream"},{id:"dairy-51",name:"كريمة حلوة، 38% دهون",hebrewName:"שמנת מתוקה 38% שומן",calories:380,protein:2.1,carbs:3.1,fat:38,category:"cream"},{id:"dairy-52",name:"زبدة، مملحة",hebrewName:"חמאה עם מלח",calories:717,protein:.9,carbs:.1,fat:81,category:"butter"},{id:"dairy-53",name:"زبدة، غير مملحة",hebrewName:"חמאה ללא מלח",calories:717,protein:.9,carbs:.1,fat:81,category:"butter"},{id:"dairy-54",name:"بديل حليب، صويا، محلى",hebrewName:"תחליף חלב סויה ממותק",calories:54,protein:3.3,carbs:4.5,fat:2.3,category:"substitute"},{id:"dairy-55",name:"بديل حليب، لوز",hebrewName:"תחליף חלב שקדים",calories:30,protein:1.1,carbs:3.5,fat:1.5,category:"substitute"},{id:"dairy-56",name:"بديل حليب، أرز",hebrewName:"תחליף חלב אורז",calories:47,protein:.3,carbs:9.2,fat:1,category:"substitute"},{id:"dairy-57",name:"بديل حليب، شوفان",hebrewName:"תחליף חלב שיבולת שועל",calories:45,protein:1.5,carbs:7.5,fat:1.5,category:"substitute"},{id:"dairy-58",name:"آيس كريم، فانيلا",hebrewName:"גלידת וניל",calories:207,protein:3.5,carbs:23.6,fat:11,category:"icecream"},{id:"dairy-59",name:"آيس كريم، شوكولاتة",hebrewName:"גלידת שוקולד",calories:216,protein:3.8,carbs:24,fat:11.5,category:"icecream"},{id:"dairy-60",name:"آيس كريم، فراولة",hebrewName:"גלידת תות",calories:192,protein:3.2,carbs:24.8,fat:9.5,category:"icecream"},{id:"dairy-61",name:"آيس كريم، فستق",hebrewName:"גלידת פיסטוק",calories:220,protein:4.5,carbs:22.5,fat:12.5,category:"icecream"},{id:"dairy-62",name:"آيس كريم، مانجو",hebrewName:"גלידת מנגו",calories:180,protein:2.8,carbs:26,fat:8.5,category:"icecream"},{id:"dairy-63",name:"آيس كريم، ليمون",hebrewName:"גלידת לימון",calories:160,protein:2,carbs:28,fat:5,category:"icecream"},{id:"dairy-64",name:"آيس كريم، قهوة",hebrewName:"גלידת קפה",calories:200,protein:3.5,carbs:23,fat:10.5,category:"icecream"},{id:"dairy-65",name:"آيس كريم، زبادي",hebrewName:"גלידת יוגורט",calories:190,protein:5.8,carbs:33.2,fat:6.4,category:"icecream"},{id:"dairy-66",name:"آيس كريم، قليل الدسم",hebrewName:"גלידה דלת שומן",calories:150,protein:3.5,carbs:28,fat:3,category:"icecream"},{id:"dairy-67",name:"آيس كريم، سوربيه",hebrewName:"סורבה",calories:130,protein:.5,carbs:32,fat:0,category:"icecream"},{id:"dairy-68",name:"ميلك شيك، شوكولاتة",hebrewName:"מילקשייק שוקולד",calories:230,protein:8,carbs:35,fat:6,category:"other"},{id:"dairy-69",name:"ميلك شيك، فانيلا",hebrewName:"מילקשייק וניל",calories:210,protein:8,carbs:32,fat:5.5,category:"other"},{id:"dairy-70",name:"ميلك شيك، موز",hebrewName:"מילקשייק בננה",calories:220,protein:7.5,carbs:36,fat:5,category:"other"},{id:"dairy-71",name:"ميلك شيك، فراولة",hebrewName:"מילקשייק תות",calories:215,protein:7.5,carbs:35,fat:5,category:"other"},{id:"dairy-72",name:"مشروب زبادي، بروبيوتيك",hebrewName:"משקה יוגורט פרוביוטי",calories:96,protein:2.9,carbs:17,fat:1.8,category:"yogurt"},{id:"dairy-73",name:"مشروب زبادي، فانيلا",hebrewName:"משקה יוגורט וניל",calories:96,protein:2.9,carbs:17,fat:1.8,category:"yogurt"},{id:"dairy-74",name:"مشروب زبادي، مانجو",hebrewName:"משקה יוגורט מנגו",calories:96,protein:2.9,carbs:17,fat:1.8,category:"yogurt"},{id:"dairy-75",name:"مشروب زبادي، قهوة",hebrewName:"משקה יוגורט קפה",calories:96,protein:2.9,carbs:17,fat:1.8,category:"yogurt"},{id:"dairy-76",name:"كريمة مخفوقة",hebrewName:"קצפת",calories:257,protein:2.2,carbs:7.5,fat:25,category:"cream"},{id:"dairy-77",name:"كريمة خفيفة",hebrewName:"שמנת קלה",calories:120,protein:2.5,carbs:3.5,fat:10,category:"cream"},{id:"dairy-78",name:"جبنة خفيفة",hebrewName:"גבינה קלה",calories:150,protein:20,carbs:2,fat:7,category:"cheese"},{id:"dairy-79",name:"جبنة خالية من اللاكتوز",hebrewName:"גבינה ללא לקטוז",calories:300,protein:25,carbs:2,fat:22,category:"cheese"},{id:"dairy-80",name:"زبادي خالي من اللاكتوز",hebrewName:"יוגורט ללא לקטוז",calories:65,protein:4.7,carbs:4.7,fat:3,category:"yogurt"},{id:"dairy-81",name:"حليب خالي من اللاكتوز",hebrewName:"חלב ללא לקטוז",calories:60,protein:3.3,carbs:4.6,fat:3,category:"milk"},{id:"dairy-82",name:"زبدة مصفاة",hebrewName:"חמאה מזוקקת",calories:876,protein:.3,carbs:0,fat:99.5,category:"butter"},{id:"dairy-83",name:"سمن",hebrewName:"גהי",calories:876,protein:.3,carbs:0,fat:99.5,category:"butter"},{id:"dairy-84",name:"مسحوق بروتين مصل اللبن",hebrewName:"אבקת חלבון מי גבינה",calories:400,protein:80,carbs:10,fat:7,category:"other"},{id:"dairy-85",name:"مسحوق بروتين كازين",hebrewName:"אבקת חלבון קזאין",calories:370,protein:80,carbs:7,fat:3.5,category:"other"},{id:"dairy-86",name:"مشروب بروتين، فانيلا",hebrewName:"משקה חלבון וניל",calories:160,protein:30,carbs:5,fat:2.5,category:"other"},{id:"dairy-87",name:"تركيبة للرضع، ليلة طيبة، قوام سميك",hebrewName:"תמ״ל, מטרנה לילה טוב, בהכנה סמיכה",calories:506,protein:11,carbs:58.5,fat:25.3,category:"other"},{id:"dairy-88",name:"تركيبة للرضع، ألبان، المرحلة 1، مسحوق",hebrewName:"תמ״ל, חלבי שלב 1, כולל מהדרין, אבקה, מטרנה",calories:500,protein:10.5,carbs:57,fat:25,category:"other"},{id:"dairy-89",name:"تركيبة للرضع، ألبان، المرحلة 2، مسحوق",hebrewName:"תמ״ל, חלבי שלב 2, כולל מהדרין, אבקה, מטרנה",calories:500,protein:11,carbs:56,fat:25,category:"other"},{id:"dairy-90",name:"تركيبة للرضع، ألبان، المرحلة 3، مسحوق",hebrewName:"תמ״ל, חלבי שלב 3, כולל מהדרין, אבקה, מטרנה",calories:500,protein:11.5,carbs:55,fat:25,category:"other"},{id:"dairy-91",name:"تركيبة للرضع، غير ألبان، من عمر سنة، جاهزة للشرب",hebrewName:"תמ״ל, מטרנה צמחית עד גיל שנה, מוכן",calories:67,protein:1.6,carbs:7.3,fat:3.5,category:"substitute"},{id:"dairy-92",name:"بودينغ حليب، 1.5% دهون، شوكولاتة",hebrewName:"מעדן חלב 1.5% שומן, שוקולד, דני, שקשק, שטראוס",calories:120,protein:3.5,carbs:22,fat:1.5,category:"other"},{id:"dairy-93",name:"بودينغ حليب، 3% دهون، شوكولاتة",hebrewName:"מעדן חלב 3% שומן, שוקולד, שטראוס, טרה",calories:140,protein:3.5,carbs:22,fat:3,category:"other"},{id:"dairy-94",name:"بودينغ حليب، 3% دهون، فانيلا",hebrewName:"מעדן חלב 1.5% שומן, וניל, דני/קרלו, שטראוס,תנובה",calories:130,protein:3.5,carbs:20,fat:3,category:"other"},{id:"dairy-95",name:"بودينغ حليب مع أرز، فانيلا",hebrewName:"מעדן חלב עם אורז, ירח מתוק, בטעם וניל, גד",calories:150,protein:3,carbs:25,fat:3,category:"other"},{id:"dairy-96",name:"بودينغ حليب، 3% دهون، فراولة/خوخ/أناناس",hebrewName:"מעדן חלב, באדי, 3% שומן, תות /אפרסק/אננס, תנובה",calories:135,protein:3.5,carbs:21,fat:3,category:"other"},{id:"dairy-97",name:"بودينغ حليب، 4% دهون، موز",hebrewName:"מעדן חלב, ג׳ננה פונץ׳ בננה 4% שומן, חצי חצי, טרה",calories:145,protein:3.5,carbs:22,fat:4,category:"other"},{id:"dairy-98",name:"بودينغ حليب، 6-12% دهون، مع كريمة، شوكولاتة",hebrewName:"מעדן חלב עם קצפת 6-12% שומן, מילקי שוקו, סוגים שונים, שטראוס",calories:200,protein:3.5,carbs:25,fat:8,category:"other"},{id:"dairy-99",name:"بودينغ حليب، مهلبية",hebrewName:"מלבי, רוזטה מלבי, מעדן חלב, עדן קינוחים, גד",calories:140,protein:3,carbs:22,fat:3,category:"other"},{id:"dairy-100",name:"بودينغ حليب 0% دهون، شوكولاتة/فانيلا، مع محلي",hebrewName:"מעדן חלב 0% שומן, שוקולד/וניל עם ממתיק דל קלוריות, טוויגי, תנובה",calories:90,protein:3.5,carbs:15,fat:0,category:"other"},{id:"dairy-101",name:"حلوى حليب أو حلوى حليب (دولسي دي ليتشي)",hebrewName:"ריבת חלב",calories:315,protein:7,carbs:55,fat:8,category:"other"},{id:"dairy-102",name:"سحلب، أساسه الماء، محضر من مسحوق",hebrewName:"סחלב מוכן מאבקה, על בסיס מים",calories:120,protein:1,carbs:25,fat:2,category:"other"},{id:"dairy-103",name:"موس شوكولاتة، غير ألبان، محضر منزلياً",hebrewName:"מוס שוקולד פרווה עם קצפת צמחית",calories:250,protein:3,carbs:30,fat:12,category:"other"},{id:"dairy-104",name:"كريم بافاريا، محضر منزلياً",hebrewName:"קרם בוואריה",calories:280,protein:5,carbs:25,fat:18,category:"other"},{id:"dairy-105",name:"كريم بروليه، محضر منزلياً",hebrewName:"קרם ברולה",calories:300,protein:4,carbs:26,fat:20,category:"other"},{id:"dairy-106",name:"حليب بقر كامل الدسم 3%",calories:60,protein:3.3,carbs:4.6,fat:3,category:"milk"},{id:"dairy-107",name:"حليب بقر قليل الدسم 1%",calories:43,protein:3.3,carbs:5.1,fat:1,category:"milk"},{id:"dairy-108",name:"حليب ماعز 4%",calories:69,protein:3.6,carbs:4.5,fat:4.1,category:"milk"},{id:"dairy-109",name:"حليب غنم 7%",calories:108,protein:6,carbs:5.4,fat:7,category:"milk"},{id:"dairy-110",name:"حليب ناقة",calories:58,protein:3.1,carbs:4.7,fat:3,category:"milk"},{id:"dairy-111",name:"زبادي كامل الدسم 4.5%",calories:68,protein:3.3,carbs:3.5,fat:4.5,category:"yogurt"},{id:"dairy-112",name:"زبادي قليل الدسم 1.5%",calories:48,protein:3.6,carbs:4.3,fat:1.5,category:"yogurt"},{id:"dairy-113",name:"زبادي طبيعي 3%",calories:65,protein:4.7,carbs:4.7,fat:3,category:"yogurt"},{id:"dairy-114",name:"زبادي خالي الدسم مع الفواكه",calories:40,protein:4.8,carbs:4.9,fat:0,category:"yogurt"},{id:"dairy-115",name:"مشروب زبادي 1.5%",calories:94,protein:3.1,carbs:17.2,fat:1.5,category:"yogurt"},{id:"dairy-116",name:"جبنة قريش 5%",calories:91,protein:8,carbs:3.5,fat:5,category:"cheese"},{id:"dairy-117",name:"جبنة كريمية 9%",calories:127,protein:8,carbs:3.5,fat:9,category:"cheese"},{id:"dairy-118",name:"جبنة فيتا 16%",calories:166,protein:9,carbs:1.1,fat:16,category:"cheese"},{id:"dairy-119",name:"جبنة صفراء 28%",calories:350,protein:25,carbs:2,fat:28,category:"cheese"},{id:"dairy-120",name:"جبنة موزاريلا",calories:280,protein:22,carbs:2.2,fat:22,category:"cheese"},{id:"dairy-121",name:"جبنة بارميزان",calories:420,protein:38,carbs:3.2,fat:29,category:"cheese"},{id:"dairy-122",name:"زبدة مملحة",calories:717,protein:.9,carbs:.1,fat:81,category:"butter"},{id:"dairy-123",name:"قشدة حامضة 15%",calories:170,protein:2.5,carbs:3.5,fat:15,category:"cream"},{id:"dairy-124",name:"قشدة حلوة 38%",calories:380,protein:2.1,carbs:3.1,fat:38,category:"cream"},{id:"dairy-125",name:"حليب لوز",calories:30,protein:1.1,carbs:3.5,fat:1.5,category:"substitute"},{id:"dairy-126",name:"حليب صويا",calories:54,protein:3.3,carbs:4.5,fat:2.3,category:"substitute"},{id:"dairy-127",name:"بروتين مصل اللبن",calories:400,protein:80,carbs:10,fat:7,category:"other"},{id:"dairy-128",name:"آيس كريم فانيلا",calories:207,protein:3.5,carbs:23.6,fat:11,category:"icecream"},{id:"dairy-129",name:"آيس كريم شوكولاتة",calories:216,protein:3.8,carbs:24,fat:11.5,category:"icecream"},{id:"dairy-130",name:"آيس كريم فراولة",calories:192,protein:3.2,carbs:24.8,fat:9.5,category:"icecream"},{id:"dairy-131",name:"آيس كريم فستق",calories:220,protein:4.5,carbs:22.5,fat:12.5,category:"icecream"},{id:"dairy-132",name:"آيس كريم مانجو",calories:180,protein:2.8,carbs:26,fat:8.5,category:"icecream"},{id:"dairy-133",name:"مهلبية",calories:140,protein:3,carbs:22,fat:3,category:"other"},{id:"dairy-134",name:"رز بالحليب",calories:150,protein:3,carbs:25,fat:3,category:"other"},{id:"dairy-135",name:"كريم كراميل",calories:200,protein:3.5,carbs:25,fat:8,category:"other"},{id:"dairy-136",name:"بودينغ الشوكولاتة",calories:220,protein:3.5,carbs:30,fat:10,category:"other"},{id:"dairy-137",name:"كاسترد",calories:160,protein:4,carbs:20,fat:6,category:"other"},{id:"dairy-138",name:"حليب بقر، 0% دهون",calories:35,protein:3.4,carbs:5,fat:0,category:"milk"},{id:"dairy-139",name:"حليب بقر، 2% دهون",calories:50,protein:3.3,carbs:4.8,fat:2,category:"milk"},{id:"dairy-140",name:"زبادي يوناني، 0% دهون",calories:60,protein:10,carbs:3.6,fat:0,category:"yogurt"},{id:"dairy-141",name:"زبادي يوناني، 2% دهون",calories:80,protein:10,carbs:3.6,fat:2,category:"yogurt"},{id:"dairy-142",name:"زبادي يوناني، 5% دهون",calories:100,protein:9,carbs:3.6,fat:5,category:"yogurt"},{id:"dairy-143",name:"جبنة قريش، 0% دهون",calories:72,protein:13,carbs:3.5,fat:0,category:"cheese"},{id:"dairy-144",name:"جبنة قريش، 2% دهون",calories:81,protein:12,carbs:3.5,fat:2,category:"cheese"},{id:"dairy-145",name:"جبنة قريش، 9% دهون",calories:120,protein:11,carbs:3.5,fat:9,category:"cheese"},{id:"dairy-146",name:"حليب جوز الهند",calories:45,protein:.5,carbs:2,fat:4.5,category:"substitute"},{id:"dairy-147",name:"حليب الكاجو",calories:50,protein:1,carbs:7.5,fat:2.5,category:"substitute"},{id:"dairy-148",name:"حليب الكينوا",calories:40,protein:1.5,carbs:6.5,fat:1,category:"substitute"},{id:"dairy-149",name:"حليب البندق",calories:60,protein:1.5,carbs:2.5,fat:5.5,category:"substitute"},{id:"dairy-150",name:"حليب الفستق",calories:65,protein:2.5,carbs:3,fat:5,category:"substitute"}];function _a({onSelectFood:a}){const[t,s]=m.useState(""),[r,n]=m.useState([]),[i,l]=m.useState(!1),[o,c]=m.useState(!1),[d,u]=m.useState(null),[x,g]=m.useState([0,1e3]),[b,p]=m.useState([0,100]),[v,h]=m.useState([]),[f,N]=m.useState({});m.useEffect(()=>{h(Qs)},[]),m.useEffect(()=>{w()},[t,d,x,b]);const w=()=>{l(!0);const E=v.filter(_=>{const k=t===""||_.name.toLowerCase().includes(t.toLowerCase())||_.hebrewName&&_.hebrewName.toLowerCase().includes(t.toLowerCase()),O=!d||_.category===d,M=_.calories>=x[0]&&_.calories<=x[1],y=_.protein>=b[0]&&_.protein<=b[1];return k&&O&&M&&y});n(E),l(!1)},j=()=>{u(null),g([0,1e3]),p([0,100])},F=E=>{N(_=>({..._,[E]:!_[E]}))},C=E=>{switch(E){case"milk":return"الحليب";case"yogurt":return"الزبادي";case"cheese":return"الجبن";case"cream":return"القشدة";case"butter":return"الزبدة";case"icecream":return"الآيس كريم";case"substitute":return"بدائل الحليب";case"other":return"منتجات أخرى";default:return E}},A={};return r.forEach(E=>{A[E.category]||(A[E.category]=[]),A[E.category].push(E)}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:t,onChange:E=>s(E.target.value),placeholder:"ابحث عن منتج...",className:"w-full bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl py-2 px-4 pr-10 text-white placeholder-gray-400 focus:outline-none focus:border-[#0AE7F2]"}),e.jsx(je,{className:"absolute top-1/2 right-3 -translate-y-1/2 text-gray-400",size:20}),t&&e.jsx("button",{onClick:()=>s(""),className:"absolute top-1/2 left-3 -translate-y-1/2 text-gray-400 hover:text-white",children:e.jsx(ue,{size:16})})]}),e.jsx("button",{onClick:()=>c(!o),className:"bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-2 text-[#0AE7F2] hover:bg-[#1A1F2E] transition-colors",children:e.jsx(Ue,{size:20})})]}),o&&e.jsxs("div",{className:"bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium",children:"تصفية النتائج"}),e.jsx("button",{onClick:j,className:"text-sm text-[#0AE7F2] hover:underline",children:"مسح الفلاتر"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"التصنيف"}),e.jsxs("select",{value:d||"",onChange:E=>u(E.target.value||null),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:[e.jsx("option",{value:"",children:"جميع التصنيفات"}),e.jsx("option",{value:"milk",children:"الحليب"}),e.jsx("option",{value:"yogurt",children:"الزبادي"}),e.jsx("option",{value:"cheese",children:"الجبن"}),e.jsx("option",{value:"cream",children:"القشدة"}),e.jsx("option",{value:"butter",children:"الزبدة"}),e.jsx("option",{value:"icecream",children:"الآيس كريم"}),e.jsx("option",{value:"substitute",children:"بدائل الحليب"}),e.jsx("option",{value:"other",children:"منتجات أخرى"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-2",children:["السعرات الحرارية: ",x[0]," - ",x[1]]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"range",min:"0",max:"1000",value:x[0],onChange:E=>g([parseInt(E.target.value),x[1]]),className:"w-1/2"}),e.jsx("input",{type:"range",min:"0",max:"1000",value:x[1],onChange:E=>g([x[0],parseInt(E.target.value)]),className:"w-1/2"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-2",children:["البروتين (جرام): ",b[0]," - ",b[1]]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:b[0],onChange:E=>p([parseInt(E.target.value),b[1]]),className:"w-1/2"}),e.jsx("input",{type:"range",min:"0",max:"100",value:b[1],onChange:E=>p([b[0],parseInt(E.target.value)]),className:"w-1/2"})]})]})]}),i&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Fe,{size:24,className:"text-[#0AE7F2] animate-spin"})}),!i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:["تم العثور على ",r.length," منتج"]}),r.length===0?e.jsx("div",{className:"bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-gray-400",children:"لم يتم العثور على منتجات مطابقة للبحث"})}):e.jsx("div",{className:"space-y-4",children:Object.entries(A).map(([E,_])=>e.jsxs("div",{className:"bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>F(E),className:"w-full flex items-center justify-between p-4 hover:bg-[#1A1F2E] transition-colors",children:[e.jsx("h3",{className:"font-medium",children:C(E)}),f[E]?e.jsx(Es,{size:20,className:"text-[#0AE7F2]"}):e.jsx(Ot,{size:20,className:"text-[#0AE7F2]"})]}),f[E]&&e.jsx("div",{className:"border-t border-[#0AE7F2]/20",children:_.map(k=>e.jsxs("button",{onClick:()=>a(k),className:"w-full px-4 py-3 text-right hover:bg-[#0AE7F2]/10 transition-colors flex justify-between items-center border-b border-[#0AE7F2]/10 last:border-0",children:[e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:"font-medium",dir:"rtl",children:k.name}),k.hebrewName&&e.jsx("span",{className:"text-xs text-gray-400",children:k.hebrewName}),e.jsxs("div",{className:"text-xs text-gray-400 flex gap-3",children:[e.jsxs("span",{children:["بروتين: ",k.protein,"g"]}),e.jsxs("span",{children:["كربوهيدرات: ",k.carbs,"g"]}),e.jsxs("span",{children:["دهون: ",k.fat,"g"]})]})]}),e.jsxs("span",{className:"text-[#0AE7F2] font-medium whitespace-nowrap",children:[k.calories," سعرة"]})]},k.id))})]},E))})]})]})}function Gc({onSelectFood:a}){const[t,s]=m.useState(""),[r,n]=m.useState([]),[i,l]=m.useState(!1),[o,c]=m.useState(null),[d,u]=m.useState([]),[x,g]=m.useState(!1);m.useEffect(()=>{const N=[...[{id:"food-1",name:"شوفان بالموز",calories:350,protein:12,carbs:45,fat:8,category:"breakfast"},{id:"food-2",name:"صدر دجاج مشوي",calories:450,protein:35,carbs:20,fat:15,category:"lunch"},{id:"food-3",name:"سلمون مشوي",calories:400,protein:30,carbs:15,fat:20,category:"dinner"},{id:"food-4",name:"سلطة خضراء",calories:150,protein:5,carbs:20,fat:8,category:"lunch"},{id:"food-5",name:"عصير بروتين",calories:200,protein:25,carbs:15,fat:5,category:"snack"},{id:"food-6",name:"بيض مسلوق",calories:155,protein:13,carbs:1,fat:11,category:"breakfast"},{id:"food-7",name:"أفوكادو",calories:240,protein:3,carbs:12,fat:22,category:"snack"},{id:"food-8",name:"خبز أسمر",calories:80,protein:4,carbs:15,fat:1,category:"breakfast"},{id:"food-9",name:"زبادي يوناني",calories:100,protein:10,carbs:4,fat:5,category:"snack"},{id:"food-10",name:"لوز نيء",calories:160,protein:6,carbs:6,fat:14,category:"snack"},{id:"food-11",name:"موز",calories:105,protein:1.3,carbs:27,fat:.4,category:"snack"},{id:"food-12",name:"تفاح",calories:95,protein:.5,carbs:25,fat:.3,category:"snack"},{id:"food-13",name:"أرز بني",calories:110,protein:2.5,carbs:23,fat:.9,category:"lunch"},{id:"food-14",name:"بطاطا حلوة",calories:90,protein:2,carbs:20,fat:.1,category:"lunch"},{id:"food-15",name:"حمص",calories:165,protein:9,carbs:27,fat:2.5,category:"lunch"}],...Qs];u(N)},[]);const b=[{name:"حبوب وبقوليات",icon:Oa,keywords:["بورغول","فاصوليا","أرز","عدس","حمص","كينوا"],examples:"بورغول، أرز، عدس"},{name:"خضروات وفواكه",icon:Be,keywords:["طماطم","خيار","جزر","بصل","فلفل","خس","تفاح","موز","برتقال"],examples:"طماطم، خيار، تفاح"},{name:"لحوم",icon:za,keywords:["لحم","دجاج","ديك رومي","خروف","بقر"],examples:"لحم، دجاج، ديك رومي"},{name:"أسماك",icon:Da,keywords:["سمك","سلمون","تونة","سمك أبيض","سمك مشوي"],examples:"سمك، سلمون، تونة"},{name:"ألبان",icon:La,keywords:["حليب","جبن","زبادي","لبن","جبنة"],examples:"حليب، جبن، زبادي"}],p=async f=>{if(!f.trim()){n([]);return}l(!0),c(null);try{const w=d.filter(j=>j.name.toLowerCase().includes(f.toLowerCase())||j.hebrewName&&j.hebrewName.includes(f)||j.category&&j.category.includes(f)).map(j=>({id:j.id,name:j.name,calories:j.calories,protein:j.protein,carbs:j.carbs,fat:j.fat}));n(w),w.length===0&&c("لم يتم العثور على نتائج. حاول استخدام كلمات بحث مختلفة")}catch(N){console.error("Error searching foods:",N),c("حدث خطأ أثناء البحث"),n([])}finally{l(!1)}},v=f=>{s(f),window.searchTimeout&&clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{f.length>=2?p(f):n([])},300)},h=f=>{const N=f[0];s(N),p(N)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 gap-3",children:b.map((f,N)=>e.jsxs("button",{onClick:()=>h(f.keywords),className:"flex items-center justify-between p-4 rounded-xl bg-[#1A1F2E]/60 hover:bg-[#1A1F2E] transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-3 rounded-xl",children:e.jsx(f.icon,{className:"text-[#0AE7F2]",size:24})}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"font-medium mb-1",children:f.name}),e.jsx("p",{className:"text-sm text-gray-400",dir:"rtl",children:f.examples})]})]}),e.jsx(zs,{className:"text-[#0AE7F2] opacity-0 group-hover:opacity-100 transition-opacity"})]},N))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:t,onChange:f=>v(f.target.value),placeholder:"اكتب اسم الوجبة للبحث",className:"w-full bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl py-3 px-5 pr-12 text-white placeholder-gray-400 focus:outline-none focus:border-[#0AE7F2]",dir:"rtl"}),e.jsx("div",{className:"absolute top-1/2 right-4 -translate-y-1/2",children:i?e.jsx(Fe,{className:"text-gray-400 animate-spin",size:20}):e.jsx(je,{className:"text-gray-400",size:20})}),t&&e.jsx("button",{onClick:()=>s(""),className:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-400 hover:text-white",children:e.jsx(ue,{size:16})})]}),e.jsx("button",{onClick:()=>g(!x),className:"bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-3 text-[#0AE7F2] hover:bg-[#1A1F2E] transition-colors",title:"بحث متقدم",children:e.jsx(Ue,{size:20})})]}),e.jsx("p",{className:"text-sm text-gray-400 text-center",children:"يمكنك البحث عن عدة مكونات بفصلها بمسافة"})]}),x&&e.jsxs("div",{className:"bg-[#1A1F2E]/60 border border-[#0AE7F2]/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium",children:"بحث متقدم"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-white",children:e.jsx(ue,{size:20})})]}),e.jsx(_a,{onSelectFood:a})]}),o&&e.jsx("div",{className:"text-red-500 text-center p-4 bg-red-500/10 rounded-xl",children:o}),r.length>0&&!x&&e.jsx("div",{className:"bg-[#1A1F2E]/80 rounded-xl overflow-hidden max-h-[400px] overflow-y-auto",children:r.map(f=>e.jsxs("button",{onClick:()=>a(f),className:"w-full px-4 py-3 text-right hover:bg-[#0AE7F2]/10 transition-colors flex justify-between items-center border-b border-[#0AE7F2]/10 last:border-0",children:[e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:"font-medium",dir:"rtl",children:f.name}),e.jsxs("div",{className:"text-sm text-gray-400 flex gap-3",children:[e.jsxs("span",{children:["بروتين: ",f.protein,"g"]}),e.jsxs("span",{children:["كربوهيدرات: ",f.carbs,"g"]}),e.jsxs("span",{children:["دهون: ",f.fat,"g"]})]})]}),e.jsxs("span",{className:"text-[#0AE7F2] font-medium whitespace-nowrap",children:[f.calories," سعرة"]})]},f.id))}),t&&r.length===0&&!i&&!o&&!x&&e.jsxs("div",{className:"text-center p-4 bg-[#1A1F2E]/60 rounded-xl",children:[e.jsx("p",{children:"😕 لا توجد نتائج مطابقة"}),e.jsxs("p",{className:"text-sm text-gray-400 mt-2",children:["جرب:",e.jsx("br",{}),"- البحث عن كل مكون على حدة",e.jsx("br",{}),"- استخدام كلمات بحث مختلفة",e.jsx("br",{}),"- اختيار فئة من الفئات أعلاه"]})]})]})}function ka({onClose:a,onSubmit:t,initialData:s}){const[r,n]=m.useState({name:"",calories:0,protein:0,carbs:0,fat:0,description:"",category:"breakfast"}),[i,l]=m.useState(!1),[o,c]=m.useState(!1),[d,u]=m.useState({milk:!0,yogurt:!1,cheese:!1,cream:!1,butter:!1,icecream:!1,substitute:!1,other:!1}),[x,g]=m.useState("");m.useEffect(()=>{s&&n({name:s.name||"",calories:s.calories||0,protein:s.protein||0,carbs:s.carbs||0,fat:s.fat||0,description:s.description||"",category:s.category||"breakfast"})},[s]);const b=j=>{n({...r,name:j.name||r.name,calories:parseInt(j.calories||"0"),protein:parseFloat(j.protein||"0"),carbs:parseFloat(j.carbs||"0"),fat:parseFloat(j.fat||"0")})},p=j=>{n({...r,name:j.name||r.name,calories:parseInt(j.calories||0),protein:parseFloat(j.protein||0),carbs:parseFloat(j.carbs||0),fat:parseFloat(j.fat||0)}),l(!1)},v=j=>{j.preventDefault(),t(r)},h=j=>{u({...d,[j]:!d[j]})},f=j=>{switch(j){case"milk":return"الحليب";case"yogurt":return"الزبادي";case"cheese":return"الجبن";case"cream":return"القشدة";case"butter":return"الزبدة";case"icecream":return"الآيس كريم";case"substitute":return"بدائل الحليب";case"other":return"منتجات أخرى";default:return j}},N=Qs.filter(j=>x?j.name.toLowerCase().includes(x.toLowerCase())||j.hebrewName&&j.hebrewName.toLowerCase().includes(x.toLowerCase()):!0),w={};return N.forEach(j=>{w[j.category]||(w[j.category]=[]),w[j.category].push(j)}),e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-[#0AE7F2]/20 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:s?"تعديل وجبة":"إضافة وجبة جديدة"}),e.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-[#0AE7F2]/10 transition-colors",children:e.jsx(ue,{size:20,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg mb-0",children:"البحث في قاعدة البيانات"}),e.jsx("button",{onClick:()=>c(!o),className:"text-[#0AE7F2] text-sm hover:underline",children:o?"بحث بسيط":"بحث متقدم"})]}),o?e.jsx(_a,{onSelectFood:b}):e.jsx(Gc,{onSelectFood:b})]}),e.jsxs("div",{className:"relative flex items-center justify-center my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-[#0AE7F2]/20"})}),e.jsx("div",{className:"relative bg-[#1A1F2E] px-4",children:e.jsx("span",{className:"text-sm text-gray-400",children:"أو"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>l(!i),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white flex justify-between items-center",children:[e.jsx("span",{children:"اختر من قائمة منتجات الألبان"}),i?e.jsx(Es,{size:20}):e.jsx(Ot,{size:20})]}),i&&e.jsxs("div",{className:"mt-3 bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",value:x,onChange:j=>g(j.target.value),placeholder:"ابحث في منتجات الألبان...",className:"w-full bg-[#1A1F2E] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white placeholder-gray-500 focus:outline-none focus:border-[#0AE7F2]"}),e.jsx(je,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:Object.keys(w).length===0?e.jsx("div",{className:"text-center py-4 text-gray-400",children:"لا توجد نتائج مطابقة للبحث"}):Object.entries(w).map(([j,F])=>e.jsxs("div",{className:"mb-3",children:[e.jsxs("button",{type:"button",onClick:()=>h(j),className:"w-full flex justify-between items-center p-2 bg-[#1A1F2E] rounded-lg mb-2",children:[e.jsx("span",{className:"font-medium",children:f(j)}),d[j]?e.jsx(Es,{size:16}):e.jsx(Ot,{size:16})]}),d[j]&&e.jsx("div",{className:"space-y-2 pr-2",children:F.map(C=>e.jsxs("button",{type:"button",onClick:A=>{A.stopPropagation(),p(C)},className:"w-full text-right p-2 hover:bg-[#1A1F2E] rounded-lg flex justify-between items-center",children:[e.jsxs("div",{className:"text-[#0AE7F2]",children:[C.calories," سعرة"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{children:C.name}),C.hebrewName&&e.jsx("div",{className:"text-xs text-gray-400",children:C.hebrewName})]})]},C.id))})]},j))})]})]})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"اسم الوجبة"}),e.jsx("input",{type:"text",value:r.name,onChange:j=>n({...r,name:j.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white placeholder-gray-500 focus:outline-none focus:border-[#0AE7F2]",placeholder:"أدخل اسم الوجبة",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"التصنيف"}),e.jsxs("select",{value:r.category,onChange:j=>n({...r,category:j.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,children:[e.jsx("option",{value:"breakfast",children:"الفطور"}),e.jsx("option",{value:"lunch",children:"الغداء"}),e.jsx("option",{value:"dinner",children:"العشاء"}),e.jsx("option",{value:"snack",children:"وجبة خفيفة"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"السعرات الحرارية"}),e.jsx("input",{type:"number",value:r.calories,onChange:j=>n({...r,calories:parseInt(j.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"البروتين (g)"}),e.jsx("input",{type:"number",step:"0.1",value:r.protein,onChange:j=>n({...r,protein:parseFloat(j.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الكربوهيدرات (g)"}),e.jsx("input",{type:"number",step:"0.1",value:r.carbs,onChange:j=>n({...r,carbs:parseFloat(j.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الدهون (g)"}),e.jsx("input",{type:"number",step:"0.1",value:r.fat,onChange:j=>n({...r,fat:parseFloat(j.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"وصف الوجبة (اختياري)"}),e.jsx("textarea",{value:r.description,onChange:j=>n({...r,description:j.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white placeholder-gray-500 focus:outline-none focus:border-[#0AE7F2] h-24 resize-none",placeholder:"أدخل وصفاً للوجبة..."})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 py-3 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex-1 py-3 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors flex items-center justify-center gap-2",children:[e.jsx(ze,{size:20}),e.jsx("span",{children:s?"تحديث الوجبة":"إضافة الوجبة"})]})]})]}),e.jsxs("div",{className:"mt-6 bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(is,{size:20,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"font-medium",children:"تواصل معنا"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:"إذا كان لديك استفسار أو تحتاج إلى مساعدة، يمكنك التواصل معنا عبر:"}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsx("a",{href:"#",className:"text-[#0AE7F2] hover:underline",children:"support@example.com"})})]})]})]})})}function Yc({onBack:a}){de();const[t,s]=m.useState(""),[r,n]=m.useState(null),[i,l]=m.useState(!1),[o,c]=m.useState([]),[d,u]=m.useState(!0),[x,g]=m.useState(null),[b,p]=m.useState("");m.useEffect(()=>{v(),p(["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"][new Date().getDay()])},[]);const v=async()=>{try{u(!0),g(null);const A=new Date().getDay();if(q()){const{data:{user:E}}=await S.auth.getUser();if(!E)throw new Error("المستخدم غير مسجل الدخول");const _=new Date,k=new Date(_);k.setDate(_.getDate()-_.getDay());const O=k.toISOString().split("T")[0],{data:M,error:y}=await S.from("weekly_schedules").select("id").eq("trainee_id",E.id).eq("week_start_date",O).single();if(y&&y.code!=="PGRST116")throw y;if(!M){h(A);return}const{data:W,error:z}=await S.from("schedule_meals").select(`
            id,
            meal_id,
            timing,
            status,
            consumed_at,
            meals (
              id,
              name,
              calories,
              protein,
              carbs,
              fat,
              description,
              category
            )
          `).eq("schedule_id",M.id).eq("day_of_week",A);if(z)throw z;if(W&&W.length>0){const I=W.map(H=>({id:H.meals.id,name:H.meals.name,description:H.meals.description||"",calories:H.meals.calories,protein:H.meals.protein,carbs:H.meals.carbs,fat:H.meals.fat,timing:f(H.timing),category:H.meals.category}));c(I)}else h(A)}else h(A)}catch(A){console.error("Error fetching meals:",A),g("حدث خطأ أثناء تحميل الوجبات");const E=new Date().getDay();h(E)}finally{u(!1)}},h=A=>{c([[{id:"1",name:"شوفان بالموز واللوز",description:"شوفان مطبوخ مع حليب لوز، موز طازج، ولوز مقطع. غني بالألياف والبروتين.",calories:350,protein:12,carbs:45,fat:14,timing:"7:00 - 9:00",category:"breakfast"},{id:"2",name:"سلطة دجاج مشوي",description:"صدر دجاج مشوي مع خضروات طازجة وصلصة زيت الزيتون. وجبة متوازنة وغنية بالبروتين.",calories:450,protein:35,carbs:20,fat:25,timing:"12:00 - 14:00",category:"lunch"},{id:"3",name:"سمك سلمون مشوي",description:"سمك سلمون مشوي مع الخضروات المشوية وأرز بني. غني بأوميغا 3 والبروتين.",calories:550,protein:40,carbs:35,fat:30,timing:"18:00 - 20:00",category:"dinner"}],[{id:"4",name:"بيض مسلوق مع خبز",description:"بيضتان مسلوقتان مع خبز أسمر وأفوكادو. غني بالبروتين والدهون الصحية.",calories:320,protein:18,carbs:30,fat:16,timing:"7:00 - 9:00",category:"breakfast"},{id:"5",name:"عدس مع أرز",description:"عدس مطبوخ مع أرز بني وخضروات. غني بالبروتين النباتي والألياف.",calories:400,protein:20,carbs:60,fat:8,timing:"12:00 - 14:00",category:"lunch"},{id:"6",name:"شوربة خضار",description:"شوربة خضار مع قطع دجاج. وجبة خفيفة وغنية بالفيتامينات.",calories:250,protein:15,carbs:30,fat:10,timing:"18:00 - 20:00",category:"dinner"}],[{id:"7",name:"زبادي يوناني مع الفواكه",description:"زبادي يوناني مع التوت والعسل. غني بالبروتين والبروبيوتيك.",calories:280,protein:20,carbs:35,fat:8,timing:"7:00 - 9:00",category:"breakfast"},{id:"8",name:"برغر دجاج مشوي",description:"برغر دجاج مشوي مع خبز أسمر وخضروات. وجبة متوازنة وغنية بالبروتين.",calories:480,protein:30,carbs:45,fat:20,timing:"12:00 - 14:00",category:"lunch"},{id:"9",name:"كينوا بالخضار",description:"كينوا مطبوخة مع خضروات مشكلة. غنية بالبروتين والألياف.",calories:350,protein:12,carbs:50,fat:10,timing:"18:00 - 20:00",category:"dinner"}],[{id:"10",name:"توست أفوكادو",description:"خبز محمص مع أفوكادو مهروس وبيض مسلوق. غني بالدهون الصحية والبروتين.",calories:380,protein:15,carbs:40,fat:20,timing:"7:00 - 9:00",category:"breakfast"},{id:"11",name:"سلطة تونة",description:"سلطة خضراء مع تونة وزيت زيتون. غنية بالبروتين والأوميغا 3.",calories:320,protein:25,carbs:20,fat:15,timing:"12:00 - 14:00",category:"lunch"},{id:"12",name:"دجاج مشوي مع بطاطا حلوة",description:"صدر دجاج مشوي مع بطاطا حلوة مشوية. غني بالبروتين والكربوهيدرات المعقدة.",calories:420,protein:35,carbs:40,fat:12,timing:"18:00 - 20:00",category:"dinner"}],[{id:"13",name:"عصيدة الشوفان",description:"شوفان مطبوخ مع حليب اللوز والموز والتوت. غني بالألياف والفيتامينات.",calories:330,protein:10,carbs:50,fat:10,timing:"7:00 - 9:00",category:"breakfast"},{id:"14",name:"ساندويتش دجاج",description:"ساندويتش دجاج مشوي مع خبز أسمر وخضروات. وجبة متوازنة وغنية بالبروتين.",calories:450,protein:30,carbs:40,fat:15,timing:"12:00 - 14:00",category:"lunch"},{id:"15",name:"سمك مشوي مع خضروات",description:"سمك أبيض مشوي مع خضروات مشوية. غني بالبروتين والفيتامينات.",calories:380,protein:35,carbs:25,fat:15,timing:"18:00 - 20:00",category:"dinner"}],[{id:"16",name:"سلطة فواكه",description:"تشكيلة من الفواكه الطازجة مع زبادي يوناني. غنية بالفيتامينات والمعادن.",calories:250,protein:8,carbs:45,fat:5,timing:"7:00 - 9:00",category:"breakfast"},{id:"17",name:"فتة حمص",description:"فتة حمص مع زيت زيتون وصنوبر. غنية بالبروتين النباتي والألياف.",calories:480,protein:20,carbs:60,fat:20,timing:"12:00 - 14:00",category:"lunch"},{id:"18",name:"شوربة عدس",description:"شوربة عدس مع الخبز المحمص. وجبة خفيفة وغنية بالبروتين.",calories:300,protein:15,carbs:40,fat:8,timing:"18:00 - 20:00",category:"dinner"}],[{id:"19",name:"بيض مخفوق مع الخضروات",description:"بيض مخفوق مع الفلفل والطماطم والبصل. غني بالبروتين والفيتامينات.",calories:300,protein:20,carbs:15,fat:20,timing:"7:00 - 9:00",category:"breakfast"},{id:"20",name:"مجدرة",description:"مجدرة مع سلطة خضراء. غنية بالبروتين النباتي والألياف.",calories:420,protein:15,carbs:65,fat:10,timing:"12:00 - 14:00",category:"lunch"},{id:"21",name:"صدر دجاج مشوي مع الخضروات",description:"صدر دجاج مشوي مع خضروات مشوية. غني بالبروتين والفيتامينات.",calories:400,protein:40,carbs:20,fat:15,timing:"18:00 - 20:00",category:"dinner"}]][A])},f=A=>{switch(A){case"breakfast":return"7:00 - 9:00";case"lunch":return"12:00 - 14:00";case"dinner":return"18:00 - 20:00";case"snack":return"10:00 - 16:00";default:return A}},N=[{id:"breakfast",name:"فطور",icon:Be},{id:"lunch",name:"غداء",icon:$s},{id:"dinner",name:"عشاء",icon:Is},{id:"snack",name:"وجبات خفيفة",icon:Rs}],w=A=>{const E=N.find(_=>_.id===A);return E?E.name:A},j=A=>{const E=N.find(_=>_.id===A);return E?E.icon:Be},F=o.filter(A=>{const E=A.name.toLowerCase().includes(t.toLowerCase())||A.description.toLowerCase().includes(t.toLowerCase()),_=!r||A.category===r;return E&&_}),C=()=>{a()};return e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsxs("div",{className:"header-base",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("button",{onClick:C,className:"text-white",children:e.jsx(me,{size:24})}),e.jsxs("h1",{className:"text-xl font-bold",children:["وجبات يوم ",b]}),e.jsx("button",{onClick:()=>l(!i),className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(Ue,{size:20,className:"text-[#0AE7F2]"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t,onChange:A=>s(A.target.value),placeholder:"ابحث عن وجبة...",className:"input-base w-full pr-12"}),e.jsx(je,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-[#0AE7F2]",size:20})]}),i&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx("button",{onClick:()=>n(null),className:`px-4 py-2 rounded-xl whitespace-nowrap transition-colors ${r?"bg-[#1A1F2E]/60 text-gray-400":"bg-[#0AE7F2] text-black"}`,children:"الكل"}),N.map(A=>e.jsx("button",{onClick:()=>n(A.id),className:`px-4 py-2 rounded-xl whitespace-nowrap transition-colors ${r===A.id?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/60 text-gray-400"}`,children:A.name},A.id))]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto content-container",children:d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):x?e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6",children:[x,e.jsx("button",{onClick:v,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}):F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(je,{size:32,className:"text-[#0AE7F2]"})}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"لا توجد نتائج"}),e.jsx("p",{className:"text-gray-400",children:"لم يتم العثور على وجبات تطابق بحثك"})]}):e.jsx("div",{className:"space-y-4",children:F.map(A=>{const E=j(A.category);return e.jsxs("div",{className:"card-base",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:A.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(Re,{size:16}),e.jsx("span",{children:A.timing})]})]}),e.jsxs("span",{className:"bg-[#0AE7F2]/10 text-[#0AE7F2] px-3 py-1 rounded-full text-sm flex items-center gap-2",children:[e.jsx(E,{size:16}),e.jsx("span",{children:w(A.category)})]})]}),e.jsx("p",{className:"text-gray-400 mb-4",children:A.description}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-3 text-center",children:[e.jsx("span",{className:"text-lg font-bold text-[#0AE7F2]",children:A.calories}),e.jsx("p",{className:"text-xs text-gray-400",children:"سعرة"})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-3 text-center",children:[e.jsxs("span",{className:"text-lg font-bold text-[#0AE7F2]",children:[A.protein,"g"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"بروتين"})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-3 text-center",children:[e.jsxs("span",{className:"text-lg font-bold text-[#0AE7F2]",children:[A.carbs,"g"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"كربوهيدرات"})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-3 text-center",children:[e.jsxs("span",{className:"text-lg font-bold text-[#0AE7F2]",children:[A.fat,"g"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"دهون"})]})]})]},A.id)})})})]})]})}function Jc({onMealClick:a}){var Q;const t=de(),[s,r]=m.useState(!1),[n,i]=m.useState(new Date),[l,o]=m.useState(null),[c,d]=m.useState({الفطور:[],الغداء:[],العشاء:[]}),[u,x]=m.useState(!1),[g,b]=m.useState([{id:1,name:"الفطور",calories:450,active:!0,status:"pending"},{id:2,name:"الغداء",calories:450,active:!0,status:"pending"},{id:3,name:"العشاء",calories:450,active:!0,status:"pending"}]),[p,v]=m.useState(!1),[h,f]=m.useState([]),[N,w]=m.useState(""),[j,F]=m.useState(0),[C,A]=m.useState(0);m.useEffect(()=>{_();const $=g.filter(P=>P.status==="completed").length;A($),k($),E()},[g,n]);const E=async()=>{try{d({الفطور:[{id:"1",name:"شوفان بالموز",calories:350,protein:12,carbs:45,fat:8,description:"شوفان مطبوخ مع حليب لوز، موز طازج، ولوز مقطع. غني بالألياف والبروتين."},{id:"2",name:"بيض مسلوق مع خبز",calories:280,protein:15,carbs:30,fat:10,description:"بيضتان مسلوقتان مع خبز أسمر وأفوكادو. غني بالبروتين والدهون الصحية."}],الغداء:[{id:"3",name:"صدر دجاج مشوي",calories:450,protein:35,carbs:20,fat:15,description:"صدر دجاج مشوي مع خضروات مشوية وأرز بني. غني بالبروتين."}],العشاء:[{id:"4",name:"سمك سلمون مشوي",calories:400,protein:30,carbs:15,fat:20,description:"سمك سلمون مشوي مع خضروات مشوية. غني بأوميغا 3 والبروتين."}]})}catch($){console.error("Error fetching assigned meals:",$)}},_=()=>{const $=g.reduce((J,R)=>R.status==="completed"?J+R.calories:J,0),P=h.reduce((J,R)=>J+R.calories,0);F($+P)},k=async $=>{try{if(q()){const{data:{user:P}}=await S.auth.getUser();if(!P)return;const{data:J,error:R}=await S.from("trainee_performance").select("completed_exercises").eq("trainee_id",P.id).eq("date",new Date().toISOString().split("T")[0]).single();if(R&&R.code!=="PGRST116"){console.error("Error fetching performance:",R);return}const Y=(J==null?void 0:J.completed_exercises)||0;await ja(Y,$)}}catch(P){console.error("Error updating performance:",P)}},O=()=>{t(-1)},M=()=>{i($=>{const P=new Date($);return P.setDate(P.getDate()-1),P})},y=()=>{i($=>{const P=new Date($);return P.setDate(P.getDate()+1),P})},W=$=>{f(P=>[...P,$]),v(!1),F(P=>P+$.calories)},z=$=>{const P=h[$];f(J=>J.filter((R,Y)=>Y!==$)),F(J=>J-P.calories)},I=()=>{alert("تم إرسال الوجبات للمدرب بنجاح!"),f([]),w(""),_()},H=($,P)=>{b(J=>J.map(R=>R.id===$?(R.status==="completed"&&P!=="completed"?F(Y=>Y-R.calories):R.status!=="completed"&&P==="completed"&&F(Y=>Y+R.calories),{...R,status:P}):R))},T=$=>{o($),x(!0)},G=$=>{switch($){case"completed":return e.jsx(He,{size:20,className:"text-emerald-500"});case"skipped":return e.jsx(ue,{size:20,className:"text-rose-500"});default:return e.jsx(Re,{size:20,className:"text-amber-500"})}},X=$=>{switch($){case"completed":return"bg-emerald-500/10 text-emerald-500";case"skipped":return"bg-rose-500/10 text-rose-500";default:return"bg-amber-500/10 text-amber-500"}},ae=$=>["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"][$.getDay()];return s?e.jsx(Yc,{onBack:()=>r(!1)}):e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsx("div",{className:"header-base",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:O,className:"text-white",children:e.jsx(me,{size:24})}),e.jsx("h1",{className:"text-xl font-bold",children:"برنامجك الغذائي"}),e.jsx("button",{className:"text-white",children:e.jsx(At,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto content-container",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card-base",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"إجمالي السعرات المستهلكة"}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-4xl font-bold text-[#0AE7F2]",children:j}),e.jsx("span",{className:"text-gray-400 ml-2",children:"سعرة حرارية"})]})]}),e.jsxs("div",{className:"card-base",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"سجل وجبات الطعام"}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("button",{onClick:M,className:"text-[#0AE7F2]",children:e.jsx(Cr,{size:24})}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-lg",children:ct(n,"yyyy-MM-dd")}),e.jsx("p",{className:"text-sm text-[#0AE7F2]",children:ae(n)})]}),e.jsx("button",{onClick:y,className:"text-[#0AE7F2]",children:e.jsx(zs,{size:24})})]}),e.jsxs("div",{className:"space-y-4",children:[g.map($=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:P=>{P.stopPropagation(),H($.id,"completed")},className:`p-2 rounded-full ${$.status==="completed"?"bg-emerald-500/10":"hover:bg-emerald-500/10"}`,children:e.jsx(He,{size:16,className:$.status==="completed"?"text-emerald-500":"text-gray-400"})}),e.jsx("button",{onClick:P=>{P.stopPropagation(),H($.id,"skipped")},className:`p-2 rounded-full ${$.status==="skipped"?"bg-rose-500/10":"hover:bg-rose-500/10"}`,children:e.jsx(ue,{size:16,className:$.status==="skipped"?"text-rose-500":"text-gray-400"})})]})}),e.jsx("span",{className:"text-lg font-medium",children:$.calories}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>T($.name),className:"text-[#0AE7F2] bg-[#0AE7F2]/10 px-4 py-1 rounded-full hover:bg-[#0AE7F2]/20 transition-colors",children:$.name}),e.jsx("span",{className:`p-2 rounded-full ${X($.status)}`,children:G($.status)})]})]},$.id)),e.jsx("button",{onClick:()=>r(!0),className:"w-full bg-black/60 backdrop-blur-sm text-[#0AE7F2] border border-[#0AE7F2] rounded-xl py-3 hover:bg-black/80 transition-colors mt-2",children:"القائمة كاملة"})]})]}),e.jsxs("div",{className:"card-base",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-lg font-bold",children:"إضافة وجبات يدوي"}),e.jsx("span",{className:"text-sm text-gray-400",children:ct(n,"yyyy-MM-dd")})]}),e.jsxs("button",{onClick:()=>v(!0),className:"w-full bg-[#0AE7F2] text-black rounded-xl py-3 flex items-center justify-center gap-2 mb-2 hover:bg-[#0AE7F2]/90 transition-all",children:[e.jsx(ze,{size:20}),e.jsx("span",{children:"إضافة وجبة"})]}),h.length>0&&e.jsxs("div",{className:"space-y-4 mt-4",children:[h.map(($,P)=>e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("button",{onClick:()=>z(P),className:"text-rose-500 hover:text-rose-400 p-1 rounded-full hover:bg-rose-500/10",children:e.jsx(ue,{size:16})}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"font-medium",children:$.name}),e.jsxs("span",{className:"text-[#0AE7F2]",children:[$.calories," سعرة"]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[e.jsxs("span",{children:["بروتين: ",$.protein,"g"]}),e.jsxs("span",{children:["كربوهيدرات: ",$.carbs,"g"]}),e.jsxs("span",{children:["دهون: ",$.fat,"g"]})]})]},P)),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx($a,{size:20,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"font-medium",children:"ملاحظات للمدرب"})]}),e.jsx("textarea",{value:N,onChange:$=>w($.target.value),placeholder:"أضف ملاحظاتك هنا...",className:"w-full h-32 bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#0AE7F2] resize-none"})]}),e.jsxs("button",{onClick:I,className:"w-full bg-[#0AE7F2] text-black rounded-xl py-3 flex items-center justify-center gap-2 hover:bg-[#0AE7F2]/90 transition-all",children:[e.jsx(dt,{size:20}),e.jsx("span",{children:"إرسال للمدرب"})]})]})]})]})}),e.jsx(mt,{})]}),p&&e.jsx(ka,{onClose:()=>v(!1),onSubmit:W}),u&&l&&e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-[#0A0F1C] w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col mx-4 rounded-3xl",children:[e.jsxs("div",{className:"p-4 border-b border-[#0AE7F2]/20 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>x(!1),className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-[#0AE7F2]/10 transition-colors",children:e.jsx(me,{size:20,className:"text-gray-400"})}),e.jsxs("h2",{className:"text-xl font-bold",children:["وجبات ",l]}),e.jsx("button",{onClick:()=>x(!1),className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-[#0AE7F2]/10 transition-colors",children:e.jsx(ue,{size:20,className:"text-gray-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:((Q=c[l])==null?void 0:Q.length)>0?c[l].map($=>e.jsxs("div",{className:"p-6 border-b border-[#0AE7F2]/10 hover:bg-[#1A1F2E] transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{children:e.jsxs("h3",{className:"font-medium text-[#0AE7F2] mb-1",children:[$.calories," سعرة"]})}),e.jsx("div",{className:"text-right",children:e.jsx("h3",{className:"font-medium text-lg mb-1",children:$.name})})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-6",children:$.description}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-3 text-center",children:[e.jsxs("span",{className:"text-sm font-medium text-[#0AE7F2]",children:[$.protein,"g"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"بروتين"})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-3 text-center",children:[e.jsxs("span",{className:"text-sm font-medium text-[#0AE7F2]",children:[$.carbs,"g"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"كربوهيدرات"})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-3 text-center",children:[e.jsxs("span",{className:"text-sm font-medium text-[#0AE7F2]",children:[$.fat,"g"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"دهون"})]})]})]},$.id)):e.jsx("div",{className:"p-6 text-center text-gray-400",children:"لا توجد وجبات معينة لهذا اليوم"})}),e.jsx("div",{className:"p-4 border-t border-[#0AE7F2]/20",children:e.jsx("button",{onClick:()=>x(!1),className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors",children:"إغلاق"})})]})})]})}const Qc=async()=>{const a=localStorage.getItem("userType");if(q())try{const{error:t}=await S.auth.signOut();if(t)throw t}catch(t){console.error("Error during logout:",t)}localStorage.removeItem("userType"),localStorage.removeItem("traineeProfile"),localStorage.removeItem("traineeId"),localStorage.removeItem("savedTraineeEmail"),localStorage.removeItem("savedTraineePassword"),a==="user"?window.location.href="/trainee/login":window.location.href="/"},Kc=async a=>{if(!q()||!a)return{id:"basic",name:"الخطة الأساسية",price:99,duration:"1 شهر",features:["برنامج تدريبي أساسي","برنامج غذائي أساسي"],startDate:new Date().toISOString(),endDate:new Date(Date.now()+30*24*60*60*1e3).toISOString(),status:"active"};try{const{data:t,error:s}=await S.from("trainee_profiles").select("subscription_plan, subscription_start, subscription_end").eq("id",a).single();return s?(console.error("Error fetching trainee profile:",s),null):t?t.subscription_plan?{id:t.subscription_plan,name:t.subscription_plan==="premium"?"الخطة المتقدمة":t.subscription_plan==="pro"?"الخطة الاحترافية":"الخطة الأساسية",price:t.subscription_plan==="premium"?199:t.subscription_plan==="pro"?299:99,duration:t.subscription_plan==="basic"?"1 شهر":"3 شهور",features:t.subscription_plan==="premium"?["برنامج تدريبي متقدم","برنامج غذائي مخصص","متابعة يومية","جلسات خاصة"]:t.subscription_plan==="pro"?["برنامج تدريبي احترافي","برنامج غذائي مخصص","متابعة يومية","جلسات خاصة","استشارات غير محدودة"]:["برنامج تدريبي أساسي","برنامج غذائي أساسي"],startDate:t.subscription_start,endDate:t.subscription_end,status:"active"}:{id:"basic",name:"الخطة الأساسية",price:0,duration:"1 شهر",features:["برنامج تدريبي أساسي"],startDate:t.subscription_start||new Date().toISOString(),endDate:t.subscription_end||new Date().toISOString(),status:"active"}:null}catch(t){return console.error("Error fetching membership:",t),null}};function Xc(){const a=de(),[t,s]=m.useState(!1),[r,n]=m.useState(null),[i,l]=m.useState(!0),[o,c]=m.useState(!1),[d,u]=m.useState("profile"),[x,g]=m.useState(!1),[b,p]=m.useState(!1),[v,h]=m.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[f,N]=m.useState({name:"",email:"",phone:"",height:175,weight:75,age:30,goal:"weight_loss",gender:"male"}),[w,j]=m.useState({emailNotifications:!0,appNotifications:!0,exerciseReminders:!0,mealReminders:!0,weightReminders:!0}),[F,C]=m.useState({theme:"dark",language:"ar",fontSize:"medium"}),[A,E]=m.useState(null),[_,k]=m.useState(null),[O,M]=m.useState(null),[y,W]=m.useState({name:"",email:"",bloodType:"A+",gender:"male",currentWeight:75,initialWeight:85,targetWeight:70,currentFat:18,initialFat:25,currentMuscle:60,initialMuscle:45,currentWaist:85,initialWaist:95,currentNeck:38,initialNeck:40,currentArm:32,initialArm:30,currentChest:95,initialChest:100,currentThigh:55,initialThigh:60,currentCalf:38,initialCalf:40,height:175,age:30});m.useEffect(()=>{z(),I()},[]);const z=async()=>{var B,D;try{if(l(!0),q()){const{data:{user:U}}=await S.auth.getUser();if(!U)throw new Error("المستخدم غير مسجل الدخول");const{data:L,error:K}=await S.from("trainee_profiles").select("*").eq("id",U.id).single();if(K)throw K;L&&(W({...y,name:L.name||"",email:L.email||"",gender:L.gender||"male",currentWeight:L.current_weight||75,initialWeight:L.initial_weight||85,targetWeight:L.target_weight||70,currentFat:L.fat_percentage||18,initialFat:L.fat_percentage||25,currentMuscle:L.muscle_mass||60,initialMuscle:L.muscle_mass||45,currentWaist:L.waist_circumference||85,initialWaist:L.waist_circumference||95,currentNeck:L.neck_circumference||38,initialNeck:L.neck_circumference||40,currentArm:L.arm_circumference||32,initialArm:L.arm_circumference||30,currentChest:L.chest_circumference||95,initialChest:L.chest_circumference||100,currentThigh:L.thigh_circumference||55,initialThigh:L.thigh_circumference||60,currentCalf:L.calf_circumference||38,initialCalf:L.calf_circumference||40,height:L.height||175,age:L.age||30}),N({name:L.name||"",email:L.email||"",phone:L.phone||"",height:L.height||175,weight:L.current_weight||75,age:L.age||30,goal:((B=L.goal)==null?void 0:B[0])||"weight_loss",gender:L.gender||"male"}))}else{const U=localStorage.getItem("traineeProfile");if(U){const L=JSON.parse(U);W({...y,name:L.name||"",email:L.email||"",gender:L.gender||"male",currentWeight:L.weight||75,targetWeight:L.targetWeight||70,height:L.height||175,age:L.age||30}),N({name:L.name||"",email:L.email||"",phone:L.phone||"",height:L.height||175,weight:L.weight||75,age:L.age||30,goal:((D=L.goals)==null?void 0:D[0])||"weight_loss",gender:L.gender||"male"})}}}catch(U){console.error("Error fetching user data:",U)}finally{l(!1)}},I=async()=>{try{l(!0);const B=localStorage.getItem("traineeId"),D=await Kc(B||void 0);n(D)}catch(B){console.error("Error fetching membership:",B)}finally{l(!1)}},H=()=>{a("/trainee")},T=async()=>{try{await Qc()}catch(B){console.error("Logout error:",B)}},G=(B,D)=>(B/100*D).toFixed(1),X=(B,D,U,L)=>{const K=B/100*D,Z=U/100*L;return(K-Z).toFixed(1)},ae=B=>{switch(B){case"premium":return"bg-gradient-to-r from-[#0AE7F2] to-[#0A84E7]";case"pro":return"bg-gradient-to-r from-[#E7A70A] to-[#E74A0A]";default:return"bg-gradient-to-r from-[#0AE7F2]/70 to-[#0A84E7]/70"}},Q=B=>{switch(B){case"premium":return"الخطة المتقدمة";case"pro":return"الخطة الاحترافية";default:return"الخطة الأساسية"}},$=B=>{var U;const D=(U=B.target.files)==null?void 0:U[0];if(D){const L=new FileReader;L.onloadend=()=>{E(L.result)},L.readAsDataURL(D)}},P=async()=>{try{if(M(null),q()){const{data:{user:B}}=await S.auth.getUser();if(!B)throw new Error("المستخدم غير مسجل الدخول");const{error:D}=await S.from("trainee_profiles").update({name:f.name,email:f.email,phone:f.phone,height:f.height,current_weight:f.weight,goal:[f.goal],gender:f.gender,age:f.age}).eq("id",B.id);if(D)throw D;W({...y,name:f.name,email:f.email,gender:f.gender,currentWeight:f.weight,height:f.height,age:f.age});const U=localStorage.getItem("traineeProfile");if(U){const K={...JSON.parse(U),name:f.name,email:f.email,phone:f.phone,height:f.height,weight:f.weight,goals:[f.goal],gender:f.gender,age:f.age};localStorage.setItem("traineeProfile",JSON.stringify(K))}}k("تم حفظ التغييرات بنجاح"),setTimeout(()=>{k(null)},3e3)}catch(B){console.error("Error saving profile:",B),M("حدث خطأ أثناء حفظ التغييرات"),k(null)}},J=async()=>{if(v.newPassword!==v.confirmPassword){M("كلمات المرور غير متطابقة");return}if(v.newPassword.length<8){M("كلمة المرور يجب أن تكون 8 أحرف على الأقل");return}try{if(M(null),q()){const{error:B}=await S.auth.updateUser({password:v.newPassword});if(B)throw B}k("تم تغيير كلمة المرور بنجاح"),g(!1),h({currentPassword:"",newPassword:"",confirmPassword:""}),setTimeout(()=>{k(null)},3e3)}catch(B){console.error("Error changing password:",B),M("حدث خطأ أثناء تغيير كلمة المرور"),k(null)}},R=()=>{k("تم حفظ إعدادات الإشعارات بنجاح"),M(null),setTimeout(()=>{k(null)},3e3)},Y=()=>{k("تم حفظ إعدادات المظهر بنجاح"),M(null),setTimeout(()=>{k(null)},3e3)},pe=()=>{switch(d){case"profile":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 bg-[#0A0F1C] rounded-full flex items-center justify-center overflow-hidden border-2 border-[#0AE7F2]",children:A?e.jsx("img",{src:A,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-[#0AE7F2] text-4xl font-bold",children:f.name.charAt(0)})}),e.jsx("input",{type:"file",accept:"image/*",onChange:$,className:"hidden",id:"photo-upload"}),e.jsx("label",{htmlFor:"photo-upload",className:"absolute bottom-0 right-0 bg-[#0AE7F2] p-2 rounded-full cursor-pointer",children:e.jsx(Ua,{size:16,className:"text-black"})})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الاسم"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:f.name,onChange:B=>N({...f,name:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]"}),e.jsx(Ae,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"البريد الإلكتروني"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:f.email,onChange:B=>N({...f,email:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]"}),e.jsx(Us,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",value:f.phone,onChange:B=>N({...f,phone:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]"}),e.jsx(Ws,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الطول (سم)"}),e.jsx("input",{type:"number",value:f.height,onChange:B=>N({...f,height:Number(B.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الوزن (كجم)"}),e.jsx("input",{type:"number",value:f.weight,onChange:B=>N({...f,weight:Number(B.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"العمر"}),e.jsx("input",{type:"number",value:f.age,onChange:B=>N({...f,age:Number(B.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الجنس"}),e.jsxs("select",{value:f.gender,onChange:B=>N({...f,gender:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:[e.jsx("option",{value:"male",children:"ذكر"}),e.jsx("option",{value:"female",children:"أنثى"}),e.jsx("option",{value:"other",children:"آخر"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الهدف"}),e.jsxs("select",{value:f.goal,onChange:B=>N({...f,goal:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:[e.jsx("option",{value:"weight_loss",children:"خسارة الوزن"}),e.jsx("option",{value:"muscle_gain",children:"زيادة الكتلة العضلية"}),e.jsx("option",{value:"maintain",children:"المحافظة على الوزن"}),e.jsx("option",{value:"fitness",children:"تحسين اللياقة البدنية"})]})]}),e.jsxs("button",{onClick:P,className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center justify-center gap-2 mt-4",children:[e.jsx(qe,{size:20}),e.jsx("span",{children:"حفظ التغييرات"})]})]});case"security":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium",children:"كلمة المرور"}),e.jsx("button",{onClick:()=>g(!x),className:"text-[#0AE7F2] text-sm hover:underline",children:x?"إلغاء":"تغيير"})]}),x?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"كلمة المرور الحالية"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:b?"text":"password",value:v.currentPassword,onChange:B=>h({...v,currentPassword:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]"}),e.jsx("button",{type:"button",onClick:()=>p(!b),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:b?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:b?"text":"password",value:v.newPassword,onChange:B=>h({...v,newPassword:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]"}),e.jsx("button",{type:"button",onClick:()=>p(!b),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:b?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:b?"text":"password",value:v.confirmPassword,onChange:B=>h({...v,confirmPassword:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]"}),e.jsx("button",{type:"button",onClick:()=>p(!b),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:b?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(!1),className:"flex-1 py-2 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:J,className:"flex-1 py-2 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors",children:"حفظ"})]})]}):e.jsx("p",{className:"text-sm text-gray-400",children:"كلمة المرور الخاصة بك آمنة. يمكنك تغييرها في أي وقت."})]}),e.jsx("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"المصادقة الثنائية"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"تفعيل المصادقة الثنائية لحماية إضافية"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0AE7F2]"})]})]})}),e.jsx("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"تأكيد البريد الإلكتروني"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"طلب تأكيد البريد الإلكتروني عند تغييره"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0AE7F2]"})]})]})})]});case"notifications":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"إشعارات البريد الإلكتروني"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"إرسال إشعارات عبر البريد الإلكتروني"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:w.emailNotifications,onChange:B=>j({...w,emailNotifications:B.target.checked})}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0AE7F2]"})]})]})}),e.jsx("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"إشعارات التطبيق"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"إشعارات داخل التطبيق"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:w.appNotifications,onChange:B=>j({...w,appNotifications:B.target.checked})}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0AE7F2]"})]})]})}),e.jsxs("button",{onClick:R,className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center justify-center gap-2 mt-4",children:[e.jsx(qe,{size:20}),e.jsx("span",{children:"حفظ الإعدادات"})]})]});case"appearance":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"المظهر"}),e.jsxs("select",{value:F.theme,onChange:B=>C({...F,theme:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:[e.jsx("option",{value:"dark",children:"داكن"}),e.jsx("option",{value:"light",children:"فاتح"}),e.jsx("option",{value:"system",children:"حسب النظام"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"اللغة"}),e.jsxs("select",{value:F.language,onChange:B=>C({...F,language:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:[e.jsx("option",{value:"ar",children:"العربية"}),e.jsx("option",{value:"en",children:"English"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"حجم الخط"}),e.jsxs("select",{value:F.fontSize,onChange:B=>C({...F,fontSize:B.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:[e.jsx("option",{value:"small",children:"صغير"}),e.jsx("option",{value:"medium",children:"متوسط"}),e.jsx("option",{value:"large",children:"كبير"})]})]}),e.jsxs("button",{onClick:Y,className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center justify-center gap-2 mt-4",children:[e.jsx(qe,{size:20}),e.jsx("span",{children:"حفظ الإعدادات"})]})]});default:return null}};return e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:H,className:"text-white",children:e.jsx(me,{size:24})}),e.jsx("h1",{className:"text-xl font-bold",children:"الصفحة الشخصية"}),e.jsx("button",{onClick:()=>s(!t),className:"text-white hover:text-[#0AE7F2]",children:e.jsx($t,{size:24})})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-lg max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-[#0AE7F2]/20 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"الإعدادات"}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-white",children:e.jsx(ue,{size:24})})]}),_&&e.jsx("div",{className:"mx-6 mt-4 bg-emerald-500/10 border border-emerald-500 text-emerald-500 p-3 rounded-xl text-center",children:_}),O&&e.jsx("div",{className:"mx-6 mt-4 bg-rose-500/10 border border-rose-500 text-rose-500 p-3 rounded-xl text-center",children:O}),e.jsxs("div",{className:"flex p-4 gap-2 border-b border-[#0AE7F2]/10",children:[e.jsx("button",{onClick:()=>u("profile"),className:`flex-1 py-2 rounded-xl transition-colors ${d==="profile"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C]/40 text-gray-400 hover:text-white"}`,children:"الملف الشخصي"}),e.jsx("button",{onClick:()=>u("security"),className:`flex-1 py-2 rounded-xl transition-colors ${d==="security"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C]/40 text-gray-400 hover:text-white"}`,children:"الأمان"}),e.jsx("button",{onClick:()=>u("notifications"),className:`flex-1 py-2 rounded-xl transition-colors ${d==="notifications"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C]/40 text-gray-400 hover:text-white"}`,children:"الإشعارات"}),e.jsx("button",{onClick:()=>u("appearance"),className:`flex-1 py-2 rounded-xl transition-colors ${d==="appearance"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C]/40 text-gray-400 hover:text-white"}`,children:"المظهر"})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:pe()})]})}),e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border-2 border-[#0AE7F2] mb-2 overflow-hidden",children:A?e.jsx("img",{src:A,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-[#1A1F2E] flex items-center justify-center",children:e.jsx("span",{className:"text-[#0AE7F2] text-2xl font-bold",children:y.name.charAt(0)})})}),e.jsx("h2",{className:"text-lg font-bold",children:y.name}),e.jsx("p",{className:"text-sm text-gray-400",children:y.email}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 bg-[#1A1F2E]/40 px-3 py-1 rounded-full",children:[e.jsx(Sr,{size:14,className:"text-[#0AE7F2]"}),e.jsx("span",{className:"text-sm text-[#0AE7F2]",children:y.gender==="male"?"ذكر":y.gender==="female"?"أنثى":"آخر"})]})]}),i?e.jsx("div",{className:"mb-6 bg-[#1A1F2E]/40 rounded-xl p-6 flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):r?e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:`rounded-xl p-4 ${ae(r.id)}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-lg",children:e.jsx(As,{size:20,className:"text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"font-bold text-white",children:Q(r.id)}),e.jsxs("p",{className:"text-sm text-white/80",children:[r.price," ₪"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{size:16}),e.jsxs("span",{className:"text-sm",children:["تنتهي في: ",ct(r.endDate,"yyyy-MM-dd")]})]}),e.jsx("button",{onClick:()=>c(!o),className:"text-white hover:text-white/80",children:e.jsx(Ot,{size:20,className:`transition-transform ${o?"rotate-180":""}`})})]}),o&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsx("h4",{className:"font-medium text-white mb-2",children:"مميزات العضوية:"}),e.jsx("ul",{className:"space-y-2",children:r.features.map((B,D)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm text-white/90",children:[e.jsx(Se,{size:14,className:"text-white"}),e.jsx("span",{children:B})]},D))})]})]})}):e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"rounded-xl p-4 bg-[#1A1F2E]/60 border border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-2 rounded-lg",children:e.jsx(As,{size:20,className:"text-[#0AE7F2]"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"font-bold text-white",children:"مشترك بدون عضوية"}),e.jsx("p",{className:"text-sm text-gray-400",children:"لا توجد خطة اشتراك نشطة"})]})]})})}),e.jsxs("div",{className:"space-y-3 overflow-y-auto",children:[e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(zt,{size:18,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold text-[#0AE7F2]",children:"المعلومات الأساسية"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"الطول"}),e.jsxs("p",{className:"text-lg font-bold",children:[y.height," سم"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"العمر"}),e.jsxs("p",{className:"text-lg font-bold",children:[y.age," سنة"]})]})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ia,{size:18,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold text-[#0AE7F2]",children:"الوزن"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"الحالي"}),e.jsxs("p",{className:"text-lg font-bold",children:[y.currentWeight," كغ"]})]}),e.jsx("div",{className:"text-[#0AE7F2]",children:"←"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"السابق"}),e.jsxs("p",{className:"text-lg font-bold",children:[y.initialWeight," كغ"]})]})]}),e.jsxs("p",{className:"text-center text-xs text-yellow-400 mt-2",children:["الفرق: ",y.initialWeight-y.currentWeight," كغ"]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(zr,{size:18,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold text-[#0AE7F2]",children:"نسبة الدهون"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"الحالي"}),e.jsxs("p",{className:"text-lg font-bold",children:[y.currentFat,"%"]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[G(y.currentFat,y.currentWeight)," كغ"]})]}),e.jsx("div",{className:"text-[#0AE7F2]",children:"←"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"السابق"}),e.jsxs("p",{className:"text-lg font-bold",children:[y.initialFat,"%"]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[G(y.initialFat,y.initialWeight)," كغ"]})]})]}),e.jsxs("p",{className:"text-center text-xs text-yellow-400 mt-2",children:["الفرق: ",X(y.currentFat,y.currentWeight,y.initialFat,y.initialWeight)," كغ"]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Xe,{size:18,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold text-[#0AE7F2]",children:"الكتلة العضلية"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"الحالي"}),e.jsxs("p",{className:"text-lg font-bold",children:[y.currentMuscle,"%"]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[G(y.currentMuscle,y.currentWeight)," كغ"]})]}),e.jsx("div",{className:"text-[#0AE7F2]",children:"←"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"السابق"}),e.jsxs("p",{className:"text-lg font-bold",children:[y.initialMuscle,"%"]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[G(y.initialMuscle,y.initialWeight)," كغ"]})]})]}),e.jsxs("p",{className:"text-center text-xs text-yellow-400 mt-2",children:["الفرق: ",X(y.currentMuscle,y.currentWeight,y.initialMuscle,y.initialWeight)," كغ"]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(Ra,{size:18,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold text-[#0AE7F2]",children:"قياسات الجسم (سم)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"محيط الخصر"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:["الحالي: ",e.jsx("span",{className:"text-[#0AE7F2]",children:y.currentWaist})]}),e.jsxs("span",{className:"text-sm",children:["السابق: ",e.jsx("span",{className:"text-gray-400",children:y.initialWaist})]})]}),e.jsxs("p",{className:"text-xs text-yellow-400 mt-1",children:["الفرق: ",y.initialWaist-y.currentWaist]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"محيط الصدر"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:["الحالي: ",e.jsx("span",{className:"text-[#0AE7F2]",children:y.currentChest})]}),e.jsxs("span",{className:"text-sm",children:["السابق: ",e.jsx("span",{className:"text-gray-400",children:y.initialChest})]})]}),e.jsxs("p",{className:"text-xs text-yellow-400 mt-1",children:["الفرق: ",y.initialChest-y.currentChest]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"محيط الرقبة"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:["الحالي: ",e.jsx("span",{className:"text-[#0AE7F2]",children:y.currentNeck})]}),e.jsxs("span",{className:"text-sm",children:["السابق: ",e.jsx("span",{className:"text-gray-400",children:y.initialNeck})]})]}),e.jsxs("p",{className:"text-xs text-yellow-400 mt-1",children:["الفرق: ",y.initialNeck-y.currentNeck]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"محيط الذراع"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:["الحالي: ",e.jsx("span",{className:"text-[#0AE7F2]",children:y.currentArm})]}),e.jsxs("span",{className:"text-sm",children:["السابق: ",e.jsx("span",{className:"text-gray-400",children:y.initialArm})]})]}),e.jsxs("p",{className:"text-xs text-yellow-400 mt-1",children:["الفرق: ",y.initialArm-y.currentArm]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"محيط الفخذ"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:["الحالي: ",e.jsx("span",{className:"text-[#0AE7F2]",children:y.currentThigh})]}),e.jsxs("span",{className:"text-sm",children:["السابق: ",e.jsx("span",{className:"text-gray-400",children:y.initialThigh})]})]}),e.jsxs("p",{className:"text-xs text-yellow-400 mt-1",children:["الفرق: ",y.initialThigh-y.currentThigh]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"محيط الساق"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:["الحالي: ",e.jsx("span",{className:"text-[#0AE7F2]",children:y.currentCalf})]}),e.jsxs("span",{className:"text-sm",children:["السابق: ",e.jsx("span",{className:"text-gray-400",children:y.initialCalf})]})]}),e.jsxs("p",{className:"text-xs text-yellow-400 mt-1",children:["الفرق: ",y.initialCalf-y.currentCalf]})]})]})]})]}),e.jsxs("button",{onClick:T,className:"w-full bg-rose-500 text-white py-3 rounded-xl font-medium hover:bg-rose-600 transition-colors flex items-center justify-center gap-2 mt-6",children:[e.jsx(Tr,{size:16}),e.jsx("span",{className:"text-sm",children:"تسجيل الخروج"})]})]})}function Zc({onBack:a}){const[t,s]=m.useState(""),[r,n]=m.useState([{id:"1",text:"مرحباً بك في برنامجك التدريبي! كيف يمكنني مساعدتك اليوم؟",sender:"trainer",timestamp:new Date(Date.now()-24*60*60*1e3),status:"read"}]),[i,l]=m.useState(!1),o=m.useRef(null),c=m.useRef(null),d=()=>{var g;(g=o.current)==null||g.scrollIntoView({behavior:"smooth"})};m.useEffect(()=>{var g;d(),(g=c.current)==null||g.focus()},[r]);const u=()=>{if(!t.trim())return;const g={id:Date.now().toString(),text:t,sender:"user",timestamp:new Date,status:"sent"};n([...r,g]),s(""),l(!0),setTimeout(()=>{n(b=>b.map(p=>p.id===g.id?{...p,status:"delivered"}:p))},1e3),setTimeout(()=>{const b={id:(Date.now()+1).toString(),text:"حسناً، سأقوم بمساعدتك. هل يمكنك إخباري بما تحتاج؟",sender:"trainer",timestamp:new Date,status:"sent"};n(p=>[...p,b]),l(!1),setTimeout(()=>{n(p=>p.map(v=>v.id===g.id?{...v,status:"read"}:v))},500)},2500)},x=g=>{switch(g){case"sent":return e.jsx(He,{size:16,className:"text-gray-400"});case"delivered":return e.jsx(ts,{size:16,className:"text-gray-400"});case"read":return e.jsx(ts,{size:16,className:"text-[#0AE7F2]"});default:return e.jsx(Re,{size:16,className:"text-gray-400"})}};return e.jsxs("div",{className:"h-full flex flex-col bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"bg-base",children:e.jsx("div",{className:"bg-overlay",children:e.jsx("div",{className:"bg-pattern"})})}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full",children:[e.jsx("div",{className:"header-base",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:a,className:"text-white",children:e.jsx(me,{size:24})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h2",{className:"font-bold",children:"المدرب أحمد"}),e.jsx("p",{className:"text-sm text-[#0AE7F2]",children:"متصل الآن"})]}),e.jsx("div",{className:"w-10 h-10 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center",children:e.jsx(Ae,{size:24,className:"text-[#0AE7F2]"})})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto content-container space-y-4",children:[r.map(g=>e.jsx("div",{className:`flex mb-4 ${g.sender==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl p-4 ${g.sender==="user"?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/60 backdrop-blur-sm border border-[#0AE7F2]/20"}`,children:[e.jsx("p",{className:"mb-2",children:g.text}),e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs",children:[e.jsx("span",{className:g.sender==="user"?"text-black/60":"text-gray-400",children:g.timestamp.toLocaleTimeString()}),g.sender==="user"&&x(g.status)]})]})},g.id)),i&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm border border-[#0AE7F2]/20 rounded-2xl p-4",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-[#0AE7F2] rounded-full animate-bounce"}),e.jsx("span",{className:"w-2 h-2 bg-[#0AE7F2] rounded-full animate-bounce [animation-delay:0.2s]"}),e.jsx("span",{className:"w-2 h-2 bg-[#0AE7F2] rounded-full animate-bounce [animation-delay:0.4s]"})]})})}),e.jsx("div",{ref:o})]}),e.jsx("div",{className:"bg-[#1A1F2E]/80 backdrop-blur-lg border-t border-[#0AE7F2]/20 p-5 safe-area-bottom",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:u,className:"button-base bg-[#0AE7F2] text-black p-3 rounded-xl hover:bg-[#0AE7F2]/90 transition-colors",children:e.jsx(dt,{size:20})}),e.jsxs("div",{className:"w-[280px] flex items-center gap-2 bg-[#0A0F1C]/50 rounded-xl border border-[#0AE7F2]/20 px-3",children:[e.jsx("button",{className:"text-[#0AE7F2] hover:text-[#0AE7F2]/80 p-2",children:e.jsx(es,{size:20})}),e.jsx("button",{className:"text-[#0AE7F2] hover:text-[#0AE7F2]/80 p-2",children:e.jsx(Ls,{size:20})}),e.jsx("input",{ref:c,type:"text",value:t,onChange:g=>s(g.target.value),placeholder:"اكتب رسالتك...",className:"w-[140px] bg-transparent px-2 py-3 text-white placeholder-gray-400 focus:outline-none",onKeyPress:g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),u())}}),e.jsx("button",{className:"text-[#0AE7F2] hover:text-[#0AE7F2]/80 p-2",children:e.jsx(Ds,{size:20})})]})]})})]})]})}function ed({trainee:a,onClose:t,onSave:s}){const[r,n]=m.useState({name:a.name||"",email:a.email||"",phone:a.phone||"",plan:a.plan||"basic",height:a.height||170,currentWeight:a.currentWeight||70,initialWeight:a.initialWeight||70,targetWeight:a.targetWeight||70,currentFat:a.currentFat||0,initialFat:a.initialFat||0,currentMuscle:a.currentMuscle||0,initialMuscle:a.initialMuscle||0,currentWaist:a.currentWaist||0,initialWaist:a.initialWaist||0,currentNeck:a.currentNeck||0,initialNeck:a.initialNeck||0,currentArm:a.currentArm||0,initialArm:a.initialArm||0,goals:a.goals||[],age:a.age||25,gender:a.gender||"male"}),[i,l]=m.useState({newPassword:"",confirmPassword:""}),[o,c]=m.useState(!1),[d,u]=m.useState(!1),[x,g]=m.useState(null),b=h=>{if(h.preventDefault(),i.newPassword&&i.newPassword!==i.confirmPassword){g("كلمات المرور غير متطابقة");return}const f={...r,...i.newPassword?{password:i.newPassword}:{}};s(a.id,f)},p=[{id:"basic",name:"الخطة الأساسية"},{id:"premium",name:"الخطة المتقدمة"},{id:"pro",name:"الخطة الاحترافية"}],v=[{id:"weight_loss",name:"خسارة الوزن",icon:"🎯"},{id:"muscle_gain",name:"زيادة العضلات",icon:"💪"},{id:"fitness",name:"اللياقة البدنية",icon:"🏃‍♂️"},{id:"strength",name:"القوة",icon:"🏋️‍♂️"},{id:"flexibility",name:"المرونة",icon:"🧘‍♂️"}];return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"تعديل بيانات المتدرب"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:e.jsx(ue,{size:24})})]})}),e.jsxs("form",{onSubmit:b,className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[x&&e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6",children:x}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-[#0AE7F2]",children:"المعلومات الشخصية"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الاسم"}),e.jsx("input",{type:"text",value:r.name,onChange:h=>n({...r,name:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",value:r.email,onChange:h=>n({...r,email:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"رقم الهاتف"}),e.jsx("input",{type:"tel",value:r.phone,onChange:h=>n({...r,phone:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"العمر"}),e.jsx("input",{type:"number",value:r.age,onChange:h=>n({...r,age:parseInt(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"12",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الجنس"}),e.jsxs("select",{value:r.gender,onChange:h=>n({...r,gender:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,children:[e.jsx("option",{value:"male",children:"ذكر"}),e.jsx("option",{value:"female",children:"أنثى"})]})]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-[#0AE7F2]",children:"تحديث كلمة المرور"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",value:i.newPassword,onChange:h=>l({...i,newPassword:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",placeholder:"اترك فارغاً للاحتفاظ بكلمة المرور الحالية"}),e.jsx("button",{type:"button",onClick:()=>c(!o),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:o?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:o?"text":"password",value:i.confirmPassword,onChange:h=>l({...i,confirmPassword:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",placeholder:"اترك فارغاً للاحتفاظ بكلمة المرور الحالية"}),e.jsx("button",{type:"button",onClick:()=>c(!o),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:o?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-[#0AE7F2]",children:"القياسات الجسدية"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الطول (سم)"}),e.jsx("input",{type:"number",value:r.height,onChange:h=>n({...r,height:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(zt,{size:18,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold text-[#0AE7F2]",children:"الوزن"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الوزن الحالي (كجم)"}),e.jsx("input",{type:"number",value:r.currentWeight,onChange:h=>n({...r,currentWeight:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الوزن السابق (كجم)"}),e.jsx("input",{type:"number",value:r.initialWeight,onChange:h=>n({...r,initialWeight:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(zr,{size:18,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold text-[#0AE7F2]",children:"نسبة الدهون"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"النسبة الحالية (%)"}),e.jsx("input",{type:"number",value:r.currentFat,onChange:h=>n({...r,currentFat:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"0",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"النسبة السابقة (%)"}),e.jsx("input",{type:"number",value:r.initialFat,onChange:h=>n({...r,initialFat:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"0",max:"100"})]})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Xe,{size:18,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold text-[#0AE7F2]",children:"الكتلة العضلية"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"النسبة الحالية (%)"}),e.jsx("input",{type:"number",value:r.currentMuscle,onChange:h=>n({...r,currentMuscle:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"0",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"النسبة السابقة (%)"}),e.jsx("input",{type:"number",value:r.initialMuscle,onChange:h=>n({...r,initialMuscle:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"0",max:"100"})]})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(zt,{size:18,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold text-[#0AE7F2]",children:"قياسات الجسم"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"محيط البطن الحالي (سم)"}),e.jsx("input",{type:"number",value:r.currentWaist,onChange:h=>n({...r,currentWaist:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"محيط البطن السابق (سم)"}),e.jsx("input",{type:"number",value:r.initialWaist,onChange:h=>n({...r,initialWaist:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"محيط العنق الحالي (سم)"}),e.jsx("input",{type:"number",value:r.currentNeck,onChange:h=>n({...r,currentNeck:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"محيط العنق السابق (سم)"}),e.jsx("input",{type:"number",value:r.initialNeck,onChange:h=>n({...r,initialNeck:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"محيط الذراع الحالي (سم)"}),e.jsx("input",{type:"number",value:r.currentArm,onChange:h=>n({...r,currentArm:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"محيط الذراع السابق (سم)"}),e.jsx("input",{type:"number",value:r.initialArm,onChange:h=>n({...r,initialArm:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]})]})]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-[#0AE7F2]",children:"خطة الاشتراك"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:p.map(h=>e.jsxs("label",{className:`block p-4 rounded-xl cursor-pointer transition-all ${r.plan===h.id?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx("input",{type:"radio",name:"plan",value:h.id,checked:r.plan===h.id,onChange:f=>n({...r,plan:f.target.value}),className:"hidden"}),e.jsx("div",{className:"text-center",children:e.jsx("h4",{className:"font-bold",children:h.name})})]},h.id))})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-[#0AE7F2]",children:"الأهداف"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:v.map(h=>e.jsxs("label",{className:`flex items-center gap-3 p-4 rounded-xl cursor-pointer transition-all ${r.goals.includes(h.id)?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx("input",{type:"checkbox",checked:r.goals.includes(h.id),onChange:f=>{f.target.checked?n({...r,goals:[...r.goals,h.id]}):n({...r,goals:r.goals.filter(N=>N!==h.id)})},className:"hidden"}),e.jsx("span",{className:"text-2xl",children:h.icon}),e.jsx("span",{children:h.name})]},h.id))})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 py-3 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:d,className:"flex-1 py-3 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50",children:d?"جاري الحفظ...":"حفظ التغييرات"})]})]})]})})}const td=async a=>{if(!q())return[{id:"1",name:"شوفان بالموز",calories:350,protein:12,carbs:45,fat:8,date:new Date().toISOString(),status:"consumed"},{id:"2",name:"صدر دجاج مشوي",calories:450,protein:35,carbs:20,fat:15,date:new Date().toISOString(),status:"pending"}];const{data:t,error:s}=await S.from("trainee_meals").select(`
      id,
      name,
      calories,
      protein,
      carbs,
      fat,
      created_at,
      status
    `).eq("trainee_id",a).order("created_at",{ascending:!1});if(s)throw s;return t.map(r=>({id:r.id,name:r.name,calories:r.calories,protein:r.protein,carbs:r.carbs,fat:r.fat,date:r.created_at,status:r.status}))},sd=async a=>{if(!q())return{completedExercises:45,totalExercises:60,completedMeals:38,totalMeals:45,progress:75};const{data:t,error:s}=await S.from("trainee_profiles").select("progress").eq("id",a).single();if(s)throw s;return{completedExercises:t.progress.completed_exercises||0,totalExercises:t.progress.total_exercises||0,completedMeals:t.progress.completed_meals||0,totalMeals:t.progress.total_meals||0,progress:t.progress.overall_progress||0}};function rd({traineeId:a,onClose:t}){const[s,r]=m.useState({completedExercises:0,totalExercises:0,completedMeals:0,totalMeals:0,progress:0}),[n,i]=m.useState([]),[l,o]=m.useState(!0);return m.useEffect(()=>{(async()=>{try{const[d,u]=await Promise.all([sd(a),td(a)]);r(d),i(u)}catch(d){console.error("Error fetching trainee data:",d)}finally{o(!1)}})()},[a]),e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"أداء المتدرب"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:e.jsx(ue,{size:24})})]})}),e.jsx("div",{className:"p-6 overflow-y-auto",children:l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Xe,{size:20,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold",children:"التمارين"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-[#0AE7F2]",children:[s.completedExercises,"/",s.totalExercises]}),e.jsx("p",{className:"text-xs text-gray-400",children:"تمرين مكتمل"})]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Be,{size:20,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold",children:"الوجبات"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-[#0AE7F2]",children:[s.completedMeals,"/",s.totalMeals]}),e.jsx("p",{className:"text-xs text-gray-400",children:"وجبة مكتملة"})]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ws,{size:20,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"text-sm font-bold",children:"التقدم الكلي"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-[#0AE7F2]",children:[s.progress,"%"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"نسبة الإنجاز"})]})]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"الوجبات المضافة"}),e.jsx("div",{className:"space-y-4",children:n.map(c=>e.jsxs("div",{className:"bg-[#1A1F2E]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"text-[#0AE7F2]",children:[c.calories," سعرة"]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",children:c.name}),e.jsx("p",{className:"text-sm text-gray-400",children:new Date(c.date).toLocaleDateString("ar-SA")})]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[e.jsxs("span",{children:["بروتين: ",c.protein,"g"]}),e.jsxs("span",{children:["كربوهيدرات: ",c.carbs,"g"]}),e.jsxs("span",{children:["دهون: ",c.fat,"g"]})]})]},c.id))})]})]})})]})})}const Sa=a=>a?/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a):!1,Ar=async(a,t)=>{if(!q())return{id:"123e4567-e89b-12d3-a456-426614174000",traineeId:a,weekStartDate:t,exercises:[{id:"123e4567-e89b-12d3-a456-426614174001",exerciseId:"123e4567-e89b-12d3-a456-426614174010",dayOfWeek:0,sets:4,reps:12,exerciseName:"بنش بريس",exerciseCategory:"chest"},{id:"123e4567-e89b-12d3-a456-426614174002",exerciseId:"123e4567-e89b-12d3-a456-426614174011",dayOfWeek:2,sets:4,reps:12,exerciseName:"سكوات",exerciseCategory:"legs"}]};try{if(!Sa(a))throw new Error("Invalid trainee ID format");const{data:s,error:r}=await S.from("weekly_schedules").select("id").eq("trainee_id",a).eq("week_start_date",t).single();if(r&&r.code!=="PGRST116")throw r;let n;if(s)n=s.id;else return null;const{data:i,error:l}=await S.from("schedule_exercises").select(`
        id,
        exercise_id,
        day_of_week,
        sets,
        reps,
        exercises (
          name,
          category
        )
      `).eq("schedule_id",n);if(l)throw l;return{id:n,traineeId:a,weekStartDate:t,exercises:i.map(o=>{var c,d;return{id:o.id,exerciseId:o.exercise_id,dayOfWeek:o.day_of_week,sets:o.sets,reps:o.reps,exerciseName:(c=o.exercises)==null?void 0:c.name,exerciseCategory:(d=o.exercises)==null?void 0:d.category}})}}catch(s){throw console.error("Error fetching weekly schedule:",s),s}},ad=async(a,t)=>{if(!q())return{id:"123e4567-e89b-12d3-a456-426614174000",traineeId:a,weekStartDate:t,exercises:[]};try{if(!Sa(a))throw new Error("Invalid trainee ID format");const{data:s,error:r}=await S.from("weekly_schedules").insert({trainee_id:a,week_start_date:t}).select("id").single();if(r)throw r;return{id:s.id,traineeId:a,weekStartDate:t,exercises:[]}}catch(s){throw console.error("Error creating weekly schedule:",s),s}},nd=async(a,t,s,r,n)=>{if(!q()){console.log("Mock assign exercise:",{scheduleId:a,exerciseId:t,dayOfWeek:s,sets:r,reps:n});return}try{const{error:i}=await S.from("schedule_exercises").insert({schedule_id:a,exercise_id:t,day_of_week:s,sets:r,reps:n});if(i)throw i}catch(i){throw console.error("Error assigning exercise:",i),i}},id=async a=>{if(!q()){console.log("Mock remove exercise:",a);return}try{const{error:t}=await S.from("schedule_exercises").delete().eq("id",a);if(t)throw t}catch(t){throw console.error("Error removing exercise:",t),t}};function od({onClose:a,onAssign:t}){const[s,r]=m.useState(""),[n,i]=m.useState([]),[l,o]=m.useState(null),[c,d]=m.useState(!0),[u,x]=m.useState(null);m.useEffect(()=>{g()},[]);const g=async()=>{try{if(d(!0),x(null),q()){const{data:v,error:h}=await S.from("exercises").select("*").eq("status","active").order("name");if(h)throw h;const f=v.map(N=>({id:N.id,name:N.name,category:N.category,sets:N.sets,reps:N.reps,description:N.description,videoUrl:N.video_url}));i(f)}else i([{id:"123e4567-e89b-12d3-a456-426614174010",name:"بنش بريس",category:"chest",sets:4,reps:12,description:"تمرين أساسي لتقوية عضلات الصدر"},{id:"123e4567-e89b-12d3-a456-426614174011",name:"سكوات",category:"legs",sets:3,reps:15,description:"تمرين أساسي لتقوية عضلات الأرجل"},{id:"123e4567-e89b-12d3-a456-426614174012",name:"ديدليفت",category:"back",sets:4,reps:10,description:"تمرين أساسي لتقوية عضلات الظهر"}])}catch(v){console.error("Error loading exercises:",v),x("حدث خطأ أثناء تحميل التمارين")}finally{d(!1)}},b=()=>{l&&(t(l),a())},p=n.filter(v=>v.name.toLowerCase().includes(s.toLowerCase())||v.category.toLowerCase().includes(s.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-lg",children:[e.jsx("div",{className:"p-6 border-b border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"اختيار تمرين"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white",children:e.jsx(ue,{size:24})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("input",{type:"text",value:s,onChange:v=>r(v.target.value),placeholder:"ابحث عن تمرين...",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white placeholder-gray-400 focus:outline-none focus:border-[#0AE7F2]"}),e.jsx(je,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]}),u&&e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6",children:[u,e.jsx("button",{onClick:g,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}),c&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}),!c&&!u&&e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:p.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"لا توجد تمارين مطابقة للبحث"}):p.map(v=>e.jsxs("button",{onClick:()=>o(v.id),className:`w-full p-4 rounded-xl text-right transition-colors ${l===v.id?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-white":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0A0F1C]/80"} border`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-2 rounded-lg",children:e.jsx(Xe,{size:20,className:"text-[#0AE7F2]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:v.name}),e.jsx("p",{className:"text-sm text-gray-400",children:v.category})]})]}),l===v.id&&e.jsx(Se,{size:20,className:"text-[#0AE7F2]"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-[#0AE7F2]",children:[e.jsxs("span",{children:[v.sets," مجموعات"]}),e.jsxs("span",{children:[v.reps," تكرار"]})]})]},v.id))})]}),e.jsx("div",{className:"p-6 border-t border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:a,className:"flex-1 py-3 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:b,disabled:!l||c,className:"flex-1 py-3 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50",children:"تعيين التمرين"})]})})]})})}const ld=["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],cd=a=>a?/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a):!1;function dd({traineeId:a}){const[t,s]=m.useState(null),[r,n]=m.useState(null),[i,l]=m.useState(!1),[o,c]=m.useState(!0),[d,u]=m.useState(null);m.useEffect(()=>{x()},[a]);const x=async()=>{var p;try{if(c(!0),u(null),!cd(a)){console.warn("Invalid trainee ID format:",a),u("معرف المتدرب غير صالح"),c(!1);return}const v=new Date,h=new Date(v);h.setDate(v.getDate()-v.getDay());const f=h.toISOString().split("T")[0];let N=await Ar(a,f);if(!N)try{N=await ad(a,f)}catch(w){if((p=w==null?void 0:w.message)!=null&&p.includes("unique_trainee_week"))N=await Ar(a,f);else throw w}s(N)}catch(v){console.error("Error loading schedule:",v),u("حدث خطأ أثناء تحميل الجدول")}finally{c(!1)}},g=async p=>{if(!(!t||r===null))try{await nd(t.id,p,r,4,12),await x(),l(!1),n(null)}catch(v){console.error("Error assigning exercise:",v),u("حدث خطأ أثناء إضافة التمرين")}},b=async p=>{try{await id(p),await x()}catch(v){console.error("Error removing exercise:",v),u("حدث خطأ أثناء حذف التمرين")}};return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):d?e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:[d,e.jsx("button",{onClick:x,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:ld.map((p,v)=>{const h=t.exercises.filter(f=>f.dayOfWeek===v)||[];return e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl border border-[#0AE7F2]/20 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-2 rounded-lg",children:e.jsx(Ze,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h3",{className:"font-medium",children:p})]}),e.jsx("button",{onClick:()=>{n(v),l(!0)},className:"bg-[#0AE7F2]/10 text-[#0AE7F2] p-2 rounded-lg hover:bg-[#0AE7F2]/20 transition-colors",children:e.jsx(ze,{size:20})})]}),h.length>0?e.jsx("div",{className:"space-y-3",children:h.map(f=>e.jsxs("div",{className:"flex items-center justify-between bg-[#0A0F1C]/40 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:f.exerciseName}),e.jsxs("p",{className:"text-sm text-gray-400",children:[f.sets," × ",f.reps]})]}),e.jsx("button",{onClick:()=>b(f.id),className:"text-rose-500 hover:text-rose-400 p-1",children:e.jsx(ue,{size:16})})]},f.id))}):e.jsx("p",{className:"text-center text-gray-400 text-sm py-4",children:"لا توجد تمارين لهذا اليوم"})]},v)})}),i&&e.jsx(od,{onClose:()=>{l(!1),n(null)},onAssign:g})]}):e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500 text-amber-500 p-4 rounded-xl text-center",children:["لا يوجد جدول لهذا الأسبوع",e.jsx("button",{onClick:x,className:"underline hover:no-underline mt-2 block w-full",children:"إنشاء جدول جديد"})]})}const ud=a=>a?/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a):!1,Fr=async(a,t)=>{if(!q())return{id:"123e4567-e89b-12d3-a456-426614174100",traineeId:a,weekStartDate:t,meals:[{id:"123e4567-e89b-12d3-a456-426614174101",mealId:"123e4567-e89b-12d3-a456-426614174020",dayOfWeek:0,timing:"breakfast",mealName:"شوفان بالموز",calories:350},{id:"123e4567-e89b-12d3-a456-426614174102",mealId:"123e4567-e89b-12d3-a456-426614174021",dayOfWeek:0,timing:"lunch",mealName:"صدر دجاج مشوي",calories:450}]};try{if(!ud(a))throw console.warn("Invalid trainee ID format:",a),new Error("Invalid trainee ID format");const{data:s,error:r}=await S.from("weekly_schedules").select("id").eq("trainee_id",a).eq("week_start_date",t).single();if(r&&r.code!=="PGRST116")throw r;let n;if(s)n=s.id;else{const{data:o,error:c}=await S.from("weekly_schedules").insert({trainee_id:a,week_start_date:t}).select("id").single();if(c)throw c;n=o.id}const{data:i,error:l}=await S.from("schedule_meals").select(`
        id,
        meal_id,
        day_of_week,
        timing,
        meals (
          name,
          calories
        )
      `).eq("schedule_id",n);if(l)throw l;return{id:n,traineeId:a,weekStartDate:t,meals:i.map(o=>{var c,d;return{id:o.id,mealId:o.meal_id,dayOfWeek:o.day_of_week,timing:o.timing,mealName:(c=o.meals)==null?void 0:c.name,calories:(d=o.meals)==null?void 0:d.calories}})}}catch(s){throw console.error("Error fetching meal schedule:",s),s}},hd=async(a,t,s,r)=>{if(!q()){console.log("Mock assign meal:",{scheduleId:a,mealId:t,dayOfWeek:s,timing:r});return}try{const{error:n}=await S.from("schedule_meals").insert({schedule_id:a,meal_id:t,day_of_week:s,timing:r});if(n)throw n}catch(n){throw console.error("Error assigning meal:",n),n}},md=async a=>{if(!q()){console.log("Mock remove meal:",a);return}try{const{error:t}=await S.from("schedule_meals").delete().eq("id",a);if(t)throw t}catch(t){throw console.error("Error removing meal:",t),t}};function xd({onBack:a,onAssign:t,traineeId:s,dayOfWeek:r,timing:n}){const[i,l]=m.useState(""),[o,c]=m.useState([]),[d,u]=m.useState([]),[x,g]=m.useState(null),[b,p]=m.useState(!0),[v,h]=m.useState(null),[f,N]=m.useState(null),[w,j]=m.useState(!1),[F,C]=m.useState(!1),A=[{id:"breakfast",name:"فطور",icon:Be},{id:"lunch",name:"غداء",icon:$s},{id:"dinner",name:"عشاء",icon:Is},{id:"snack",name:"وجبات خفيفة",icon:Rs}];m.useEffect(()=>{E()},[]),m.useEffect(()=>{_()},[i,f,o]);const E=async()=>{try{if(p(!0),h(null),q()){const{data:y,error:W}=await S.from("meals").select("*").eq("status","active").order("name");if(W)throw W;c(y||[]),u(y||[])}else{const y=[{id:"1",name:"شوفان بالموز واللوز",calories:350,protein:12,carbs:45,fat:14,description:"شوفان مطبوخ مع حليب لوز، موز طازج، ولوز مقطع. غني بالألياف والبروتين.",category:"breakfast"},{id:"2",name:"سلطة دجاج مشوي",calories:450,protein:35,carbs:20,fat:25,description:"صدر دجاج مشوي مع خضروات طازجة وصلصة زيت الزيتون. وجبة متوازنة وغنية بالبروتين.",category:"lunch"},{id:"3",name:"سمك سلمون مشوي",calories:550,protein:40,carbs:35,fat:30,description:"سمك سلمون مشوي مع الخضروات المشوية وأرز بني. غني بأوميغا 3 والبروتين.",category:"dinner"},{id:"4",name:"زبادي يوناني مع التوت",calories:180,protein:15,carbs:20,fat:5,description:"زبادي يوناني مع توت طازج وعسل. غني بالبروتين والبروبيوتيك.",category:"snack"},{id:"5",name:"بيض مسلوق مع خبز",calories:320,protein:18,carbs:30,fat:16,description:"بيضتان مسلوقتان مع خبز أسمر وأفوكادو. غني بالبروتين والدهون الصحية.",category:"breakfast"},{id:"6",name:"عدس مع أرز",calories:400,protein:20,carbs:60,fat:8,description:"عدس مطبوخ مع أرز بني وخضروات. غني بالبروتين النباتي والألياف.",category:"lunch"}];c(y),u(y)}}catch(y){console.error("Error fetching meals:",y),h("حدث خطأ أثناء تحميل الوجبات")}finally{p(!1)}},_=()=>{let y=[...o];i&&(y=y.filter(W=>W.name.toLowerCase().includes(i.toLowerCase())||W.description&&W.description.toLowerCase().includes(i.toLowerCase()))),f&&(y=y.filter(W=>W.category===f)),u(y)},k=async()=>{if(!(!x||!t))try{C(!0);const y=o.find(W=>W.id===x);if(!y)throw new Error("الوجبة غير موجودة");t(x,y.name),a()}catch(y){console.error("Error assigning meal:",y),h("حدث خطأ أثناء تعيين الوجبة")}finally{C(!1)}},O=y=>{const W=A.find(z=>z.id===y);return W?W.name:y},M=y=>{const W=A.find(z=>z.id===y);return W?W.icon:Be};return e.jsxs("div",{className:"fixed inset-0 bg-[#0A0F1C] text-white z-50 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-[#0AE7F2]/20 bg-[#1A1F2E]/80 backdrop-blur-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:a,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h1",{className:"text-xl font-bold",children:"بحث عن وجبة"}),e.jsx("button",{onClick:()=>j(!w),className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(Ue,{size:20,className:"text-[#0AE7F2]"})})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i,onChange:y=>l(y.target.value),placeholder:"ابحث عن وجبة...",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white placeholder-gray-400 focus:outline-none focus:border-[#0AE7F2]"}),e.jsx(je,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-[#0AE7F2]",size:20})]})}),w&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto py-4",children:[e.jsx("button",{onClick:()=>N(null),className:`px-4 py-2 rounded-xl whitespace-nowrap transition-colors ${f?"bg-[#1A1F2E]/60 text-gray-400":"bg-[#0AE7F2] text-black"}`,children:"الكل"}),A.map(y=>e.jsxs("button",{onClick:()=>N(y.id),className:`px-4 py-2 rounded-xl whitespace-nowrap transition-colors flex items-center gap-2 ${f===y.id?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/60 text-gray-400"}`,children:[e.jsx(y.icon,{size:16}),e.jsx("span",{children:y.name})]},y.id))]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[v&&e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-4",children:[v,e.jsx("button",{onClick:E,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}),b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Fe,{size:40,className:"text-[#0AE7F2] animate-spin"})}):d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(je,{size:32,className:"text-[#0AE7F2]"})}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"لا توجد نتائج"}),e.jsx("p",{className:"text-gray-400",children:"لم يتم العثور على وجبات تطابق بحثك"})]}):e.jsx("div",{className:"space-y-3",children:d.map(y=>{const W=M(y.category);return e.jsxs("button",{onClick:()=>g(y.id),className:`w-full p-4 rounded-xl text-right transition-colors ${x===y.id?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-white":"bg-[#1A1F2E]/60 border-[#0AE7F2]/20 hover:bg-[#1A1F2E]"} border`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-2 rounded-lg",children:e.jsx(W,{size:20,className:"text-[#0AE7F2]"})}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"font-medium",children:y.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-sm text-[#0AE7F2]",children:[y.calories," سعرة"]}),e.jsx("span",{className:"text-xs text-gray-400",children:O(y.category)})]})]})]}),x===y.id&&e.jsx("div",{className:"bg-[#0AE7F2] text-black p-2 rounded-full",children:e.jsx(He,{size:16})})]}),y.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-2 pr-10",children:y.description}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3 pr-10",children:[e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"text-[#0AE7F2]",children:[y.protein,"g"]}),e.jsx("span",{className:"text-gray-400 mr-1",children:"بروتين"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"text-[#0AE7F2]",children:[y.carbs,"g"]}),e.jsx("span",{className:"text-gray-400 mr-1",children:"كربوهيدرات"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"text-[#0AE7F2]",children:[y.fat,"g"]}),e.jsx("span",{className:"text-gray-400 mr-1",children:"دهون"})]})]})]},y.id)})})]}),e.jsx("div",{className:"p-4 border-t border-[#0AE7F2]/20 bg-[#1A1F2E]/80 backdrop-blur-lg",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:a,className:"flex-1 py-3 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:k,disabled:!x||F,className:"flex-1 py-3 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{size:20,className:"animate-spin"}),e.jsx("span",{children:"جاري التعيين..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{size:20}),e.jsx("span",{children:"تعيين الوجبة"})]})})]})})]})}const fd=["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],pd=[{id:"breakfast",name:"فطور",icon:Wa},{id:"lunch",name:"غداء",icon:$s},{id:"dinner",name:"عشاء",icon:Is},{id:"snack",name:"وجبة خفيفة",icon:Rs}],gd=a=>a?/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a):!1;function bd({traineeId:a}){const[t,s]=m.useState(null),[r,n]=m.useState(null),[i,l]=m.useState(null),[o,c]=m.useState(!1),[d,u]=m.useState(!0),[x,g]=m.useState(null),[b,p]=m.useState(!1);m.useEffect(()=>{v()},[a]);const v=async()=>{try{if(u(!0),g(null),!gd(a)){console.warn("Invalid trainee ID format:",a);const C=await Fr("123e4567-e89b-12d3-a456-426614174030",new Date().toISOString().split("T")[0]);s(C);return}const N=new Date,w=new Date(N);w.setDate(N.getDate()-N.getDay());const j=await Fr(a,w.toISOString().split("T")[0]);s(j)}catch(N){console.error("Error loading meal schedule:",N),g("حدث خطأ أثناء تحميل جدول الوجبات")}finally{u(!1)}},h=async N=>{if(!(!t||r===null||!i))try{p(!0),await hd(t.id,N,r,i),await v(),c(!1),n(null),l(null)}catch(w){console.error("Error assigning meal:",w),g("حدث خطأ أثناء إضافة الوجبة")}finally{p(!1)}},f=async N=>{try{p(!0),await md(N),await v()}catch(w){console.error("Error removing meal:",w),g("حدث خطأ أثناء حذف الوجبة")}finally{p(!1)}};return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Fe,{size:40,className:"text-[#0AE7F2] animate-spin"})}):x?e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:[x,e.jsx("button",{onClick:v,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}):t?e.jsxs("div",{className:"space-y-4",children:[b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsx(Fe,{size:40,className:"text-[#0AE7F2] animate-spin"})}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:fd.map((N,w)=>{const j=(t==null?void 0:t.meals.filter(F=>F.dayOfWeek===w))||[];return e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl border border-[#0AE7F2]/20 p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-2 rounded-lg",children:e.jsx(Ze,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h3",{className:"font-medium",children:N})]})}),e.jsx("div",{className:"space-y-4",children:pd.map(F=>{const C=j.filter(E=>E.timing===F.id),A=F.icon;return e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{size:16,className:"text-[#0AE7F2]"}),e.jsx("span",{className:"text-sm font-medium",children:F.name})]}),e.jsx("button",{onClick:()=>{n(w),l(F.id),c(!0)},className:"bg-[#0AE7F2]/10 text-[#0AE7F2] p-1.5 rounded-lg hover:bg-[#0AE7F2]/20 transition-colors",children:e.jsx(ze,{size:16})})]}),C.length>0?e.jsx("div",{className:"space-y-2",children:C.map(E=>e.jsxs("div",{className:"flex items-center justify-between bg-[#1A1F2E]/40 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:E.mealName}),e.jsxs("p",{className:"text-sm text-[#0AE7F2]",children:[E.calories," سعرة"]})]}),e.jsx("button",{onClick:()=>f(E.id),className:"text-rose-500 hover:text-rose-400 p-1",children:e.jsx(ue,{size:16})})]},E.id))}):e.jsx("p",{className:"text-center text-gray-400 text-sm py-2",children:"لا توجد وجبات"})]},F.id)})})]},w)})}),o&&e.jsx(xd,{onBack:()=>{c(!1),n(null),l(null)},onAssign:h,traineeId:a,dayOfWeek:r||void 0,timing:i||void 0})]}):e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500 text-amber-500 p-4 rounded-xl text-center",children:["لا يوجد جدول وجبات لهذا الأسبوع",e.jsx("button",{onClick:v,className:"underline hover:no-underline mt-2 block w-full",children:"إنشاء جدول جديد"})]})}function vd({traineeId:a,traineeName:t,onClose:s}){const[r,n]=m.useState("exercises");return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-[#0AE7F2]/20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-3 rounded-xl",children:e.jsx(Ze,{size:24,className:"text-[#0AE7F2]"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:["جدول ",t]}),e.jsx("p",{className:"text-sm text-gray-400",children:"تعيين التمارين والوجبات"})]})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white",children:e.jsx(ue,{size:24})})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{onClick:()=>n("exercises"),className:`flex-1 py-3 rounded-xl transition-colors ${r==="exercises"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C]/40 text-gray-400 hover:text-white"}`,children:"التمارين"}),e.jsx("button",{onClick:()=>n("meals"),className:`flex-1 py-3 rounded-xl transition-colors ${r==="meals"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C]/40 text-gray-400 hover:text-white"}`,children:"الوجبات"})]})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:r==="exercises"?e.jsx(dd,{traineeId:a}):e.jsx(bd,{traineeId:a})})]})})}function jd({onSuccess:a,onCancel:t}){const[s,r]=m.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",height:170,weight:70,targetWeight:70,goals:[],plan:"basic",age:25,gender:"male",bloodType:"A+"}),[n,i]=m.useState(!1),[l,o]=m.useState(!1),[c,d]=m.useState(null),[u,x]=m.useState(null),g=[{id:"basic",name:"الخطة الأساسية",price:99,duration:"شهر واحد",features:["برنامج تدريبي أساسي","برنامج غذائي أساسي","متابعة أسبوعية"]},{id:"premium",name:"الخطة المتقدمة",price:199,duration:"3 شهور",features:["برنامج تدريبي متقدم","برنامج غذائي مخصص","متابعة يومية","جلسات خاصة"]},{id:"pro",name:"الخطة الاحترافية",price:299,duration:"6 شهور",features:["برنامج تدريبي احترافي","برنامج غذائي مخصص","متابعة مستمرة","جلسات خاصة","استشارات غير محدودة"]}],b=[{id:"weight_loss",name:"خسارة الوزن",icon:"🎯"},{id:"muscle_gain",name:"زيادة العضلات",icon:"💪"},{id:"fitness",name:"اللياقة البدنية",icon:"🏃‍♂️"},{id:"strength",name:"القوة",icon:"🏋️‍♂️"},{id:"flexibility",name:"المرونة",icon:"🧘‍♂️"}],p=["A+","A-","B+","B-","AB+","AB-","O+","O-"],v=async h=>{if(h.preventDefault(),d(null),x(null),s.password!==s.confirmPassword){d("كلمات المرور غير متطابقة");return}if(s.password.length<8){d("يجب أن تكون كلمة المرور 8 أحرف على الأقل");return}if(s.goals.length===0){d("يرجى اختيار هدف واحد على الأقل");return}try{o(!0);const f=await ha(s.name,s.email,s.password,s.phone,s.height,s.weight,s.targetWeight,s.goals,s.plan);if(!f.success)throw new Error(f.error||"حدث خطأ أثناء التسجيل");x("تم تسجيل المتدرب بنجاح"),r({name:"",email:"",phone:"",password:"",confirmPassword:"",height:170,weight:70,targetWeight:70,goals:[],plan:"basic",age:25,gender:"male",bloodType:"A+"}),setTimeout(()=>{a()},2e3)}catch(f){console.error("Registration error:",f),d(f instanceof Error?f.message:"حدث خطأ أثناء التسجيل"),x(null)}finally{o(!1)}};return e.jsx("div",{dir:"rtl",className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-[#1A1F2E] w-full h-full max-w-full max-h-full overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-[#0AE7F2]/20 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 bg-[#0A0F1C] rounded-full flex items-center justify-center hover:bg-[#0A0F1C]/80 transition-colors",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"إضافة متدرب جديد"})]}),e.jsx("button",{onClick:t,className:"w-10 h-10 bg-[#0A0F1C] rounded-full flex items-center justify-center hover:bg-[#0A0F1C]/80 transition-colors",children:e.jsx(ue,{size:20,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[c&&e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6",children:c}),u&&e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500 text-emerald-500 p-4 rounded-xl text-center mb-6",children:u}),e.jsxs("form",{onSubmit:v,className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-[#0AE7F2]",children:"المعلومات الشخصية"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الاسم"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:s.name,onChange:h=>r({...s,name:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx(Ae,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"البريد الإلكتروني"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:s.email,onChange:h=>r({...s,email:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx(Us,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",value:s.phone,onChange:h=>r({...s,phone:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx(Ws,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:n?"text":"password",value:s.password,onChange:h=>r({...s,password:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,minLength:8}),e.jsx("button",{type:"button",onClick:()=>i(!n),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:n?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:n?"text":"password",value:s.confirmPassword,onChange:h=>r({...s,confirmPassword:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx("button",{type:"button",onClick:()=>i(!n),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:n?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"العمر"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s.age,onChange:h=>r({...s,age:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"12",max:"100"}),e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الجنس"}),e.jsxs("select",{value:s.gender,onChange:h=>r({...s,gender:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,children:[e.jsx("option",{value:"male",children:"ذكر"}),e.jsx("option",{value:"female",children:"أنثى"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"فصيلة الدم"}),e.jsx("select",{value:s.bloodType,onChange:h=>r({...s,bloodType:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:p.map(h=>e.jsx("option",{value:h,children:h},h))})]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-[#0AE7F2]",children:"القياسات الجسدية"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الطول (سم)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s.height,onChange:h=>r({...s,height:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"100",max:"250"}),e.jsx(zt,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الوزن الحالي (كجم)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s.weight,onChange:h=>r({...s,weight:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"30",max:"200"}),e.jsx(Dr,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الوزن المستهدف (كجم)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s.targetWeight,onChange:h=>r({...s,targetWeight:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"30",max:"200"}),e.jsx(ot,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"الأهداف"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:b.map(h=>e.jsxs("label",{className:`flex items-center gap-3 p-4 rounded-xl cursor-pointer transition-all ${s.goals.includes(h.id)?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx("input",{type:"checkbox",checked:s.goals.includes(h.id),onChange:f=>{f.target.checked?r({...s,goals:[...s.goals,h.id]}):r({...s,goals:s.goals.filter(N=>N!==h.id)})},className:"hidden"}),e.jsx("span",{className:"text-2xl",children:h.icon}),e.jsx("span",{children:h.name})]},h.id))})]})]})]}),e.jsxs("div",{className:"mt-8 bg-[#0A0F1C]/40 rounded-xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-[#0AE7F2]",children:"خطة الاشتراك"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:g.map(h=>e.jsxs("label",{className:`block p-6 rounded-xl cursor-pointer transition-all ${s.plan===h.id?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-white":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx("input",{type:"radio",name:"plan",value:h.id,checked:s.plan===h.id,onChange:f=>r({...s,plan:f.target.value}),className:"hidden"}),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h4",{className:"text-lg font-bold",children:h.name}),e.jsxs("p",{className:"text-xl font-bold text-[#0AE7F2]",children:[h.price," ₪"]})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:h.duration}),e.jsx("ul",{className:"space-y-2 mt-auto",children:h.features.map((f,N)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-[#0AE7F2]",children:"✓"}),e.jsx("span",{children:f})]},N))})]})]},h.id))})]}),e.jsxs("div",{className:"flex gap-4 mt-8",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 py-4 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:l,className:"flex-1 py-4 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"جاري التسجيل..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{size:20}),e.jsx("span",{children:"تسجيل المتدرب"})]})})]})]})]})]})})}function yd({trainee:a,onClose:t,onSave:s}){const[r,n]=m.useState(a.targetSteps||3e3),[i,l]=m.useState(!1),[o,c]=m.useState(null),d=async()=>{try{if(l(!0),c(null),q()){const u=new Date().toISOString().split("T")[0],{data:x,error:g}=await S.from("trainee_steps").select("id").eq("trainee_id",a.id).eq("date",u).single();if(g&&g.code!=="PGRST116")throw g;if(x){const{error:p}=await S.from("trainee_steps").update({target_steps:r,updated_at:new Date().toISOString()}).eq("id",x.id);if(p)throw p}else{const{error:p}=await S.from("trainee_steps").insert({trainee_id:a.id,date:u,steps:0,target_steps:r});if(p)throw p}const{error:b}=await S.from("trainee_steps").update({target_steps:r,updated_at:new Date().toISOString()}).eq("trainee_id",a.id).gte("date",u);if(b)throw b}else{const x=JSON.parse(localStorage.getItem("trainees")||"[]").map(g=>g.id===a.id?{...g,targetSteps:r}:g);localStorage.setItem("trainees",JSON.stringify(x))}s({...a,targetSteps:r})}catch(u){console.error("Error updating target steps:",u),c(u instanceof Error?u.message:"حدث خطأ أثناء تحديث الخطوات المستهدفة")}finally{l(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-md",children:[e.jsx("div",{className:"p-6 border-b border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"إدارة الخطوات اليومية"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:e.jsx(ue,{size:24})})]})}),e.jsxs("div",{className:"p-6",children:[o&&e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6",children:o}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center",children:e.jsx(Oe,{size:24,className:"text-[#0AE7F2]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-400",children:a.email})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"الخطوات المستهدفة يومياً"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ot,{size:24,className:"text-[#0AE7F2]"}),e.jsx("input",{type:"number",value:r,onChange:u=>n(Math.max(1e3,Math.min(2e4,parseInt(u.target.value)||3e3))),className:"flex-1 bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",min:"1000",max:"20000",step:"500"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"يمكنك تعيين هدف يومي للخطوات بين 1000 و 20000 خطوة"})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"معلومات مفيدة"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[e.jsx("li",{children:"• متوسط الخطوات اليومية الموصى بها: 7000-10000 خطوة"}),e.jsx("li",{children:"• للمبتدئين: 3000-5000 خطوة"}),e.jsx("li",{children:"• للمتوسطين: 5000-7000 خطوة"}),e.jsx("li",{children:"• للمتقدمين: 8000-12000 خطوة"})]})]})]})]}),e.jsx("div",{className:"p-6 border-t border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:t,className:"flex-1 py-3 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:d,disabled:i,className:"flex-1 py-3 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[i?e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(qe,{size:20}),e.jsx("span",{children:"حفظ التغييرات"})]})]})})]})})}function wd(){const[a,t]=m.useState(""),[s,r]=m.useState([]),[n,i]=m.useState(!1),[l,o]=m.useState(!1),[c,d]=m.useState(!1),[u,x]=m.useState(!1),[g,b]=m.useState(!1),[p,v]=m.useState(null),[h,f]=m.useState(!0),[N,w]=m.useState(null);m.useEffect(()=>{j()},[]);const j=async()=>{try{if(f(!0),w(null),q()){const{data:z,error:I}=await S.from("trainee_profiles").select("*").order("created_at",{ascending:!1});if(I)throw I;const H=z.map(Q=>Q.id),{data:T,error:G}=await S.from("trainee_steps").select("trainee_id, target_steps").in("trainee_id",H).order("date",{ascending:!1});if(G)throw G;const X=new Map;T.forEach(Q=>{X.has(Q.trainee_id)||X.set(Q.trainee_id,Q.target_steps)});const ae=z.map(Q=>({id:Q.id,name:Q.name,email:Q.email,phone:Q.phone||"",plan:Q.subscription_plan,status:Q.status,joinDate:ct(new Date(Q.created_at),"yyyy-MM-dd"),height:Q.height||0,weight:Q.current_weight||0,targetWeight:Q.target_weight||0,fatPercentage:Q.fat_percentage||0,muscleMass:Q.muscle_mass||0,goals:Q.goal||[],currentWeight:Q.current_weight||0,initialWeight:Q.initial_weight||0,currentFat:Q.fat_percentage||0,initialFat:Q.fat_percentage||0,currentMuscle:Q.muscle_mass||0,initialMuscle:Q.muscle_mass||0,currentWaist:0,initialWaist:0,currentNeck:0,initialNeck:0,currentArm:0,initialArm:0,targetSteps:X.get(Q.id)||3e3}));r(ae)}else{const z=localStorage.getItem("trainees");if(z)r(JSON.parse(z));else{const I=[{id:Ie(),name:"أحمد محمد",email:"ahmed@example.com",phone:"970 59 123 4567",plan:"premium",status:"active",joinDate:"2024-03-15",currentWeight:80,initialWeight:85,currentFat:18,initialFat:22,currentMuscle:45,initialMuscle:40,currentWaist:85,initialWaist:90,currentNeck:38,initialNeck:40,currentArm:32,initialArm:30,targetSteps:3e3},{id:Ie(),name:"سارة علي",email:"sara@example.com",phone:"970 59 987 6543",plan:"basic",status:"pending",joinDate:"2024-03-14",currentWeight:65,initialWeight:70,currentFat:22,initialFat:25,currentMuscle:35,initialMuscle:30,currentWaist:70,initialWaist:75,currentNeck:32,initialNeck:33,currentArm:25,initialArm:24,targetSteps:5e3},{id:Ie(),name:"محمد خالد",email:"mohamed@example.com",phone:"970 59 456 7890",plan:"pro",status:"inactive",joinDate:"2024-03-13",currentWeight:90,initialWeight:95,currentFat:20,initialFat:24,currentMuscle:50,initialMuscle:45,currentWaist:95,initialWaist:100,currentNeck:42,initialNeck:44,currentArm:36,initialArm:34,targetSteps:4e3}];r(I),localStorage.setItem("trainees",JSON.stringify(I))}}}catch(z){console.error("Error fetching trainees:",z),w(z instanceof Error?z.message:"حدث خطأ أثناء تحميل المتدربين")}finally{f(!1)}},F=z=>{const I=s.find(H=>H.id===z);I&&(v(I),o(!0))},C=async(z,I)=>{try{if(f(!0),q()){const{error:H}=await S.from("trainee_profiles").update({name:I.name,email:I.email,phone:I.phone,subscription_plan:I.plan,height:I.height,current_weight:I.currentWeight,initial_weight:I.initialWeight,target_weight:I.targetWeight,fat_percentage:I.currentFat,muscle_mass:I.currentMuscle,goal:I.goals,status:I.status}).eq("id",z);if(H)throw H}else{const T=JSON.parse(localStorage.getItem("trainees")||"[]").map(G=>G.id===z?{...G,...I}:G);localStorage.setItem("trainees",JSON.stringify(T))}r(H=>H.map(T=>T.id===z?{...T,...I}:T)),o(!1),v(null)}catch(H){console.error("Error updating trainee:",H),alert(H instanceof Error?H.message:"حدث خطأ أثناء تحديث المتدرب")}finally{f(!1)}},A=async z=>{if(confirm("هل أنت متأكد من حذف هذا المتدرب؟"))try{if(f(!0),q()){const{error:I}=await S.from("trainee_profiles").delete().eq("id",z);if(I)throw I}else{const H=JSON.parse(localStorage.getItem("trainees")||"[]").filter(T=>T.id!==z);localStorage.setItem("trainees",JSON.stringify(H))}r(I=>I.filter(H=>H.id!==z))}catch(I){console.error("Error deleting trainee:",I),w(I instanceof Error?I.message:"حدث خطأ أثناء حذف المتدرب")}finally{f(!1)}},E=z=>{const I=s.find(H=>H.id===z);I&&(v(I),d(!0))},_=z=>{const I=s.find(H=>H.id===z);I&&(v(I),b(!0))},k=()=>{i(!1),j()},O=z=>{switch(z){case"active":return"text-emerald-500 bg-emerald-500/10";case"pending":return"text-amber-500 bg-amber-500/10";case"inactive":return"text-rose-500 bg-rose-500/10";default:return"text-gray-500 bg-gray-500/10"}},M=z=>{switch(z){case"active":return e.jsx(Se,{className:"w-4 h-4"});case"pending":return e.jsx(Re,{className:"w-4 h-4"});case"inactive":return e.jsx(os,{className:"w-4 h-4"});default:return null}},y=z=>{switch(z){case"active":return"نشط";case"pending":return"معلق";case"inactive":return"غير نشط";default:return z}},W=s.filter(z=>z.name.toLowerCase().includes(a.toLowerCase())||z.email.toLowerCase().includes(a.toLowerCase())||z.phone.includes(a));return e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-bold",children:"المتدربين"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx(Ue,{size:16,className:"text-white/60"})}),e.jsxs("button",{onClick:()=>i(!0),className:"bg-[#0AE7F2] text-black px-4 py-2 rounded-lg text-sm font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center gap-2",children:[e.jsx(ze,{size:16}),e.jsx("span",{children:"إضافة متدرب"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"w-5 h-5 text-white/40 absolute right-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",value:a,onChange:z=>t(z.target.value),placeholder:"البحث عن متدرب...",className:"w-full bg-white/5 border border-white/10 rounded-lg py-2 px-4 pr-10 text-white placeholder-white/40 focus:outline-none focus:border-[#0AE7F2]/50 transition-colors"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"المتدرب"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"البريد الإلكتروني"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"رقم الهاتف"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الخطة"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الحالة"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الوزن الحالي"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الخطوات المستهدفة"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"تاريخ الانضمام"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60"})]})}),e.jsx("tbody",{children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center py-8",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})})})}):N?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center py-8",children:e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl",children:[N,e.jsx("button",{onClick:j,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]})})}):W.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center py-8 text-gray-400",children:"لا توجد متدربين"})}):W.map(z=>e.jsxs("tr",{className:"border-b border-white/10 last:border-0",children:[e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#0AE7F2]/10 rounded-lg flex items-center justify-center",children:e.jsx(Ae,{size:16,className:"text-[#0AE7F2]"})}),e.jsx("span",{className:"font-medium",children:z.name})]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:z.email})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:z.phone})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:z.plan==="basic"?"الخطة الأساسية":z.plan==="premium"?"الخطة المتقدمة":z.plan==="pro"?"الخطة الاحترافية":z.plan})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${O(z.status)}`,children:[M(z.status),e.jsx("span",{children:y(z.status)})]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("span",{className:"text-sm",children:[z.currentWeight," كجم"]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("span",{className:"text-sm",children:[z.targetSteps," خطوة"]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:z.joinDate})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>F(z.id),className:"p-2 hover:bg-[#0AE7F2]/10 rounded-full transition-colors text-[#0AE7F2]",title:"تعديل البيانات",children:e.jsx($t,{size:16})}),e.jsx("button",{onClick:()=>{v(z),x(!0)},className:"p-2 hover:bg-[#0AE7F2]/10 rounded-full transition-colors text-[#0AE7F2]",title:"تعيين جدول",children:e.jsx(Ze,{size:16})}),e.jsx("button",{onClick:()=>E(z.id),className:"p-2 hover:bg-[#0AE7F2]/10 rounded-full transition-colors text-[#0AE7F2]",title:"عرض الأداء",children:e.jsx(Lr,{size:16})}),e.jsx("button",{onClick:()=>_(z.id),className:"p-2 hover:bg-[#0AE7F2]/10 rounded-full transition-colors text-[#0AE7F2]",title:"إدارة الخطوات",children:e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:()=>A(z.id),className:"p-2 hover:bg-rose-500/10 rounded-full transition-colors text-rose-500",title:"حذف المتدرب",children:e.jsx(Ft,{size:16})})]})})]},z.id))})]})}),n&&e.jsx(jd,{onSuccess:k,onCancel:()=>i(!1)}),l&&p&&e.jsx(ed,{trainee:p,onClose:()=>{o(!1),v(null)},onSave:C}),c&&p&&e.jsx(rd,{traineeId:p.id,onClose:()=>{d(!1),v(null)}}),u&&p&&e.jsx(vd,{traineeId:p.id,traineeName:p.name,onClose:()=>{x(!1),v(null)}}),g&&p&&e.jsx(yd,{trainee:p,onClose:()=>{b(!1),v(null)},onSave:z=>{r(I=>I.map(H=>H.id===z.id?{...H,targetSteps:z.targetSteps}:H)),b(!1),v(null)}})]})}function Nd(){const[a,t]=m.useState(""),[s,r]=m.useState([]),[n,i]=m.useState(!1),[l,o]=m.useState(!1),[c,d]=m.useState(null),[u,x]=m.useState({name:"",category:"chest",sets:3,reps:12}),[g,b]=m.useState(0),[p,v]=m.useState("file");m.useEffect(()=>{h()},[]);const h=async()=>{try{if(o(!0),q()){const{data:A,error:E}=await S.from("exercises").select("*").order("created_at",{ascending:!1});if(E)throw E;r(A||[])}else r([{id:"1",name:"بنش بريس",category:"chest",sets:4,reps:12,status:"active"},{id:"2",name:"سكوات",category:"legs",sets:3,reps:15,status:"active"},{id:"3",name:"ديدليفت",category:"back",sets:4,reps:10,status:"active"}])}catch(A){console.error("Error fetching exercises:",A),d(A instanceof Error?A.message:"حدث خطأ أثناء تحميل التمارين")}finally{o(!1)}},f=async A=>{if(!q())throw new Error("Database connection not available");const E=A.name.split(".").pop(),k=`exercise-videos/${`${Math.random()}.${E}`}`,{error:O,data:M}=await S.storage.from("videos").upload(k,A,{contentType:"video/mp4",upsert:!0,onUploadProgress:W=>{b(W.loaded/W.total*100)}});if(O)throw O;const{data:{publicUrl:y}}=S.storage.from("videos").getPublicUrl(k);return y},N=async()=>{try{o(!0),d(null);let A=u.videoUrl||"";if(p==="file"&&u.videoFile&&(A=await f(u.videoFile)),q()){const{data:E,error:_}=await S.from("exercises").insert([{name:u.name,category:u.category,sets:u.sets,reps:u.reps,description:u.description,video_url:A,status:"active"}]).select().single();if(_)throw _;r(k=>[E,...k])}else{const E={id:Date.now().toString(),name:u.name,category:u.category,sets:u.sets,reps:u.reps,status:"active",videoUrl:A};r(_=>[E,..._])}i(!1),w()}catch(A){console.error("Error adding exercise:",A),d(A instanceof Error?A.message:"حدث خطأ أثناء إضافة التمرين")}finally{o(!1),b(0)}},w=()=>{x({name:"",category:"chest",sets:3,reps:12}),d(null),v("file")},j=A=>{switch(A){case"active":return"text-emerald-500 bg-emerald-500/10";case"pending":return"text-amber-500 bg-amber-500/10";case"inactive":return"text-rose-500 bg-rose-500/10";default:return"text-gray-500 bg-gray-500/10"}},F=A=>{switch(A){case"active":return e.jsx(Se,{className:"w-4 h-4"});case"pending":return e.jsx(Re,{className:"w-4 h-4"});case"inactive":return e.jsx(os,{className:"w-4 h-4"});default:return null}},C=s.filter(A=>A.name.toLowerCase().includes(a.toLowerCase())||A.category.toLowerCase().includes(a.toLowerCase()));return e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-bold",children:"التمارين"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx(Ue,{size:16,className:"text-white/60"})}),e.jsxs("button",{onClick:()=>i(!0),className:"bg-[#0AE7F2] text-black px-4 py-2 rounded-lg text-sm font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center gap-2",children:[e.jsx(ze,{size:16}),e.jsx("span",{children:"إضافة تمرين"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"w-5 h-5 text-white/40 absolute right-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",value:a,onChange:A=>t(A.target.value),placeholder:"البحث عن تمرين...",className:"w-full bg-white/5 border border-white/10 rounded-lg py-2 px-4 pr-10 text-white placeholder-white/40 focus:outline-none focus:border-[#0AE7F2]/50"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"التمرين"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الفئة"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"المجموعات"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"التكرارات"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الحالة"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60"})]})}),e.jsx("tbody",{children:l?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})})})}):C.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-gray-400",children:"لا توجد تمارين"})}):C.map(A=>e.jsxs("tr",{className:"border-b border-white/10 last:border-0",children:[e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#0AE7F2]/10 rounded-lg flex items-center justify-center",children:e.jsx(Xe,{size:16,className:"text-[#0AE7F2]"})}),e.jsx("span",{className:"font-medium",children:A.name})]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:A.category})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:A.sets})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:A.reps})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${j(A.status)}`,children:[F(A.status),e.jsx("span",{children:A.status==="active"?"نشط":A.status==="pending"?"معلق":"غير نشط"})]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"p-1 hover:bg-white/5 rounded transition-colors",children:e.jsx(Nt,{size:16,className:"text-white/60"})}),e.jsx("button",{className:"p-1 hover:bg-white/5 rounded transition-colors",children:e.jsx(Ft,{size:16,className:"text-white/60"})})]})})]},A.id))})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-lg",children:[e.jsx("div",{className:"p-6 border-b border-[#0AE7F2]/20",children:e.jsx("h2",{className:"text-xl font-bold",children:"إضافة تمرين جديد"})}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:A=>{A.preventDefault(),N()},className:"space-y-4",children:[c&&e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:c}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"اسم التمرين"}),e.jsx("input",{type:"text",value:u.name,onChange:A=>x({...u,name:A.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الفئة"}),e.jsxs("select",{value:u.category,onChange:A=>x({...u,category:A.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,children:[e.jsx("option",{value:"chest",children:"الصدر"}),e.jsx("option",{value:"back",children:"الظهر"}),e.jsx("option",{value:"legs",children:"الأرجل"}),e.jsx("option",{value:"shoulders",children:"الأكتاف"}),e.jsx("option",{value:"arms",children:"الذراعين"}),e.jsx("option",{value:"abs",children:"البطن"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"المجموعات"}),e.jsx("input",{type:"number",value:u.sets,onChange:A=>x({...u,sets:Number(A.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"التكرارات"}),e.jsx("input",{type:"number",value:u.reps,onChange:A=>x({...u,reps:Number(A.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"1"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الوصف (اختياري)"}),e.jsx("textarea",{value:u.description||"",onChange:A=>x({...u,description:A.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2] h-24 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"فيديو التمرين"}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>v("file"),className:`flex-1 py-2 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors ${p==="file"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C] text-gray-400"}`,children:[e.jsx(Ns,{size:20}),e.jsx("span",{children:"رفع ملف"})]}),e.jsxs("button",{type:"button",onClick:()=>v("url"),className:`flex-1 py-2 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors ${p==="url"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C] text-gray-400"}`,children:[e.jsx(qa,{size:20}),e.jsx("span",{children:"رابط"})]})]}),p==="file"?e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"video/mp4",onChange:A=>{var _;const E=(_=A.target.files)==null?void 0:_[0];E&&x({...u,videoFile:E,videoUrl:void 0})},className:"hidden",id:"video-upload"}),e.jsxs("label",{htmlFor:"video-upload",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white flex items-center justify-center gap-2 cursor-pointer hover:bg-[#0A0F1C]/80 transition-colors",children:[e.jsx(Ns,{size:20,className:"text-[#0AE7F2]"}),e.jsx("span",{children:u.videoFile?u.videoFile.name:"اختر ملف فيديو"})]}),g>0&&g<100&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full",children:e.jsx("div",{className:"h-full bg-[#0AE7F2] rounded-full transition-all duration-300",style:{width:`${g}%`}})}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1 text-center",children:[Math.round(g),"%"]})]})]}):e.jsx("input",{type:"url",value:u.videoUrl||"",onChange:A=>x({...u,videoUrl:A.target.value,videoFile:void 0}),placeholder:"أدخل رابط الفيديو",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),w()},className:"flex-1 py-3 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:l,className:"flex-1 py-3 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50",children:l?"جاري الإضافة...":"إضافة التمرين"})]})]})})]})})]})}function Ed(){const[a,t]=m.useState(""),[s,r]=m.useState([]),[n,i]=m.useState(!1),[l,o]=m.useState(!0),[c,d]=m.useState(null),[u,x]=m.useState(null);m.useEffect(()=>{g()},[]);const g=async()=>{try{if(o(!0),d(null),q()){const{data:w,error:j}=await S.from("meals").select("*").order("created_at",{ascending:!1});if(j)throw j;r(w||[])}else r([{id:"1",name:"شوفان بالموز",calories:350,protein:12,carbs:45,fat:8,category:"breakfast",status:"active",description:"وجبة فطور صحية غنية بالألياف"},{id:"2",name:"صدر دجاج مشوي",calories:450,protein:35,carbs:20,fat:15,category:"lunch",status:"active",description:"وجبة غداء غنية بالبروتين"},{id:"3",name:"سلمون مشوي",calories:400,protein:30,carbs:15,fat:20,category:"dinner",status:"active",description:"وجبة عشاء صحية غنية بالأوميغا 3"},{id:"4",name:"سلطة خضراء",calories:150,protein:5,carbs:20,fat:8,category:"lunch",status:"active",description:"سلطة خضراء طازجة"},{id:"5",name:"عصير بروتين",calories:200,protein:25,carbs:15,fat:5,category:"snack",status:"active",description:"مشروب بروتين للتعافي بعد التمرين"}])}catch(w){console.error("Error fetching meals:",w),d(w instanceof Error?w.message:"حدث خطأ أثناء تحميل الوجبات")}finally{o(!1)}},b=async w=>{try{if(o(!0),q()){const{data:j,error:F}=await S.from("meals").insert([{name:w.name,calories:w.calories,protein:w.protein,carbs:w.carbs,fat:w.fat,description:w.description,category:w.category,status:"active"}]).select().single();if(F)throw F;r(C=>[j,...C])}else{const j={id:Date.now().toString(),name:w.name,calories:w.calories,protein:w.protein,carbs:w.carbs,fat:w.fat,description:w.description,category:w.category,status:"active"};r(F=>[j,...F])}i(!1)}catch(j){console.error("Error adding meal:",j),alert("حدث خطأ أثناء إضافة الوجبة")}finally{o(!1)}},p=w=>{x(w),i(!0)},v=async w=>{if(u)try{if(o(!0),q()){const{error:j}=await S.from("meals").update({name:w.name,calories:w.calories,protein:w.protein,carbs:w.carbs,fat:w.fat,description:w.description,category:w.category}).eq("id",u.id);if(j)throw j}r(j=>j.map(F=>F.id===u.id?{...F,...w}:F)),i(!1),x(null)}catch(j){console.error("Error updating meal:",j),alert("حدث خطأ أثناء تحديث الوجبة")}finally{o(!1)}},h=async w=>{if(confirm("هل أنت متأكد من حذف هذه الوجبة؟"))try{if(o(!0),q()){const{error:j}=await S.from("meals").delete().eq("id",w);if(j)throw j}r(j=>j.filter(F=>F.id!==w))}catch(j){console.error("Error deleting meal:",j),alert("حدث خطأ أثناء حذف الوجبة")}finally{o(!1)}},f=w=>{switch(w){case"breakfast":return"الفطور";case"lunch":return"الغداء";case"dinner":return"العشاء";case"snack":return"وجبة خفيفة";default:return w}},N=s.filter(w=>w.name.toLowerCase().includes(a.toLowerCase())||f(w.category).includes(a));return e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-bold",children:"الوجبات"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx(Ue,{size:16,className:"text-white/60"})}),e.jsxs("button",{onClick:()=>{x(null),i(!0)},className:"bg-[#0AE7F2] text-black px-4 py-2 rounded-lg text-sm font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center gap-2",children:[e.jsx(ze,{size:16}),e.jsx("span",{children:"إضافة وجبة"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"w-5 h-5 text-white/40 absolute right-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",value:a,onChange:w=>t(w.target.value),placeholder:"البحث عن وجبة...",className:"w-full bg-white/5 border border-white/10 rounded-lg py-2 px-4 pr-10 text-white placeholder-white/40 focus:outline-none focus:border-[#0AE7F2]/50 transition-colors"})]})]}),e.jsx("div",{className:"overflow-y-auto max-h-[70vh] px-6",children:l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):c?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:[c,e.jsx("button",{onClick:g,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]})}):N.length===0?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"لا توجد وجبات"}):e.jsxs("table",{className:"w-full min-w-[700px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الوجبة"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"التصنيف"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"السعرات"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"البروتين"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الكربوهيدرات"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الدهون"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60"})]})}),e.jsx("tbody",{children:N.map(w=>e.jsxs("tr",{className:"border-b border-white/10 last:border-0",children:[e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#0AE7F2]/10 rounded-lg flex items-center justify-center",children:e.jsx(Be,{size:16,className:"text-[#0AE7F2]"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:w.name}),w.description&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:w.description})]})]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:f(w.category)})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:w.calories})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("span",{className:"text-sm",children:[w.protein,"g"]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("span",{className:"text-sm",children:[w.carbs,"g"]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("span",{className:"text-sm",children:[w.fat,"g"]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>p(w),className:"p-1 hover:bg-[#0AE7F2]/10 rounded transition-colors text-[#0AE7F2]",children:e.jsx(Nt,{size:16})}),e.jsx("button",{onClick:()=>h(w.id),className:"p-1 hover:bg-rose-500/10 rounded transition-colors text-rose-500",children:e.jsx(Ft,{size:16})})]})})]},w.id))})]})}),n&&e.jsx(ka,{onClose:()=>{i(!1),x(null)},onSubmit:u?v:b,initialData:u||void 0})]})}function Ad(){const[a,t]=m.useState(""),[s,r]=m.useState([{id:"1",name:"الخطة الأساسية",price:99,duration:"1 شهر",features:["برنامج تدريبي","برنامج غذائي","متابعة يومية"],status:"active"},{id:"2",name:"الخطة المتقدمة",price:199,duration:"3 شهور",features:["برنامج تدريبي متقدم","برنامج غذائي مخصص","متابعة يومية","جلسات خاصة"],status:"active"},{id:"3",name:"الخطة الاحترافية",price:299,duration:"6 شهور",features:["برنامج تدريبي احترافي","برنامج غذائي احترافي","متابعة مستمرة","جلسات خاصة","استشارات غير محدودة"],status:"active"}]),[n,i]=m.useState(!1),[l,o]=m.useState(null),[c,d]=m.useState({name:"",price:0,duration:"",features:[]}),u=h=>{o(h),d({name:h.name,price:h.price,duration:h.duration,features:h.features}),i(!0)},x=()=>{o(null),d({name:"",price:0,duration:"",features:[]}),i(!0)},g=()=>{if(l)r(h=>h.map(f=>f.id===l.id?{...f,...c}:f));else{const h={id:Date.now().toString(),...c,status:"active"};r(f=>[...f,h])}i(!1)},b=h=>{confirm("هل أنت متأكد من حذف هذه العضوية؟")&&r(f=>f.filter(N=>N.id!==h))},p=h=>{switch(h){case"active":return"text-emerald-500 bg-emerald-500/10";case"pending":return"text-amber-500 bg-amber-500/10";case"inactive":return"text-rose-500 bg-rose-500/10";default:return"text-gray-500 bg-gray-500/10"}},v=h=>{switch(h){case"active":return e.jsx(Se,{className:"w-4 h-4"});case"pending":return e.jsx(Re,{className:"w-4 h-4"});case"inactive":return e.jsx(os,{className:"w-4 h-4"});default:return null}};return e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10",children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-bold",children:"العضويات"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-white/5 rounded-lg transition-colors",children:e.jsx(Ue,{size:16,className:"text-white/60"})}),e.jsxs("button",{onClick:x,className:"bg-[#0AE7F2] text-black px-4 py-2 rounded-lg text-sm font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center gap-2",children:[e.jsx(ze,{size:16}),e.jsx("span",{children:"إضافة عضوية"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"w-5 h-5 text-white/40 absolute right-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",value:a,onChange:h=>t(h.target.value),placeholder:"البحث عن عضوية...",className:"w-full bg-white/5 border border-white/10 rounded-lg py-2 px-4 pr-10 text-white placeholder-white/40 focus:outline-none focus:border-[#0AE7F2]/50"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"العضوية"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"السعر"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"المدة"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"المميزات"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الحالة"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60"})]})}),e.jsx("tbody",{children:s.map(h=>e.jsxs("tr",{className:"border-b border-white/10 last:border-0",children:[e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#0AE7F2]/10 rounded-lg flex items-center justify-center",children:e.jsx(As,{size:16,className:"text-[#0AE7F2]"})}),e.jsx("span",{className:"font-medium",children:h.name})]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("span",{className:"text-sm",children:["₪",h.price]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:h.duration})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:h.features.map((f,N)=>e.jsx("span",{className:"text-xs bg-[#0AE7F2]/10 text-[#0AE7F2] px-2 py-1 rounded-full",children:f},N))})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${p(h.status)}`,children:[v(h.status),e.jsx("span",{children:h.status==="active"?"نشط":h.status==="pending"?"معلق":"غير نشط"})]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>u(h),className:"p-2 hover:bg-[#0AE7F2]/10 rounded-full transition-colors text-[#0AE7F2]",children:e.jsx(Nt,{size:16})}),e.jsx("button",{onClick:()=>b(h.id),className:"p-2 hover:bg-rose-500/10 rounded-full transition-colors text-rose-500",children:e.jsx(Ft,{size:16})})]})})]},h.id))})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-lg",children:[e.jsx("div",{className:"p-6 border-b border-[#0AE7F2]/20",children:e.jsx("h2",{className:"text-xl font-bold",children:l?"تعديل العضوية":"إضافة عضوية جديدة"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"اسم العضوية"}),e.jsx("input",{type:"text",value:c.name,onChange:h=>d({...c,name:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"السعر"}),e.jsx("input",{type:"number",value:c.price,onChange:h=>d({...c,price:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"المدة"}),e.jsx("input",{type:"text",value:c.duration,onChange:h=>d({...c,duration:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,placeholder:"مثال: 3 شهور"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"المميزات (افصل بين المميزات بسطر جديد)"}),e.jsx("textarea",{value:c.features.join(`
`),onChange:h=>d({...c,features:h.target.value.split(`
`).filter(f=>f.trim())}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2] h-32 resize-none",required:!0})]})]}),e.jsx("div",{className:"p-6 border-t border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>i(!1),className:"flex-1 py-3 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:g,className:"flex-1 py-3 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors",children:l?"حفظ التغييرات":"إضافة العضوية"})]})})]})})]})}function Fd(){const[a,t]=m.useState("security"),[s,r]=m.useState(""),[n,i]=m.useState(""),[l,o]=m.useState(""),[c,d]=m.useState(!1),[u,x]=m.useState(!1),[g,b]=m.useState(null),[p,v]=m.useState(null),h=[{id:"endpoints",label:"نقاط النهاية",icon:qs},{id:"general",label:"إعدادات عامة",icon:$t},{id:"security",label:"إعدادات الأمان",icon:Ba},{id:"notifications",label:"إعدادات الإشعارات",icon:Me},{id:"appearance",label:"إعدادات المظهر",icon:Ha}],f=[{name:"نظرة عامة",endpoint:"/admin-api/stats",methods:["GET"]},{name:"المتدربين",endpoint:"/admin-api/trainees",methods:["GET","POST","PUT","DELETE"]},{name:"التمارين",endpoint:"/admin-api/exercises",methods:["GET","POST","PUT","DELETE"]},{name:"الوجبات",endpoint:"/admin-api/meals",methods:["GET","POST","PUT","DELETE"]},{name:"المحادثات",endpoint:"/admin-api/chat",methods:["GET","POST"]},{name:"الإشعارات",endpoint:"/admin-api/notifications",methods:["GET","POST","PUT","DELETE"]},{name:"العضويات",endpoint:"/admin-api/memberships",methods:["GET","POST","PUT","DELETE"]},{name:"الإعدادات العامة",endpoint:"/admin-api/settings/general",methods:["GET","PUT"]},{name:"إعدادات الأمان",endpoint:"/admin-api/settings/security",methods:["GET","PUT"]},{name:"إعدادات الإشعارات",endpoint:"/admin-api/settings/notifications",methods:["GET","PUT"]},{name:"إعدادات المظهر",endpoint:"/admin-api/settings/appearance",methods:["GET","PUT"]}],N=async j=>{if(j.preventDefault(),b(null),v(null),n!==l){b("كلمات المرور غير متطابقة");return}if(!/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(n)){b("كلمة المرور يجب أن تحتوي على 8 أحرف على الأقل، حرف كبير، حرف صغير، رقم وحرف خاص");return}try{x(!0);const{data:C,error:A}=await S.rpc("update_admin_password",{admin_email:"mk@powerhouse.com",current_password:s,new_password:n});if(A)throw A;if(!C)throw new Error("كلمة المرور الحالية غير صحيحة");v("تم تغيير كلمة المرور بنجاح"),r(""),i(""),o("")}catch(C){console.error("Error changing password:",C),b(C instanceof Error?C.message:"حدث خطأ أثناء تغيير كلمة المرور")}finally{x(!1)}},w=()=>{switch(a){case"endpoints":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl p-6 border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"نقاط النهاية المتاحة"}),e.jsx("div",{className:"space-y-4",children:f.map((j,F)=>e.jsxs("div",{className:"bg-[#0A0F1C] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:j.name}),e.jsx("div",{className:"flex gap-2",children:j.methods.map(C=>e.jsx("span",{className:`text-xs px-2 py-1 rounded ${C==="GET"?"bg-emerald-500/20 text-emerald-400":C==="POST"?"bg-blue-500/20 text-blue-400":C==="PUT"?"bg-amber-500/20 text-amber-400":"bg-rose-500/20 text-rose-400"}`,children:C},C))})]}),e.jsx("p",{className:"text-[#0AE7F2] text-sm font-mono",children:j.endpoint})]},F))})]})});case"general":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl p-6 border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"معلومات التطبيق"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"اسم التطبيق"}),e.jsx("input",{type:"text",defaultValue:"MK",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"وصف التطبيق"}),e.jsx("textarea",{defaultValue:"منصة تدريب رياضي متكاملة",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2] h-24 resize-none"})]})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl p-6 border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"معلومات التواصل"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",defaultValue:"contact@powerhouse.com",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"رقم الهاتف"}),e.jsx("input",{type:"tel",defaultValue:"+970 59 123 4567",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]})]})]})]});case"security":return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl p-6 border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"تغيير كلمة المرور"}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[g&&e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:g}),p&&e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500 text-emerald-500 p-4 rounded-xl text-center",children:p}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"كلمة المرور الحالية"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:c?"text":"password",value:s,onChange:j=>r(j.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:c?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:c?"text":"password",value:n,onChange:j=>i(j.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:c?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"تأكيد كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:c?"text":"password",value:l,onChange:j=>o(j.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:c?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50",children:u?"جاري تغيير كلمة المرور...":"تغيير كلمة المرور"})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl p-6 border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"إعدادات الأمان الأخرى"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#0A0F1C] rounded-xl",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"المصادقة الثنائية"}),e.jsx("p",{className:"text-sm text-gray-400",children:"تفعيل المصادقة الثنائية لحماية إضافية"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0AE7F2]"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#0A0F1C] rounded-xl",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"تأكيد البريد الإلكتروني"}),e.jsx("p",{className:"text-sm text-gray-400",children:"طلب تأكيد البريد الإلكتروني عند التسجيل"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0AE7F2]"})]})]})]})]})]});case"notifications":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl p-6 border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"إعدادات الإشعارات"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#0A0F1C] rounded-xl",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"إشعارات البريد الإلكتروني"}),e.jsx("p",{className:"text-sm text-gray-400",children:"إرسال إشعارات عبر البريد الإلكتروني"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0AE7F2]"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#0A0F1C] rounded-xl",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"إشعارات التطبيق"}),e.jsx("p",{className:"text-sm text-gray-400",children:"إشعارات داخل التطبيق"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0AE7F2]"})]})]})]})]})});case"appearance":return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl p-6 border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"إعدادات المظهر"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"المظهر"}),e.jsxs("select",{className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:[e.jsx("option",{value:"dark",children:"داكن"}),e.jsx("option",{value:"light",children:"فاتح"}),e.jsx("option",{value:"system",children:"حسب النظام"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"اللون الرئيسي"}),e.jsx("div",{className:"grid grid-cols-5 gap-4",children:["#0AE7F2","#F20A0A","#0AF20A","#F2A70A","#A70AF2"].map(j=>e.jsx("button",{className:"w-full aspect-square rounded-xl border-2 border-transparent hover:border-white/20 transition-colors",style:{backgroundColor:j}},j))})]})]})]})});default:return null}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4",children:h.map(j=>e.jsxs("button",{onClick:()=>t(j.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition-colors ${a===j.id?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/60 text-gray-400 hover:text-white"}`,children:[e.jsx(j.icon,{size:20}),e.jsx("span",{children:j.label})]},j.id))}),w()]})}function _d({onBack:a}){const t=de(),[s,r]=m.useState(!0),[n,i]=m.useState(null),[l,o]=m.useState([]),[c,d]=m.useState(""),[u,x]=m.useState(!1),[g,b]=m.useState(""),[p,v]=m.useState(null);m.useEffect(()=>{h()},[]);const h=async()=>{try{if(r(!0),i(null),q()){const{data:k,error:O}=await S.from("trainee_profiles").select("id, name, email").neq("email","mk@powerhouse.com");if(O)throw O;const M=new Date().toISOString().split("T")[0],{data:y,error:W}=await S.from("trainee_steps").select("*").eq("date",M);if(W)throw W;const z=new Map;y==null||y.forEach(H=>{z.set(H.trainee_id,H)});const I=k.map(H=>{const T=z.get(H.id);return{id:(T==null?void 0:T.id)||`temp-${H.id}`,traineeId:H.id,traineeName:H.name,date:M,steps:(T==null?void 0:T.steps)||0,targetSteps:(T==null?void 0:T.target_steps)||3e3,progress:T?Math.round(T.steps/T.target_steps*100):0}});o(I)}else{const k=[{id:"1",traineeId:"1",traineeName:"أحمد محمد",date:new Date().toISOString().split("T")[0],steps:5432,targetSteps:8e3,progress:68},{id:"2",traineeId:"2",traineeName:"سارة علي",date:new Date().toISOString().split("T")[0],steps:7890,targetSteps:1e4,progress:79},{id:"3",traineeId:"3",traineeName:"محمد خالد",date:new Date().toISOString().split("T")[0],steps:3245,targetSteps:5e3,progress:65},{id:"4",traineeId:"4",traineeName:"فاطمة أحمد",date:new Date().toISOString().split("T")[0],steps:9876,targetSteps:12e3,progress:82},{id:"5",traineeId:"5",traineeName:"عمر حسن",date:new Date().toISOString().split("T")[0],steps:2345,targetSteps:6e3,progress:39}];o(k)}}catch(k){console.error("Error fetching steps data:",k),i("حدث خطأ أثناء تحميل بيانات الخطوات")}finally{r(!1)}},f=k=>{o(O=>O.map(M=>M.id===k?{...M,isEditing:!0}:M))},N=k=>{o(O=>O.map(M=>M.id===k?{...M,isEditing:!1}:M))},w=(k,O)=>{o(M=>M.map(y=>y.id===k?{...y,targetSteps:Math.max(1e3,Math.min(2e4,O))}:y))},j=async k=>{try{v(k);const O=l.find(M=>M.id===k);if(!O)return;if(q()){if(k.startsWith("temp-")){const{error:M}=await S.from("trainee_steps").insert({trainee_id:O.traineeId,date:O.date,steps:O.steps,target_steps:O.targetSteps});if(M)throw M}else{const{error:M}=await S.from("trainee_steps").update({target_steps:O.targetSteps,updated_at:new Date().toISOString()}).eq("id",k);if(M)throw M}await S.rpc("update_trainee_target_steps",{p_trainee_id:O.traineeId,p_target_steps:O.targetSteps})}o(M=>M.map(y=>y.id===k?{...y,isEditing:!1}:y))}catch(O){console.error("Error saving target steps:",O),i("حدث خطأ أثناء حفظ الخطوات المستهدفة")}finally{v(null)}},F=l.filter(k=>{const O=k.traineeName.toLowerCase().includes(c.toLowerCase()),M=!g||k.date===g;return O&&M}),C=k=>k>=100?"bg-emerald-500":k>=75?"bg-[#0AE7F2]":k>=50?"bg-amber-500":"bg-rose-500",A=k=>k>=100?"text-emerald-500":k>=75?"text-[#0AE7F2]":k>=50?"text-amber-500":"text-rose-500",E=()=>{const k=["اسم المتدرب","التاريخ","الخطوات","الخطوات المستهدفة","نسبة الإنجاز"],O=F.map(I=>[I.traineeName,I.date,I.steps.toString(),I.targetSteps.toString(),`${I.progress}%`]),M=[k.join(","),...O.map(I=>I.join(","))].join(`
`),y=new Blob([M],{type:"text/csv;charset=utf-8;"}),W=URL.createObjectURL(y),z=document.createElement("a");z.setAttribute("href",W),z.setAttribute("download",`خطوات_المتدربين_${new Date().toISOString().split("T")[0]}.csv`),z.style.visibility="hidden",document.body.appendChild(z),z.click(),document.body.removeChild(z)},_=()=>{a?a():t("/admin")};return e.jsxs("div",{dir:"rtl",className:"min-h-screen bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"fixed inset-0 z-0 opacity-5",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415L51.8 0h2.827zM5.373 0l-.83.828L5.96 2.243 8.2 0H5.374zM48.97 0l3.657 3.657-1.414 1.414L46.143 0h2.828zM11.03 0L7.372 3.657 8.787 5.07 13.857 0H11.03zm32.284 0L49.8 6.485 48.384 7.9l-7.9-7.9h2.83zM16.686 0L10.2 6.485 11.616 7.9l7.9-7.9h-2.83zM22.344 0L13.858 8.485 15.272 9.9l9.9-9.9h-2.828zM32 0l-9.9 9.9 1.414 1.414L33.414 1.414 32 0zm-3.172 0L19.757 9.071l1.415 1.414L31.243 0h-2.415zm-5.656 0L14.343 8.828l1.415 1.415L25.586 0h-2.415zm-5.656 0L8.687 8.828 10.1 10.243 20.93 0h-3.414zM28.828 0L27.414 1.414 33.414 7.414V0h-4.586zm-9.656 0L17.757 1.414 23.757 7.414V0h-4.585zm-9.657 0L8.1 1.414l6 6V0H9.516zM0 0c0 .828.635 1.5 1.414 1.5.793 0 1.414-.672 1.414-1.5H0zm0 4.172l4.172 4.172 1.415-1.415L1.414 2.757 0 4.172zm0 5.656l9.828 9.828 1.414-1.414L1.414 8.414 0 9.828zm0 5.656l14.485 14.485 1.414-1.414L1.414 14.07 0 15.485zm0 5.657l19.142 19.142 1.414-1.414L1.414 19.728 0 21.142zm0 5.657l23.8 23.8 1.414-1.414L1.414 25.385 0 26.8zm0 5.657l28.456 28.457 1.414-1.414L1.414 31.042 0 32.456zm0 5.657l33.113 33.114 1.414-1.414L1.414 36.7 0 38.113zm0 5.657l37.77 37.77 1.415-1.414L1.414 42.356 0 43.77zm0 5.657l42.427 42.428 1.414-1.414L1.414 48.013 0 49.427zm0 5.657l47.084 47.085 1.414-1.414L1.414 53.67 0 55.084zm0 5.657l51.741 51.741 1.414-1.414L1.414 59.327 0 60.741zm0 5.657l56.398 56.398 1.414-1.414L1.414 65.084 0 66.498zm60.741 0L0 5.757 1.414 4.343 60.74 63.67l-1.414 1.414z' fill='%23ffffff' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E")`,backgroundSize:"30px 30px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-[#1A1F2E]/80 backdrop-blur-lg border-b border-[#0AE7F2]/20",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:_,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h1",{className:"text-xl font-bold",children:"جدول الخطوات المستهدفة"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:h,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(Os,{size:20,className:`text-[#0AE7F2] ${s?"animate-spin":""}`})}),e.jsx("button",{onClick:E,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(Va,{size:20,className:"text-[#0AE7F2]"})})]})]})})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"البحث والتصفية"}),e.jsx("button",{onClick:()=>x(!u),className:"bg-[#0AE7F2]/10 text-[#0AE7F2] p-2 rounded-lg hover:bg-[#0AE7F2]/20 transition-colors",children:e.jsx(Ue,{size:20})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(je,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",value:c,onChange:k=>d(k.target.value),placeholder:"البحث عن متدرب...",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white placeholder-gray-400 focus:outline-none focus:border-[#0AE7F2]"})]}),u&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"التاريخ"}),e.jsx("input",{type:"date",value:g,onChange:k=>b(k.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]})})]}),e.jsx("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:s&&!l.length?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Fe,{size:40,className:"text-[#0AE7F2] animate-spin"})}):n?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:[n,e.jsx("button",{onClick:h,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]})}):F.length===0?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"لا توجد بيانات مطابقة للبحث"}):e.jsxs("table",{className:"w-full min-w-[700px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"المتدرب"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"التاريخ"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الخطوات"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الخطوات المستهدفة"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"نسبة الإنجاز"}),e.jsx("th",{className:"text-right py-3 px-6 text-sm font-medium text-white/60",children:"الإجراءات"})]})}),e.jsx("tbody",{children:F.map(k=>e.jsxs("tr",{className:"border-b border-white/10 last:border-0",children:[e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#0AE7F2]/10 rounded-lg flex items-center justify-center",children:e.jsx(Oe,{size:16,className:"text-[#0AE7F2]"})}),e.jsx("span",{className:"font-medium",children:k.traineeName})]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:ct(k.date,"yyyy-MM-dd")})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("span",{className:"text-sm",children:k.steps.toLocaleString()})}),e.jsx("td",{className:"py-3 px-6",children:k.isEditing?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:k.targetSteps,onChange:O=>w(k.id,parseInt(O.target.value)||3e3),className:"w-24 bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-lg p-1 text-white text-center focus:outline-none focus:border-[#0AE7F2]",min:"1000",max:"20000",step:"500"}),e.jsx("span",{className:"text-sm text-gray-400",children:"خطوة"})]}):e.jsxs("span",{className:"text-sm",children:[k.targetSteps.toLocaleString()," خطوة"]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${C(k.progress)} rounded-full`,style:{width:`${Math.min(100,k.progress)}%`}})}),e.jsxs("span",{className:`text-sm font-medium ${A(k.progress)}`,children:[k.progress,"%"]})]})}),e.jsx("td",{className:"py-3 px-6",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:k.isEditing?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j(k.id),disabled:p===k.id,className:"p-2 bg-[#0AE7F2]/10 hover:bg-[#0AE7F2]/20 rounded-lg transition-colors text-[#0AE7F2]",children:p===k.id?e.jsx(Fe,{size:16,className:"animate-spin"}):e.jsx(qe,{size:16})}),e.jsx("button",{onClick:()=>N(k.id),className:"p-2 bg-rose-500/10 hover:bg-rose-500/20 rounded-lg transition-colors text-rose-500",children:e.jsx(ue,{size:16})})]}):e.jsx("button",{onClick:()=>f(k.id),className:"p-2 bg-[#0AE7F2]/10 hover:bg-[#0AE7F2]/20 rounded-lg transition-colors text-[#0AE7F2]",children:e.jsx(Nt,{size:16})})})})]},k.id))})]})})}),!s&&F.length>0&&e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6 mt-6",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"ملخص الخطوات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Oe,{size:20,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"font-medium",children:"إجمالي الخطوات"})]}),e.jsx("p",{className:"text-2xl font-bold text-[#0AE7F2]",children:F.reduce((k,O)=>k+O.steps,0).toLocaleString()})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ot,{size:20,className:"text-[#0AE7F2]"}),e.jsx("h3",{className:"font-medium",children:"متوسط الخطوات المستهدفة"})]}),e.jsx("p",{className:"text-2xl font-bold text-[#0AE7F2]",children:Math.round(F.reduce((k,O)=>k+O.targetSteps,0)/F.length).toLocaleString()})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-[#0AE7F2] flex items-center justify-center",children:e.jsx("span",{className:"text-black text-xs font-bold",children:"%"})}),e.jsx("h3",{className:"font-medium",children:"متوسط نسبة الإنجاز"})]}),e.jsxs("p",{className:"text-2xl font-bold text-[#0AE7F2]",children:[Math.round(F.reduce((k,O)=>k+O.progress,0)/F.length),"%"]})]})]})]})]})]})]})}const kd=async()=>{if(!q())return{totalUsers:1250,activeUsers:856,totalRevenue:15600,newSubscriptions:28,subscriptionDistribution:{basic:450,premium:320,pro:86},statusDistribution:{active:856,pending:245,inactive:149},averageWeight:75.5,averageProgress:68.3,totalMeals:156,totalExercises:42};try{const{data:a,error:t}=await S.from("trainee_profiles").select("status, subscription_plan, current_weight, initial_weight, target_weight, created_at");if(t)throw t;const{count:s,error:r}=await S.from("meals").select("id",{count:"exact",head:!0});if(r)throw r;const{count:n,error:i}=await S.from("exercises").select("id",{count:"exact",head:!0});if(i)throw i;return{totalUsers:a.length,activeUsers:a.filter(o=>o.status==="active").length,totalRevenue:a.reduce((o,c)=>o+({basic:99,premium:199,pro:299}[c.subscription_plan]||0),0),newSubscriptions:a.filter(o=>{const c=new Date;return c.setDate(c.getDate()-30),new Date(o.created_at)>=c}).length,subscriptionDistribution:{basic:a.filter(o=>o.subscription_plan==="basic").length,premium:a.filter(o=>o.subscription_plan==="premium").length,pro:a.filter(o=>o.subscription_plan==="pro").length},statusDistribution:{active:a.filter(o=>o.status==="active").length,pending:a.filter(o=>o.status==="pending").length,inactive:a.filter(o=>o.status==="inactive").length},averageWeight:a.reduce((o,c)=>o+(c.current_weight||0),0)/a.length||0,averageProgress:a.reduce((o,c)=>{if(c.initial_weight&&c.current_weight&&c.target_weight&&c.initial_weight>c.target_weight){const d=(c.initial_weight-c.current_weight)/(c.initial_weight-c.target_weight)*100;return o+d}return o},0)/a.length||0,totalMeals:s||0,totalExercises:n||0}}catch(a){return console.error("Error fetching admin stats:",a),{totalUsers:1250,activeUsers:856,totalRevenue:15600,newSubscriptions:28,subscriptionDistribution:{basic:450,premium:320,pro:86},statusDistribution:{active:856,pending:245,inactive:149},averageWeight:75.5,averageProgress:68.3,totalMeals:156,totalExercises:42}}};function Sd({onBack:a}){const t=de(),[s,r]=m.useState(!1),[n,i]=m.useState(!0),[l,o]=m.useState("overview"),[c,d]=m.useState(null),[u,x]=m.useState(!0),[g,b]=m.useState(null),[p,v]=m.useState({totalUsers:0,activeUsers:0,totalRevenue:0,newSubscriptions:0,subscriptionDistribution:{basic:0,premium:0,pro:0},statusDistribution:{active:0,pending:0,inactive:0},averageWeight:0,averageProgress:0,totalMeals:0,totalExercises:0});m.useEffect(()=>{l==="overview"&&h()},[l]);const h=async()=>{try{x(!0),b(null),await Js();const F=await kd();v(F)}catch(F){console.error("Error loading stats:",F),b(F instanceof Error?F.message:"حدث خطأ أثناء تحميل البيانات")}finally{x(!1)}},f=[{id:"overview",icon:bt,label:"نظرة عامة",endpoint:"/admin-api/stats",methods:["GET"]},{id:"trainees",icon:bt,label:"المتدربين",endpoint:"/admin-api/trainees",methods:["GET","POST","PUT","DELETE"]},{id:"exercises",icon:Lr,label:"التمارين",endpoint:"/admin-api/exercises",methods:["GET","POST","PUT","DELETE"]},{id:"meals",icon:Ze,label:"الوجبات",endpoint:"/admin-api/meals",methods:["GET","POST","PUT","DELETE"]},{id:"steps",icon:Oe,label:"الخطوات",endpoint:"/admin-api/steps",methods:["GET","PUT"]},{id:"chat",icon:is,label:"المحادثات",endpoint:"/admin-api/chat",methods:["GET","POST"]},{id:"notifications",icon:Me,label:"الإشعارات",endpoint:"/admin-api/notifications",methods:["GET","POST","PUT","DELETE"]},{id:"memberships",icon:Zs,label:"العضويات",endpoint:"/admin-api/memberships",methods:["GET","POST","PUT","DELETE"]},{id:"settings",icon:$t,label:"إعدادات التطبيق",endpoint:"/admin-api/settings",methods:["GET","PUT"],subEndpoints:[{label:"إعدادات عامة",endpoint:"/admin-api/settings/general",methods:["GET","PUT"]},{label:"إعدادات الأمان",endpoint:"/admin-api/settings/security",methods:["GET","PUT"]},{label:"إعدادات الإشعارات",endpoint:"/admin-api/settings/notifications",methods:["GET","PUT"]},{label:"إعدادات المظهر",endpoint:"/admin-api/settings/appearance",methods:["GET","PUT"]}]}],N=()=>{localStorage.removeItem("userType"),window.location.href="/admin/login"},w=F=>{switch(F){case"chat":t("/admin/chat");break;case"notifications":t("/admin/notifications");break;default:o(F)}},j=()=>{switch(l){case"overview":return e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:u?e.jsx("div",{className:"col-span-4 flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{className:"w-6 h-6 text-[#0AE7F2] animate-spin"}),e.jsx("span",{className:"text-gray-400",children:"جاري تحميل البيانات..."})]})}):g?e.jsxs("div",{className:"col-span-4 bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center",children:[g,e.jsx("button",{onClick:h,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-emerald-500/10 p-3 rounded-xl",children:e.jsx(bt,{className:"w-6 h-6 text-emerald-500"})}),e.jsx(et,{className:"w-5 h-5 text-emerald-500"})]}),e.jsx("p",{className:"text-sm text-white/60 mb-1",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold",children:p.totalUsers})]}),e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-blue-500/10 p-3 rounded-xl",children:e.jsx(bt,{className:"w-6 h-6 text-blue-500"})}),e.jsx(et,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-sm text-white/60 mb-1",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold",children:p.activeUsers})]}),e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-amber-500/10 p-3 rounded-xl",children:e.jsx(Zs,{className:"w-6 h-6 text-amber-500"})}),e.jsx(et,{className:"w-5 h-5 text-amber-500"})]}),e.jsx("p",{className:"text-sm text-white/60 mb-1",children:"إجمالي الإيرادات"}),e.jsxs("p",{className:"text-2xl font-bold",children:["₪",p.totalRevenue]})]}),e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-purple-500/10 p-3 rounded-xl",children:e.jsx(bt,{className:"w-6 h-6 text-purple-500"})}),e.jsx(et,{className:"w-5 h-5 text-purple-500"})]}),e.jsx("p",{className:"text-sm text-white/60 mb-1",children:"اشتراكات جديدة"}),e.jsx("p",{className:"text-2xl font-bold",children:p.newSubscriptions})]})]})}),!u&&!g&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-green-500/10 p-3 rounded-xl",children:e.jsx(Be,{className:"w-6 h-6 text-green-500"})}),e.jsx(et,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-sm text-white/60 mb-1",children:"إجمالي الوجبات"}),e.jsx("p",{className:"text-2xl font-bold",children:p.totalMeals}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"نسبة الاكتمال"}),e.jsx("span",{className:"text-green-400",children:"85%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:"85%"}})})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-orange-500/10 p-3 rounded-xl",children:e.jsx(Xe,{className:"w-6 h-6 text-orange-500"})}),e.jsx(et,{className:"w-5 h-5 text-orange-500"})]}),e.jsx("p",{className:"text-sm text-white/60 mb-1",children:"إجمالي التمارين"}),e.jsx("p",{className:"text-2xl font-bold",children:p.totalExercises}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"نسبة الاكتمال"}),e.jsx("span",{className:"text-orange-400",children:"70%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 rounded-full",style:{width:"70%"}})})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-3 rounded-xl",children:e.jsx(Oe,{className:"w-6 h-6 text-[#0AE7F2]"})}),e.jsx(et,{className:"w-5 h-5 text-[#0AE7F2]"})]}),e.jsx("p",{className:"text-sm text-white/60 mb-1",children:"متوسط الخطوات اليومية"}),e.jsx("p",{className:"text-2xl font-bold",children:"5,432"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"نسبة الإنجاز"}),e.jsx("span",{className:"text-[#0AE7F2]",children:"65%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0AE7F2] rounded-full",style:{width:"65%"}})})]})]})]}),!u&&!g&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"توزيع الوجبات حسب الفئة"}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"space-y-3 w-full",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"فطور"}),e.jsx("span",{className:"text-[#0AE7F2]",children:"45%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0AE7F2] rounded-full",style:{width:"45%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"غداء"}),e.jsx("span",{className:"text-green-400",children:"30%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:"30%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"عشاء"}),e.jsx("span",{className:"text-purple-400",children:"15%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-500 rounded-full",style:{width:"15%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"وجبة خفيفة"}),e.jsx("span",{className:"text-amber-400",children:"10%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:"10%"}})})]})]})})]}),e.jsxs("div",{className:"bg-[#1A1F2E] rounded-xl border border-white/10 p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"توزيع التمارين حسب الفئة"}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"space-y-3 w-full",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"صدر"}),e.jsx("span",{className:"text-[#0AE7F2]",children:"25%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#0AE7F2] rounded-full",style:{width:"25%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"ظهر"}),e.jsx("span",{className:"text-green-400",children:"20%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:"20%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"أرجل"}),e.jsx("span",{className:"text-purple-400",children:"20%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-500 rounded-full",style:{width:"20%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"كتف"}),e.jsx("span",{className:"text-amber-400",children:"15%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:"15%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-400",children:"أخرى"}),e.jsx("span",{className:"text-rose-400",children:"20%"})]}),e.jsx("div",{className:"h-2 bg-[#0A0F1C] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-rose-500 rounded-full",style:{width:"20%"}})})]})]})})]})]})]});case"trainees":return e.jsx(wd,{});case"exercises":return e.jsx(Nd,{});case"meals":return e.jsx(Ed,{});case"steps":return e.jsx(_d,{onBack:()=>{}});case"memberships":return e.jsx(Ad,{});case"settings":return e.jsx(Fd,{});default:return null}};return e.jsxs("div",{dir:"rtl",className:"min-h-screen bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"fixed inset-0 z-0 bg-gradient-to-br from-[#0A0F1C] via-[#1A1F2E] to-[#0A0F1C]"}),e.jsxs("div",{className:"relative z-10 flex",children:[e.jsxs("div",{className:`fixed top-0 right-0 h-full w-64 bg-[#1A1F2E]/80 backdrop-blur-lg border-l border-white/10 transition-transform duration-300 ${n?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-[#0AE7F2]",children:"MK"}),e.jsx("p",{className:"text-sm text-gray-400",children:"لوحة تحكم المدير"})]}),e.jsx("nav",{className:"flex-1 p-4",children:e.jsx("div",{className:"space-y-2",children:f.map(F=>e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>w(F.id),onMouseEnter:()=>d(F.id),onMouseLeave:()=>d(null),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-colors ${l===F.id?"bg-[#0AE7F2] text-black":"text-gray-400 hover:bg-white/5"}`,children:[e.jsx(F.icon,{size:20}),e.jsx("span",{children:F.label}),e.jsx(qs,{size:16,className:`mr-auto transition-opacity ${c===F.id?"opacity-100":"opacity-0"}`})]}),c===F.id&&e.jsxs("div",{className:"absolute left-full top-0 ml-2 p-3 bg-[#1A1F2E] rounded-lg border border-[#0AE7F2]/20 shadow-xl z-50 whitespace-nowrap",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"text-[#0AE7F2] text-sm font-mono mb-1",children:F.endpoint}),e.jsx("div",{className:"flex gap-2",children:F.methods.map(C=>e.jsx("span",{className:`text-xs px-2 py-1 rounded ${C==="GET"?"bg-emerald-500/20 text-emerald-400":C==="POST"?"bg-blue-500/20 text-blue-400":C==="PUT"?"bg-amber-500/20 text-amber-400":"bg-rose-500/20 text-rose-400"}`,children:C},C))})]}),F.subEndpoints&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-[#0AE7F2]/10",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"نقاط النهاية الفرعية:"}),F.subEndpoints.map((C,A)=>e.jsxs("div",{className:"mb-2 last:mb-0",children:[e.jsx("p",{className:"text-[#0AE7F2] text-xs font-mono mb-1",children:C.endpoint}),e.jsx("div",{className:"flex gap-2",children:C.methods.map(E=>e.jsx("span",{className:`text-xs px-2 py-1 rounded ${E==="GET"?"bg-emerald-500/20 text-emerald-400":E==="POST"?"bg-blue-500/20 text-blue-400":E==="PUT"?"bg-amber-500/20 text-amber-400":"bg-rose-500/20 text-rose-400"}`,children:E},E))})]},A))]})]})]},F.id))})}),e.jsx("div",{className:"p-4 border-t border-white/10",children:e.jsxs("button",{onClick:N,className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-rose-500 hover:bg-rose-500/10 transition-colors",children:[e.jsx(me,{size:20}),e.jsx("span",{children:"تسجيل الخروج"})]})})]}),e.jsxs("div",{className:`flex-1 ${n?"mr-64":""}`,children:[e.jsx("div",{className:"sticky top-0 z-50 bg-[#1A1F2E]/80 backdrop-blur-lg border-b border-white/10",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>i(!n),className:"text-white/80 hover:text-white transition-colors",children:e.jsx(Pr,{size:24})}),e.jsx("button",{onClick:a,className:"text-white/80 hover:text-white transition-colors",children:e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{onClick:()=>t("/admin/notifications"),className:"text-white/80 hover:text-white transition-colors",children:e.jsx(Me,{size:20})}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>r(!s),className:"flex items-center gap-2 hover:bg-white/5 rounded-full py-1 px-2 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-[#0AE7F2] rounded-full flex items-center justify-center",children:e.jsx(Ae,{size:16,className:"text-black"})}),e.jsx(Ot,{size:16,className:"text-white/60"})]}),s&&e.jsx("div",{className:"absolute left-0 mt-2 w-48 bg-[#1A1F2E] rounded-xl border border-white/10 shadow-xl",children:e.jsxs("div",{className:"p-2",children:[e.jsx("button",{className:"w-full text-right px-3 py-2 text-sm text-white/80 hover:bg-white/5 rounded-lg transition-colors",children:"الملف الشخصي"}),e.jsx("hr",{className:"my-2 border-white/10"}),e.jsx("button",{onClick:N,className:"w-full text-right px-3 py-2 text-sm text-rose-500 hover:bg-rose-500/10 rounded-lg transition-colors",children:"تسجيل الخروج"})]})})]})]})]})})}),e.jsx("div",{className:"p-6",children:j()})]})]})]})}function Cd({onBack:a}){const t=de(),[s,r]=m.useState(!1),[n,i]=m.useState("all"),[l,o]=m.useState(""),[c,d]=m.useState(""),[u,x]=m.useState([]),[g,b]=m.useState(""),[p,v]=m.useState(!1),[h,f]=m.useState([]),[N,w]=m.useState(!0),[j,F]=m.useState(!1),[C,A]=m.useState(null),[E,_]=m.useState([]),[k,O]=m.useState(null),[M,y]=m.useState("info");m.useEffect(()=>{W(),n==="specific"&&z()},[n]);const W=async()=>{try{if(w(!0),A(null),q()){const{data:P,error:J}=await S.from("notifications").select("*").order("created_at",{ascending:!1});if(J)throw J;const R=P.map(Y=>({id:Y.id,title:Y.title,message:Y.message,timestamp:new Date(Y.created_at),type:Y.type,read:!!Y.read_at}));_(R)}else{const J=(await wa()).map(R=>({id:R.id,title:R.title,message:R.message,timestamp:new Date(R.createdAt),type:R.type,read:!!R.readAt}));_(J)}}catch(P){console.error("Error fetching notifications:",P),A("حدث خطأ أثناء تحميل الإشعارات"),_([{id:"1",title:"تحديث البرنامج التدريبي",message:"تم تحديث برنامجك التدريبي لهذا الأسبوع. تفقد التمارين الجديدة!",timestamp:new Date(Date.now()-5*60*1e3),type:"info",read:!1},{id:"2",title:"تهانينا!",message:"لقد أكملت جميع تمارين اليوم. أحسنت!",timestamp:new Date(Date.now()-2*60*60*1e3),type:"success",read:!1},{id:"3",title:"تذكير بموعد التمرين",message:"لديك تمرين مجدول بعد ساعة من الآن",timestamp:new Date(Date.now()-3*60*60*1e3),type:"warning",read:!0}])}finally{w(!1)}},z=async()=>{try{if(w(!0),A(null),q()){const{data:P,error:J}=await S.from("trainee_profiles").select("id, name, email").eq("status","active").neq("email","mk@powerhouse.com").order("name");if(J)throw J;f(P||[])}else f([{id:"1",name:"أحمد محمد",email:"ahmed@example.com"},{id:"2",name:"سارة علي",email:"sara@example.com"},{id:"3",name:"محمد خالد",email:"mohamed@example.com"},{id:"4",name:"فاطمة أحمد",email:"fatima@example.com"},{id:"5",name:"عمر حسن",email:"omar@example.com"},{id:"6",name:"ليلى سعيد",email:"layla@example.com"},{id:"7",name:"خالد عمر",email:"khaled@example.com"},{id:"8",name:"نور محمد",email:"noor@example.com"}])}catch(P){console.error("Error fetching trainees:",P),A("حدث خطأ أثناء تحميل قائمة المتدربين")}finally{w(!1)}},I=h.filter(P=>P.name.toLowerCase().includes(g.toLowerCase())||P.email.toLowerCase().includes(g.toLowerCase())),H=P=>{x(J=>J.includes(P)?J.filter(R=>R!==P):[...J,P])},T=async()=>{if(!l||!c){A("يرجى إدخال عنوان ونص الإشعار");return}if(n==="specific"&&u.length===0){A("يرجى اختيار متدرب واحد على الأقل");return}try{if(F(!0),A(null),q()){const{data:{user:P}}=await S.auth.getUser();if(!P)throw new Error("المستخدم غير مسجل الدخول");if(n==="all"){const{error:J}=await S.from("notifications").insert({title:l,message:c,type:M,sender_id:P.id,recipient_id:null});if(J)throw J}else{const J=u.map(Y=>({title:l,message:c,type:M,sender_id:P.id,recipient_id:Y})),{error:R}=await S.from("notifications").insert(J);if(R)throw R}}else if(n==="all")await Er(l,c,M);else for(const P of u)await Er(l,c,M,P);v(!0),setTimeout(()=>{v(!1),r(!1),o(""),d(""),x([]),i("all"),y("info"),W()},2e3)}catch(P){console.error("Error sending notification:",P),A("حدث خطأ أثناء إرسال الإشعار")}finally{F(!1)}},G=()=>{t("/admin")},X=(P,J)=>{const R="rounded-2xl p-6 border transition-all",Y=J?"border-[#0AE7F2]/20":"border-[#0AE7F2]";switch(P){case"success":return`${R} ${Y} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"warning":case"weight":return`${R} ${Y} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"error":return`${R} ${Y} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"exercise":return`${R} ${Y} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"meal":return`${R} ${Y} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;case"subscription":return`${R} ${Y} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`;default:return`${R} ${Y} bg-[#1A1F2E]/60 backdrop-blur-sm hover:bg-[#1A1F2E]/80`}},ae=P=>{switch(P){case"success":return e.jsx(Se,{size:24,className:"text-[#0AE7F2]"});case"warning":case"weight":return e.jsx(Re,{size:24,className:"text-[#0AE7F2]"});default:return e.jsx(Me,{size:24,className:"text-[#0AE7F2]"})}},Q=async P=>{try{await Na(P),_(E.map(J=>J.id===P?{...J,read:!0}:J)),O(null)}catch(J){console.error("Error marking notification as read:",J)}},$=async P=>{try{await Ea(P),_(E.filter(J=>J.id!==P)),O(null)}catch(J){console.error("Error deleting notification:",J)}};return E.filter(P=>!P.read).length,N&&E.length===0?e.jsx("div",{className:"h-full flex items-center justify-center bg-[#0A0F1C]",children:e.jsx("div",{className:"w-12 h-12 border-4 border-[#0AE7F2] border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{dir:"rtl",className:"min-h-screen bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"fixed inset-0 z-0 opacity-5",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415L51.8 0h2.827zM5.373 0l-.83.828L5.96 2.243 8.2 0H5.374zM48.97 0l3.657 3.657-1.414 1.414L46.143 0h2.828zM11.03 0L7.372 3.657 8.787 5.07 13.857 0H11.03zm32.284 0L49.8 6.485 48.384 7.9l-7.9-7.9h2.83zM16.686 0L10.2 6.485 11.616 7.9l7.9-7.9h-2.83zM22.344 0L13.858 8.485 15.272 9.9l9.9-9.9h-2.828zM32 0l-9.9 9.9 1.414 1.414L33.414 1.414 32 0zm-3.172 0L19.757 9.071l1.415 1.414L31.243 0h-2.415zm-5.656 0L14.343 8.828l1.415 1.415L25.586 0h-2.415zm-5.656 0L8.687 8.828 10.1 10.243 20.93 0h-3.414zM28.828 0L27.414 1.414 33.414 7.414V0h-4.586zm-9.656 0L17.757 1.414 23.757 7.414V0h-4.585zm-9.657 0L8.1 1.414l6 6V0H9.516zM0 0c0 .828.635 1.5 1.414 1.5.793 0 1.414-.672 1.414-1.5H0zm0 4.172l4.172 4.172 1.415-1.415L1.414 2.757 0 4.172zm0 5.656l9.828 9.828 1.414-1.414L1.414 8.414 0 9.828zm0 5.656l14.485 14.485 1.414-1.414L1.414 14.07 0 15.485zm0 5.657l19.142 19.142 1.414-1.414L1.414 19.728 0 21.142zm0 5.657l23.8 23.8 1.414-1.414L1.414 25.385 0 26.8zm0 5.657l28.456 28.457 1.414-1.414L1.414 31.042 0 32.456zm0 5.657l33.113 33.114 1.414-1.414L1.414 36.7 0 38.113zm0 5.657l37.77 37.77 1.415-1.414L1.414 42.356 0 43.77zm0 5.657l42.427 42.428 1.414-1.414L1.414 48.013 0 49.427zm0 5.657l47.084 47.085 1.414-1.414L1.414 53.67 0 55.084zm0 5.657l51.741 51.741 1.414-1.414L1.414 59.327 0 60.741zm0 5.657l56.398 56.398 1.414-1.414L1.414 65.084 0 66.498zm60.741 0L0 5.757 1.414 4.343 60.74 63.67l-1.414 1.414z' fill='%23ffffff' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E")`,backgroundSize:"30px 30px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-[#1A1F2E]/80 backdrop-blur-lg border-b border-[#0AE7F2]/20",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:G,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h1",{className:"text-xl font-bold",children:"الإشعارات"}),e.jsxs("button",{onClick:()=>r(!0),className:"bg-[#0AE7F2] text-black px-4 py-2 rounded-xl text-sm font-medium hover:bg-[#0AE7F2]/90 transition-colors flex items-center gap-2",children:[e.jsx(Me,{size:16}),e.jsx("span",{children:"إشعار جديد"})]})]})})}),e.jsxs("div",{className:"p-6",children:[C&&e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6",children:[C,e.jsx("button",{onClick:W,className:"underline hover:no-underline mt-2 block w-full",children:"إعادة المحاولة"})]}),E.length>0?e.jsx("div",{className:"space-y-4",children:E.map(P=>e.jsx("div",{className:X(P.type,P.read),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 p-3 rounded-xl",children:ae(P.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold",children:P.title}),!P.read&&e.jsx("span",{className:"w-2 h-2 bg-[#0AE7F2] rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-400",children:va(P.timestamp)}),e.jsx("button",{onClick:()=>O(k===P.id?null:P.id),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(Or,{size:16})})]})]}),e.jsx("p",{className:"text-gray-400",children:P.message}),k===P.id&&e.jsxs("div",{className:"mt-4 flex gap-4 border-t border-[#0AE7F2]/20 pt-4",children:[!P.read&&e.jsx("button",{onClick:()=>Q(P.id),className:"text-sm text-[#0AE7F2] hover:text-[#0AE7F2]/80 transition-colors",children:"تحديد كمقروء"}),e.jsxs("button",{onClick:()=>$(P.id),className:"text-sm text-rose-500 hover:text-rose-400 transition-colors flex items-center gap-1",children:[e.jsx(Ft,{size:14}),e.jsx("span",{children:"حذف"})]})]})]})]})},P.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-[#0AE7F2]/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Me,{size:32,className:"text-[#0AE7F2]"})}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"لا توجد إشعارات"}),e.jsx("p",{className:"text-gray-400",children:'اضغط على زر "إشعار جديد" لإرسال إشعار'})]})]})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#1A1F2E] rounded-2xl w-full max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"إرسال إشعار جديد"}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-400 hover:text-white",children:e.jsx(ue,{size:24})})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[C&&e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6",children:C}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"نوع الإشعار"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>i("all"),className:`flex-1 py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors ${n==="all"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C] text-gray-400"}`,children:[e.jsx(bt,{size:20}),e.jsx("span",{children:"إشعار للجميع"})]}),e.jsxs("button",{onClick:()=>i("specific"),className:`flex-1 py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors ${n==="specific"?"bg-[#0AE7F2] text-black":"bg-[#0A0F1C] text-gray-400"}`,children:[e.jsx(Ae,{size:20}),e.jsx("span",{children:"إشعار مخصص"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"نوع الرسالة"}),e.jsxs("select",{value:M,onChange:P=>y(P.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:[e.jsx("option",{value:"info",children:"معلومات"}),e.jsx("option",{value:"success",children:"نجاح"}),e.jsx("option",{value:"warning",children:"تنبيه"}),e.jsx("option",{value:"error",children:"خطأ"}),e.jsx("option",{value:"exercise",children:"تمرين"}),e.jsx("option",{value:"meal",children:"وجبة"}),e.jsx("option",{value:"weight",children:"وزن"}),e.jsx("option",{value:"subscription",children:"اشتراك"})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"عنوان الإشعار"}),e.jsx("input",{type:"text",value:l,onChange:P=>o(P.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#0AE7F2]",placeholder:"أدخل عنوان الإشعار"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"نص الإشعار"}),e.jsx("textarea",{value:c,onChange:P=>d(P.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white placeholder-gray-400 focus:outline-none focus:border-[#0AE7F2] h-32 resize-none",placeholder:"أدخل نص الإشعار"})]})]}),n==="specific"&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"اختر المتدربين"}),e.jsxs("span",{className:"text-xs text-[#0AE7F2]",children:[u.length," متدرب محدد"]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",value:g,onChange:P=>b(P.target.value),placeholder:"البحث عن متدرب...",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white placeholder-gray-400 focus:outline-none focus:border-[#0AE7F2]"}),e.jsx(je,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]}),N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Fe,{size:24,className:"text-[#0AE7F2] animate-spin"})}):e.jsx("div",{className:"bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl max-h-48 overflow-y-auto",children:I.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400",children:g?"لا توجد نتائج مطابقة للبحث":"لا يوجد متدربين"}):I.map(P=>e.jsxs("label",{className:"flex items-center justify-between p-3 hover:bg-[#0AE7F2]/5 cursor-pointer border-b border-[#0AE7F2]/10 last:border-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:P.name}),e.jsx("p",{className:"text-sm text-gray-400",children:P.email})]}),e.jsx("input",{type:"checkbox",checked:u.includes(P.id),onChange:()=>H(P.id),className:"w-5 h-5 rounded border-[#0AE7F2]/20 bg-[#0A0F1C] text-[#0AE7F2] focus:ring-[#0AE7F2] focus:ring-offset-0"})]},P.id))})]}),e.jsxs("div",{className:"bg-[#0A0F1C] rounded-xl p-4 flex items-start gap-3 mb-6",children:[e.jsx(Ga,{size:20,className:"text-[#0AE7F2] flex-shrink-0 mt-1"}),e.jsx("p",{className:"text-sm text-gray-400",children:n==="all"?"سيتم إرسال هذا الإشعار لجميع المتدربين في النظام":"سيتم إرسال هذا الإشعار فقط للمتدربين المحددين"})]})]}),e.jsx("div",{className:"p-6 border-t border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>r(!1),className:"flex-1 py-3 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:T,disabled:j||!l||!c||n==="specific"&&u.length===0,className:"flex-1 py-3 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{size:20,className:"animate-spin"}),e.jsx("span",{children:"جاري الإرسال..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{size:20}),e.jsx("span",{children:"إرسال الإشعار"})]})})]})})]})}),p&&e.jsxs("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 bg-emerald-500 text-white px-6 py-3 rounded-xl flex items-center gap-2 shadow-lg z-50",children:[e.jsx(Se,{size:20}),e.jsx("span",{children:"تم إرسال الإشعار بنجاح"})]})]})}function Td({onBack:a}){de();const[t,s]=m.useState(null),[r,n]=m.useState([]);m.useState([]),m.useState("");const[i,l]=m.useState("");m.useState(!0),m.useState(!1),m.useState(null),m.useState(null);const o=m.useRef(null);m.useEffect(()=>{fetchTrainees()},[]),m.useEffect(()=>{t&&(fetchMessages(t.id),c())},[t]);const c=()=>{var d;(d=o.current)==null||d.scrollIntoView({behavior:"smooth"})};return r.filter(d=>d.name.toLowerCase().includes(i.toLowerCase())),e.jsx("div",{dir:"rtl",className:"h-screen w-full max-w-screen flex bg-[#0A0F1C] text-white overflow-hidden"})}function Pd({onBack:a}){const t=de(),[s,r]=m.useState(null),[n,i]=m.useState([]),[l,o]=m.useState([]),[c,d]=m.useState(""),[u,x]=m.useState(""),[g,b]=m.useState(!0),[p,v]=m.useState(!1),[h,f]=m.useState(null),[N,w]=m.useState(null),[j,F]=m.useState(null),[C,A]=m.useState(!1),E=m.useRef(null);m.useEffect(()=>{k()},[]),m.useEffect(()=>{s&&(O(s.id),_())},[s]);const _=()=>{var T;(T=E.current)==null||T.scrollIntoView({behavior:"smooth"})},k=async()=>{try{if(b(!0),q()){const{data:{user:T}}=await S.auth.getUser();if(!T)throw new Error("المستخدم غير مسجل الدخول");const{data:G,error:X}=await S.from("trainee_profiles").select("id, name, email, subscription_plan").neq("email","mk@powerhouse.com");if(X)throw X;const{data:ae,error:Q}=await S.from("conversations").select(`
            id,
            trainee_id,
            last_message_at
          `).eq("trainer_id",T.id);if(Q)throw Q;const{data:$,error:P}=await S.from("messages").select("conversation_id, count").eq("read_at",null).neq("sender_id",T.id).in("conversation_id",ae.map(R=>R.id)).group("conversation_id");if(P)throw P;const J=G.map(R=>{var B;const Y=ae.find(D=>D.trainee_id===R.id),pe=Y&&((B=$.find(D=>D.conversation_id===Y.id))==null?void 0:B.count)||0;return{id:R.id,name:R.name||"متدرب",lastMessage:"",unreadCount:parseInt(pe||"0"),lastActive:Y!=null&&Y.last_message_at?new Date(Y.last_message_at):new Date,plan:R.subscription_plan}});for(const R of J){const Y=ae.find(pe=>pe.trainee_id===R.id);if(Y){const{data:pe}=await S.from("messages").select("content").eq("conversation_id",Y.id).order("created_at",{ascending:!1}).limit(1).single();pe&&(R.lastMessage=pe.content)}}i(J)}else i([{id:"123e4567-e89b-12d3-a456-426614174030",name:"أحمد محمد",lastMessage:"مرحباً، عندي استفسار عن برنامج التمارين",unreadCount:2,lastActive:new Date(Date.now()-5*60*1e3),plan:"premium"},{id:"123e4567-e89b-12d3-a456-426614174031",name:"سارة علي",lastMessage:"شكراً جزيلاً على المساعدة",unreadCount:0,lastActive:new Date(Date.now()-2*60*60*1e3),plan:"basic"},{id:"123e4567-e89b-12d3-a456-426614174032",name:"محمد خالد",lastMessage:"هل يمكنني تغيير موعد التمرين؟",unreadCount:1,lastActive:new Date(Date.now()-1*24*60*60*1e3),plan:"pro"}])}catch(T){console.error("Error fetching trainees:",T),f("حدث خطأ أثناء تحميل قائمة المتدربين"),i([{id:"123e4567-e89b-12d3-a456-426614174030",name:"أحمد محمد",lastMessage:"مرحباً، عندي استفسار عن برنامج التمارين",unreadCount:2,lastActive:new Date(Date.now()-5*60*1e3),plan:"premium"},{id:"123e4567-e89b-12d3-a456-426614174031",name:"سارة علي",lastMessage:"شكراً جزيلاً على المساعدة",unreadCount:0,lastActive:new Date(Date.now()-2*60*60*1e3),plan:"basic"},{id:"123e4567-e89b-12d3-a456-426614174032",name:"محمد خالد",lastMessage:"هل يمكنني تغيير موعد التمرين؟",unreadCount:1,lastActive:new Date(Date.now()-1*24*60*60*1e3),plan:"pro"}])}finally{b(!1)}},O=async T=>{try{if(q()){const{data:{user:G}}=await S.auth.getUser();if(!G)throw new Error("المستخدم غير مسجل الدخول");let X;const{data:ae,error:Q}=await S.from("conversations").select("*").eq("trainee_id",T).eq("trainer_id",G.id).single();if(Q)if(Q.code==="PGRST116"){const{data:Y,error:pe}=await S.from("conversations").insert({trainee_id:T,trainer_id:G.id,status:"active"}).select().single();if(pe)throw pe;X=Y}else throw Q;else X=ae;w(X);const{data:$,error:P}=await S.from("messages").select(`
            id,
            sender_id,
            content,
            created_at,
            read_at,
            trainee_profiles:sender_id (name)
          `).eq("conversation_id",X.id).order("created_at",{ascending:!0});if(P)throw P;const J=$.map(Y=>{var pe;return{id:Y.id,traineeId:T,traineeName:((pe=Y.trainee_profiles)==null?void 0:pe.name)||"متدرب",content:Y.content,timestamp:new Date(Y.created_at),status:Y.read_at?"read":"unread",isReply:Y.sender_id===G.id}});o(J);const R=$.filter(Y=>Y.sender_id===T&&!Y.read_at).map(Y=>Y.id);R.length>0&&(await S.from("messages").update({read_at:new Date().toISOString()}).in("id",R),k())}else{const G=[{id:"1",traineeId:T,traineeName:(s==null?void 0:s.name)||"متدرب",content:"مرحباً، عندي استفسار عن برنامج التمارين",timestamp:new Date(Date.now()-72e5),status:"read"},{id:"2",traineeId:T,traineeName:"المدرب",content:"أهلاً بك! كيف يمكنني مساعدتك؟",timestamp:new Date(Date.now()-684e4),status:"read",isReply:!0},{id:"3",traineeId:T,traineeName:(s==null?void 0:s.name)||"متدرب",content:"هل يمكنني تغيير موعد التمرين؟",timestamp:new Date(Date.now()-36e5),status:"read"}];o(G),w({id:"mock-conversation-id"})}}catch(G){console.error("Error fetching messages:",G),f("حدث خطأ أثناء تحميل الرسائل");const X=[{id:"1",traineeId:T,traineeName:(s==null?void 0:s.name)||"متدرب",content:"مرحباً، عندي استفسار عن برنامج التمارين",timestamp:new Date(Date.now()-2*60*60*1e3),status:"read"},{id:"2",traineeId:T,traineeName:"المدرب",content:"أهلاً بك! كيف يمكنني مساعدتك؟",timestamp:new Date(Date.now()-1.9*60*60*1e3),status:"read",isReply:!0},{id:"3",traineeId:T,traineeName:(s==null?void 0:s.name)||"متدرب",content:"هل يمكنني تغيير موعد التمرين؟",timestamp:new Date(Date.now()-1*60*60*1e3),status:"read"}];o(X),w({id:"mock-conversation-id"})}},M=async()=>{if(!c.trim()||!s||!N)return;const T=c.trim();d(""),v(!0);try{if(q()){const{data:{user:G}}=await S.auth.getUser();if(!G)throw new Error("المستخدم غير مسجل الدخول");const X={id:`temp-${Date.now()}`,traineeId:s.id,traineeName:"المدرب",content:T,timestamp:new Date,status:"unread",isReply:!0};o($=>[...$,X]);const{data:ae,error:Q}=await S.from("messages").insert({conversation_id:N.id,sender_id:G.id,content:T}).select().single();if(Q)throw Q;await S.from("conversations").update({last_message_at:new Date().toISOString()}).eq("id",N.id),o($=>$.map(P=>P.id===X.id?{...P,id:ae.id,timestamp:new Date(ae.created_at)}:P))}else{const G={id:Date.now().toString(),traineeId:s.id,traineeName:"المدرب",content:T,timestamp:new Date,status:"unread",isReply:!0};o(X=>[...X,G])}}catch(G){console.error("Error sending reply:",G),f("حدث خطأ أثناء إرسال الرد")}finally{v(!1)}},y=T=>{r(T)},W=T=>{switch(T){case"basic":return"bg-blue-500/20 text-blue-400";case"premium":return"bg-purple-500/20 text-purple-400";case"pro":return"bg-amber-500/20 text-amber-400";default:return"bg-gray-500/20 text-gray-400"}},z=T=>{switch(T){case"basic":return"أساسية";case"premium":return"متقدمة";case"pro":return"احترافية";default:return T}},I=n.filter(T=>T.name.toLowerCase().includes(u.toLowerCase())&&(j===null||T.plan===j)),H=()=>{t("/admin")};return g&&n.length===0?e.jsx("div",{className:"h-full flex items-center justify-center bg-[#0A0F1C]",children:e.jsx(Fe,{className:"w-12 h-12 text-[#0AE7F2] animate-spin"})}):h&&n.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center bg-[#0A0F1C] p-6",children:[e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-4",children:h}),e.jsx("button",{onClick:k,className:"bg-[#0AE7F2] text-black px-4 py-2 rounded-xl",children:"إعادة المحاولة"})]}):e.jsxs("div",{dir:"rtl",className:"h-full flex bg-[#0A0F1C] text-white",children:[e.jsxs("div",{className:"w-[380px] flex flex-col border-l border-[#0AE7F2]/20 bg-[#1A1F2E]/80 backdrop-blur-lg",children:[e.jsxs("div",{className:"p-4 border-b border-[#0AE7F2]/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:H,className:"text-white/80 hover:text-white",children:e.jsx(me,{size:24})}),e.jsx("h1",{className:"text-xl font-bold",children:"المحادثات"}),e.jsx("button",{onClick:()=>A(!C),className:"text-white/80 hover:text-white",children:e.jsx(Ue,{size:20})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:u,onChange:T=>x(T.target.value),placeholder:"البحث عن متدرب...",className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl py-2 px-4 pr-10 text-white placeholder-white/40 focus:outline-none focus:border-[#0AE7F2]/50"}),e.jsx(je,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-white/40",size:20})]}),C&&e.jsxs("div",{className:"mt-4 p-3 bg-[#0A0F1C] rounded-xl border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"تصفية حسب الخطة"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>F(null),className:`px-3 py-1 rounded-lg text-sm ${j===null?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/60 text-gray-400"}`,children:"الكل"}),e.jsx("button",{onClick:()=>F("basic"),className:`px-3 py-1 rounded-lg text-sm ${j==="basic"?"bg-blue-500 text-white":"bg-blue-500/20 text-blue-400"}`,children:"أساسية"}),e.jsx("button",{onClick:()=>F("premium"),className:`px-3 py-1 rounded-lg text-sm ${j==="premium"?"bg-purple-500 text-white":"bg-purple-500/20 text-purple-400"}`,children:"متقدمة"}),e.jsx("button",{onClick:()=>F("pro"),className:`px-3 py-1 rounded-lg text-sm ${j==="pro"?"bg-amber-500 text-white":"bg-amber-500/20 text-amber-400"}`,children:"احترافية"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[I.map(T=>e.jsx("button",{onClick:()=>y(T),className:`w-full p-4 text-right hover:bg-[#0AE7F2]/5 transition-colors border-b border-[#0AE7F2]/10 ${(s==null?void 0:s.id)===T.id?"bg-[#0AE7F2]/10":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Ae,{size:24,className:"text-[#0AE7F2]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium truncate",children:T.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${W(T.plan)}`,children:z(T.plan)})]}),e.jsx("span",{className:"text-xs text-gray-400",children:Kt(T.lastActive,{addSuffix:!0,locale:Xt})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-400 truncate",children:T.lastMessage}),T.unreadCount>0&&e.jsx("span",{className:"bg-[#0AE7F2] text-black text-xs px-2 py-0.5 rounded-full",children:T.unreadCount})]})]})]})},T.id)),I.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-400",children:"لا توجد محادثات تطابق معايير البحث"})]})]}),s?e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-[#0AE7F2]/20 bg-[#1A1F2E]/80 backdrop-blur-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center",children:e.jsx(Ae,{size:24,className:"text-[#0AE7F2]"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"font-bold text-lg",children:s.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${W(s.plan)}`,children:z(s.plan)})]}),e.jsxs("p",{className:"text-sm text-[#0AE7F2]",children:["آخر نشاط: ",Kt(s.lastActive,{addSuffix:!0,locale:Xt})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[l.map(T=>e.jsx("div",{className:`flex ${T.isReply?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`max-w-[60%] rounded-2xl p-4 ${T.isReply?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/80 backdrop-blur-sm border border-[#0AE7F2]/20"}`,children:[e.jsx("p",{className:"mb-2",children:T.content}),e.jsxs("div",{className:"flex items-center justify-end gap-2 text-xs",children:[e.jsx("span",{className:T.isReply?"text-black/60":"text-gray-400",children:Kt(T.timestamp,{addSuffix:!0,locale:Xt})}),T.status==="read"?e.jsx(Se,{size:14,className:"text-[#0AE7F2]"}):e.jsx(Re,{size:14,className:"text-gray-400"})]})]})},T.id)),e.jsx("div",{ref:E})]}),e.jsx("div",{className:"p-4 border-t border-[#0AE7F2]/20 bg-[#1A1F2E]/80 backdrop-blur-lg",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 bg-[#0A0F1C] rounded-xl border border-[#0AE7F2]/20",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3",children:[e.jsx("button",{className:"text-gray-400 hover:text-[#0AE7F2] transition-colors p-2",disabled:p,children:e.jsx(es,{size:20})}),e.jsx("button",{className:"text-gray-400 hover:text-[#0AE7F2] transition-colors p-2",disabled:p,children:e.jsx(Ls,{size:20})})]}),e.jsx("input",{type:"text",value:c,onChange:T=>d(T.target.value),placeholder:"اكتب رسالتك...",className:"flex-1 bg-transparent px-4 py-3 text-white placeholder-gray-400 focus:outline-none min-h-[48px]",onKeyPress:T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),M())},disabled:p}),e.jsx("button",{className:"text-gray-400 hover:text-[#0AE7F2] transition-colors px-3",disabled:p,children:e.jsx(Ds,{size:20})})]})}),e.jsx("button",{onClick:M,disabled:!c.trim()||p,className:"bg-[#0AE7F2] text-black p-3 rounded-xl hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?e.jsx(Fe,{size:20,className:"animate-spin"}):e.jsx(dt,{size:20})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-[#0A0F1C]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(is,{size:32,className:"text-[#0AE7F2]"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"اختر محادثة"}),e.jsx("p",{className:"text-gray-400",children:"اختر متدرب من القائمة لبدء المحادثة"})]})})]})}function Md({onBack:a}){const t=de(),[s,r]=m.useState([]),[n,i]=m.useState(""),[l,o]=m.useState(!1),c=m.useRef(null),d=m.useRef(null);m.useEffect(()=>{var p;(p=c.current)==null||p.focus()},[]),m.useEffect(()=>{x()},[s]);const u=async()=>{if(!n.trim())return;o(!0);const p={id:`${Date.now()}`,content:n.trim(),timestamp:new Date,isCurrentUser:!0};r(v=>[...v,p]),i(""),o(!1)},x=()=>{var p;(p=d.current)==null||p.scrollIntoView({behavior:"smooth"})},g=()=>{t("/trainee")},b=p=>p.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{dir:"rtl",className:"h-screen flex flex-col bg-[#0A0F1C] text-white relative overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4 bg-[#1A1F2E]/80 backdrop-blur-lg border-b border-[#0AE7F2]/20",children:[e.jsx("button",{onClick:g,className:"text-white",children:e.jsx(me,{size:24})}),e.jsx("h2",{className:"font-bold",children:"الدردشة"}),e.jsx("div",{style:{width:"24px"}})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 pb-32 space-y-4",children:[s.length===0?e.jsx("div",{className:"flex justify-center items-center h-full text-gray-400",children:"لا توجد رسائل بعد..."}):s.map(p=>e.jsx("div",{className:`flex ${p.isCurrentUser?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[75%] rounded-2xl p-3 ${p.isCurrentUser?"bg-[#0AE7F2] text-black":"bg-[#1A1F2E]/80 border border-[#0AE7F2]/20"}`,children:[e.jsx("p",{children:p.content}),e.jsx("div",{className:"text-xs mt-2 text-right text-gray-400",children:b(p.timestamp)})]})},p.id)),e.jsx("div",{ref:d})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-[#1A1F2E]/95 backdrop-blur-lg border-t border-[#0AE7F2]/20 p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 flex items-center bg-black/40 rounded-full px-4 py-2",children:e.jsx("input",{ref:c,type:"text",value:n,onChange:p=>i(p.target.value),placeholder:"اكتب رسالتك...",className:"flex-1 bg-transparent text-white placeholder-gray-400 focus:outline-none text-sm",onKeyDown:p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),u())},disabled:l})}),e.jsx("button",{onClick:u,disabled:!n.trim()||l,className:"flex items-center justify-center p-3 rounded-full bg-[#0AE7F2] hover:bg-[#0AE7F2]/90 disabled:opacity-50 transition-colors",style:{minWidth:"48px",minHeight:"48px"},children:l?e.jsx(Fe,{size:20,className:"animate-spin"}):e.jsx(dt,{size:20})})]})})]})}function Od({onBack:a}){const t=de(),[s,r]=m.useState(""),[n,i]=m.useState(!1),[l,o]=m.useState(!1),[c,d]=m.useState(null),u=async x=>{x.preventDefault(),i(!0),d(null);try{if(!s)throw new Error("يرجى إدخال البريد الإلكتروني");if(q()){const{error:g}=await S.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/reset-password-confirmation`});if(g)throw g}o(!0)}catch(g){console.error("Error resetting password:",g),d(g instanceof Error?g.message:"حدث خطأ أثناء إرسال طلب إعادة تعيين كلمة المرور")}finally{i(!1)}};return e.jsxs("div",{dir:"rtl",className:"min-h-screen bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"fixed inset-0 z-0 opacity-5",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415L51.8 0h2.827zM5.373 0l-.83.828L5.96 2.243 8.2 0H5.374zM48.97 0l3.657 3.657-1.414 1.414L46.143 0h2.828zM11.03 0L7.372 3.657 8.787 5.07 13.857 0H11.03zm32.284 0L49.8 6.485 48.384 7.9l-7.9-7.9h2.83zM16.686 0L10.2 6.485 11.616 7.9l7.9-7.9h-2.83zM22.344 0L13.858 8.485 15.272 9.9l9.9-9.9h-2.828zM32 0l-9.9 9.9 1.414 1.414L33.414 1.414 32 0zm-3.172 0L19.757 9.071l1.415 1.414L31.243 0h-2.415zm-5.656 0L14.343 8.828l1.415 1.415L25.586 0h-2.415zm-5.656 0L8.687 8.828 10.1 10.243 20.93 0h-3.414zM28.828 0L27.414 1.414 33.414 7.414V0h-4.586zm-9.656 0L17.757 1.414 23.757 7.414V0h-4.585zm-9.657 0L8.1 1.414l6 6V0H9.516zM0 0c0 .828.635 1.5 1.414 1.5.793 0 1.414-.672 1.414-1.5H0zm0 4.172l4.172 4.172 1.415-1.415L1.414 2.757 0 4.172zm0 5.656l9.828 9.828 1.414-1.414L1.414 8.414 0 9.828zm0 5.656l14.485 14.485 1.414-1.414L1.414 14.07 0 15.485zm0 5.657l19.142 19.142 1.414-1.414L1.414 19.728 0 21.142zm0 5.657l23.8 23.8 1.414-1.414L1.414 25.385 0 26.8zm0 5.657l28.456 28.457 1.414-1.414L1.414 31.042 0 32.456zm0 5.657l33.113 33.114 1.414-1.414L1.414 36.7 0 38.113zm0 5.657l37.77 37.77 1.415-1.414L1.414 42.356 0 43.77zm0 5.657l42.427 42.428 1.414-1.414L1.414 48.013 0 49.427zm0 5.657l47.084 47.085 1.414-1.414L1.414 53.67 0 55.084zm0 5.657l51.741 51.741 1.414-1.414L1.414 59.327 0 60.741zm0 5.657l56.398 56.398 1.414-1.414L1.414 65.084 0 66.498zm60.741 0L0 5.757 1.414 4.343 60.74 63.67l-1.414 1.414z' fill='%23ffffff' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E")`,backgroundSize:"30px 30px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:a,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h1",{className:"text-xl font-bold",children:"إعادة تعيين كلمة المرور"}),e.jsx("div",{className:"w-10"})]})}),e.jsx("div",{className:"px-6 pt-8",children:l?e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-2xl border border-[#0AE7F2]/20 p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Se,{size:32,className:"text-[#0AE7F2]"})}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"تم إرسال رابط إعادة التعيين"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"تم إرسال رابط إعادة تعيين كلمة المرور إلى بريدك الإلكتروني. يرجى التحقق من صندوق الوارد الخاص بك واتباع التعليمات."}),e.jsx("button",{onClick:()=>t("/trainee/login"),className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors",children:"العودة إلى تسجيل الدخول"})]}):e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-2xl border border-[#0AE7F2]/20 p-6",children:[e.jsx("p",{className:"text-gray-400 mb-6",children:"أدخل بريدك الإلكتروني وسنرسل لك رابطًا لإعادة تعيين كلمة المرور الخاصة بك."}),c&&e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6 flex items-center gap-2 justify-center",children:[e.jsx($r,{size:20}),e.jsx("span",{children:c})]}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",value:s,onChange:x=>r(x.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",placeholder:"أدخل بريدك الإلكتروني",required:!0})]}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"جاري الإرسال..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{size:20}),e.jsx("span",{children:"إرسال رابط إعادة التعيين"})]})})]})]})})]})]})}function zd(){const a=de(),[t,s]=m.useState(""),[r,n]=m.useState(""),[i,l]=m.useState(!1),[o,c]=m.useState(!1),[d,u]=m.useState(!1),[x,g]=m.useState(null);m.useEffect(()=>{const v=window.location.hash;(!v||!v.includes("access_token"))&&g("رابط إعادة تعيين كلمة المرور غير صالح أو منتهي الصلاحية")},[]);const b=async v=>{v.preventDefault(),c(!0),g(null);try{if(t!==r)throw new Error("كلمات المرور غير متطابقة");if(t.length<8)throw new Error("يجب أن تكون كلمة المرور 8 أحرف على الأقل");if(q()){const{error:h}=await S.auth.updateUser({password:t});if(h)throw h}u(!0),setTimeout(()=>{a("/trainee/login")},3e3)}catch(h){console.error("Error updating password:",h),g(h instanceof Error?h.message:"حدث خطأ أثناء تحديث كلمة المرور")}finally{c(!1)}},p=()=>{a("/trainee/login")};return e.jsxs("div",{dir:"rtl",className:"min-h-screen bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"fixed inset-0 z-0 opacity-5",children:e.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415L51.8 0h2.827zM5.373 0l-.83.828L5.96 2.243 8.2 0H5.374zM48.97 0l3.657 3.657-1.414 1.414L46.143 0h2.828zM11.03 0L7.372 3.657 8.787 5.07 13.857 0H11.03zm32.284 0L49.8 6.485 48.384 7.9l-7.9-7.9h2.83zM16.686 0L10.2 6.485 11.616 7.9l7.9-7.9h-2.83zM22.344 0L13.858 8.485 15.272 9.9l9.9-9.9h-2.828zM32 0l-9.9 9.9 1.414 1.414L33.414 1.414 32 0zm-3.172 0L19.757 9.071l1.415 1.414L31.243 0h-2.415zm-5.656 0L14.343 8.828l1.415 1.415L25.586 0h-2.415zm-5.656 0L8.687 8.828 10.1 10.243 20.93 0h-3.414zM28.828 0L27.414 1.414 33.414 7.414V0h-4.586zm-9.656 0L17.757 1.414 23.757 7.414V0h-4.585zm-9.657 0L8.1 1.414l6 6V0H9.516zM0 0c0 .828.635 1.5 1.414 1.5.793 0 1.414-.672 1.414-1.5H0zm0 4.172l4.172 4.172 1.415-1.415L1.414 2.757 0 4.172zm0 5.656l9.828 9.828 1.414-1.414L1.414 8.414 0 9.828zm0 5.656l14.485 14.485 1.414-1.414L1.414 14.07 0 15.485zm0 5.657l19.142 19.142 1.414-1.414L1.414 19.728 0 21.142zm0 5.657l23.8 23.8 1.414-1.414L1.414 25.385 0 26.8zm0 5.657l28.456 28.457 1.414-1.414L1.414 31.042 0 32.456zm0 5.657l33.113 33.114 1.414-1.414L1.414 36.7 0 38.113zm0 5.657l37.77 37.77 1.415-1.414L1.414 42.356 0 43.77zm0 5.657l42.427 42.428 1.414-1.414L1.414 48.013 0 49.427zm0 5.657l47.084 47.085 1.414-1.414L1.414 53.67 0 55.084zm0 5.657l51.741 51.741 1.414-1.414L1.414 59.327 0 60.741zm0 5.657l56.398 56.398 1.414-1.414L1.414 65.084 0 66.498zm60.741 0L0 5.757 1.414 4.343 60.74 63.67l-1.414 1.414z' fill='%23ffffff' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E")`,backgroundSize:"30px 30px"}})}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:p,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h1",{className:"text-xl font-bold",children:"تعيين كلمة مرور جديدة"}),e.jsx("div",{className:"w-10"})]})}),e.jsx("div",{className:"px-6 pt-8",children:d?e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-2xl border border-[#0AE7F2]/20 p-6 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#0AE7F2]/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Se,{size:32,className:"text-[#0AE7F2]"})}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"تم تغيير كلمة المرور بنجاح"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"تم تغيير كلمة المرور الخاصة بك بنجاح. سيتم توجيهك إلى صفحة تسجيل الدخول."})]}):e.jsxs("div",{className:"bg-[#1A1F2E]/60 backdrop-blur-sm rounded-2xl border border-[#0AE7F2]/20 p-6",children:[e.jsx("p",{className:"text-gray-400 mb-6",children:"يرجى إدخال كلمة المرور الجديدة الخاصة بك."}),x&&e.jsxs("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6 flex items-center gap-2 justify-center",children:[e.jsx($r,{size:20}),e.jsx("span",{children:x})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:i?"text":"password",value:t,onChange:v=>s(v.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",placeholder:"أدخل كلمة المرور الجديدة",required:!0,minLength:8}),e.jsx("button",{type:"button",onClick:()=>l(!i),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:i?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:i?"text":"password",value:r,onChange:v=>n(v.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",placeholder:"أدخل كلمة المرور مرة أخرى",required:!0,minLength:8}),e.jsx("button",{type:"button",onClick:()=>l(!i),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:i?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full bg-[#0AE7F2] text-black py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"جاري التحديث..."})]}):e.jsx("span",{children:"تعيين كلمة المرور الجديدة"})})]})]})})]})]})}function Dd({onSuccess:a,onCancel:t}){de();const[s,r]=m.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",height:170,weight:70,targetWeight:70,goals:[],plan:"basic",age:25,gender:"male",bloodType:"A+"}),[n,i]=m.useState(!1),[l,o]=m.useState(!1),[c,d]=m.useState(null),[u,x]=m.useState(null),g=[{id:"basic",name:"الخطة الأساسية",price:99,duration:"شهر واحد",features:["برنامج تدريبي أساسي","برنامج غذائي أساسي","متابعة أسبوعية"]},{id:"premium",name:"الخطة المتقدمة",price:199,duration:"3 شهور",features:["برنامج تدريبي متقدم","برنامج غذائي مخصص","متابعة يومية","جلسات خاصة"]},{id:"pro",name:"الخطة الاحترافية",price:299,duration:"6 شهور",features:["برنامج تدريبي احترافي","برنامج غذائي مخصص","متابعة مستمرة","جلسات خاصة","استشارات غير محدودة"]}],b=[{id:"weight_loss",name:"خسارة الوزن",icon:"🎯"},{id:"muscle_gain",name:"زيادة العضلات",icon:"💪"},{id:"fitness",name:"اللياقة البدنية",icon:"🏃‍♂️"},{id:"strength",name:"القوة",icon:"🏋️‍♂️"},{id:"flexibility",name:"المرونة",icon:"🧘‍♂️"}],p=["A+","A-","B+","B-","AB+","AB-","O+","O-"],v=async h=>{if(h.preventDefault(),d(null),x(null),s.password!==s.confirmPassword){d("كلمات المرور غير متطابقة");return}if(s.password.length<8){d("يجب أن تكون كلمة المرور 8 أحرف على الأقل");return}if(s.goals.length===0){d("يرجى اختيار هدف واحد على الأقل");return}try{o(!0);const f=await ha(s.name,s.email,s.password,s.phone,s.height,s.weight,s.targetWeight,s.goals,s.plan);if(!f.success)throw new Error(f.error||"حدث خطأ أثناء التسجيل");x("تم تسجيل المتدرب بنجاح"),r({name:"",email:"",phone:"",password:"",confirmPassword:"",height:170,weight:70,targetWeight:70,goals:[],plan:"basic",age:25,gender:"male",bloodType:"A+"}),setTimeout(()=>{a()},2e3)}catch(f){console.error("Registration error:",f),d(f instanceof Error?f.message:"حدث خطأ أثناء التسجيل"),x(null)}finally{o(!1)}};return e.jsx("div",{dir:"rtl",className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-[#1A1F2E] w-full h-full max-w-full max-h-full overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-[#0AE7F2]/20 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,className:"w-10 h-10 bg-[#0A0F1C] rounded-full flex items-center justify-center hover:bg-[#0A0F1C]/80 transition-colors",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h2",{className:"text-2xl font-bold",children:"إضافة متدرب جديد"})]}),e.jsx("button",{onClick:t,className:"w-10 h-10 bg-[#0A0F1C] rounded-full flex items-center justify-center hover:bg-[#0A0F1C]/80 transition-colors",children:e.jsx(ue,{size:20,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[c&&e.jsx("div",{className:"bg-rose-500/10 border border-rose-500 text-rose-500 p-4 rounded-xl text-center mb-6",children:c}),u&&e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500 text-emerald-500 p-4 rounded-xl text-center mb-6",children:u}),e.jsxs("form",{onSubmit:v,className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-[#0AE7F2]",children:"المعلومات الشخصية"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الاسم"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:s.name,onChange:h=>r({...s,name:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx(Ae,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"البريد الإلكتروني"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:s.email,onChange:h=>r({...s,email:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx(Us,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",value:s.phone,onChange:h=>r({...s,phone:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx(Ws,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:n?"text":"password",value:s.password,onChange:h=>r({...s,password:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,minLength:8}),e.jsx("button",{type:"button",onClick:()=>i(!n),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:n?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:n?"text":"password",value:s.confirmPassword,onChange:h=>r({...s,confirmPassword:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0}),e.jsx("button",{type:"button",onClick:()=>i(!n),className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:n?e.jsx(ye,{size:20}):e.jsx(we,{size:20})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"العمر"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s.age,onChange:h=>r({...s,age:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"12",max:"100"}),e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الجنس"}),e.jsxs("select",{value:s.gender,onChange:h=>r({...s,gender:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,children:[e.jsx("option",{value:"male",children:"ذكر"}),e.jsx("option",{value:"female",children:"أنثى"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"فصيلة الدم"}),e.jsx("select",{value:s.bloodType,onChange:h=>r({...s,bloodType:h.target.value}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]",children:p.map(h=>e.jsx("option",{value:h,children:h},h))})]})]}),e.jsxs("div",{className:"bg-[#0A0F1C]/40 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-[#0AE7F2]",children:"القياسات الجسدية"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الطول (سم)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s.height,onChange:h=>r({...s,height:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"100",max:"250"}),e.jsx(zt,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الوزن الحالي (كجم)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s.weight,onChange:h=>r({...s,weight:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"30",max:"200"}),e.jsx(Dr,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الوزن المستهدف (كجم)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:s.targetWeight,onChange:h=>r({...s,targetWeight:Number(h.target.value)}),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 pr-10 text-white focus:outline-none focus:border-[#0AE7F2]",required:!0,min:"30",max:"200"}),e.jsx(ot,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",size:20})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"الأهداف"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:b.map(h=>e.jsxs("label",{className:`flex items-center gap-3 p-4 rounded-xl cursor-pointer transition-all ${s.goals.includes(h.id)?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx("input",{type:"checkbox",checked:s.goals.includes(h.id),onChange:f=>{f.target.checked?r({...s,goals:[...s.goals,h.id]}):r({...s,goals:s.goals.filter(N=>N!==h.id)})},className:"hidden"}),e.jsx("span",{className:"text-2xl",children:h.icon}),e.jsx("span",{children:h.name})]},h.id))})]})]})]}),e.jsxs("div",{className:"mt-8 bg-[#0A0F1C]/40 rounded-xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-[#0AE7F2]",children:"خطة الاشتراك"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:g.map(h=>e.jsxs("label",{className:`block p-6 rounded-xl cursor-pointer transition-all ${s.plan===h.id?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-white":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx("input",{type:"radio",name:"plan",value:h.id,checked:s.plan===h.id,onChange:f=>r({...s,plan:f.target.value}),className:"hidden"}),e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h4",{className:"text-lg font-bold",children:h.name}),e.jsxs("p",{className:"text-xl font-bold text-[#0AE7F2]",children:[h.price," ₪"]})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:h.duration}),e.jsx("ul",{className:"space-y-2 mt-auto",children:h.features.map((f,N)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-[#0AE7F2]",children:"✓"}),e.jsx("span",{children:f})]},N))})]})]},h.id))})]}),e.jsxs("div",{className:"flex gap-4 mt-8",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 py-4 rounded-xl border border-[#0AE7F2] text-[#0AE7F2] hover:bg-[#0AE7F2]/10 transition-colors",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:l,className:"flex-1 py-4 rounded-xl bg-[#0AE7F2] text-black hover:bg-[#0AE7F2]/90 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"جاري التسجيل..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{size:20}),e.jsx("span",{children:"تسجيل المتدرب"})]})})]})]})]})]})})}function Ld(){const a=de(),[t,s]=m.useState(!0),r=()=>{s(!1),setTimeout(()=>{a("/trainee/login")},2e3)},n=()=>{a("/trainee/login")};return e.jsx(e.Fragment,{children:t&&e.jsx(Dd,{onSuccess:r,onCancel:n})})}function ys({url:a="https://mk-powerhouse.netlify.app",height:t="100%",width:s="100%",title:r="MK Fitness App",className:n="",allowFullscreen:i=!0,style:l}){const[o,c]=m.useState(t),[d,u]=m.useState(s);return m.useEffect(()=>{c(t),u(s)},[t,s]),e.jsx("div",{className:`iframe-container ${n}`,style:{overflow:"hidden",borderRadius:"12px",...l||{}},children:e.jsx("iframe",{src:a,height:o,width:d,title:r,frameBorder:"0",allow:"accelerometer; autoplay; camera; encrypted-media; geolocation; gyroscope; microphone; picture-in-picture",allowFullScreen:i,style:{border:"none",overflow:"hidden"}})})}function $d({onBack:a}){const[t,s]=m.useState("fullscreen"),[r,n]=m.useState(!1),[i,l]=m.useState("100%"),[o,c]=m.useState("600"),d=()=>{const x="https://mk-powerhouse.netlify.app";return t==="fullscreen"?`<iframe src="${x}/iframe.html" width="${i}" height="${o}" style="border: none; overflow: hidden;" allowfullscreen></iframe>`:t==="mobile"?`
<div style="background-color: #111; border-radius: 40px; padding: 10px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); max-width: 375px; margin: 0 auto; height: ${o}px; display: flex; flex-direction: column;">
  <div style="flex: 1; background-color: #0A0F1C; border-radius: 30px; overflow: hidden; position: relative;">
    <div style="position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background-color: #111; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; z-index: 10;"></div>
    <iframe src="${x}/iframe.html" style="width: 100%; height: 100%; border: none;" allowfullscreen></iframe>
  </div>
  <div style="width: 100px; height: 5px; background-color: #333; border-radius: 3px; margin: 10px auto 0;"></div>
</div>`:`
<div style="position: relative; padding-bottom: 177.78%; /* 16:9 aspect ratio for portrait mobile */ height: 0; overflow: hidden; max-width: 100%;">
  <iframe src="${x}/iframe.html" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" allowfullscreen></iframe>
</div>`},u=()=>{navigator.clipboard.writeText(d()),n(!0),setTimeout(()=>n(!1),2e3)};return e.jsx("div",{dir:"rtl",className:"min-h-screen bg-[#0A0F1C] text-white p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"تضمين تطبيق MK في موقعك"}),e.jsxs("div",{className:"bg-[#1A1F2E]/80 rounded-xl border border-[#0AE7F2]/20 p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"اختر نوع التضمين"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>s("fullscreen"),className:`p-4 rounded-xl flex flex-col items-center gap-2 transition-colors ${t==="fullscreen"?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx(Ir,{size:24}),e.jsx("span",{children:"شاشة كاملة"})]}),e.jsxs("button",{onClick:()=>s("mobile"),className:`p-4 rounded-xl flex flex-col items-center gap-2 transition-colors ${t==="mobile"?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx(Rr,{size:24}),e.jsx("span",{children:"محاكاة هاتف محمول"})]}),e.jsxs("button",{onClick:()=>s("responsive"),className:`p-4 rounded-xl flex flex-col items-center gap-2 transition-colors ${t==="responsive"?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx(qs,{size:24}),e.jsx("span",{children:"متجاوب مع الشاشة"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"العرض (بكسل أو %):"}),e.jsx("input",{type:"text",value:i,onChange:x=>l(x.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"الارتفاع (بكسل):"}),e.jsx("input",{type:"text",value:o,onChange:x=>c(x.target.value),className:"w-full bg-[#0A0F1C] border border-[#0AE7F2]/20 rounded-xl p-3 text-white focus:outline-none focus:border-[#0AE7F2]"})]})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/80 rounded-xl border border-[#0AE7F2]/20 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"معاينة"}),e.jsxs("button",{onClick:u,className:"bg-[#0AE7F2] text-black px-4 py-2 rounded-xl flex items-center gap-2 hover:bg-[#0AE7F2]/90 transition-colors",children:[r?e.jsx(He,{size:16}):e.jsx(Ur,{size:16}),e.jsx("span",{children:r?"تم النسخ!":"نسخ الكود"})]})]}),e.jsx("div",{className:"bg-[#0A0F1C] rounded-xl p-4 overflow-x-auto mb-6",children:e.jsx("pre",{className:"text-gray-400 text-sm whitespace-pre-wrap",children:d()})}),e.jsxs("div",{className:`preview-container ${t==="mobile"?"flex justify-center":""}`,style:{height:t==="responsive"?"400px":"600px"},children:[t==="fullscreen"&&e.jsx(ys,{url:"https://mk-powerhouse.netlify.app/iframe.html",height:"100%",width:"100%"}),t==="mobile"&&e.jsxs("div",{className:"device-frame",style:{backgroundColor:"#111",borderRadius:"40px",padding:"10px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.5)",maxWidth:"375px",height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{flex:1,backgroundColor:"#0A0F1C",borderRadius:"30px",overflow:"hidden",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",width:"150px",height:"30px",backgroundColor:"#111",borderBottomLeftRadius:"15px",borderBottomRightRadius:"15px",zIndex:10}}),e.jsx(ys,{url:"https://mk-powerhouse.netlify.app/iframe.html",height:"100%",width:"100%"})]}),e.jsx("div",{style:{width:"100px",height:"5px",backgroundColor:"#333",borderRadius:"3px",margin:"10px auto 0"}})]}),t==="responsive"&&e.jsx("div",{style:{position:"relative",paddingBottom:"177.78%",height:0,overflow:"hidden",maxWidth:"100%"},children:e.jsx(ys,{url:"https://mk-powerhouse.netlify.app/iframe.html",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}})})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/80 rounded-xl border border-[#0AE7F2]/20 p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"تعليمات التضمين"}),e.jsxs("div",{className:"space-y-4 text-gray-300",children:[e.jsx("p",{children:"1. انسخ كود التضمين أعلاه."}),e.jsx("p",{children:"2. الصق الكود في صفحة موقعك حيث تريد أن يظهر التطبيق."}),e.jsx("p",{children:"3. يمكنك تعديل العرض والارتفاع حسب احتياجاتك."}),e.jsx("p",{children:'4. للحصول على أفضل تجربة، نوصي باستخدام خيار "محاكاة هاتف محمول" للمواقع العادية وخيار "متجاوب مع الشاشة" للمواقع المتجاوبة.'})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:a,className:"bg-[#0AE7F2] text-black px-6 py-3 rounded-xl font-medium hover:bg-[#0AE7F2]/90 transition-colors",children:"العودة"})})]})]})})}function _r({url:a="https://mk-powerhouse.netlify.app",width:t="100%",height:s="100%",showDeviceFrame:r=!0,className:n=""}){const[i,l]=m.useState(!0),o=m.useRef(null);return m.useEffect(()=>{const c=()=>{setTimeout(()=>{l(!1)},1e3)},d=o.current;return d&&d.addEventListener("load",c),()=>{d&&d.removeEventListener("load",c)}},[]),r?e.jsxs("div",{className:`device-frame ${n}`,style:{maxWidth:"375px",margin:"0 auto",height:typeof s=="string"?s:`${s}px`,background:"#111",borderRadius:"40px",padding:"10px",boxShadow:"0 0 30px rgba(0, 0, 0, 0.5)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{className:"device-screen",style:{flex:1,background:"#0A0F1C",borderRadius:"30px",overflow:"hidden",position:"relative"},children:[e.jsx("div",{className:"device-notch",style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",width:"150px",height:"30px",background:"#111",borderBottomLeftRadius:"15px",borderBottomRightRadius:"15px",zIndex:10}}),i&&e.jsxs("div",{className:"loading",style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#0A0F1C",color:"white",zIndex:5},children:[e.jsx("img",{src:"https://souqpale.com/wp-content/uploads/2025/03/تصميم-بدون-عنوان-9.png",alt:"Logo",style:{width:"80px",height:"auto",marginBottom:"20px"}}),e.jsx("div",{className:"spinner",style:{width:"30px",height:"30px",border:"3px solid rgba(10, 231, 242, 0.3)",borderRadius:"50%",borderTopColor:"#0AE7F2",animation:"spin 1s ease-in-out infinite"}})]}),e.jsx("iframe",{ref:o,src:a,style:{width:"100%",height:"100%",border:"none"},allow:"accelerometer; autoplay; camera; encrypted-media; geolocation; gyroscope; microphone; picture-in-picture",allowFullScreen:!0})]}),e.jsx("div",{className:"device-home",style:{width:"100px",height:"5px",background:"#333",borderRadius:"3px",margin:"10px auto 0"}})]}):e.jsxs("div",{className:`responsive-container ${n}`,style:{position:"relative",paddingBottom:"177.78%",height:0,overflow:"hidden",maxWidth:"100%"},children:[i&&e.jsxs("div",{className:"loading",style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#0A0F1C",color:"white",zIndex:5},children:[e.jsx("img",{src:"https://souqpale.com/wp-content/uploads/2025/03/تصميم-بدون-عنوان-9.png",alt:"Logo",style:{width:"80px",height:"auto",marginBottom:"20px"}}),e.jsx("div",{className:"spinner",style:{width:"30px",height:"30px",border:"3px solid rgba(10, 231, 242, 0.3)",borderRadius:"50%",borderTopColor:"#0AE7F2",animation:"spin 1s ease-in-out infinite"}})]}),e.jsx("iframe",{ref:o,src:a,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"},allow:"accelerometer; autoplay; camera; encrypted-media; geolocation; gyroscope; microphone; picture-in-picture",allowFullScreen:!0})]})}function Id({onBack:a}){const t=de(),[s,r]=m.useState("mobile"),[n,i]=m.useState(!1),l=()=>{const d="https://mk-powerhouse.netlify.app";return s==="fullscreen"?`<iframe src="${d}" width="100%" height="600px" style="border: none; overflow: hidden;" allowfullscreen></iframe>`:s==="mobile"?`
<div style="background-color: #111; border-radius: 40px; padding: 10px; box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); max-width: 375px; margin: 0 auto; height: 700px; display: flex; flex-direction: column;">
  <div style="flex: 1; background-color: #0A0F1C; border-radius: 30px; overflow: hidden; position: relative;">
    <div style="position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background-color: #111; border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; z-index: 10;"></div>
    <iframe src="${d}" style="width: 100%; height: 100%; border: none;" allowfullscreen></iframe>
  </div>
  <div style="width: 100px; height: 5px; background-color: #333; border-radius: 3px; margin: 10px auto 0;"></div>
</div>`:`
<div style="position: relative; padding-bottom: 177.78%; /* 16:9 aspect ratio for portrait mobile */ height: 0; overflow: hidden; max-width: 100%;">
  <iframe src="${d}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" allowfullscreen></iframe>
</div>`},o=()=>{navigator.clipboard.writeText(l()),i(!0),setTimeout(()=>i(!1),2e3)},c=()=>{a?a():t(-1)};return e.jsxs("div",{dir:"rtl",className:"min-h-screen bg-[#0A0F1C] text-white",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-[#1A1F2E]/80 backdrop-blur-lg border-b border-[#0AE7F2]/20",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:c,className:"w-10 h-10 bg-[#1A1F2E]/60 backdrop-blur-sm rounded-xl flex items-center justify-center hover:bg-[#1A1F2E]/80 transition-colors border border-[#0AE7F2]",children:e.jsx(me,{size:20,className:"text-[#0AE7F2]"})}),e.jsx("h1",{className:"text-xl font-bold",children:"تضمين صفحة تسجيل الدخول"}),e.jsx("div",{className:"w-10"})]})})}),e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-[#1A1F2E]/80 rounded-xl border border-[#0AE7F2]/20 p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"اختر نوع التضمين"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>r("fullscreen"),className:`p-4 rounded-xl flex flex-col items-center gap-2 transition-colors ${s==="fullscreen"?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx(Ya,{size:24}),e.jsx("span",{children:"شاشة كاملة"})]}),e.jsxs("button",{onClick:()=>r("mobile"),className:`p-4 rounded-xl flex flex-col items-center gap-2 transition-colors ${s==="mobile"?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx(Rr,{size:24}),e.jsx("span",{children:"محاكاة هاتف محمول"})]}),e.jsxs("button",{onClick:()=>r("responsive"),className:`p-4 rounded-xl flex flex-col items-center gap-2 transition-colors ${s==="responsive"?"bg-[#0AE7F2]/20 border-[#0AE7F2] text-[#0AE7F2]":"bg-[#0A0F1C] border-[#0AE7F2]/20 hover:bg-[#0AE7F2]/10"} border`,children:[e.jsx(Ir,{size:24}),e.jsx("span",{children:"متجاوب مع الشاشة"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-[#1A1F2E]/80 rounded-xl border border-[#0AE7F2]/20 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"معاينة"}),e.jsxs("button",{onClick:o,className:"bg-[#0AE7F2] text-black px-4 py-2 rounded-xl flex items-center gap-2 hover:bg-[#0AE7F2]/90 transition-colors",children:[n?e.jsx(He,{size:16}):e.jsx(Ur,{size:16}),e.jsx("span",{children:n?"تم النسخ!":"نسخ الكود"})]})]}),e.jsxs("div",{className:"preview-container",style:{height:"600px"},children:[s==="fullscreen"&&e.jsx("iframe",{src:"https://mk-powerhouse.netlify.app",width:"100%",height:"100%",style:{border:"none",borderRadius:"12px",overflow:"hidden"},allow:"accelerometer; autoplay; camera; encrypted-media; geolocation; gyroscope; microphone; picture-in-picture",allowFullScreen:!0}),s==="mobile"&&e.jsx(_r,{showDeviceFrame:!0,height:600}),s==="responsive"&&e.jsx(_r,{showDeviceFrame:!1,height:600})]})]}),e.jsxs("div",{className:"bg-[#1A1F2E]/80 rounded-xl border border-[#0AE7F2]/20 p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"كود التضمين"}),e.jsx("div",{className:"bg-[#0A0F1C] rounded-xl p-4 overflow-x-auto mb-6",children:e.jsx("pre",{className:"text-gray-400 text-sm whitespace-pre-wrap",children:l()})}),e.jsx("h3",{className:"text-lg font-bold mb-2",children:"تعليمات التضمين"}),e.jsxs("ul",{className:"space-y-2 text-gray-300 list-disc list-inside",children:[e.jsx("li",{children:"انسخ كود التضمين أعلاه والصقه في صفحة موقعك."}),e.jsxs("li",{children:["تأكد من إضافة الوسوم التالية إلى رؤوس HTTP الخاصة بموقعك للسماح بتضمين الإطار:",e.jsxs("ul",{className:"list-disc list-inside mr-4 mt-1",children:[e.jsx("li",{children:e.jsx("code",{children:"X-Frame-Options: ALLOWALL"})}),e.jsx("li",{children:e.jsx("code",{children:"Content-Security-Policy: frame-ancestors *;"})})]})]}),e.jsx("li",{children:"يمكنك تعديل العرض والارتفاع حسب احتياجاتك."}),e.jsx("li",{children:'للحصول على أفضل تجربة، نوصي باستخدام خيار "محاكاة هاتف محمول" للمواقع العادية وخيار "متجاوب مع الشاشة" للمواقع المتجاوبة.'})]}),e.jsxs("div",{className:"mt-6 p-4 bg-[#0AE7F2]/10 rounded-xl border border-[#0AE7F2]/20",children:[e.jsx("h3",{className:"font-bold mb-2 text-[#0AE7F2]",children:"ملاحظة هامة"}),e.jsxs("p",{className:"text-gray-300",children:["لتضمين التطبيق بشكل صحيح، يجب أن يكون لديك ملف ",e.jsx("code",{children:"_headers"})," في مجلد ",e.jsx("code",{children:"public"})," يحتوي على الإعدادات المناسبة للسماح بتضمين الإطار."]})]})]})]})]})]})}function Rd(){const[a,t]=m.useState(()=>localStorage.getItem("userType"));m.useEffect(()=>{Js()},[]);const s=r=>{t(r),localStorage.setItem("userType",r)};return e.jsx(Xa,{children:e.jsxs(er,{children:[e.jsx(fe,{path:"/",element:a?e.jsx(Te,{to:a==="admin"?"/admin":"/trainee",replace:!0}):e.jsx(vo,{onRegister:()=>{},onSuccess:()=>s("user")})}),e.jsx(fe,{path:"/admin/login",element:a?e.jsx(Te,{to:a==="admin"?"/admin":"/trainee",replace:!0}):e.jsx(Za,{onRegister:()=>{},onSuccess:()=>s("admin")})}),e.jsx(fe,{path:"/trainee/login",element:e.jsx(Te,{to:"/",replace:!0})}),e.jsx(fe,{path:"/trainee/register",element:a?e.jsx(Te,{to:a==="admin"?"/admin":"/trainee",replace:!0}):e.jsx(Ld,{})}),e.jsx(fe,{path:"/reset-password",element:e.jsx(Od,{onBack:()=>{}})}),e.jsx(fe,{path:"/reset-password-confirmation",element:e.jsx(zd,{})}),e.jsx(fe,{path:"/embed",element:e.jsx($d,{onBack:()=>{}})}),e.jsx(fe,{path:"/login-embed",element:e.jsx(Id,{onBack:()=>{}})}),e.jsx(fe,{path:"/admin",element:a?a==="admin"?e.jsx(Sd,{onBack:()=>{}}):e.jsx(Te,{to:"/",replace:!0}):e.jsx(Te,{to:"/admin/login",replace:!0})}),e.jsx(fe,{path:"/admin/notifications",element:a==="admin"?e.jsx(Cd,{onBack:()=>{}}):e.jsx(Te,{to:"/admin/login",replace:!0})}),e.jsx(fe,{path:"/admin/chat",element:a==="admin"?e.jsx(Pd,{onBack:()=>{}}):e.jsx(Te,{to:"/admin/login",replace:!0})}),e.jsx(fe,{path:"/admin/trainer-chat",element:a==="admin"?e.jsx(Td,{onBack:()=>{}}):e.jsx(Te,{to:"/admin/login",replace:!0})}),e.jsx(fe,{path:"/trainee/*",element:a==="user"?e.jsxs(er,{children:[e.jsx(fe,{path:"/",element:e.jsx(fc,{onProfileClick:()=>{},onWeightClick:()=>{},onExerciseProgramClick:()=>{},onDietProgramClick:()=>{},onAdminInfoClick:()=>{}})}),e.jsx(fe,{path:"weight",element:e.jsx(bc,{onBack:()=>{},onCaloriesRateClick:()=>{}})}),e.jsx(fe,{path:"calories",element:e.jsx(vc,{onBack:()=>{}})}),e.jsx(fe,{path:"exercise",element:e.jsx(Vc,{onBack:()=>{}})}),e.jsx(fe,{path:"diet",element:e.jsx(Jc,{onBack:()=>{},onMealClick:()=>{}})}),e.jsx(fe,{path:"profile",element:e.jsx(Xc,{onBack:()=>{}})}),e.jsx(fe,{path:"chat",element:e.jsx(Md,{onBack:()=>{}})}),e.jsx(fe,{path:"contact",element:e.jsx(Zc,{onBack:()=>{}})}),e.jsx(fe,{path:"notifications",element:e.jsx(Aa,{onBack:()=>{}})}),e.jsx(fe,{path:"steps",element:e.jsx(Fa,{onBack:()=>{}})})]}):e.jsx(Te,{to:"/",replace:!0})}),e.jsx(fe,{path:"*",element:e.jsx(Te,{to:"/",replace:!0})})]})})}function Ud(a={}){const{immediate:t=!1,onNeedRefresh:s,onOfflineReady:r,onRegistered:n,onRegisteredSW:i,onRegisterError:l}=a;let o,c;const d=async(x=!0)=>{await c};async function u(){if("serviceWorker"in navigator){if(o=await lt(async()=>{const{Workbox:x}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:x}},[]).then(({Workbox:x})=>new x("/sw.js",{scope:"/",type:"classic"})).catch(x=>{l==null||l(x)}),!o)return;o.addEventListener("activated",x=>{(x.isUpdate||x.isExternal)&&window.location.reload()}),o.addEventListener("installed",x=>{x.isUpdate||r==null||r()}),o.register({immediate:t}).then(x=>{i?i("/sw.js",x):n==null||n(x)}).catch(x=>{l==null||l(x)})}}return c=u(),d}const Wd=Ud({onNeedRefresh(){confirm("تحديث جديد متاح. هل ترغب في التحديث؟")&&Wd()},onOfflineReady(){console.log("التطبيق جاهز للعمل بدون إنترنت")}});Wr(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(Rd,{})}));
